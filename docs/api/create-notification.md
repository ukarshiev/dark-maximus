> Обновлено: 24.09.2025

# API: Ручная отправка уведомления о скором окончании подписки

## Эндпоинт
- Метод: `POST`
- Путь: `/create-notification`
- Аутентификация: админская сессия (`session` cookie)
- Заголовки: `Content-Type: application/json`

## Тело запроса
```json
{
  "user_id": 123456789,
  "marker_hours": 24
}
```
- `user_id` (int, обязательно): Telegram ID пользователя.
- `marker_hours` (int, обязательно): один из значений `1`, `24`, `48`, `72` — сколько часов осталось до окончания подписки в тексте уведомления.

## Ответы

### 200 OK
```json
{ "message": "Уведомление отправлено" }
```

### 400 Bad Request
```json
{ "message": "Некорректные данные: выберите пользователя и тип уведомления" }
```
или
```json
{ "message": "У пользователя нет активных ключей с будущей датой истечения" }
```

### 503 Service Unavailable
```json
{ "message": "Бот не запущен. Запустите бота на панели и повторите." }
```

### 500 Internal Server Error
```json
{ "message": "Внутренняя ошибка сервера" }
```

## Поведение
- Эндпоинт ищет у пользователя активный VPN-ключ с ближайшей датой истечения и запускает отправку уведомления через Telegram-бота.
- Текст уведомления содержит отметку времени до окончания согласно `marker_hours`, а дата окончания берётся из ключа (при рассинхронизации используется ближайшее значение в будущем).
- Отправка происходит асинхронно; запись об уведомлении фиксируется в таблице `notifications` со статусом `sent`.

## Пример CURL
```bash
curl -X POST "http://localhost:1488/create-notification" \
  -H "Content-Type: application/json" \
  -b "session=<admin-session-cookie>" \
  -d '{"user_id":123456789, "marker_hours":24}'
```


