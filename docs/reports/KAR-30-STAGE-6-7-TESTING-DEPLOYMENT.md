# KAR-30 –≠—Ç–∞–ø 6-7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

**–î–∞—Ç–∞:** 07.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (–≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é)  
**Linear:** https://linear.app/karshiev/issue/KAR-30

---

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ 8 integration —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (17/17)
- ‚úÖ –í—Å–µ integration —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (8/8)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å–≤–æ–¥–∫–∞ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚è≥ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚è≥ –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ (4+ –¥–Ω—è)

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã (test_timezone_utils.py)
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 17/17 –ø—Ä–æ–π–¥–µ–Ω–æ

**–û—Ö–≤–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:**
1. `ensure_utc_datetime()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ UTC
2. `timestamp_to_utc_datetime()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è timestamp
3. `format_datetime_moscow()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Moscow
4. `format_datetime_for_user()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å timezone
5. `get_current_utc_naive()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ UTC
6. `get_moscow_now()` - –ø–æ–ª—É—á–µ–Ω–∏–µ Moscow –≤—Ä–µ–º–µ–Ω–∏
7. `calculate_remaining_seconds()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**
```bash
python tests/test_timezone_utils.py
```

---

### Integration —Ç–µ—Å—Ç—ã (test_timezone_integration.py)
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 8/8 –ø—Ä–æ–π–¥–µ–Ω–æ

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

#### ‚úÖ –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ UTC –≤ –ë–î
- –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–ª—é—á–æ–º (—Å—Ä–æ–∫ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `expiry_date` –≤ –ë–î –±–µ–∑ tzinfo (naive UTC)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞—Ç—ã (¬±1 —Å–µ–∫—É–Ω–¥–∞)

#### ‚úÖ –¢–µ—Å—Ç 2: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –°–æ–∑–¥–∞—ë—Ç –∫–ª—é—á —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ 1 —á–∞—Å
- –í—ã—á–∏—Å–ª—è–µ—Ç `remaining_seconds` (~3600)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ–≤—Ä–µ–º—è

#### ‚úÖ –¢–µ—Å—Ç 3: –°–º–µ–Ω–∞ timezone ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è Moscow (15:00 –ø—Ä–∏ 12:00 UTC)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è Yekaterinburg (–Ω–∞ Windows fallback –Ω–∞ Moscow)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è UTC

#### ‚úÖ –¢–µ—Å—Ç 4: Feature flag –≤—ã–∫–ª—é—á–µ–Ω ‚Üí Moscow
- –ü—Ä–∏ `feature_enabled=False` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç `user_timezone`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Moscow –≤—Ä–µ–º—è

#### ‚úÖ –¢–µ—Å—Ç 5: –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –∑–∞ 1 —á–∞—Å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `expiry_date` –≤ UTC

#### ‚úÖ –¢–µ—Å—Ç 6: –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚Üí —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏
- –°—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏) —Ä–∞–±–æ—Ç–∞—é—Ç
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º timezone

#### ‚úÖ –¢–µ—Å—Ç 7: –ì—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π ‚Üí –∏—Å—Ç–µ–∫—à–∏–π –∫–ª—é—á
- –î–ª—è –∏—Å—Ç–µ–∫—à–µ–≥–æ –∫–ª—é—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Å–µ–∫—É–Ω–¥

#### ‚úÖ –¢–µ—Å—Ç 8: –ì—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π ‚Üí –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π timezone
- Fallback –Ω–∞ Moscow –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º timezone

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**
```bash
python tests/test_timezone_integration.py
```

---

## üìù –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã

### 1. Integration —Ç–µ—Å—Ç—ã
**–§–∞–π–ª:** `tests/test_timezone_integration.py`
- 8 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ lifecycle: —Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 2. –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ –ë–î
**–§–∞–π–ª:** `tests/backup_before_timezone_migration.py`
- –°–æ–∑–¥–∞—ë—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å (—Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞)
- –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é

### 3. –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
**–§–∞–π–ª:** `docs/guides/deployment/timezone-rollout-checklist.md`
- –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (4+ –¥–Ω—è)
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
- Rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 4. –°–≤–æ–¥–∫–∞ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–§–∞–π–ª:** `docs/guides/deployment/timezone-testing-summary.md`
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä—É—á–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- Rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏

---

## üöÄ –ü–ª–∞–Ω —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

### –î–µ–Ω—å 1: –î–µ–ø–ª–æ–π –∫–æ–¥–∞ (feature_flag = 0)
**–¶–µ–ª—å:** –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥ –±–µ–∑ –≤–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î: `python tests/backup_before_timezone_migration.py`
2. –î–µ–ø–ª–æ–π –∫–æ–¥–∞: `npx nx build bot && npx nx serve bot`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –î–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Moscow –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤–æ–≤—Ä–µ–º—è

---

### –î–µ–Ω—å 2: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É timezone –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É: `python tests/add_timezone_column.py`
2. Dry-run –º–∏–≥—Ä–∞—Ü–∏–∏: `python tests/migrate_expiry_dates_to_utc.py --dry-run`
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `python tests/migrate_expiry_dates_to_utc.py --apply`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: `SELECT user_id, key, expiry_date, timezone FROM users LIMIT 10;`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ timezone –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –í—Å–µ –¥–∞—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ UTC
- ‚úÖ –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

### –î–µ–Ω—å 3: –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
**–¶–µ–ª—å:** –í–∫–ª—é—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–∫–ª—é—á–∏—Ç—å feature flag: `UPDATE bot_settings SET value = '1' WHERE key = 'feature_timezone_enabled';`
2. –ü–æ–ø—Ä–æ—Å–∏—Ç—å —Ç–µ—Å—Ç–µ—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π
   - –°–º–µ–Ω—É timezone
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –¢–µ—Å—Ç–µ—Ä—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –∂–∞–ª–æ–± –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤–æ–≤—Ä–µ–º—è

---

### –î–µ–Ω—å 4+: –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
**–¶–µ–ª—å:** –í–∫–ª—é—á–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ (24-48 —á–∞—Å–æ–≤):
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–¥–æ–ª–∂–Ω–æ = 0)
   - –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç–æ—á–Ω–æ—Å—Ç—å ¬±1 –º–∏–Ω—É—Ç–∞)
   - –û—à–∏–±–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timezone (–≤ –ª–æ–≥–∞—Ö)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `npx nx logs bot | grep -i "timezone\|expiry\|notification"`
3. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –≤ –Ω–æ—Ä–º–µ
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∂–∞–ª—É—é—Ç—Å—è

---

## üîÑ Rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –£—Ä–æ–≤–µ–Ω—å 1: –í—ã–∫–ª—é—á–∏—Ç—å feature flag (–±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ)
```sql
UPDATE bot_settings SET value = '0' WHERE key = 'feature_timezone_enabled';
```
**–≠—Ñ—Ñ–µ–∫—Ç:** –í–æ–∑–≤—Ä–∞—Ç –∫ legacy —Ä–µ–∂–∏–º—É (Moscow –¥–ª—è –≤—Å–µ—Ö)

### –£—Ä–æ–≤–µ–Ω—å 2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î (–µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ)
```bash
npx nx stop bot
cp users_backup_YYYYMMDD_HHMMSS.db users.db
npx nx serve bot
```

### –£—Ä–æ–≤–µ–Ω—å 3: –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–¥ (–∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π)
```bash
git revert <commit_hash>
git push
# –ü–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö (–¥–æ–ª–∂–Ω–æ = 0)
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–¥–µ—Ä–∂–∫–∏ (< 1 –º–∏–Ω—É—Ç–∞)

2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è timezone**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ (–¥–æ–ª–∂–Ω–æ = 0)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ fallback –Ω–∞ Moscow

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è scheduler (< 1 —Å–µ–∫—É–Ω–¥–∞)
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞ 6-7

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] Unit —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã (17/17)
- [x] Integration —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã (8/8)
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- [x] –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ –ë–î —Å–æ–∑–¥–∞–Ω
- [x] –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã
- [x] –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω
- [x] –°–≤–æ–¥–∫–∞ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–æ–∑–¥–∞–Ω–∞
- [x] Rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã

### –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- [ ] –î–µ–Ω—å 1: –î–µ–ø–ª–æ–π –∫–æ–¥–∞
- [ ] –î–µ–Ω—å 2: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- [ ] –î–µ–Ω—å 3: –¢–µ—Å—Ç–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
- [ ] –î–µ–Ω—å 4+: –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
- [ ] –ó–∞–¥–∞—á–∞ KAR-30 –∑–∞–∫—Ä—ã—Ç–∞ –≤ Linear

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
1. **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ 1 —á–∞—Å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
   - –î–æ–∂–¥–∞—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   - –°–º–µ–Ω–∏—Ç—å timezone

### –î–µ–Ω—å 1 (—Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è)
2. **–°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î**
   ```bash
   python tests/backup_before_timezone_migration.py
   ```

3. **–î–µ–ø–ª–æ–π –∫–æ–¥–∞**
   ```bash
   git checkout main
   git pull
   npx nx build bot
   npx nx serve bot
   ```

---

## üìö –°—Å—ã–ª–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã

- **Linear –∑–∞–¥–∞—á–∞:** https://linear.app/karshiev/issue/KAR-30
- **–ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** `.cursor/plans/timezone-support-production-safe.plan.md`
- **–ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è:** `docs/guides/deployment/timezone-rollout-checklist.md`
- **–°–≤–æ–¥–∫–∞ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:** `docs/guides/deployment/timezone-testing-summary.md`
- **Unit —Ç–µ—Å—Ç—ã:** `tests/test_timezone_utils.py`
- **Integration —Ç–µ—Å—Ç—ã:** `tests/test_timezone_integration.py`
- **–°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞:** `tests/backup_before_timezone_migration.py`

---

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–≠—Ç–∞–ø 6-7 —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!**

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã —Ü–µ–ª–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ 8 integration —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (25/25)
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã rollback —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é!

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ—ç—Ç–∞–ø–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 07.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

