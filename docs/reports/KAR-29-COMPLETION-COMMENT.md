# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –∑–∞–¥–∞—á–∏ KAR-29

## ‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 15.11.2025 05:00  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 4.18.1

---

## üìä –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Allure Framework –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Dark Maximus. –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–æ–≤ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã

### –≠—Ç–∞–ø 1: –†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ (`tests/unit/`, `tests/integration/`, `tests/e2e/`, `tests/ad-hoc/` —Å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞–º–∏)
- ‚úÖ –í—Å–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `tests/ad-hoc/` —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –ø–æ —Ç–∏–ø–∞–º
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ –ø–µ—Ä–µ–¥–µ–ª–∞–Ω—ã –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î
- ‚úÖ –°–æ–∑–¥–∞–Ω `conftest.py` —Å —Ñ–∏–∫—Å—Ç—É—Ä–æ–π `temp_db` –∏ –±–∞–∑–æ–≤—ã–º–∏ –º–æ–∫–∞–º–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω `pytest.ini`

### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_utils/test_deeplink.py` - —Ç–µ—Å—Ç—ã –¥–ª—è —É—Ç–∏–ª–∏—Ç deeplink
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_security/test_validators.py` - —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_database/test_user_operations.py` - —Ç–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_database/test_promo_code_operations.py` - —Ç–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_database/test_transaction_operations.py` - —Ç–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç—ã –±–æ—Ç–∞ —Å –º–æ–∫–∞–º–∏ ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_bot/test_handlers.py` - —Ç–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–æ—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_bot/test_promo_code_logic.py` - —Ç–µ—Å—Ç—ã –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/unit/test_bot/test_keyboard_generation.py` - —Ç–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/integration/test_deeplink_flow.py` - —Ç–µ—Å—Ç—ã flow deeplink
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/integration/test_deeplink_integration.py` - —Ç–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ deeplink
- ‚úÖ –°–æ–∑–¥–∞–Ω `tests/integration/test_timezone_integration.py` - —Ç–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ timezone

### –≠—Ç–∞–ø 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Allure Framework ‚úÖ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pyproject.toml` (pytest, allure-pytest, faker –∏ –¥—Ä.)
- ‚úÖ –°–æ–∑–¥–∞–Ω `Dockerfile.tests` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π Allure CLI (–≤–µ—Ä—Å–∏—è 2.24.1)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã `monitoring` –∏ `allure-service` –≤ `docker-compose.yml`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω `pytest.ini` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Allure Framework
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤: `tests/run_tests.sh` –∏ `tests/run_tests.ps1`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –¥–ª—è `tests.dark-maximus.com` (HTTP –∏ HTTPS)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω `deploy/nginx/dark-maximus.conf.tpl` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–¥–æ–º–µ–Ω–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `install-autotest.sh` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è ‚úÖ
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ COPY –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `Dockerfile.tests` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–∞
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å `tests` ‚Üí `monitoring` ‚Üí `autotest` –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
- ‚úÖ **Passed:** 103 —Ç–µ—Å—Ç–∞
- ‚ùå **Failed:** 15 —Ç–µ—Å—Ç–æ–≤
- ‚ö†Ô∏è **Broken:** 14 —Ç–µ—Å—Ç–æ–≤
- üì¶ **Total:** 132 —Ç–µ—Å—Ç–∞
- üìÅ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** 308 JSON —Ñ–∞–π–ª–æ–≤ –≤ `allure-results/`

---

## üåê –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

### –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **Swagger UI (API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è):** `http://localhost:50005`
- **Allure Reports:** `http://localhost:50005/allure-docker-service/projects/default/reports/latest/index.html`

### –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)
- `https://tests.dark-maximus.com/allure-docker-service/projects/default/reports/latest/index.html`

---

## üìÅ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `Dockerfile.tests` - Dockerfile –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
- `install-autotest.sh` - —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
- `tests/conftest.py` - –æ–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã pytest
- `pytest.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest —Å Allure
- `tests/run_tests.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (bash)
- `tests/run_tests.ps1` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (PowerShell)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–∞—Ö

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `docker-compose.yml` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã `autotest` –∏ `allure-service`
- `pyproject.toml` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–µ—Ä—Å–∏—è 4.18.1)
- `nginx/nginx.conf` –∏ `nginx/nginx-ssl.conf` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è `tests.dark-maximus.com`
- `deploy/nginx/dark-maximus.conf.tpl` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–¥–æ–º–µ–Ω–∞
- `.cursor/rules/rights-rules.mdc` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- `CHANGELOG.md` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–ø–∏—Å–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
docker compose exec autotest pytest

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã
docker compose exec autotest pytest tests/unit/ -m unit

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
docker compose exec autotest pytest tests/integration/ -m integration

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
sudo ./install-autotest.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Allure Service
docker compose logs -f allure-service
```

---

## üîí –ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î (–Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç `users.db`)  
‚úÖ –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Telegram, XUI, –ø–ª–∞—Ç–µ–∂–∏) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –¢–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö  
‚úÖ –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è - —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## üìù –û—Ç—á–µ—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `docs/reports/KAR-29-AUTOTEST-IMPLEMENTATION-PLAN.md`
- **–ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** `.cursor/plans/dark-maximus-0223f44d-eb265aa0.plan.md`
- **Changelog:** `CHANGELOG.md` (–≤–µ—Ä—Å–∏–∏ 4.18.0 –∏ 4.18.1)

---

## ‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- **–≠—Ç–∞–ø 6:** –°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **–≠—Ç–∞–ø 8:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

---

**–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Allure –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.** ‚úÖ

