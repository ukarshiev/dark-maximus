# –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

> **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 17.11.2025  
> **–í–µ—Ä—Å–∏—è:** 4.21.6

## üìã –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ "–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞". –û–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —à–∞–±–ª–æ–Ω–æ–≤, —Ç–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫, —Å–ø–æ—Å–æ–±—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–æ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Allure.

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ "–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞" —Å–æ–¥–µ—Ä–∂–∏—Ç —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–∞—Ö, –ø–æ–∫—É–ø–∫–∞—Ö –∏ –¥—Ä—É–≥–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram Bot API.

## üîç –¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–≥–æ–≤ `<br>`

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram Bot API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–≥ `<br>` –≤ HTML-—Ä–∞–∑–º–µ—Ç–∫–µ.

**–û—à–∏–±–∫–∞:** `can't parse entities: Unsupported start tag 'br'`

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã `<br>`, `<br/>`, `<br />`, `<BR>` –Ω–∞ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏ `\n`.

**–ü—Ä–∏–º–µ—Ä:**
```html
<!-- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ -->
<b>–¢–µ–∫—Å—Ç</b><br>–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞

<!-- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ -->
<b>–¢–µ–∫—Å—Ç</b>\n–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —à–∞–±–ª–æ–Ω–∞—Ö –º–æ–≥—É—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- `{fallback_text}` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–¥–∞
- `{cabinet_text}` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ –ë–î.

**–í–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- `{key_number}` - –Ω–æ–º–µ—Ä –∫–ª—é—á–∞
- `{expiry_formatted}` - –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
- `{created_formatted}` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (–æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
- `{connection_string}` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è VLESS
- `{subscription_link}` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
- `{cabinet_url}` - URL –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- `{status_icon}` - –∏–∫–æ–Ω–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `{status_text}` - —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
- –ò –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Å–ª–æ–≤–∞—Ä—è `template_variables` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_message_text()`

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è HTML-—Ç–µ–≥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä HTML-—Ç–µ–≥–æ–≤.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–≥–∏:**
- `<b>` - –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
- `<i>` - –∫—É—Ä—Å–∏–≤
- `<u>` - –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
- `<s>` - –∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
- `<a href="...">` - —Å—Å—ã–ª–∫–∞
- `<code>` - –∫–æ–¥
- `<pre>` - –ø—Ä–µ–¥—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- `<blockquote>` - —Ü–∏—Ç–∞—Ç–∞

**–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–≥–∏:**
- `<br>` - –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `\n`)
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ HTML-—Ç–µ–≥–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `InputValidator.validate_html_tags()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ç–µ–≥–æ–≤.

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –®–∞–±–ª–æ–Ω —Å –ø—É—Å—Ç—ã–º `template_text` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–∫—Å—Ç.

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: `tools/check_templates.py`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python tools/check_templates.py
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:
  - –ó–∞–º–µ–Ω–∞ `<br>` –Ω–∞ `\n`
  - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
================================================================================
–ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ '–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞'
================================================================================

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –í—Å–µ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤: 5
   –ê–∫—Ç–∏–≤–Ω—ã—Ö: 5
   –ö–∞—Ç–µ–≥–æ—Ä–∏–π: 1

üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ 5 —à–∞–±–ª–æ–Ω–æ–≤...

‚úÖ –í—Å–µ —à–∞–±–ª–æ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã!
```

### Unit-—Ç–µ—Å—Ç—ã: `tests/unit/test_utils/test_template_validation.py`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Allure.

**–¢–µ—Å—Ç—ã:**
1. `test_all_active_templates_are_valid` - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
2. `test_no_br_tags_in_templates` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–µ–≥–æ–≤ `<br>`
3. `test_no_invalid_variables_in_templates` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–ó–∞–ø—É—Å–∫:**
```bash
# –ß–µ—Ä–µ–∑ Docker
docker compose exec autotest pytest tests/unit/test_utils/test_template_validation.py -v --alluredir=allure-results

# –õ–æ–∫–∞–ª—å–Ω–æ
pytest tests/unit/test_utils/test_template_validation.py -v --alluredir=allure-results
```

## üìä –û—Ç—á–µ—Ç—ã Allure

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á–µ—Ç–∞

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:

1. **–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞:**
   - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
   - –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å
   - –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

2. **–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞

3. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ (TEXT, JSON)
   - –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (JSON)
   - –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ (TEXT, HTML, JSON)
   - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç (TEXT, JSON)

### –¢–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–¢–µ–≥–∏:**
- `templates` - —Ç–µ—Å—Ç—ã —à–∞–±–ª–æ–Ω–æ–≤
- `validation` - –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `database` - —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- `unit` - unit-—Ç–µ—Å—Ç—ã
- `critical` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏
- `message-templates` - —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- `html-validation` - –≤–∞–ª–∏–¥–∞—Ü–∏—è HTML
- `br-tag` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–≥–æ–≤ `<br>`
- `template-variables` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- `html` - HTML-—Ä–∞–∑–º–µ—Ç–∫–∞
- `telegram-api` - Telegram Bot API

**Severity:** `CRITICAL` - –≤—Å–µ —Ç–µ—Å—Ç—ã –∏–º–µ—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏

**Epic:** "–í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤"

**Feature:** "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ '–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞'"

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `tools/check_templates.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç:
- –¢–µ–≥–∏ `<br>` ‚Üí –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `\n`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Üí —É–¥–∞–ª—è—é—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä:**
```bash
python tools/check_templates.py
```

### –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. **–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏" ‚Üí "–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞"
   - –ù–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —à–∞–±–ª–æ–Ω
   - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

2. **–ß–µ—Ä–µ–∑ SQL:**
   ```sql
   UPDATE message_templates 
   SET template_text = REPLACE(template_text, '<br>', '\n'),
       updated_at = CURRENT_TIMESTAMP
   WHERE template_text LIKE '%<br>%';
   ```

## üìù –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä 1: –¢–µ–≥–∏ `<br>`

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
<b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–µ</b><br><br>
<b>–ü—Ä–∏–æ–±—Ä–µ—Ç—ë–Ω:</b> {created_formatted}<br>
<b>–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ:</b> {expiry_formatted}<br>
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
<b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–µ</b>\n\n
<b>–ü—Ä–∏–æ–±—Ä–µ—Ç—ë–Ω:</b> {created_formatted}\n
<b>–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ:</b> {expiry_formatted}\n
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
üéâ <b>–í–∞—à –∫–ª—é—á –≥–æ—Ç–æ–≤!</b>
{cabinet_text}{fallback_text}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
üéâ <b>–í–∞—à –∫–ª—é—á –≥–æ—Ç–æ–≤!</b>
```

### –ü—Ä–∏–º–µ—Ä 3: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ HTML-—Ç–µ–≥–∏

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
<div><b>–¢–µ–∫—Å—Ç</b></div>
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:**
```html
<b>–¢–µ–∫—Å—Ç</b>
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- `shop_bot.data_manager.database.get_all_message_templates()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤
- `shop_bot.data_manager.database.get_message_template_statistics()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
- `shop_bot.data_manager.database.update_message_template()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `shop_bot.security.validators.InputValidator.validate_html_tags()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è HTML
- `shop_bot.config.get_message_text()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —à–∞–±–ª–æ–Ω–∞

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram Bot API - HTML](https://core.telegram.org/bots/api#html-style)
- [Allure Reporting Guide](../testing/allure-reporting.md)
- [Testing Best Practices](../testing/best-practices.md)
- [HTML Validation Tests](../testing/html-validation-tests.md)

## üö® –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å

**CRITICAL** - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å:
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –∏–∑ –∫–æ–¥–∞ –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–æ–≤ –∏–∑ –ë–î
- –ü–æ—è–≤–ª–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ü–∞–¥–µ–Ω–∏–µ –±–æ—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ–≥–æ–≤ `<br>`
- [ ] –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é HTML
- [ ] –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –Ω–µ –ø—É—Å—Ç—ã–µ
- [ ] –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ Telegram —Ç–µ–≥–∏
- [ ] –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –û—Ç—á–µ—Ç Allure —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≤–µ—Ä–∫–µ

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤

1. **–°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞** —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —á–µ—Ä–µ–∑ unit-—Ç–µ—Å—Ç—ã –ø—Ä–∏ CI/CD
3. **–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `tools/check_templates.py`
4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
5. **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –¥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 17.11.2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

