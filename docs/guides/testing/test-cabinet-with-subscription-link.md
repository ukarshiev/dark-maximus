# –ê–Ω–∞–ª–∏–∑ —Ç–µ—Å—Ç–∞ `test_cabinet_with_subscription_link`

> **–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–¥–∞–∫—Ü–∏–∏:** 27.01.2025

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 16.11.2025  
**–¢–µ—Å—Ç:** `integration.test_user_cabinet.test_cabinet_flow.TestCabinetFlow#test_cabinet_with_subscription_link`  
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω

---

## üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞

### –¶–µ–ª—å —Ç–µ—Å—Ç–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ —Å subscription link (—Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É VPN). –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–Ω—ã–π flow: —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ subscription link, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ subscription link –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

### –¢–∏–ø —Ç–µ—Å—Ç–∞

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç** (`@pytest.mark.integration`)
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—É `temp_db`
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ test client

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ö–æ—Å—Ç–∞** ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ VPN —Ö–æ—Å—Ç–∞
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ VPN –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `add_new_key()`
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ —Å subscription link** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ subscription link –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∫–ª—é—á—É —á–µ—Ä–µ–∑ `update_key_info()`
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É
5. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Flask** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é —Å —Ç–æ–∫–µ–Ω–æ–º
6. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ subscription link** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è subscription link –≤ –æ—Ç–≤–µ—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- **user_id:** `123471`
- **username:** `test_user2`
- **host_name:** `test_host`
- **xui_client_uuid:** `test-uuid-sub`
- **key_email:** `user123471-key1@testcode.bot`
- **expiry_ms:** —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 30 –¥–Ω–µ–π (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
- **connection_string:** `vless://test-sub`
- **plan_name:** `Test Plan`
- **price:** `100.0`
- **subscription_link:** `https://example.com/subscription-link`

### –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –ü–∞—Ç—á–∏–Ω–≥ `DB_FILE` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ë–î
   - –ó–∞–≥—Ä—É–∑–∫–∞ Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `_load_user_cabinet_app()`

2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `register_user_if_not_exists()`
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ `create_host()`

3. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞**
   - –°–æ–∑–¥–∞–Ω–∏–µ VPN –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `add_new_key()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
     - `user_id`, `host_name`, `xui_client_uuid`, `key_email`
     - `expiry_ms` (–≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
     - `connection_string`, `plan_name`, `price`

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ —Å subscription link**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `get_key_by_id()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `update_key_info()` —Å –ø–µ—Ä–µ–¥–∞—á–µ–π:
     - `key_id` ‚Äî ID –∫–ª—é—á–∞
     - `new_xui_uuid` ‚Äî —Ç–µ–∫—É—â–∏–π UUID –∏–∑ –∫–ª—é—á–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
     - `new_expiry_ms` ‚Äî —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –∏–∑ –∫–ª—é—á–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
     - `subscription_link` ‚Äî –Ω–æ–≤–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É

5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞**
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ `get_or_create_permanent_token()`

6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**
   - –°–æ–∑–¥–∞–Ω–∏–µ test client –¥–ª—è Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏ —Å —Ç–æ–∫–µ–Ω–æ–º, `user_id`, `key_id`, `subscription_link`
   - –ó–∞–ø—Ä–æ—Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ `client.get('/')`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–≤–µ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `200`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è subscription link –≤ –æ—Ç–≤–µ—Ç–µ

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞

```
TypeError: update_key_info() missing 2 required positional arguments: 'new_xui_uuid' and 'new_expiry_ms'
```

### –ü—Ä–∏—á–∏–Ω–∞

–§—É–Ω–∫—Ü–∏—è `update_key_info()` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ `src/shop_bot/data_manager/database.py` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π:

```python
def update_key_info(key_id: int, new_xui_uuid: str, new_expiry_ms: int, subscription_link: str = None):
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `key_id` ‚Äî ID –∫–ª—é—á–∞
- `new_xui_uuid` ‚Äî –Ω–æ–≤—ã–π UUID –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3X-UI
- `new_expiry_ms` ‚Äî –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:**
- `subscription_link` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `None`)

–í —Ç–µ—Å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ —Å `key_id` –∏ `subscription_link`:

```python
update_key_info(key_id, subscription_link=subscription_link)
```

–≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ –æ—à–∏–±–∫–µ, —Ç–∞–∫ –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `new_xui_uuid` –∏ `new_expiry_ms` –Ω–µ –±—ã–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã.

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API** ‚Äî —Ç–µ—Å—Ç –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ `subscription_link`, –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –∫–ª—é—á–∞
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã** ‚Äî –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –Ω–µ –±—ã–ª–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `update_key_info()`
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –∫–ª—é—á–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –∞ –Ω–µ –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∫–ª—é—á–∞** —á–µ—Ä–µ–∑ `get_key_by_id()`:
   ```python
   key = get_key_by_id(key_id)
   ```

2. **–ü–µ—Ä–µ–¥–∞—á–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞:
   ```python
   update_key_info(
       key_id,
       key['xui_client_uuid'],      # –¢–µ–∫—É—â–∏–π UUID (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
       key['expiry_timestamp_ms'],  # –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
       subscription_link=subscription_link  # –ù–æ–≤—ã–π subscription link
   )
   ```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ç—á–∏–Ω–≥ DB_FILE** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ë–î (–∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–∞—Ö –∫–ª–∞—Å—Å–∞):
   ```python
   original_db_file = database.DB_FILE
   database.DB_FILE = temp_db
   try:
       # ... –∫–æ–¥ —Ç–µ—Å—Ç–∞ ...
   finally:
       database.DB_FILE = original_db_file
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `get_key_by_id`** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∫–ª—é—á–∞

3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞** –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º:
   ```python
   assert key is not None, "–ö–ª—é—á –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å"
   ```

---

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–í `src/shop_bot/bot/handlers.py`:**
```python
update_key_info(key_id, result['client_uuid'], result['expiry_timestamp_ms'], result.get('subscription_link'))
```

**–í `tests/integration/test_vpn_purchase/test_key_extension_flow.py`:**
```python
update_key_info(key_id, new_uuid, new_expiry_timestamp_ms, "https://example.com/subscription")
```

–í–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å —Ç—Ä–µ–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: `key_id`, `new_xui_uuid`, `new_expiry_ms`, –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º `subscription_link`.

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç:
1. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–ª—é—á–∞
2. ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `update_key_info()`
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î —á–µ—Ä–µ–∑ –ø–∞—Ç—á–∏–Ω–≥ `DB_FILE`
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è UUID –∏ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ subscription link

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **–¢–µ—Å—Ç:** `tests/integration/test_user_cabinet/test_cabinet_flow.py` (—Å—Ç—Ä–æ–∫–∞ 146)
- **–§—É–Ω–∫—Ü–∏—è:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∞ 7419)
- **–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ç–µ—Å—Ç:** `tests/integration/test_vpn_purchase/test_key_extension_flow.py` (—Å—Ç—Ä–æ–∫–∞ 92)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 16.11.2025

