# üß™ –õ–æ–∫–∞–ª—å–Ω—ã–π stub –¥–ª—è YooKassa

> –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–¥–∞–∫—Ü–∏–∏: 10.11.2025

–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π YooKassa –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –í—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ localhost –∏ —Ö–æ—Ç–∏—Ç–µ –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –≤–µ–±—Ö—É–∫–∞.
- –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–¥–∞—á—É –∫–ª—é—á–µ–π –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞.
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ YooKassa –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç stub

- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (`yookassa_test_mode = true`) –∏ –ø—Ä–∏ –¥–æ–º–µ–Ω–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–º `localhost`.
- –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ `yookassa_local_stub = true` –≤–µ—Ç–∫–∏ `pay_yookassa` –∏ `topup_pay_yookassa` –≤ `src/shop_bot/bot/handlers.py` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç `Payment.create`.
- –°–æ–∑–¥–∞—ë—Ç—Å—è –ø—Å–µ–≤–¥–æ-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å `payment_id = stub-<UUID>`, –ø–æ–º–µ—á–µ–Ω–Ω–∞—è `yookassa_stub = true`, –∏ —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `process_successful_payment`.
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `paid`, –∫–ª—é—á –≤—ã–¥–∞—ë—Ç—Å—è –∏–ª–∏ –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ webhook'–∞.
- –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è c `http://` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –±–µ–∑ TLS), –±–æ—Ç –¥–æ–±–∞–≤–∏—Ç –æ–±—ã—á–Ω—É—é URL-–∫–Ω–æ–ø–∫—É –≤–º–µ—Å—Ç–æ WebApp ‚Äî Telegram –∑–∞–ø—Ä–µ—â–∞–µ—Ç WebApp-–∫–Ω–æ–ø–∫–∏ –±–µ–∑ HTTPS.

## –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã¬ª –∏ –≤–∫–ª—é—á–∏—Ç–µ **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º YooKassa**.
2. –û—Ç–º–µ—Ç—å—Ç–µ —á–µ–∫–±–æ–∫—Å **¬´üß™ –õ–æ–∫–∞–ª—å–Ω—ã–π stub YooKassa (—ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏)¬ª** ‚Äî –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω —Å—Ä–∞–∑—É –ø–æ–¥ –±–ª–æ–∫–æ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ (`npx --yes nx stop bot` ‚Üí `npx --yes nx serve bot`), —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ —Ñ–ª–∞–≥–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª–∏—Å—å.
4. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –≤ –±–æ—Ç–µ:
   - –ø–æ–∫—É–ø–∫–∞ —Ç–∞—Ä–∏—Ñ–∞ ‚Üí `pay_yookassa`;
   - –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ ‚Üí `topup_pay_yookassa`.
6. –ü–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º YooKassa‚Ä¶¬ª –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á/–±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏–ª–∏—Å—å.

## –í–æ–∑–≤—Ä–∞—Ç –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É API

- –ü–µ—Ä–µ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ç–µ—Å—Ç–æ–º —Å–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É `yookassa_local_stub`, –∏–Ω–∞—á–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ —É–π–¥—É—Ç –≤ YooKassa.
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å, —á—Ç–æ–±—ã —Ñ–ª–∞–≥ —Å–±—Ä–æ—Å–∏–ª—Å—è.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ `https://panel.dark-maximus.com/yookassa-webhook` —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è.

## –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

- –í `transactions` –∑–∞–ø–∏—Å—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è `yookassa_stub = true`.
- –ñ—É—Ä–Ω–∞–ª –±–æ—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è `YOO–öASSA ... stub`, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥–æ–Ω—ã –æ—Ç –±–æ–µ–≤—ã—Ö.

> Stub –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤. –í—Å–µ–≥–¥–∞ –≤—ã–∫–ª—é—á–∞–π—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –∏–ª–∏ –ø—Ä–æ–≥–æ–Ω–æ–º end-to-end —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

