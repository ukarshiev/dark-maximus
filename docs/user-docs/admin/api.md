# üîå API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

> REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é Dark Maximus

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
3. [–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã](#—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
4. [–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤](#—Ñ–æ—Ä–º–∞—Ç-–æ—Ç–≤–µ—Ç–æ–≤)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
6. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)

---

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL

```
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: http://localhost:1488
–ü—Ä–æ–¥–∞–∫—à–Ω: https://your-domain.com
```

### –í–µ—Ä—Å–∏—è API

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: **v1**

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

- **Content-Type:** `application/json`
- **Accept:** `application/json`

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –°–µ—Å—Å–∏–æ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é:

1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
2. –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ cookies
3. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã

### –¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

```http
Authorization: Bearer YOUR_API_TOKEN
```

---

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

#### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/user-details/<user_id>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (path, required) ‚Äî Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "user_id": 123456789,
    "username": "username",
    "first_name": "–ò–º—è",
    "last_name": "–§–∞–º–∏–ª–∏—è",
    "balance": 100.50,
    "keys_count": 2,
    "registration_date": "2025-01-01T00:00:00"
  }
}
```

#### –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
POST /api/update-user/<user_id>
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "first_name": "–ù–æ–≤–æ–µ –∏–º—è",
  "last_name": "–ù–æ–≤–∞—è —Ñ–∞–º–∏–ª–∏—è"
}
```

#### –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å

```http
POST /api/topup-balance
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 123456789,
  "amount": 100.00,
  "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞"
}
```

#### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π

```http
GET /api/user-payments/<user_id>
```

#### –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/user-keys/<user_id>
```

#### –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/user-balance/<user_id>
```

#### –ü–æ–ª—É—á–∏—Ç—å –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é —Å—É–º–º—É

```http
GET /api/user-earned/<user_id>
```

#### –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/user-notifications/<user_id>
```

#### –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```http
GET /api/search-users?query=username&limit=10
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (query, optional) ‚Äî –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `limit` (query, optional) ‚Äî –ª–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)

---

### üîë –ö–ª—é—á–∏

#### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–ª—é—á–∞

```http
GET /api/key/<key_id>
```

#### –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫–ª—é—á

```http
POST /api/toggle-key-enabled
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "key_id": 123,
  "enabled": true
}
```

#### –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏

```http
POST /refresh-keys
```

#### –û–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
POST /refresh-user-keys
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 123456789
}
```

#### –£–¥–∞–ª–∏—Ç—å –æ—à–∏–±–æ—á–Ω—ã–µ –∫–ª—é—á–∏

```http
POST /delete-error-keys
```

---

### üí∞ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```http
GET /api/transaction/<transaction_id>
```

#### –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```http
POST /refresh-transactions
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂

```http
GET /check-payment?user_id=123456789&amount=100
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (query, required) ‚Äî Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `amount` (query, required) ‚Äî —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞

---

### üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

```http
GET /api/promo-codes
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "SUMMER2024",
      "discount_percent": 20,
      "discount_amount": 0,
      "discount_bonus": 0,
      "usage_limit": 100,
      "used_count": 5,
      "is_active": true
    }
  ]
}
```

#### –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥

```http
POST /api/promo-codes
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "code": "SUMMER2024",
  "discount_percent": 20,
  "discount_amount": 0,
  "discount_bonus": 0,
  "usage_limit": 100,
  "is_active": true
}
```

#### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞

```http
GET /api/promo-codes/<promo_id>
```

#### –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥

```http
PUT /api/promo-codes/<promo_id>
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "discount_percent": 25,
  "is_active": true
}
```

#### –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥

```http
DELETE /api/promo-codes/<promo_id>
```

#### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```http
GET /api/promo-codes/<promo_id>/usage
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥

```http
POST /api/validate-promo-code
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "code": "SUMMER2024",
  "user_id": 123456789
}
```

---

### üñ•Ô∏è –•–æ—Å—Ç—ã

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤

```http
GET /api/hosts
```

#### –û–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á–∏ —Ö–æ—Å—Ç–∞

```http
POST /api/refresh-keys-by-host
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "host_name": "–°–µ—Ä–≤–µ—Ä 1"
}
```

---

### üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

#### –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```http
POST /create-notification
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "user_id": 123456789,
  "message": "–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
  "type": "info"
}
```

#### –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É

```http
POST /resend-notification/<notification_id>
```

---

## –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": { ... },
  "message": "–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
}
```

### –û—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π

```json
{
  "success": false,
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "code": "ERROR_CODE"
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python

```python
import requests

# –ë–∞–∑–æ–≤—ã–π URL
BASE_URL = "https://your-domain.com"

# –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
response = requests.get(f"{BASE_URL}/api/user-details/123456789")
data = response.json()

if data["success"]:
    user = data["data"]
    print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user['username']}")
    print(f"–ë–∞–ª–∞–Ω—Å: {user['balance']} —Ä—É–±.")
```

### JavaScript

```javascript
const BASE_URL = "https://your-domain.com";

// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
fetch(`${BASE_URL}/api/user-details/123456789`)
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const user = data.data;
      console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.username}`);
      console.log(`–ë–∞–ª–∞–Ω—Å: ${user.balance} —Ä—É–±.`);
    }
  });
```

### cURL

```bash
# –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X GET https://your-domain.com/api/user-details/123456789

# –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
curl -X POST https://your-domain.com/api/topup-balance \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 123456789,
    "amount": 100.00,
    "description": "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞"
  }'
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `UNAUTHORIZED` | –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `FORBIDDEN` | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω |
| `NOT_FOUND` | –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| `VALIDATION_ERROR` | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| `INTERNAL_ERROR` | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

```python
import requests

try:
    response = requests.get(f"{BASE_URL}/api/user-details/123456789")
    data = response.json()
    
    if not data["success"]:
        error_code = data.get("code", "UNKNOWN")
        error_message = data.get("error", "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")
        
        if error_code == "NOT_FOUND":
            print("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
        elif error_code == "UNAUTHORIZED":
            print("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
        else:
            print(f"–û—à–∏–±–∫–∞: {error_message}")
    else:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        user = data["data"]
        print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: {user['username']}")
        
except requests.exceptions.RequestException as e:
    print(f"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {e}")
```

---

## Rate Limiting

API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:

- **–û–±—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:** 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** 10 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É
- **Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:** –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞:

```json
{
  "success": false,
  "error": "Too many requests. Please try again later.",
  "code": "RATE_LIMIT_EXCEEDED"
}
```

---

## Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### YooKassa Webhook

```http
POST /yookassa-webhook
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç YooKassa –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π.

### CryptoBot Webhook

```http
POST /cryptobot-webhook
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç CryptoBot –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π.

### Heleket Webhook

```http
POST /heleket-webhook
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Heleket –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π.

### TON Webhook

```http
POST /ton-webhook
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ TON –ø–ª–∞—Ç–µ–∂–∞—Ö.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏](guide.md)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](quickstart.md)
- [–ß–µ–∫-–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](security.md)

---

**–í–µ—Ä—Å–∏—è API:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-XX

