# Настройка Webhook для ЮKassa

> Последнее обновление: 12.10.2025

## Проблема
Бот создает ссылку на оплату, вы проходите тестовый платеж, но бот не отправляет ключ. Это происходит потому, что webhook от ЮKassa не доходит до бота.

## Причина
В настройках домена указан `http://localhost:1488`, но ЮKassa не может достучаться до localhost.

## Решение

### 1. Настройте правильный домен

В веб-панели бота перейдите в **Настройки → Платежные системы** и измените поле **Домен** на ваш реальный домен:

```
https://ваш-домен.com
```

Например:
- `https://paris.dark-maximus.com`
- `https://your-domain.com`
- `https://your-server-ip.com`

### 2. Настройте webhook в ЮKassa

1. Войдите в личный кабинет ЮKassa: https://yookassa.ru/
2. Перейдите в **Настройки → HTTP-уведомления**
3. Добавьте URL webhook:
   ```
   https://ваш-домен.com/yookassa-webhook
   ```
4. Выберите события: `payment.succeeded`
5. Сохраните настройки

### 3. Проверьте доступность webhook

После настройки проверьте, что webhook доступен:

```bash
curl -X POST https://ваш-домен.com/yookassa-webhook \
  -H "Content-Type: application/json" \
  -d '{"test": "webhook"}'
```

Должен вернуть `OK`.

### 4. Перезапустите бота

```bash
docker compose restart bot
```

## Текущие настройки

- **Домен**: `http://localhost:1488` ❌ (нужно изменить)
- **Webhook URL**: `http://localhost:1488/yookassa-webhook` ❌ (недоступен для ЮKassa)

## После настройки

1. Измените домен в настройках
2. Настройте webhook в ЮKassa
3. Перезапустите бота
4. Протестируйте платеж снова

Теперь бот должен корректно получать уведомления о платежах и отправлять ключи пользователям.
