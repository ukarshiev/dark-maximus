# Проблемы с кодировкой в Git на Windows

**Дата последней редакции:** 16.01.2025

## ✅ РЕШЕНИЕ ПРОБЛЕМЫ

**Проблема полностью решена!** Настроен автоматический профиль PowerShell, который устанавливает UTF-8 при каждом запуске.

### Что было сделано

1. **Создан профиль PowerShell** (`Microsoft.PowerShell_profile.ps1`), который автоматически:
   - Устанавливает UTF-8 кодировку для консоли
   - Настраивает PowerShell на использование UTF-8
   - Конфигурирует Git для работы с UTF-8
   - Добавляет вспомогательные функции

2. **Добавлены функции**:
   - `Test-UTF8Encoding` — проверка настроек кодировки
   - `gitc <сообщение>` — создание коммитов с правильной кодировкой

### Как использовать

Просто откройте новый терминал PowerShell — всё настроится автоматически!

Для создания коммитов с кириллицей используйте:
```powershell
gitc "Добавлена новая функция"
gitc "Исправлена ошибка" -All  # с авто-добавлением всех файлов
```

Для проверки настроек:
```powershell
Test-UTF8Encoding
```

---

## Суть проблемы

При работе с Git на Windows возникают проблемы с кодировкой кириллицы в сообщениях коммитов, именах файлов и выводе команд. Это происходит из-за несоответствия кодировок между PowerShell, Git и консолью Windows.

## Причины проблемы

### 1. Разные кодировки по умолчанию

- **Git** ожидает UTF-8 для всех текстовых данных
- **PowerShell** в Windows использует Windows-1251 (русская локаль) или Windows-1252 (английская)
- **Консоль Windows** (cmd.exe) использует OEM-кодировку (обычно Windows-866 для русского)

### 2. Проблема передачи параметров

Когда вы выполняете команду:
```powershell
git commit -m "Добавлена новая функция"
```

PowerShell кодирует строку в Windows-1251, но Git интерпретирует её как UTF-8. Результат — кракозябры в истории коммитов.

### 3. Проблема с интерактивными командами

Команды типа `git commit` без `-m` открывают редактор (обычно vim или nano), который также может работать с неправильной кодировкой.

### 4. Проблема с выводом

Даже если коммит создан правильно, вывод команд Git может отображаться с ошибками из-за неправильной кодировки консоли.

## Глобальные настройки Git

Профиль автоматически устанавливает следующие настройки:

```powershell
git config --global core.quotepath false
git config --global i18n.commitencoding utf-8
git config --global i18n.logoutputencoding utf-8
git config --global gui.encoding utf-8
git config --global core.autocrlf false
```

### Объяснение настроек

- `core.quotepath false` — Git не будет экранировать не-ASCII символы в именах файлов
- `i18n.commitencoding utf-8` — все коммиты будут кодироваться в UTF-8
- `i18n.logoutputencoding utf-8` — вывод команд git log будет в UTF-8
- `gui.encoding utf-8` — Git GUI будет использовать UTF-8
- `core.autocrlf false` — отключает автоматическое преобразование окончаний строк

## Проверка текущих настроек

```powershell
git config --list | Select-String -Pattern "i18n|core.quotepath|core.autocrlf"
```

Или используйте встроенную функцию:
```powershell
Test-UTF8Encoding
```

## Исправление уже созданных коммитов с неправильной кодировкой

Если в истории уже есть коммиты с кракозябрами:

```powershell
# Просмотр истории с правильной кодировкой
$env:GIT_PAGER = "cat"
git log --pretty=format:"%h - %an, %ar : %s" --encoding=UTF-8

# Если нужно переписать историю (осторожно!)
git rebase -i HEAD~N  # где N — количество последних коммитов
```

## Дополнительные ресурсы

- [Git для Windows: кодировки](https://github.com/git-for-windows/git/wiki/FAQ#how-to-configure-git-to-handle-line-endings)
- [PowerShell и UTF-8](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_character_encoding)

## Часто задаваемые вопросы

### Q: Почему не помогает просто установить UTF-8 в PowerShell?

A: Потому что Git запускается как отдельный процесс и может использовать другие настройки кодировки. Также проблема в том, как PowerShell передает параметры командной строки. **Теперь это решено автоматически через профиль!**

### Q: Можно ли использовать Git Bash вместо PowerShell?

A: Да, Git Bash работает с UTF-8 из коробки и не имеет таких проблем. Но теперь и PowerShell настроен правильно!

### Q: Проблема только с коммитами или с другими командами тоже?

A: Проблема может проявляться в:
- Сообщениях коммитов
- Именах файлов с кириллицей
- Выводе команд `git log`, `git status`, `git diff`
- Интерактивных режимах (rebase, merge)

**Все эти проблемы решены профилем PowerShell!**

### Q: Как проверить, правильно ли работает кодировка?

A: Используйте встроенную функцию:
```powershell
Test-UTF8Encoding
```

Или создайте тестовый коммит с кириллицей:
```powershell
gitc "Тестовый коммит с кириллицей"
git log -1 --pretty=format:"%s"
```
Если видите кракозябры — проблема не решена (но она должна быть решена!).

