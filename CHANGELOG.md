# История изменений

2.72.23 – 17.10.2025 14:04
- [Критическое исправление] (Установка) Исправлена ошибка sed с специальными символами
  - Добавлено экранирование специальных символов в FLASK_SECRET_KEY и ADMIN_PASSWORD
  - Исправлена ошибка "sed: unknown option to 's'" при генерации секретов
  - Теперь sed корректно обрабатывает пароли и ключи с специальными символами
  - Файл: install.sh

2.72.22 – 17.10.2025 13:43
- [Критическое исправление] (Установка) Исправлена критическая ошибка с nginx конфигурацией
  - Исправлена логика очистки nginx конфигураций - теперь не удаляется полная конфигурация
  - Полная nginx конфигурация создается в шаге 6, временная в шаге 6, активируется в шаге 9
  - Добавлены тесты для проверки логики nginx конфигурации
  - Протестирована вся логика установки - все тесты проходят
  - Устранена ошибка "host not found in upstream" при активации полной конфигурации
  - Файл: install.sh

2.72.21 – 17.10.2025 13:27
- [Критическое исправление] (Установка) Исправлена ошибка nginx с upstream docs:80
  - Добавлена очистка старых nginx конфигураций перед созданием новых
  - Удалены дублирующиеся блоки создания nginx конфигурации
  - Исправлена ошибка "host not found in upstream docs:80" при установке
  - Теперь install.sh корректно очищает старые конфигурации перед созданием временной
  - Файл: install.sh

2.72.20 – 17.10.2025 13:20
- [Улучшение] (SSL установка) Сделал ssl-install.sh полностью независимым
  - Добавлена проверка и создание HTTP nginx конфигурации с upstream серверами
  - Добавлена автоматическая проверка и запуск Docker контейнеров
  - Улучшена обработка рабочей директории проекта
  - Добавлена гибкая логика определения домена (из аргументов или nginx конфигурации)
  - Теперь ssl-install.sh может работать независимо от install.sh
  - Улучшена обработка ошибок и диагностика
  - Файл: ssl-install.sh

2.72.19 – 17.10.2025 13:10
- [Критическое исправление] (Установка) Исправлена ошибка nginx при установке
  - Изменен порядок операций: nginx проверяется после запуска контейнеров
  - Добавлена временная nginx конфигурация без upstream серверов для проверки синтаксиса
  - Полная конфигурация nginx активируется только после запуска всех контейнеров
  - Исправлена ошибка "host not found in upstream" при установке
  - Файл: install.sh

2.72.18 – 17.10.2025 13:01
- [Критическое исправление] (Scheduler) Исправлен спам уведомлений о недоступности тарифа
  - Исправлена логика в check_expiring_subscriptions: убран continue, добавлен break после отправки уведомлений
  - Добавлена дополнительная защита от спама в send_plan_unavailable_notice
  - Добавлена функция cleanup_duplicate_notifications для очистки дублирующихся уведомлений
  - Добавлено подробное логирование отправки уведомлений для отслеживания проблем
  - Исправлена проблема с отправкой 26+ одинаковых уведомлений каждые 5 минут
  - Файл: src/shop_bot/data_manager/scheduler.py

2.72.17 – 17.10.2025 12:59
- [Исправление] (Docker) Исправлены проблемы сборки Docker образов
  - Исправлен синтаксис heredoc в Dockerfile для корректной работы с RUN блоками
  - Исправлена проблема с правами доступа в Dockerfile.docs для установки пакетов
  - Добавлено явное переключение на root пользователя перед установкой пакетов
  - Заменен heredoc на последовательные echo команды для лучшей совместимости

2.72.16 – 17.10.2025 12:56
- [Улучшение] (Установка) Обновлен формат передачи домена через переменную окружения
  - Изменен приоритет: переменная окружения DOMAIN имеет приоритет над аргументами
  - Обновлены инструкции в install.sh для показа правильного формата команды
  - Обновлен README.md с новым форматом установки
  - Команда теперь: curl -sSL ... | sudo bash    DOMAIN=yourdomain.com

2.72.15 – 17.10.2025 11:55
- [Исправление] (Установка) Исправлены критические ошибки в install.sh
  - Добавлена инициализация переменных в начале скрипта для предотвращения 'unbound variable'
  - Улучшена функция read_input с обработкой ошибок
  - Добавлена детальная диагностика для отладки проблем с доменами
  - Исправлена логика проверки аргументов командной строки
  - Скрипт теперь безопасно работает при запуске через curl | bash

2.72.14 – 17.10.2025 11:48
- [Исправление] (Установка) Исправлена ошибка "unbound variable" в install.sh
  - Добавлена безопасная проверка аргументов командной строки с использованием ${1:-}
  - Исправлена функция handle_error для корректной обработки параметров
  - Теперь скрипт корректно работает при запуске через curl | bash

2.72.13 – 17.10.2025 11:41
- [Улучшение] (Установка) Значительно улучшен процесс установки и настройки
  - Добавлено создание .env файла на основе config/env.example с автозаполнением
  - Добавлено создание всех необходимых директорий (logs, backups, sessions, codex.docs)
  - Добавлена инициализация базы данных users.db при первом запуске
  - Добавлена настройка logrotate для автоматической ротации логов
  - Добавлен systemd сервис для автозапуска при перезагрузке сервера
  - Исправлен Dockerfile.docs - добавлен wget для корректной работы healthcheck
  - Исправлен nginx/nginx.conf - заменены жестко прописанные домены на примеры
  - Улучшено резюме установки с полным списком выполненных действий
  - Добавлены полезные команды для управления systemd сервисом
  - Добавлена проверка доступности портов перед установкой
  - Добавлена валидация домена при вводе

2.72.12 – 17.10.2025 11:23
- [Исправление] (Конфигурация) Исправлены критические ошибки конфигурации и безопасности
  - Исправлено версионирование в CHANGELOG.md - удалены дублирующиеся версии
  - Исправлена конфигурация Python в pyrightconfig.json - приведена в соответствие с pyproject.toml
  - Исправлены пути в pyrightconfig.json - сделаны кроссплатформенными
  - Унифицирована конфигурация nginx между docker-compose.yml и install.sh
  - Включена CSRF защита для production окружения
  - Оптимизированы миграции базы данных с проверкой существования колонок
  - Настроено гибкое логирование в зависимости от окружения
  - Улучшена обработка исключений в scheduler.py с более специфичными типами ошибок

2.72.11 – 17.10.2025 11:13
- [Упрощение] (SSL) Объединены SSL скрипты в один файл ssl-install.sh
  - Удален лишний файл setup-ssl.sh
  - Весь функционал SSL настройки теперь в одном скрипте ssl-install.sh
  - Упрощена структура проекта - теперь только один SSL скрипт
  - Использование: curl -sSL ... | sudo bash -s -- domain.com

2.72.10 – 17.10.2025 11:07
- [Исправление] (SSL) Улучшена работа ssl-install.sh с автоматическим переходом в папку проекта
  - ssl-install.sh теперь автоматически переходит в /opt/dark-maximus если docker-compose.yml не найден
  - Исправлена проблема с запуском SSL скрипта из любой директории
  - Улучшены сообщения об ошибках и инструкции для пользователей
- [Исправление] (SSL) Исправлена передача домена в SSL скрипты через pipe
  - ssl-install.sh теперь поддерживает переменную окружения DOMAIN
  - Исправлена проблема с передачей аргументов через curl | bash
  - Обновлены инструкции для использования DOMAIN=example.com curl ... | sudo bash
  - Теперь корректно работает: DOMAIN=dark-maximus.com curl -sSL ... | sudo bash

2.72.10 – 17.10.2025 11:01
- [Улучшение] (SSL) Добавлена поддержка передачи домена как аргумента в SSL скрипты
  - ssl-install.sh теперь передает все аргументы в setup-ssl.sh
  - setup-ssl.sh принимает домен как аргумент командной строки
  - Обновлены инструкции в install.sh для использования ssl-install.sh
  - Теперь можно запускать: curl -sSL ... | sudo bash dark-maximus.com

2.72.9 – 17.10.2025 10:57
- [Исправление] (Установка) Улучшена обработка интерактивного ввода домена в install.sh
  - Добавлена поддержка передачи домена через переменную окружения DOMAIN
  - Добавлена поддержка передачи домена как аргумента командной строки
  - Исправлена проблема с чтением ввода при запуске через pipe (curl | bash)
  - Добавлены понятные инструкции для пользователей при запуске через pipe
  - Теперь можно запускать: DOMAIN=example.com curl -sSL ... | sudo bash

2.72.8 – 17.10.2025 10:51
- [Улучшение] (Установка) Разделение установки на два этапа для лучшей безопасности
  - Основная установка: curl -sSL https://raw.githubusercontent.com/ukarshiev/dark-maximus/main/install.sh | sudo bash
  - SSL настройка: curl -sSL https://raw.githubusercontent.com/ukarshiev/dark-maximus/main/ssl-install.sh | sudo bash
  - Создан отдельный скрипт-обертка ssl-install.sh для настройки HTTPS
  - Обновлена документация с новыми ссылками и инструкциями
  - Теперь SSL настройка выполняется отдельно и только при необходимости

2.72.7 – 17.10.2025 10:51
- [Исправление] (SSL) Исправлена синтаксическая ошибка в скрипте setup-ssl.sh
  - Заменена проблемная команда crontab с использованием подстановки команд на более безопасный подход
  - Теперь используется временный файл для настройки cron-задач
  - Исправлена ошибка "syntax error near unexpected token '('"

2.72.6 – 17.10.2025 10:44
- [Исправление] (Уведомления) Исправлено дублирование уведомлений о истечении тарифов
  - Перемещена запись в базу данных перед отправкой сообщения для предотвращения race condition
  - Исправлены функции send_plan_unavailable_notice, send_subscription_notification и send_autorenew_balance_notice
  - Теперь уведомления отправляются только один раз, даже при параллельных запусках планировщика

2.72.5 – 17.10.2025 09:57
- [Исправление] (Установка) Критические исправления скрипта автоматической установки
  - Добавлено автоматическое клонирование репозитория в /opt/dark-maximus
  - Исправлена проверка наличия файлов проекта после клонирования
  - Добавлена проверка всех необходимых файлов (Dockerfile, конфигурации)
  - Обновлены инструкции с правильными путями к проекту
  - Исправлена документация INSTALL-README.md с корректными командами
  - Теперь скрипт корректно работает через curl | bash

2.72.4 – 17.10.2025 09:51
- [Улучшение] (Инфраструктура) Оптимизация Docker конфигурации и скриптов развертывания
  - Улучшена структура Dockerfile для более эффективной сборки
  - Оптимизированы скрипты установки и настройки SSL
  - Обновлена документация по развертыванию и архитектуре
  - Улучшена конфигурация nginx для лучшей производительности
  - Добавлены улучшения в скрипты автоматической установки

2.72.3 – 17.10.2025 01:35
- [Безопасность] (Инфраструктура) Критические исправления безопасности и устойчивости
  - Исправлены порты Docker на localhost-only (127.0.0.1:PORT) для предотвращения доступа из интернета
  - Убраны отладочные порты из UFW (1488/3001/3002 больше не открыты наружу)
  - Добавлена генерация случайного пароля админа и сохранение в .admin_pass
  - Создан .env файл для хранения секретов (FLASK_SECRET_KEY, ADMIN_PASSWORD)
  - Исправлены healthcheck с nc вместо curl для надежности
  - Добавлен DEBIAN_FRONTEND=noninteractive для предотвращения интерактивных вопросов APT
  - Улучшено ожидание запуска сервисов с timeout и проверкой готовности
  - Оптимизированы WebSocket настройки nginx (proxy_read_timeout 60m, proxy_buffering off)
  - Добавлены современные заголовки безопасности (HSTS, CSP, X-Frame-Options)
  - Улучшена конфигурация SSL с TLS 1.2/1.3 и современными шифрами
  - Добавлена проверка SSH порта перед сбросом UFW
  - Улучшена обработка пользователей Docker группы

2.72.2 – 17.10.2025 01:30
- [Упрощение] (Инфраструктура) Удален setup-admin-docs.sh и интегрирована функциональность в Dockerfile
  - Удален setup-admin-docs.sh (ненужный скрипт)
  - Интегрировано развертывание админской документации напрямую в Dockerfile
  - Упрощена архитектура: убран лишний шаг развертывания
  - Сохранена вся функциональность развертывания админской документации
  - Улучшена производительность сборки Docker образа

2.72.1 – 17.10.2025 01:25
- [Очистка] (Инфраструктура) Удалены неиспользуемые установочные скрипты
  - Удален install-old.sh (старая версия установщика)
  - Удален setup-ssl-old.sh (старая версия SSL-скрипта)
  - Удален nginx/ssl/generate-certs.sh (неиспользуемый скрипт генерации сертификатов)
  - Обновлена документация в docs/setup-scripts/README.md
  - Все функции удаленных скриптов интегрированы в основные скрипты установки

2.72.0 – 17.10.2025 01:20
- [Упрощение] (Инфраструктура) Заменен Docker nginx-proxy на системный nginx
  - Удален nginx-proxy контейнер из docker-compose.yml
  - Переработан install.sh для установки и настройки системного nginx
  - Обновлен setup-ssl.sh для работы с системным nginx вместо Docker контейнера
  - Изменены upstream серверы с Docker имен на localhost (127.0.0.1:1488, 127.0.0.1:3001, 127.0.0.1:3002)
  - Добавлена установка nginx конфигурации в /etc/nginx/nginx.conf
  - Обновлены cron задачи для автообновления SSL сертификатов под системный nginx
  - Исправлен режим обновления в install.sh для перезапуска системного nginx
  - Упрощена архитектура: убран лишний слой Docker контейнера для nginx
  - Снижено потребление ресурсов и упрощена отладка

2.71.0 – 16.10.2025 21:45
- [Упрощение] (Инфраструктура) Полностью переработан подход к установке - разделение на этапы
  - install.sh теперь только устанавливает пакеты и настраивает HTTP
  - setup-ssl.sh отдельно настраивает SSL и HTTPS
  - Упрощена логика и убраны сложные проверки
  - Улучшена читаемость и отладка
  - Создан install-simple.sh и setup-ssl-simple.sh как новые версии
  - Старые версии сохранены как install-old.sh и setup-ssl-old.sh

2.70.0 – 16.10.2025 21:42
- [Переписывание] (Инфраструктура) Полностью переписан install.sh для исправления всех проблем с SSL
  - Исправлены все проблемы с путями к SSL сертификатам Let's Encrypt (.crt/.key → .pem)
  - Исправлено монтирование volume для Let's Encrypt сертификатов в nginx-прокси контейнер
  - Создан новый install.sh с пошаговой установкой: сначала HTTP, потом SSL
  - Добавлен отдельный скрипт setup-ssl.sh для настройки SSL после основной установки
  - Исправлена логика создания nginx конфигурации (динамическая генерация вместо sed замен)
  - Исправлен docker-compose.yml с правильными volume для SSL сертификатов
  - Добавлена проверка DNS записей перед выпуском SSL сертификатов
  - Улучшена обработка ошибок и диагностическая информация
  - Создан nginx-ssl.conf как эталонная конфигурация с правильными SSL путями
  - Все сервисы теперь работают стабильно: сначала по HTTP, затем по HTTPS с Let's Encrypt

2.69.0 – 16.10.2025 21:34
- [Исправление] (Инфраструктура) Временно отключен SSL для исправления проблем с nginx-прокси
  - Исправлена проблема с монтированием Let's Encrypt сертификатов в nginx-прокси контейнер
  - Временно отключены SSL-настройки для всех доменов (docs.dark-maximus.com, help.dark-maximus.com, panel.dark-maximus.com)
  - Все сервисы теперь работают по HTTP без SSL-шифрования
  - nginx-прокси успешно запускается и проксирует запросы на соответствующие сервисы
  - Статус всех сервисов: bot (Up), codex-docs (healthy), docs (unhealthy), nginx-proxy (healthy)
  - Все домены доступны и отвечают корректно (HTTP 200/302)

2.68.0 – 16.10.2025 20:40
- [Исправление] (Инфраструктура) Исправлена интеграция Let's Encrypt SSL сертификатов с nginx-прокси
  - Исправлено монтирование Let's Encrypt сертификатов в nginx-прокси контейнер
  - Обновлена конфигурация nginx для использования реальных сертификатов вместо самоподписанных
  - Добавлено копирование сертификатов из /etc/letsencrypt/ в локальную папку ssl-certs/
  - Обновлен docker-compose.yml для монтирования папки ssl-certs/live в контейнер
  - Исправлены пути к сертификатам в nginx.conf (fullchain.pem → .crt, privkey.pem → .key)
  - Все SSL соединения теперь работают корректно:
    * panel.dark-maximus.com - HTTP/2 302
    * docs.dark-maximus.com - HTTP/2 200
    * help.dark-maximus.com - HTTP/2 200
  - Использованы доверенные Let's Encrypt SSL сертификаты со сроком действия до 14.01.2026

2.67.1 – 16.10.2025 18:57
- [Исправление] (Установка) Исправлена генерация SSL сертификатов в install.sh
  - Исправлена генерация SSL сертификатов для nginx-прокси в режиме обновления
  - Убрана зависимость от Docker контейнера для создания сертификатов
  - Добавлена проверка существования SSL сертификатов перед созданием
  - Исправлен перезапуск nginx-proxy вместо системного nginx
  - Добавлена проверка статуса nginx-proxy после запуска
  - Протестирована работа всех доменов: panel.dark-maximus.com, docs.dark-maximus.com, help.dark-maximus.com
  - Все домены работают через HTTPS с самоподписанными сертификатами

2.67.0 – 16.10.2025 17:47
- [Новый функционал] (Инфраструктура) Добавлен nginx-прокси для поддоменов
  - Создан nginx-прокси контейнер для маршрутизации поддоменов
  - Настроена маршрутизация docs.dark-maximus.com → docs сервис (порт 3001)
  - Настроена маршрутизация help.dark-maximus.com → codex-docs сервис (порт 3002)
  - Настроена маршрутизация panel.dark-maximus.com → bot сервис (порт 1488)
  - Добавлена поддержка HTTP/HTTPS с автоматическим редиректом
  - Созданы самоподписанные SSL сертификаты для тестирования
  - Добавлена документация по настройке поддоменов в docs/subdomain-setup.md
  - Исправлены ошибки ERR_CONNECTION_CLOSED для поддоменов

2.66.26 – 16.10.2025 17:20
- [Улучшение] (Установка) Улучшена секция обновления в install.sh
  - Добавлена проверка и создание SSL-файлов при обновлении
  - Добавлено извлечение доменов из nginx конфигурации
  - Исправлено отображение правильных URL в финальном сообщении
  - Добавлен перезапуск nginx с SSL-конфигурацией при обновлении
  - Теперь показываются реальные домены вместо localhost при обновлении

2.66.25 – 16.10.2025 17:11
- [Исправление] (Установка) Добавлено автоматическое создание SSL-конфигурации в install.sh
  - Добавлен шаг создания файла /etc/letsencrypt/options-ssl-nginx.conf
  - Добавлена генерация DH параметров /etc/letsencrypt/ssl-dhparams.pem
  - Исправлена проблема "Welcome to nginx!" при первом запуске
  - Nginx теперь корректно запускается после установки без ручного вмешательства
  - Обновлена нумерация шагов установки (добавлен Шаг 4: Создание SSL-конфигурации)

2.66.24 – 16.10.2025 17:00
- [Исправление] (Зависимости) Обновлены зависимости для совместимости с Node.js 20
  - Обновлен eslint-config-codex с ^1.7.0 до ^2.0.3
  - Обновлен eslint-plugin-jsdoc с 39.3.6 до 50.8.0 (поддержка Node.js >=18)
  - Обновлен ESLint до версии 8.57.1
  - Исправлена проблема несовместимости с Node.js 20 в Docker-контейнере codex-docs
  - Сборка Docker-контейнера codex-docs теперь проходит успешно

2.66.23 – 16.10.2025 17:10
- [Исправление] (Установка) Полностью переработан install.sh для корректной работы с Ubuntu 24.04
  - Заменена установка docker.io на официальный Docker CE с репозитория Docker
  - Добавлена настройка Docker APT репозитория с GPG ключами
  - Улучшена проверка Docker Compose: приоритет Docker Compose v2 (плагин), fallback на v1
  - Добавлена проверка успешности установки Docker с выводом версии
  - Исправлены проблемы совместимости с Python 3.12

2.66.22 – 16.10.2025 16:50
- [Улучшение] (Docker) Добавлены проверки и защита от ошибок в Dockerfile.codex-docs
  - Добавлено создание папки dist перед сборкой (mkdir -p dist)
  - Добавлена проверка содержимого папки dist после сборки
  - Добавлена проверка успешного копирования папки dist между stage'ами
  - Предотвращены ошибки "failed to calculate checksum" при отсутствии папки dist

2.66.21 – 16.10.2025 16:45
- [Исправление] (Docker) Переработан Dockerfile.codex-docs для автоматической сборки
  - Добавлен multi-stage build с отдельным stage для сборки codex.docs
  - Папка dist теперь собирается внутри контейнера командой yarn build-backend
  - Устранена зависимость от предсобранной папки dist в build context
  - Исправлена ошибка "failed to calculate checksum of ref ... /codex.docs/dist: not found"

2.66.20 – 16.10.2025 16:35
- [Исправление] (Docker) Исправлена проблема с копированием папки codex.docs/dist в Dockerfile.codex-docs
  - Изменен .dockerignore: исключается только /dist/ в корне проекта, но не в подпапках
  - Теперь codex.docs/dist корректно включается в build context
  - Исправлена ошибка "failed to calculate checksum of ref ... /codex.docs/dist: not found"

2.66.19 – 16.10.2025 16:24
- [Исправление] (Установка) Автоматическое исправление проблемы с docker-compose в install.sh
  - Добавлена проверка совместимости docker-compose с Python 3.12
  - Автоматическое удаление неработающей версии docker-compose (1.29.2)
  - Автоматическая установка совместимой версии docker-compose из GitHub
  - Проверка работает как при первоначальной установке, так и при обновлении
  - Исправлена ошибка "ModuleNotFoundError: No module named 'distutils'"

2.66.18 – 16.10.2025 15:21
- [Исправление] (Установка) Критическое исправление логики формирования поддоменов в install.sh
  - Исправлена ошибка с ${DOMAIN#*.} которая отрезала всё до первой точки
  - Добавлена правильная логика извлечения корневого домена (последние 2 лейбла)
  - Добавлена валидация домена для предотвращения некорректных вводов
  - Добавлен shebang #!/usr/bin/env bash в начало скрипта
  - Теперь dark-maximus.com корректно формирует docs.dark-maximus.com и help.dark-maximus.com

2.66.17 – 16.10.2025 15:06
- [Исправление] (Установка) Исправлена проверка DNS в скрипте install.sh
  - Добавлена автоматическая установка dnsutils при отсутствии команды dig
  - Улучшена обработка ошибок при проверке DNS-записей
  - Добавлены информативные сообщения о статусе DNS-записей
- [Исправление] (SSL) Исправлено получение SSL-сертификатов
  - Изменен метод получения сертификатов с --nginx на --webroot
  - Исправлена конфигурация для использования одного сертификата для всех поддоменов
  - Добавлены HTTP редиректы на HTTPS для всех доменов
  - Улучшена стабильность процесса получения сертификатов

2.66.16 – 15.10.2025 12:47
- [Улучшение] (Установка) Перенесен скрипт установки в корень проекта
  - Скрипт install.sh теперь доступен в корне проекта для прямого доступа
  - Обновлены все ссылки в документации на правильный путь к скрипту
  - Теперь ссылка https://raw.githubusercontent.com/ukarshiev/dark-maximus/main/install.sh работает корректно
- [Документация] (Installation) Дополнена статья по установке новой информацией
  - Добавлен раздел "Система автоматических бэкапов" с подробным описанием
  - Описана частота создания бэкапов (каждые 24 часа)
  - Указано место хранения бэкапов (папка backups/, 30 дней)
  - Добавлены команды для управления бэкапами
  - Добавлен раздел "Темная тема в админской документации"
  - Описаны возможности переключателя темы в Codex.docs
  - Указаны особенности темной темы (Material Design, автоматическое определение)
  - Обновлена дата последней редакции статьи на 15.01.2025
- [Документация] (Codex.docs) Подтверждена готовность темной темы к развертыванию
  - Все файлы темной темы уже собраны и включены в репозиторий
  - Темная тема будет работать при развертывании без дополнительных действий
  - Переключатель темы с иконками солнца/луны готов к использованию

2.66.15 – 14.10.2025 12:59
- [Исправление] (PowerShell) Полностью решена проблема с кодировкой UTF-8
  - Переписан профиль PowerShell с нуля для автоматической настройки UTF-8
  - Профиль теперь устанавливает UTF-8 при каждом запуске PowerShell
  - Настроены все необходимые параметры: [Console]::InputEncoding, [Console]::OutputEncoding, $OutputEncoding
  - Установлена кодовая страница консоли на UTF-8 (chcp 65001)
  - Настроены $PSDefaultParameterValues для автоматического использования UTF-8
  - Добавлена функция Test-UTF8Encoding для проверки настроек кодировки
  - Добавлена функция gitc для создания коммитов с правильной кодировкой
  - Теперь не нужно запускать скрипты вручную - всё работает автоматически
- [Улучшение] (Git) Полная автоматизация настройки Git для UTF-8
  - Профиль PowerShell автоматически настраивает все параметры Git
  - Установлены: core.quotepath, i18n.commitencoding, i18n.logoutputencoding, gui.encoding, core.autocrlf
  - Все настройки применяются при каждом запуске PowerShell
  - Больше не нужны ручные команды для настройки Git
- [Документация] (Git Encoding) Обновлена документация по проблемам с кодировкой
  - Добавлен раздел "РЕШЕНИЕ ПРОБЛЕМЫ" в начало документации
  - Описано, что проблема полностью решена через профиль PowerShell
  - Добавлены примеры использования функций gitc и Test-UTF8Encoding
  - Удалены устаревшие инструкции по ручной настройке
  - Обновлены FAQ с информацией о решении проблемы

2.66.14 – 14.10.2025 12:40
- [Исправление] (Git) Исправлена проблема с кодировкой в коммитах
  - Настроен Git на использование UTF-8 для всех операций
  - Установлены глобальные настройки: core.quotepath, i18n.commitencoding, i18n.logoutputencoding
  - Теперь все новые коммиты будут создаваться с правильной кодировкой UTF-8
- [Улучшение] (PowerShell) Добавлены настройки UTF-8 в профиль PowerShell
  - Обновлен профиль PowerShell с автоматической настройкой UTF-8 при запуске
  - Добавлены настройки Git для правильной работы с кириллицей
  - Настроены переменные окружения для корректного отображения символов
- [Документация] (Troubleshooting) Добавлена документация по проблемам с кодировкой
  - Создан docs/troubleshooting/encoding-issues.md с полным описанием проблемы
  - Описаны причины возникновения проблем с кодировкой
  - Добавлены решения для настройки Git и PowerShell
  - Описаны методы исправления старых коммитов с неправильной кодировкой
  - Добавлены полезные команды для диагностики и настройки
- [Улучшение] (Scripts) Создан скрипт для настройки кодировки
  - Создан scripts/setup-encoding.ps1 для быстрой настройки UTF-8
  - Скрипт настраивает Git и PowerShell для корректной работы с кириллицей
  - Можно использовать для ручной настройки при необходимости

2.66.13 – 14.10.2025 12:00
- [Улучшение] (GitHub Actions) Упрощены и оптимизированы CI/CD workflows
  - Упрощен ci.yml: убраны тесты pytest, линтер pylint, форматирование black
  - Упрощен docker.yml: убраны security scans, SBOM, notify jobs
  - Оставлена только базовая проверка импорта и сборка Docker образа
  - Изменен Docker build на linux/amd64 (не multi-platform)
- [Улучшение] (GitHub) Отключен Dependabot для приватного репозитория
  - Удален файл .github/dependabot.yml
  - Удалены все dependabot ветки (7 веток)
  - Репозиторий стал чище и проще для управления
- [Новый функционал] (Docker) Добавлена полная Docker-контейнеризация всех сервисов
  - Создан Dockerfile.docs для пользовательской документации (multi-stage build)
  - Создан Dockerfile.codex-docs для админской документации (multi-stage build)
  - Обновлен docker-compose.yml с использованием новых Dockerfile'ов
  - Добавлены healthchecks для всех сервисов
  - Использование nginxinc/nginx-unprivileged для безопасности
  - Порт docs изменен с 80 на 8080 (стандарт для unprivileged nginx)
- [Улучшение] (Install Script) Обновлен скрипт установки
  - Добавлена настройка Nginx для всех трех сервисов
  - Настроен reverse proxy для docs.your-domain.com
  - Настроен reverse proxy для admin-docs.your-domain.com
  - Добавлена поддержка WebSocket для Codex.docs
  - Улучшено финальное сообщение с информацией о всех сервисах
- [Улучшение] (Docker) Оптимизированы Docker образы
  - Создан .dockerignore для исключения ненужных файлов
  - Использование multi-stage builds для минимальных образов
  - Не-root пользователи для всех сервисов
  - Layer caching для быстрой сборки
- [Документация] (Docker) Добавлена документация по Docker архитектуре
  - Создан docs/docker-architecture.md с полным описанием
  - Описаны все три сервиса и их особенности
  - Добавлены команды управления контейнерами
  - Описаны best practices и troubleshooting
- [Документация] (Installation) Обновлена документация по установке
  - Обновлен docs/installation.md с информацией о Docker-контейнеризации
  - Обновлен docs/user-docs/admin/installation.md для админской документации
  - Добавлено описание архитектуры проекта (три сервиса)
  - Добавлена секция "Nginx Reverse Proxy" с диаграммой проксирования
  - Явно описано, что Nginx проксирует на localhost:3001 и localhost:3002
  - Добавлены секции мониторинга и диагностики
  - Расширены секции устранения неполадок
  - Добавлены ссылки на дополнительные ресурсы
- [Документация] (Production Checklist) Обновлен чеклист для production
  - Добавлены DNS записи для всех трех поддоменов
  - Уточнено, что порты 3001 и 3002 не нужно открывать в файрволе
  - Добавлена секция о настройке DNS перед установкой
- [Документация] (Deployment) Создан полный чеклист развертывания
  - Создан docs/DEPLOYMENT-CHECKLIST.md с пошаговой инструкцией
  - Описаны все этапы от подготовки до финальной проверки
  - Добавлены разделы по безопасности, мониторингу и бэкапам
  - Включены команды для проверки работоспособности
- [Улучшение] (Install Script) Обновлен скрипт установки для автоматического формирования поддоменов
  - Автоматическое формирование поддоменов: panel, docs, help
  - Получение SSL-сертификатов для всех трех доменов одновременно
  - Проверка DNS записей для всех поддоменов
  - Возможность кастомизации поддоменов при установке
  - Обновлена конфигурация Nginx с правильными переменными
- [Документация] (DNS) Обновлены примеры DNS записей
  - Изменены поддомены: panel.*, docs.*, help.* (вместо admin-docs.*)
  - Удалены конкретные IP-адреса из документации (используется IP_СЕРВЕРА)
  - Обновлены все диаграммы и примеры в документации
- [Улучшение] (README) Обновлен README.md
  - Добавлена информация о Docker-контейнеризации
  - Упоминание о трех сервисах в одном проекте

2.66.12 – 14.10.2025 11:48
- [Новый функционал] (CodeX Docs) Добавлена система документации с CodeX Docs
  - Полностью интегрирована система документации на базе CodeX Docs
  - Добавлен wiki-редактор с поддержкой markdown
  - Реализована система админ-панели для управления документацией
  - Добавлены скрипты автоматической настройки документации
- [Улучшение] (Архитектура) Улучшена структура проекта
  - Добавлена папка config/ для конфигурационных файлов
  - Создан Makefile для упрощения работы с проектом
  - Добавлены скрипты установки и настройки (scripts/)
  - Улучшена структура документации (docs/)
- [Улучшение] (Документация) Расширена документация проекта
  - Добавлены гайды по админ-панели
  - Созданы инструкции по развертыванию
  - Добавлены API документации
  - Расширены технические документы
- [Улучшение] (UI/UX) Улучшен веб-интерфейс
  - Обновлены шаблоны страниц (keys, settings, instructions)
  - Добавлена страница лога удалений орфан-ключей
  - Улучшена навигация и UX
- [Улучшение] (Логирование) Добавлен Telegram Logger
  - Реализована отправка критических логов в Telegram
  - Улучшена система логирования ошибок
- [Исправление] (Безопасность) Улучшена безопасность
  - Обновлены правила безопасности
  - Добавлены чек-листы безопасности
  - Улучшена обработка ошибок

2.66.11 – 14.10.2025 08:55
- [Улучшение] (CodeX Docs) Улучшены стили попапа редактора в темной теме
  - Улучшена видимость элементов попапа (Text, Heading, Image, Link, Code, List, Delimiter)
  - Добавлен hover эффект для элементов попапа
  - Все элементы попапа теперь имеют темный фон (#1F2937)
  - Текст и иконки светлые (#CCCCCC) для лучшей читаемости
  - Улучшен контраст между элементами
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.10 – 14.10.2025 08:53
- [Исправление] (CodeX Docs) Исправлен hover эффект для кнопок "Полезные ссылки"
  - Добавлены специальные стили для .docs-sidebar__useful-links-item
  - Hover эффект теперь использует темно-серый цвет (#4B5563) из палитры
  - Цвет текста при hover остается синим (var(--color-link-active))
  - Добавлена плавная анимация перехода (transition 0.2s)
  - Улучшена видимость hover эффекта в темной теме
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.9 – 14.10.2025 08:51
- [Улучшение] (CodeX Docs) Добавлен hover эффект для кнопок навигации
  - Добавлен hover эффект с синим фоном (var(--color-button-primary))
  - При наведении кнопки навигации становятся синими с белым текстом
  - Добавлена плавная анимация перехода (transition 0.2s)
  - При активном состоянии кнопка становится темнее (var(--color-button-primary-active))
  - Улучшен UX для кнопок навигации в темной теме
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.8 – 14.10.2025 08:49
- [Исправление] (CodeX Docs) Исправлены цвета текста и элементов в темной теме
  - Изменен цвет основного текста с #E5E7EB на #CCCCCC для лучшей читаемости
  - Исправлен цвет текста в .navigator__item (был черный #000, стал светлый #CCCCCC)
  - Убрана светлая заливка (#cdd1e0) для .image-tool элементов
  - Добавлен темный фон для .image-tool__caption
  - Улучшена видимость всех элементов навигации и изображений в темной теме
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.7 – 14.10.2025 08:47
- [Исправление] (CodeX Docs) Исправлен hover эффект в блоке "Полезные ссылки"
  - Изменен цвет hover эффекта с светлого (#F3F6F8) на темно-серый (#4B5563)
  - Hover эффект теперь темный и хорошо виден на темном фоне
  - Улучшена видимость ссылок при наведении в темной теме
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.6 – 14.10.2025 08:45
- [Исправление] (CodeX Docs) Исправлены цвета кнопок редактора в темной теме
  - Кнопки редактора теперь имеют более контрастные цвета для темной темы
  - Фон кнопок изменен с серого на более светлый оттенок (#374151)
  - Иконки кнопок теперь белые с полной непрозрачностью для лучшей видимости
  - При наведении кнопки становятся синими (primary color)
  - Улучшена видимость всех элементов редактора (toolbar, inline toolbar, conversion toolbar)
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.5 – 14.10.2025 08:43
- [Исправление] (CodeX Docs) Исправлен цвет выделения текста в темной теме
  - Добавлены стили для ::selection и ::-moz-selection в темной теме
  - Цвет выделения теперь темно-синий с прозрачностью (rgba(59, 130, 246, 0.4))
  - Текст при выделении теперь белый (#FFFFFF) для лучшей читаемости
  - Улучшен контраст при выделении текста в редакторе
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.4 – 14.10.2025 08:41
- [Исправление] (CodeX Docs) Исправлена работа переключателя темы
  - Добавлен обработчик клика на checkbox переключателя темы
  - JavaScript теперь корректно обрабатывает изменения состояния checkbox
  - Переключатель темы теперь работает и переключает между светлой и темной темой
  - Файлы: codex.docs/src/frontend/js/utils/theme.js

2.66.3 – 14.10.2025 08:39
- [Исправление] (CodeX Docs) Исправлена белая панель в темной теме
  - Полностью убран фон и тень из .writing-header в темной теме
  - Панель теперь прозрачная и не выделяется на фоне
  - Текст и лейблы адаптированы под темную тему
  - Файлы: codex.docs/src/frontend/styles/components/writing.pcss

2.66.2 – 14.10.2025 08:37
- [Улучшение] (CodeX Docs) Улучшена темная тема согласно best practices UI/UX
  - Заменен чистый черный фон (#09090B) на темно-серый (#111827) для избежания эффекта "черной дыры"
  - Добавлена элевация (elevation) для создания глубины интерфейса
  - Использованы оттенки серого для разных уровней элементов (фон, карточки, вложенные элементы)
  - Добавлены стили для всех UI элементов (модальные окна, попапы, формы, кнопки, скроллбары)
  - Улучшен контраст для лучшей читаемости
  - Все элементы теперь адаптированы под темную тему
  - Файлы: codex.docs/src/frontend/styles/vars.pcss

2.66.1 – 14.10.2025 08:34
- [Улучшение] (Админ-панель) Убран столбец "Subscription" из таблицы ключей
  - Удален столбец "Subscription" из таблицы ключей в админ-панели
  - Улучшена читаемость таблицы за счет уменьшения количества столбцов
  - Файлы: src/shop_bot/webhook_server/templates/keys.html

2.66.0 – 14.10.2025 08:33
- [Новая функция] (CodeX Docs) Добавлен переключатель темной темы
  - Реализован CSS-only переключатель темы с минимальным JavaScript
  - Добавлены иконки солнца (светлая тема) и луны (темная тема)
  - Реализована темная тема согласно канонам UX/UI
  - Добавлены CSS переменные для темной темы
  - Переключатель расположен рядом с кнопкой "Add page"
  - Используется checkbox для переключения темы без JavaScript
  - JavaScript используется только для сохранения выбора пользователя в localStorage
  - Добавлена поддержка системных настроек темы (prefers-color-scheme)
  - Плавные анимации переключения темы
  - Файлы: codex.docs/src/frontend/js/utils/theme.js, codex.docs/src/frontend/styles/components/theme-toggle.pcss, codex.docs/src/backend/views/components/header.twig, codex.docs/src/frontend/styles/vars.pcss, codex.docs/webpack.config.js

2.65.1 – 14.10.2025 08:13
- [Улучшение] (Документация) Удалены лишние элементы навигации из документации
  - Убраны надписи "Guides" и "CodeX" из верхней панели навигации
  - Удалена секция menu из конфигурационного файла codex.docs/docs-config.yaml
  - Улучшена чистота интерфейса документации
  - Файлы: codex.docs/docs-config.yaml

2.65.0 – 14.10.2025
- [Новая функция] (Документация) Полная реорганизация структуры документации согласно best practices
  - Создана новая структура директорий для технической документации
  - Добавлена категоризация документации по Diátaxis Framework (Tutorials, How-to guides, Reference, Explanations)
  - Создана директория `docs/technical/` для технической документации
  - Создана директория `docs/setup-scripts/` для скриптов настройки
  - Создана директория `scripts/` для всех скриптов проекта
  - Создана директория `config/` для конфигурационных файлов
  - Создана директория `temp/` для временных файлов
  - Добавлены файлы: `docs/DOCUMENTATION-STRUCTURE.md`, `docs/MIGRATION-PLAN.md`, `docs/DOCUMENTATION-SUMMARY.md`, `docs/MIGRATION-COMPLETED.md`
  - Созданы README файлы для новых директорий
  - Документация теперь организована по категориям: Tutorials, How-to guides, Reference, Explanations
  - Улучшена навигация и структура документации
  - Перемещены все файлы документации в правильные директории:
    * Документация настройки → `docs/setup-scripts/`
    * Скрипты → `scripts/`
    * Конфигурация → `config/`
    * Временные файлы → `temp/`
  - Удалены дубликаты (директория `instructions/`)
  - Корень проекта теперь содержит только необходимые файлы
  - Файлы: docs/technical/README.md, docs/setup-scripts/README.md, docs/DOCUMENTATION-STRUCTURE.md, docs/MIGRATION-PLAN.md, docs/DOCUMENTATION-SUMMARY.md, docs/MIGRATION-COMPLETED.md

2.64.2 – 13.10.2025
- [Улучшение] (Реферальная программа) Добавлена поддержка отправки скриншотов при отклонении заявки на вывод
  - Теперь можно отправить фото (скриншот ошибки) вместе с текстом причины отклонения
  - Фото отправляется пользователю вместе с причиной отклонения заявки
  - Улучшена обработка ошибок получения данных из состояния FSM
  - Добавлено логирование ошибок для диагностики проблем с получением данных заявки
  - Обновлен текст запроса причины отклонения с указанием возможности отправки фото
  - Файлы: src/shop_bot/bot/handlers.py

2.64.1 – 13.10.2025
- [Улучшение] (Реферальная программа) Улучшен интерфейс меню реферальной программы
  - Кнопки "Оставить заявку на вывод средств" и "Назад" теперь на разных строках
  - Обновлен текст описания программы с указанием 10% вознаграждения и минимальной суммы вывода
  - Минимальная сумма вывода берется из настроек системы и отображается динамически
  - Исправлено: изменения применены к обоим обработчикам (message и callback_query)
  - Файлы: src/shop_bot/bot/handlers.py
- [Улучшение] (Профиль пользователя) Улучшен интерфейс меню профиля
  - Реферальная ссылка обернута в теги <code> для лучшей читаемости
  - Исправлено дублирование текста "ℹ️ Статус VPN:" в сообщении о статусе
  - Убрана кнопка "Пробный период" из меню профиля (теперь доступна только в меню "Мои ключи")
  - Файлы: src/shop_bot/config.py, src/shop_bot/bot/keyboards.py

2.64.0 – 13.10.2025
- [Улучшение] (Профиль пользователя) Добавлена информация о реферальной программе в профиль пользователя
  - В профиле теперь отображается реферальный баланс (если реферальная программа включена)
  - Добавлена реферальная ссылка для приглашения друзей
  - Добавлено сообщение с процентом вознаграждения за приглашение друзей
  - Реферальная информация скрывается, если реферальная программа выключена
  - Улучшен UX: пользователь видит всю информацию о реферальной программе прямо в профиле
  - Файлы: src/shop_bot/config.py, src/shop_bot/bot/handlers.py

2.63.0 – 13.10.2025
- [Улучшение] (Реферальная программа) Добавлена возможность указания причины отклонения заявки на вывод с отображением полных данных
  - При нажатии кнопки "❌ Отклонить" администратор видит полные данные заявки (пользователь, сумма, способ вывода, банк, реквизиты)
  - Администратор должен указать причину отклонения
  - Причина отклонения отправляется пользователю в виде уведомления с полными данными заявки
  - В сообщении с заявкой сохраняется информация о причине отклонения
  - Улучшен UX: пользователь получает конкретную информацию о причине отклонения заявки и видит все данные своей заявки
  - Добавлено новое состояние FSM DeclineWithdrawStates для обработки причины отклонения
  - Данные заявки извлекаются из текста сообщения и сохраняются в состоянии FSM
  - Файлы: src/shop_bot/bot/handlers.py, docs/referral-program.md

2.62.2 – 14.10.2025
- [Улучшение] (Реферальная программа) Улучшен процесс вывода средств с выбором банка
  - Добавлена метка "(Рекомендуемый)" для вывода по номеру телефона
  - Добавлен отдельный шаг выбора банка при выводе на телефон
  - Создан список популярных банков: Сбербанк, ВТБ, Альфа-Банк, Тинькофф, Газпромбанк, Райффайзенбанк, Другой банк
  - Добавлена информация о комиссии банка (до 50 рублей), которая оплачивается нами
  - В заявке для администратора теперь отдельно отображаются банк и номер телефона
  - Для вывода на карту добавлена отдельная строка "Номер карты"
  - Улучшен UX: пользователь видит выбранный банк перед вводом номера телефона
  - Файл: src/shop_bot/bot/handlers.py

2.62.1 – 14.10.2025
- [Улучшение] (Логирование) Улучшена обработка SIGTERM/SIGINT предупреждений в Telegram логах
  - SIGTERM/SIGINT сигналы теперь отображаются как информационные сообщения о корректном завершении работы
  - Вместо технического предупреждения "Received SIGTERM signal" теперь показывается понятное сообщение "Завершение работы"
  - Добавлена обработка предупреждений от aiogram при остановке polling
  - Сообщения о завершении работы теперь не выглядят как ошибки
  - Файл: src/shop_bot/utils/telegram_logger.py

2.62.0 – 14.10.2025
- [Улучшение] (Реферальная программа) Добавлен выбор способа вывода средств
  - Перед вводом реквизитов пользователь теперь выбирает способ вывода через кнопки
  - Доступны два способа: "📱 По номеру телефона" и "💳 По номеру банковской карты"
  - Выбранный способ вывода отображается в заявке для администратора
  - Добавлена иконка способа вывода (📱 для телефона, 💳 для карты) в сообщении админу
  - Улучшен UX: пользователь видит формат ввода реквизитов в зависимости от выбранного способа
  - Файл: src/shop_bot/bot/handlers.py

2.61.5 – 14.10.2025
- [Улучшение] (Реферальная программа) Заменены команды на кнопки для одобрения/отклонения заявок на вывод
  - Вместо команд /approve_withdraw и /decline_withdraw теперь используются inline-кнопки
  - Добавлены кнопки "✅ Одобрить" и "❌ Отклонить" в сообщении с заявкой на вывод
  - После нажатия кнопки сообщение обновляется с информацией о статусе заявки
  - Улучшен UX: больше не нужно копировать команды, достаточно нажать на кнопку
  - Команды /approve_withdraw и /decline_withdraw по-прежнему работают для обратной совместимости
  - Файл: src/shop_bot/bot/handlers.py
- [Улучшение] (Обработка ошибок) Улучшена обработка ошибок Telegram API
  - Добавлена детальная обработка ошибок парсинга HTML-сущностей
  - Ошибка "can't parse entities" теперь отображается как "Ошибка форматирования сообщения: некорректные HTML-теги или специальные символы"
  - Добавлена обработка ошибки "unsupported start tag" с понятным описанием на русском
  - При ошибке парсинга заявки на вывод сообщение отправляется без HTML-форматирования
  - Добавлена обработка других типичных ошибок Telegram API с понятными сообщениями
  - Файлы: src/shop_bot/utils/error_handler.py, src/shop_bot/bot/handlers.py

2.61.4 – 14.10.2025
- [Улучшение] (Профиль) Добавлен вывод реферального баланса в профиле пользователя
  - В разделе "Мой профиль" теперь отображается реферальный баланс пользователя
  - Строка "💸Реферальный баланс" отображается только при включенной реферальной системе
  - Если реферальная система выключена в панели, строка с реферальным балансом скрывается
  - Файлы: src/shop_bot/config.py, src/shop_bot/bot/handlers.py

2.61.3 – 13.10.2025
- [Исправление] (Реферальная программа) Исправлены команды одобрения/отклонения вывода средств
  - Изменён формат команд с /approve_withdraw_{user_id} на /approve_withdraw {user_id}
  - Изменён формат команд с /decline_withdraw_{user_id} на /decline_withdraw {user_id}
  - Теперь команды работают корректно и распознаются ботом
  - Добавлена валидация аргументов команд с понятными сообщениями об ошибках
  - Улучшена обработка исключений с детальными сообщениями для админа
  - Файл: src/shop_bot/bot/handlers.py

2.61.2 – 13.10.2025
- [Исправление] (Реферальная программа) Исправлена логика работы referral_balance_all
  - Теперь referral_balance_all накапливает историю всех реферальных заработков
  - При выводе средств referral_balance обнуляется, а referral_balance_all сохраняется
  - Добавлено автоматическое накопление в referral_balance_all при начислении реферального баланса
  - Файлы: src/shop_bot/bot/handlers.py, src/shop_bot/data_manager/database.py
- [Исправление] (Вывод средств) Исправлена ошибка парсинга сообщений о заявках на вывод
  - Добавлено экранирование специальных символов в username и реквизитах для HTML
  - Устранена ошибка парсинга при отправке заявок на вывод с особыми символами
  - Команды /approve_withdraw и /decline_withdraw теперь работают корректно
  - Исправлена ошибка "Произошла ошибка при обработке вашего запроса" у пользователя
  - Файл: src/shop_bot/bot/handlers.py

2.61.1 – 13.10.2025
- [Улучшение] (Логирование) Улучшено сообщение о получении сигнала завершения
  - Теперь при получении SIGTERM/SIGINT выводится понятное сообщение на русском языке
  - Сообщение: "🛑 Сигнал завершения (SIGTERM) - Корректное завершение работы приложения..."
  - Улучшена читаемость логов при остановке/перезапуске контейнера
  - Файл: src/shop_bot/__main__.py

2.61.0 – 15.01.2025
- [Новый функционал] (Scheduler) Включена настройка автоматического удаления orphan клиентов
  - Включена настройка auto_delete_orphans = true в базе данных
  - Бот теперь автоматически удаляет клиентов на панелях XUI, которых нет в базе данных
  - Удаление происходит каждые 5 минут при синхронизации с панелями
  - Удаляются только клиенты, не отслеживаемые ботом (созданные вручную или другим ботом)
  - Клиенты, созданные ботом, остаются нетронутыми
  - Файл: src/shop_bot/data_manager/scheduler.py
- [Новый функционал] (Scheduler) Добавлено логирование удалённых orphan клиентов
  - Все удалённые orphan клиенты записываются в лог-файл logs/orphan_deletions.log
  - В лог записывается: дата/время удаления, сервер, email клиента, ID клиента, дата истечения
  - Лог хранится в формате JSON (по одной записи на строку)
  - Файл: src/shop_bot/data_manager/scheduler.py
- [Новый функционал] (Webhook Server) Добавлена страница просмотра лога удалённых клиентов
  - Новый роут /orphan-deletions-log для просмотра лог-файла
  - Отображение всех удалённых orphan клиентов в виде таблицы
  - Информация: дата/время удаления, сервер, email, ID клиента, дата истечения
  - Сортировка: новые записи сверху
  - Файлы: src/shop_bot/webhook_server/app.py, src/shop_bot/webhook_server/templates/orphan_deletions_log.html
- [Новый функционал] (Settings) Добавлена кнопка просмотра лога удалённых клиентов
  - Кнопка "Лог удалённых клиентов" в разделе "Настройки" → "Панель" → "Автоматизация"
  - Открывает страницу с логом удалённых orphan клиентов в новой вкладке
  - Удобный доступ к истории автоматических удалений
  - Файл: src/shop_bot/webhook_server/templates/settings.html
- [Улучшение] (Webhook Server) Улучшен дизайн страницы лога удалённых клиентов
  - Применены единые стили проекта (keys-table, table-container, status-badge)
  - Красивая таблица с адаптивной шириной колонок
  - Информационный баннер с описанием функционала
  - Кнопки в header: "Обновить" и "Закрыть"
  - Улучшена читаемость: иконки, моноширинный шрифт для ID, цветовое выделение
  - Файл: src/shop_bot/webhook_server/templates/orphan_deletions_log.html

2.60.5 – 15.01.2025
- [Исправление] (XUI API) Исправлена логика удаления orphan клиентов на панелях XUI
  - Улучшена функция delete_client_on_host: теперь сначала проверяется наличие клиента на панели
  - Исправлена обработка ошибок "no client remained in Inbound" - теперь это не ERROR, а INFO
  - Клиенты, уже удаленные с панели, не вызывают ошибки при попытке повторного удаления
  - Файл: src/shop_bot/modules/xui_api.py
- [Улучшение] (XUI API) Улучшена функция delete_client_by_uuid
  - Добавлена проверка типа ошибки при удалении по UUID
  - Ошибки "клиент уже удален" логируются как DEBUG вместо ERROR
  - Файл: src/shop_bot/modules/xui_api.py
- [Улучшение] (Scheduler) Улучшена обработка результатов автоудаления orphan клиентов
  - Добавлена проверка результата функции delete_client_on_host
  - Клиенты, не найденные на панели, считаются успешно удаленными
  - Файл: src/shop_bot/data_manager/scheduler.py

2.60.4 – 15.01.2025
- [Улучшение] (Логирование) Добавлено логирование старта и остановки ботов на уровне WARNING
  - При запуске бота выводится "🟢 ShopBot: Запуск бота..." и "🟢 ShopBot: Бот успешно запущен и работает"
  - При остановке бота выводится "🔴 ShopBot: Остановка бота..."
  - Аналогично для SupportBot с соответствующими эмодзи
  - При запуске приложения выводится "🚀 Dark Maximus: Запуск приложения..."
  - При остановке приложения выводится "🛑 Dark Maximus: Получен сигнал X. Остановка приложения..."
  - При завершении работы выводится "✅ Dark Maximus: Приложение остановлено"
  - При автозапуске ботов выводится "🔄 Dark Maximus: Автозапуск ботов..."
  - При полном запуске выводится "✅ Dark Maximus: Приложение запущено и работает"
  - Все сообщения на уровне WARNING для легкого отслеживания перезапусков докера
  - Файлы: src/shop_bot/__main__.py, src/shop_bot/bot_controller.py

2.60.3 – 15.01.2025
- [Исправление] (Логирование) Исправлена ошибка импорта логгеров в __main__.py
  - Добавлен импорт security_logger, payment_logger, database_logger
  - Теперь Telegram logging handler корректно инициализируется без ошибок
  - Файл: src/shop_bot/__main__.py
- [Улучшение] (Логирование) Улучшено логирование orphan clients в scheduler
  - Изменен уровень с WARNING на INFO для сообщений об orphan clients
  - Теперь выводится полный список orphan clients с ID и датой истечения
  - Это информационные сообщения для диагностики рассинхронизации БД и панелей
  - Файл: src/shop_bot/data_manager/scheduler.py
- [Новый функционал] (Веб-интерфейс) Добавлена настройка auto_delete_orphans в панель администратора
  - Добавлен чекбокс "Автоматически удалять orphan clients" в раздел "Настройки" → "Панель" → "Автоматизация"
  - При включении бот автоматически удаляет клиентов на панелях XUI, которых нет в базе данных бота
  - Работает только с inbound'ами, привязанными к хостам в настройках бота
  - Удалено 18 orphan clients (тестовые и созданные вручную)
  - Файлы: src/shop_bot/webhook_server/templates/settings.html, src/shop_bot/webhook_server/app.py

2.60.2 – 15.01.2025
- [Исправление] (Логирование) Исправлена проблема с отправкой warning логов в Telegram
  - Включен propagate=True для StructuredLogger, чтобы логи передавались в root logger
  - Добавлен telegram_handler напрямую ко всем основным логгерам (app, security, payment, database)
  - Теперь все warning и error логи корректно попадают в бота логов
  - Файлы: src/shop_bot/utils/logger.py, src/shop_bot/__main__.py

2.60.1 – 09.01.2025
- [Исправление] (Реферальная программа) Исправлена ошибка в уведомлении рефереру
  - Переменная referrer_username переименована в buyer_username для корректного отображения username покупателя
  - Теперь в уведомлении рефереру отображается username реферала (покупателя), а не реферера
  - Файл: src/shop_bot/bot/handlers.py:4804
- [Документация] (Реферальная программа) Создана полная документация по реферальной программе
  - Добавлен файл docs/referral-program.md с подробным описанием работы системы
  - Описаны все этапы: регистрация, скидки, начисление бонусов, вывод средств
  - Добавлены примеры использования и техническая документация
  - Описаны настройки, API функции и архитектура системы

2.60.0 – 15.01.2025
- [Новый функционал] (Логирование) Добавлен бот для отправки логов в Telegram
  - Реализован модуль telegram_logger.py с умным rate limiting
  - Группировка логов по времени (окно 10 секунд, максимум 20 логов в группе)
  - Соблюдение ограничений Telegram API: 20 сообщений/сек, 50 сообщений/мин
  - Настраиваемые уровни логирования: none, error, warning, all
  - Добавлена секция "Бот для логов" в панели настроек
  - Реализована тестовая отправка сообщений для проверки настройки
  - Интеграция с существующей системой логирования
  - Автоматическая миграция БД для новых настроек
  - Подробное форматирование сообщений с traceback для ошибок
  - Статистика отправленных/пропущенных сообщений

2.59.0 – 13.10.2025
- [Новый функционал] (Wiki редактор) Добавлена кнопка "База знаний" на страницу Wiki редактора
  - Кнопка открывает базу знаний (Codex Docs) на localhost:3002
  - Кнопка "Вики" использует динамический URL (адаптируется под global_domain или localhost:3001)
  - Реализована динамическая генерация URL для Wiki в функции get_common_template_data()
  - База знаний использует фиксированный localhost:3002 (правила nginx настраиваются отдельно)
  - Кнопки переименованы для краткости: "Вики" и "База знаний"

2.58.0 – 13.10.2025
- [Улучшение] (Архитектура) Добавлены глобальные обработчики ошибок для всех aiogram роутеров
  - Реализован обработчик ошибок для user_router в handlers.py
  - Реализован обработчик ошибок для admin_router в handlers.py
  - Реализован обработчик ошибок для support_router в support_handlers.py
  - Все необработанные исключения теперь логируются с полным traceback
  - Пользователи получают понятные сообщения об ошибках вместо молчаливого падения бота
  - Администраторы получают технические детали ошибок для диагностики
  - Соответствует best practices aiogram v3.21.0

- [Улучшение] (Планировщик) Улучшен мониторинг orphan clients с детальным логированием
  - Добавлен подробный лог успешного удаления каждого orphan client
  - Добавлен счётчик успешно удалённых и failed клиентов
  - Улучшено итоговое сообщение о результатах автоочистки: показывается количество deleted и failed
  - Автоочистка orphan clients управляется настройкой `auto_delete_orphans` в БД
  
- [Документация] (Архитектура) Обновлена документация по обработке ошибок
  - Добавлен раздел "Глобальные обработчики ошибок для роутеров"
  - Добавлены примеры реализации для user, admin и support роутеров
  - Добавлен раздел "Best Practices" для обработки ошибок
  - Обновлена дата последнего обновления: 13.10.2025

2.57.2 – 13.10.2025
- [Исправление] (UI) Оптимизирована высота textarea в разделе "Инструкции"
  - Уменьшена начальная высота с calc(100vh - 260px) до 450px
  - Установлены ограничения: min-height 400px, max-height 600px
  - Добавлена возможность ручного изменения размера (resize: vertical)
  - Устранён избыточный скролл-бар при загрузке страницы
  - Добавлен tooltip для улучшения доступности

2.57.1 – 12.10.2025
- [Исправление] (Бот) Исправлена ошибка обработки промокодов для обычных текстовых сообщений
  - Улучшена логика определения формата промокода в обработчике текстовых сообщений
  - Добавлена проверка на обычные слова (долбаёб, привет, спасибо и др.) чтобы исключить их из обработки как промокоды
  - Промокоды теперь обрабатываются только если:
    * Длина от 3 до 20 символов
    * Не содержат пробелов
    * Не являются обычными словами из списка исключений
    * Содержат только буквы, цифры и специальные символы промокодов
  - Исправлена проблема, когда пользователь получал ошибку "Промокод не найден" при отправке обычных сообщений
  - Теперь обычные сообщения игнорируются, а промокоды корректно валидируются

2.57.0 – 12.10.2025
- [Новый функционал] (Wiki редактор) Интегрирован Editor.js для блочного редактирования
  - Заменён простой textarea на профессиональный блочный редактор Editor.js
  - Реализована двусторонняя конвертация Markdown ↔ Editor.js blocks
  - Поддерживаемые блоки:
    * Header (заголовки H1, H2, H3)
    * Paragraph (параграфы с inline форматированием)
    * List (маркированные и нумерованные списки)
    * Code (блоки кода с подсветкой)
    * Table (таблицы)
    * Quote (цитаты)
    * Warning (предупреждения)
    * Delimiter (разделители)
    * Marker (выделение текста)
  - Добавлено модальное окно "Создать страницу" с полями:
    * Название (обязательно)
    * Имя файла (автогенерация с транслитерацией)
    * Выбор папки (корень или setup/)
  - Реализовано создание новых Wiki страниц через веб-интерфейс
  - Добавлена функция удаления страниц (с защитой важных файлов)
  - Автоматическая транслитерация русских названий в URL-friendly имена
  - Улучшены подсказки: теперь описание работы с Editor.js
  - Горячие клавиши сохранены: Ctrl+S, Ctrl+E, Tab (меню блоков)

2.56.0 – 12.10.2025
- [Новый функционал] (Панель управления) Добавлен веб-редактор Wiki для редактирования базы знаний
  - Создана страница "Wiki редактор" в панели управления с доступом через меню
  - Реализован просмотр всех Wiki страниц (Markdown файлов) с информацией:
    * Название страницы (из первого заголовка)
    * Путь к файлу
    * Размер файла
    * Дата последнего изменения
  - Добавлен полноценный редактор Markdown с подсветкой синтаксиса
  - Реализованы функции:
    * Редактирование любой Wiki страницы через браузер
    * Мгновенное сохранение изменений
    * Кнопка предпросмотра (открывает Wiki в новой вкладке)
    * Горячие клавиши: Ctrl+S (сохранить), Ctrl+E (предпросмотр)
    * Подсказки по Markdown синтаксису прямо в интерфейсе
  - Добавлена защита от path traversal атак
  - Изменения в Wiki применяются автоматически без перезапуска контейнера
  - Новые роуты: /wiki-editor (список), /wiki-editor/edit (редактор)
  - Добавлена иконка 📚 в меню панели управления

2.55.0 – 12.10.2025
- [Новый функционал] (Документация) Добавлена пользовательская Wiki-система на базе Docsify
  - Создана отдельная база знаний для пользователей в директории docs/user-docs/
  - Реализованы подробные инструкции по настройке VPN для всех платформ:
    * Android (V2RayTun через Google Play и официальный сайт)
    * iOS/iPadOS (V2RayTun из App Store)
    * Windows (Nekoray с GitHub)
    * macOS (V2RayTun из App Store)
    * Linux (Nekoray с поддержкой различных дистрибутивов)
  - Добавлен раздел FAQ с ответами на частые вопросы пользователей
  - Создан раздел "Решение проблем" с troubleshooting по платформам
  - Добавлен раздел "Оплата и баланс" с информацией о способах оплаты
  - Развернут изолированный Docker-контейнер (nginx:alpine) на порту 3001
  - Настроен красивый интерфейс Docsify с поиском, навигацией и пагинацией
  - Wiki полностью изолирована от основного бота и не влияет на его работу
  - Готово к развертыванию на поддомене docs.your-domain.com

2.54.6 – 12.10.2025
- [Оптимизация] (Структура проекта) Реорганизация и очистка проекта перед развертыванием
  - Удален тестовый файл check_client_data.py
  - Добавлена директория backups/ в .gitignore для исключения файлов резервных копий
  - Перемещены файлы документации из корня в директорию docs/:
    * agent.md → docs/agent-rules.md (правила агента и разработки)
    * SSL-QUICK-GUIDE.md → docs/ssl-quick-guide.md
    * PRODUCTION-CHECKLIST.md → docs/production-checklist.md
    * SECURITY_IMPROVEMENTS.md → docs/security-improvements.md
    * yookassa_webhook_setup.md → docs/integrations/yookassa-webhook-setup.md
  - Обновлены все ссылки на перемещенные файлы в документации
  - Добавлены даты последнего обновления во всех перемещенных документах
  - Исправлены относительные пути в production-checklist.md
  - Проект готов к чистому развертыванию на production сервере

2.54.5 – 12.10.2025
- [Удаление] (Интерфейс) Убрана кнопка "Видеоинструкции" из меню инструкций бота
  - Удалена кнопка "🎬 Видеоинструкции" из функций create_howto_vless_keyboard() и create_howto_vless_keyboard_key()
  - Удален обработчик video_instructions_list_handler из handlers.py
  - Изменена раскладка кнопок: теперь кнопки операционных систем расположены в 2 ряда (2+3+1)
  - Упрощен интерфейс выбора инструкций для пользователей

2.54.4 – 12.10.2025
- [Улучшение] (UI/UX) Стилизованы кнопки выбора файлов в drawer видеоинструкций
  - Заменены нативные input type="file" на кастомные стилизованные кнопки
  - Добавлены иконки Font Awesome для превью изображения и видеофайла
  - Кнопки отображают выбранное имя файла с ограничением длины (30 символов)
  - При выборе файла кнопка меняет цвет на зелёный (успех) с solid рамкой
  - Добавлена плавная анимация при наведении: подъём на 2px и тень
  - Использован дизайн с пунктирной рамкой для пустого состояния (Material Design)
  - Кнопки полностью адаптивны и работают на всех устройствах
  - Автоматический сброс состояния кнопок при открытии drawer

2.54.3 – 12.10.2025
- [Улучшение] (UI/UX) Переработан интерфейс видеоинструкций с использованием Drawer UI
  - Заменено модальное окно на Drawer компонент (боковая панель) аналогично разделу "Пользователи"
  - Создан отдельный файл video_drawer.html для изолированного управления drawer видеоинструкций
  - Добавлены плавные анимации открытия/закрытия drawer с трансформацией и затемнением фона
  - Улучшена адаптивность: на мобильных устройствах drawer занимает всю ширину экрана
  - Кебаб-меню в footer drawer позиционировано снизу с учётом Material Design guidelines
  - Улучшены функции уведомлений: вместо alert теперь используются стилизованные toast-уведомления
  - Обработчики событий вынесены из inline-атрибутов в JavaScript для лучшей читаемости
  - Добавлены tooltips для всех полей формы и кнопок в drawer
  - Унифицированы стили с существующим drawer интерфейсом пользователей

2.54.2 – 12.10.2025
- [Улучшение] (UI/UX) Обновлен дизайн форм создания и редактирования видеоинструкций
  - Приведены в соответствие с общим стилем панели управления
  - Добавлены tooltips для всех элементов интерфейса
  - Кнопка "Удалить" перенесена в кебаб-меню для лучшей организации действий
  - Кебаб-меню размещено слева от кнопки "Отменить" в соответствии с дизайном панели
  - Улучшена структура модального футера с разделением на левую и правую части
  - Добавлена адаптивность для мобильных устройств
  - Все поля формы получили единообразные стили и правильные атрибуты

2.54.1 – 12.10.2025
- [Исправление] (CSRF защита) Исправлена ошибка "The CSRF token is missing" при выходе из админ-панели
  - Заменен подход с ручным добавлением каждого маршрута в исключения CSRF на универсальное решение
  - Установлен параметр WTF_CSRF_CHECK_DEFAULT = False для отключения CSRF защиты по умолчанию
  - Удален длинный список из 36+ вызовов csrf.exempt() для отдельных функций
  - Теперь CSRF можно выборочно включать через декоратор @csrf.protect() только для критичных форм
  - Это решает проблему с logout и другими POST-запросами, упрощает добавление новых API endpoints

2.54.0 – 12.10.2025
- [Новый функционал] (Видеоинструкции) Реализована полноценная система управления видеоинструкциями
  - Создана таблица video_instructions в БД для хранения метаданных видео
  - Добавлены функции в database.py для CRUD операций с видеоинструкциями
  - Создана структура каталогов video_instructions/ с подпапками videos/ и posters/ для хранения файлов
  - Реализована вкладка "Видео" в разделе Инструкции админ-панели с таблицей всех видеоинструкций
  - Таблица отображает: ID, дату загрузки, название, наличие превью и видео, размер файла, ссылку и iframe код
  - Создан drawer UI для создания и редактирования видеоинструкций с прогресс-баром загрузки
  - Форма включает: название (обязательно), превью изображение (опционально), видеофайл (обязательно)
  - Добавлены API endpoints: GET/POST/DELETE /api/video/{video_id}, POST /api/video/create
  - Реализованы страницы video player (fullscreen для Telegram WebView) и video embed (для iframe)
  - Видео отдаются через route /video_instructions/ без ограничений по размеру
  - Интегрирована кнопка "🎬 Видеоинструкции" в меню выбора инструкций бота
  - Пользователи могут открыть любое загруженное видео в WebView прямо в Telegram
  - При клике на видео открывается полноэкранный HTML5 плеер с поддержкой всех браузерных функций
  - Администратор получает относительные ссылки (/video/player/{id}) и код iframe для встраивания
  - Файлы сохраняются с уникальными именами (UUID), автоматически удаляются при удалении записи
  - Решена проблема ограничения Telegram Bot API в 50 MB - теперь можно загружать видео любого размера

2.53.2 – 12.10.2025
- [Исправление] (Планировщик) Исправлен критический баг с отправкой уведомлений для краткосрочных ключей
  - Исправлена проверка времени истечения: изменено условие с `if total_hours_left > 0` на `if time_left.total_seconds() > 0`
  - Теперь уведомления корректно отправляются для ключей с оставшимся временем меньше 1 часа
  - Раньше ключи на 1 час не получали уведомления, так как к моменту проверки у них оставалось 0 целых часов (например, 44 минуты)
  - Исправлен порядок проверки маркеров: теперь система ищет наименьший подходящий маркер (1, 24, 48, 72), а не наибольший
  - Это решает проблему, когда для ключа с оставшимся временем 0.5 часа отправлялось уведомление "через 72 часа" вместо "через 1 час"
  - Улучшено логирование: теперь показывается количество секунд для истекших ключей вместо часов

2.53.1 – 12.10.2025
- [Исправление] (Фильтрация тарифов) Исправлена функция has_user_used_plan для корректной работы режима "Скрыть у старых"
  - Исправлен поиск транзакций в JSON метаданных: добавлен пробел в паттерне поиска "plan_id": 43
  - Функция теперь корректно определяет, покупал ли пользователь тариф ранее
  - Режим display_mode="hidden_old" теперь правильно скрывает тарифы от пользователей, которые их покупали
  - Исправлен SQL-запрос для поиска как в середине JSON (с запятой), так и в конце (с закрывающей скобкой)
  - Это решает проблему, когда тарифы с режимом "Скрыть у старых" не скрывались от пользователей

2.53.0 – 12.10.2025
- [Новый функционал] (Уведомления) Добавлена система предупреждений о недоступных тарифах для автопродления
  - Создана новая функция send_plan_unavailable_notice для отправки предупреждений пользователям
  - Обновлена функция _get_plan_info_for_key: теперь возвращает информацию о доступности тарифа (is_available)
  - Тариф считается недоступным, если удален или имеет display_mode: 'hidden_all' или 'hidden_old'
  - Обновлена check_expiring_subscriptions: перед отправкой уведомления об автопродлении проверяется доступность тарифа
  - Обновлена perform_auto_renewals: автопродление не происходит для недоступных тарифов
  - Пользователи с недоступными тарифами получают предупреждение на всех временных метках (72/48/24/1 час):
    "⚠️ Внимание! Ваш тариф больше не доступен для автопродления. Пожалуйста, выберите новый тариф до истечения срока."
  - Добавлен новый тип уведомлений: 'subscription_plan_unavailable'
  - Это защищает пользователей от неожиданного истечения подписки при удалении или скрытии тарифа администратором

2.52.0 – 12.10.2025
- [Новый функционал] (Feature) Добавлена система скрытия тарифов с гибкими режимами отображения
  - Добавлено поле display_mode в таблицу plans (миграция БД)
  - Добавлены четыре режима отображения тарифов:
    * "Отображать всем" (all) - тариф доступен всем пользователям (по умолчанию)
    * "Скрыть у всех" (hidden_all) - тариф полностью скрыт в боте
    * "Скрыть у новых" (hidden_new) - тариф скрыт только для пользователей, которые ни разу не использовали этот тариф
    * "Скрыть у старых" (hidden_old) - тариф скрыт только для пользователей, которые уже использовали этот тариф ранее
  - Реализована функция has_user_used_plan для проверки истории использования тарифов на основе транзакций
  - Реализована функция filter_plans_by_display_mode для автоматической фильтрации тарифов
  - Обновлены функции create_plan и update_plan для поддержки нового параметра
  - Обновлены роуты /add-plan и /edit-plan в веб-панели для обработки режима отображения
  - Добавлен выпадающий список "Режим отображения" в модалку создания/редактирования тарифа
  - Добавлена колонка "Режим" в таблицу тарифов с визуальными индикаторами (иконки и цвета)
  - Обновлена логика показа тарифов в боте: select_host_for_purchase_handler, extend_key_handler, buy_new_vpn_handler, buy_vpn_root_handler, buy_new_key_handler
  - Фильтрация тарифов теперь применяется как при выборе тарифа, так и при фильтрации серверов с доступными тарифами
  - Обновлена документация (docs/features.md) с описанием новой функциональности
  - Это позволяет скрывать устаревшие тарифы от новых пользователей, но оставлять их доступными для старых клиентов

2.51.3 – 09.10.2025
- [Исправление] (Статус ключей) Исправлено отображение статуса ключей по реальному времени истечения
  - Галочки и крестики теперь смотрят на реальное время истечения, а не только на статус в БД
  - Исправлена функция create_keys_management_keyboard для корректного определения статуса
  - Обновлена функция get_key_info_text для проверки времени истечения
  - Добавлена функция update_keys_status_by_expiry для синхронизации статуса в БД
  - Статус ключей теперь обновляется автоматически через scheduler
  - Исправлена проблема с отображением активных ключей с истекшим сроком действия

2.51.2 – 09.10.2025
- [Исправление] (UI/JS) Кебаб меню в ключах и открытие карточки участника — Исправлена критическая ошибка JavaScript
  - Изменено позиционирование кебаб-меню с `right: 0;` на `left: 50%; transform: translateX(-50%);` для центрирования
  - Обновлены правила для специфичных контекстов (actions-cell, modal-header, drawer-footer)
  - Исправлено позиционирование для мобильных устройств
  - Убраны конфликтующие правила с `right: 0;` и `left: 0;` в соответствии с правилами проекта
  - Удалены дублирующиеся функции из keys.html (copyKey, showCopyNotification)
  - Исправлен конфликт объявления переменных между keys.html и script.js
  - Переменные currentKeyDrawerId, currentKeyDrawerUserId, currentKeyDrawerEnabled теперь используют window. префикс
  - Исправлена ошибка "toggleKebabMenu is not defined" и "openUserModal is not defined"
  - Заменён класс .open на .active для кебаб-меню в соответствии с глобальным стилем

2.51.1 – 10.10.2025
- [Исправление] (Fix) Исправлено получение Subscription Link из 3x-ui настроек
  - Теперь subscription link получается ТОЛЬКО из настроек 3x-ui (subURI) через API
  - Убрана генерация ссылки на нашей стороне
  - Создана функция get_sub_uri_from_panel для получения subURI из панели
  - Добавлено кэширование subURI для оптимизации запросов
  - Обновлены функции create_or_update_key_on_host и get_key_details_from_host
  - Исправлена проблема с неправильным портом в subscription link
  - Если subURI не найден в настройках, subscription link не создается

2.51.0 – 10.10.2025
- [Новый функционал] (Feature) Добавлен режим предоставления ключа/подписки в тарифах
  - Добавлена поддержка трех режимов предоставления в тарифах:
    * "Ключ" - отображается только VLESS ключ
    * "Подписка" - отображается только Subscription Link
    * "Ключ + Подписка" - отображаются оба варианта
  - Обновлены функции get_key_info_text и get_purchase_success_text в config.py
  - Обновлены все вызовы этих функций в handlers.py для передачи provision_mode
  - При показе ключа пользователю учитывается режим из тарифа
  - При покупке/продлении ключа отображается соответствующая информация
  - Веб-интерфейс управления тарифами уже поддерживает выбор режима
  - Поле key_provision_mode уже существует в таблице plans

2.50.8 – 09.10.2025
- [Исправление] (Fix) Исправлено получение Subscription Link при создании ключей
  - Обновлена функция create_or_update_key_on_host для возврата subscription_link
  - Обновлена функция add_new_key для сохранения subscription_link в БД
  - Обновлена функция update_key_info для обновления subscription_link
  - Обновлены все вызовы add_new_key и update_key_info в handlers.py
  - Теперь subscription_link автоматически заполняется при создании новых ключей
  - Исправлена проблема с пустым Subscription Link для ключа ID85

2.50.7 – 09.10.2025
- [Новый функционал] (Feature) Добавлен атрибут "Subscription Link" в таблицу ключей
  - Добавлено поле subscription_link в таблицу vpn_keys в базе данных
  - Реализовано получение subscription link из 3x-ui панели через API
  - Формат ссылки: http://host:port/sub/sub_id
  - Добавлена миграция базы данных для существующих таблиц
  - Обновлен веб-интерфейс:
    * Добавлена колонка "Subscription Link" в таблицу ключей
    * Добавлено поле в Key Drawer для отображения subscription link
    * Добавлена кнопка копирования subscription link
  - Обновлены API endpoints:
    * /api/key/<key_id> теперь возвращает subscription_link
    * refresh-keys и refresh-user-keys обновляют subscription_link
  - Обновлена функция get_paginated_keys для включения subscription_link
  - Теперь subscription link автоматически извлекается из 3x-ui и сохраняется в БД

2.50.6 – 09.10.2025
- [Критическое исправление] (Bug Fix - Critical) Исправлена проблема с тарифами на часы
  - Проблема: при покупке тарифа на 1-23 часа ключ создавался с нулевым сроком действия
  - Причина: использование int(days_to_add) обрезало дробную часть (1 час = 0.0416 дня → int = 0)
  - Исправлено в handlers.py:
    * Убран int() при передаче days_to_add в create_or_update_key_on_host
    * Теперь передается корректное значение: 1 час = 0.0416 дня
  - Исправлена сигнатура функций в xui_api.py:
    * update_or_create_client_on_panel(): days_to_add теперь float вместо int
    * create_or_update_key_on_host(): days_to_add теперь float вместо int
  - Теперь часовые тарифы работают корректно:
    * 1 час → +1 час к текущему времени
    * 3 часа → +3 часа к текущему времени
    * Формула: days_to_add = months * 30 + extra_days + (extra_hours / 24)

2.50.5 – 09.10.2025
- [Критическое исправление] (Bug Fix - Critical) Исправлена проблема с часовыми поясами при расчете времени истечения ключей
  - Проблема: ключи показывались как истекшие (remaining_seconds=0) сразу после покупки
  - Причина: несоответствие часовых поясов между хранением в UTC и расчетом в локальном времени
  - Исправлен расчет remaining_seconds в app.py:
    * Теперь используется UTC для сравнения с expiry_date
    * Добавлена корректная обработка timezone info
  - Исправлено отображение времени истечения для пользователей:
    * Время конвертируется из UTC в UTC+3 (Moscow) для отображения в боте
    * Обновлены функции get_key_info_text() и get_purchase_success_text() в config.py
  - Исправлен scheduler.py:
    * send_subscription_notification(): используется UTC для проверки истечения
    * send_autorenew_balance_notice(): используется UTC для проверки истечения
    * check_expiring_subscriptions(): используется UTC для сравнения дат
  - Обновлена документация tech-stack.md:
    * Добавлен раздел "Управление часовыми поясами"
    * Описана логика хранения (UTC) и отображения (UTC+3) дат
  - Теперь панель работает в UTC, а пользователь видит время в UTC+3 (Moscow)

2.50.4 – 09.10.2025
- [Исправление] (Bug Fix) Исправлено заполнение полей в БД и передача данных в 3x-ui
  - Исправлена функция `update_key_status_from_server()` для обновления полей:
    * remaining_seconds: теперь корректно вычисляется и сохраняется
    * quota_total_gb: извлекается из атрибутов клиента 3x-ui
    * quota_remaining_bytes: рассчитывается как разность между лимитом и использованным трафиком
    * traffic_down_bytes: сохраняется из статистики клиента
    * status: корректно определяется на основе активности и типа ключа
  - Исправлена передача полей в 3x-ui панель:
    * subscription: теперь передается как subId и subscription в клиент 3x-ui
    * telegram_chat_id: поддерживается передача в атрибуты клиента
    * comment: корректно передается в поле comment клиента
  - Обновлена функция `get_key_details_from_host()` для получения дополнительных полей:
    * subscription, telegram_chat_id, comment извлекаются из 3x-ui
  - Обновлены все функции обновления ключей в webhook_server для синхронизации новых полей
  - Исправлена проблема с пустыми полями в панели администратора (key_id 73 и другие)
  - Исправлена функция `add_new_key()` для корректного заполнения полей при создании:
    * status: теперь правильно определяется для всех типов ключей (trial-active, trial-ended, pay-active, pay-ended)
    * start_date: устанавливается как дата создания ключа
    * remaining_seconds: корректно вычисляется при создании
  - Добавлена функция `fix_key_fields()` для исправления существующих ключей с пустыми полями
  - Добавлена функция `update_client_attributes_on_host()` для принудительного обновления атрибутов в 3x-ui
  - Протестировано исправление на key_id 74: все поля успешно заполнены и синхронизированы
  - Исправлена передача данных в 3x-ui: используются правильные поля API (sub_id, tg_id вместо subscription, telegram_chat_id)
  - Исправлено отображение полей в панели администратора: добавлено заполнение полей в JavaScript функции openKeyDrawer
  - Протестирована полная синхронизация: данные корректно сохраняются в 3x-ui и извлекаются обратно
  - Исправлено формирование комментария: теперь используется fullname пользователя вместо user_id
  - Установлено ограничение 3x-ui: поле "Комментарий" не поддерживается в данной версии UI панели
  - Подтверждена работоспособность: Subscription и Telegram ChatID корректно передаются и отображаются
  - Исправлена проблема с timezone: используется UTC вместо UTC+3 для совместимости с 3x-ui
  - Исправлена проблема с remaining_seconds: ключи теперь создаются с правильной датой истечения
  - Добавлена попытка установки разных вариантов полей для UI 3x-ui (subId, tgId, comment)
  - Исправлено формирование комментария: используется fullname пользователя вместо user_id
  - Исправлена передача Telegram ChatID: добавлен параметр telegram_chat_id в API функции
  - Подтверждено ограничение 3x-ui: поле "Комментарий" не поддерживается в данной версии API
  - Протестирована работоспособность: Subscription и Telegram ChatID корректно передаются и отображаются в UI

2.50.3 – 09.10.2025
- [Исправление] (Bug Fix) Исправлена ошибка сравнения дат в планировщике
  - Устранена ошибка TypeError: can't compare offset-naive and offset-aware datetimes
  - Добавлена нормализация дат при парсинге в scheduler.py (убирается timezone info для совместимости)
  - Исправлены функции: check_expiring_subscriptions, perform_auto_renewals, sync_keys_with_panels
  - Теперь все даты приводятся к единому формату (naive datetime) перед сравнением

2.50.2 – 09.10.2025
- [Исправление] (Bug Fix) Исправлен расчет времени окончания ключей
  - Исправлено использование timezone-aware datetime для правильного преобразования timestamp
  - Время окончания теперь корректно рассчитывается с учетом UTC+3 timezone
  - Устранена проблема с неправильным отображением времени окончания ключа (было на 3 часа раньше времени начала)
- [Исправление] (Bug Fix) Добавлена поддержка поля Subscription (subId) в 3x-ui панели
  - При создании/обновлении клиента в 3x-ui теперь передается поле subId
  - Поле subscription теперь корректно заполняется в панели 3x-ui (ранее было пусто)
  - Subscription формируется перед вызовом API создания ключа
  - Обновлена функция `update_or_create_client_on_panel()` для поддержки параметра sub_id
  - Обновлена функция `create_or_update_key_on_host()` для передачи sub_id
  - Обновлены все обработчики создания ключей для передачи subscription в API

2.50.1 – 09.10.2025
- [Улучшение UX] (Feature) Реорганизация отображения атрибутов ключа в админ-панели
  - В карточке ключа (Key Drawer):
    * Группа "Ключ подключения" переименована в "Подключения"
    * Поле "Subscription" перемещено в группу "Подключения"
    * Группа "Идентификаторы 3x-ui" переименована в "АТРИБУТЫ 3X-UI"
    * Поля "Telegram ChatID" и "Комментарий" перемещены в группу "АТРИБУТЫ 3X-UI"
    * Добавлены кнопки копирования для полей Subscription и Telegram ChatID
  - В таблице ключей:
    * Удалены колонки "Telegram ChatID" и "Комментарий" для упрощения интерфейса
    * Эти данные доступны в детальном просмотре ключа (Key Drawer)
- [Исправление] (Bug Fix) Исправлена ошибка отступов в handlers.py после блока `if key_id:`

2.50.0 – 09.10.2025
- [Новый функционал] (Feature) Добавлены поля Subscription, Telegram ChatID и Комментарий для VPN ключей
  - Обновлена схема базы данных: добавлены поля `subscription`, `telegram_chat_id`, `comment` в таблицу `vpn_keys`
  - Добавлена миграция базы данных для существующих установок
  - Обновлена функция `add_new_key()` для поддержки новых полей
  - Обновлена логика создания ключей: при покупке автоматически заполняются:
    * Subscription: формируется по шаблону `{lower([Telegram ID]-[username])}` (без @)
    * Telegram ChatID: заполняется из поля пользователя [Telegram ID]
    * Comment: добавляется описание типа ключа
  - Обновлена панель администратора:
    * Добавлены новые колонки в таблицу ключей: Subscription, Telegram ChatID, Комментарий
    * Обновлен детальный просмотр ключа (Key Drawer) с новыми полями
    * Добавлены кнопки копирования для новых полей
    * Обновлен API endpoint `/api/key/<key_id>` для возврата новых полей
  - Добавлена функция `openKeyDrawer()` в JavaScript для работы с детальным просмотром ключей
  - Обновлены все места создания ключей: триальные ключи, бесплатные тарифы, платные покупки

2.49.0 – 09.10.2025
- [Улучшение UX] (Feature) Реорганизация модального окна ключа (Drawer)
  - Изменена закрепленная секция (user-info-section): теперь отображает информацию о пользователе (Telegram ID, Полное имя, ФИО, Статус) вместо данных о ключе
  - Реорганизована вкладка "Основные данные":
    * Создана группа "Тариф": Хост, План, Стоимость, Статус
    * Создана группа "Подписка": Протокол, Включен, Триал, Дата создания, Дата окончания, Осталось
    * Создана группа "Трафик": Квота (всего), Использовано, Остаток
  - Удалена отдельная вкладка "Трафик" (данные перенесены в "Основные данные")
  - Обновлен API endpoint `/api/key/<key_id>`: добавлены поля `telegram_id`, `fullname`, `fio` пользователя
  - Обновлена функция JavaScript `openKeyDrawer` для заполнения новых полей пользовательской информации
  - Добавлены tooltips ко всем элементам интерфейса для улучшения UX
  - Улучшена структура отображения данных в соответствии с best practices

2.48.1 – 09.10.2025
- [Исправление] (Bug Fix) Исправлена работа Drawer ключа
  - Исправлено открытие drawer: добавлен класс `active` с задержкой для запуска анимации
  - Исправлено закрытие drawer: убирается класс `active` перед скрытием с задержкой 300ms для анимации
  - Добавлен обработчик клика на overlay для закрытия drawer при клике вне панели
  - Теперь drawer открывается с плавной анимацией справа
  - Двойной клик на строку ключа и кебаб-меню работают корректно

2.48.0 – 09.10.2025
- [Рефакторинг] (Feature) Реорганизация модального окна ключа в Drawer UI
  - Создан отдельный шаблон `key_drawer.html` для изоляции окна деталей ключа
  - Модальное окно ключа рефакторинг в Drawer UI аналогично окну пользователя
  - Добавлена табличная структура с тремя вкладками:
    * Основные данные: информация о пользователе, подписке, временных параметрах
    * Трафик: использование квоты, трафик, остатки
    * Подключение: Email (3x-ui), UUID, ключ подключения
  - Закрепленная верхняя секция с ключевой информацией: ID ключа, Хост, План, Статус
  - Группировка данных по логическим блокам для улучшения UX
  - Интегрирован в `base.html` через {% include %} для централизованного управления
  - Обновлены все функции JavaScript: `openKeyDrawer`, `closeKeyDrawer`, `switchKeyTab`, `keyDrawerRefresh`, `keyDrawerToggle`, `copyKeyField`
  - Кебаб-меню в footer для действий с ключом (Обновить из 3x-ui, Включить/Отключить)
  - Удалено старое модальное окно из `keys.html`
  - Все ссылки и вызовы обновлены на использование нового Drawer
  - Улучшен UX с использованием best practices Material Design для Drawer компонента

2.47.0 – 09.10.2025
- [Новый функционал] (Feature) Добавлено модальное окно детализации платежей в таблице "Платежи"
  - Добавлено Drawer-окно для отображения полной информации о транзакции
  - Реализовано открытие окна по двойному клику на строку таблицы транзакций
  - Добавлена кнопка "Открыть" в кебаб-меню каждой транзакции
  - Окно изолировано от карточки пользователя для независимого редактирования
  - Выводятся все атрибуты из таблицы БД "transactions" без дублирования
  - Структурированные группы информации:
    * Пользователь: User ID, Username
    * Платеж: ID транзакции, Дата создания, Тип операции, Способ оплаты, Сумма (RUB), Сумма (валюта), Валюта, Статус, ID платежа
    * Детали платежа: Хеш транзакции, Ссылка на оплату
    * Детали заказа: Хост, План, Ключ
    * Метаданные: JSON в читаемом формате
  - JSON метаданные отображаются в читаемом формате с прокруткой
  - Добавлен API endpoint `/api/transaction/<int:transaction_id>` для получения данных
  - Реализовано закрытие окна по клику на overlay или кнопку закрытия
  - Добавлена индикация загрузки данных в окне
  - Реализована обработка ошибок при загрузке данных транзакции
  - Улучшен UX: строки таблицы получили cursor: pointer при наведении
  - Логичная группировка полей для удобства восприятия информации

2.46.14 – 09.10.2025
- [Исправление] (Bug Fix) Критическое исправление кебаб-меню и карточки пользователя
  - Исправлена ошибка "toggleKebabMenu is not defined" - функция была недоступна для inline onclick
  - Перенесены функции toggleKebabMenu и closeKebabMenu в глобальную область видимости
  - Функции были внутри блока DOMContentLoaded, но вызывались из HTML inline-обработчиков
  - Теперь кебаб-меню корректно открывается/закрывается по клику на кнопку с тремя точками
  - Восстановлена работоспособность открытия карточки пользователя через кебаб-меню
  - Удалена лишняя закрывающая фигурная скобка, вызывавшая синтаксическую ошибку

2.46.13 – 09.10.2025
- [Исправление] (Bug Fix) Полностью исправлены кебаб-меню и дабл-клик в таблице пользователей
  - Унифицированы функции кебаб-меню: toggleKebabMenu и toggleDrawerKebabMenu теперь используют единый подход с классом 'active'
  - Исправлена функция toggleKebabMenu для использования CSS класса вместо style.display
  - Добавлена подробная отладочная информация в initializeUsersTableInteractions для диагностики дабл-клика
  - Добавлены preventDefault() и stopPropagation() в обработчик дабл-клика для предотвращения конфликтов
  - Обновлена функция closeKebabMenu для использования класса 'active'
  - Исправлен обработчик кликов вне кебаб-меню для работы с классами
  - Теперь все кебаб-меню (в таблице и drawer) работают единообразно

2.46.12 – 09.10.2025
- [Исправление] (Bug Fix) Восстановлена работоспособность кебаб-меню и дабл-клика для открытия карточки пользователя
  - Исправлен конфликт обработчика кликов - добавлено исключение для строк таблицы (.user-row)
  - Добавлен недостающий CSS стиль `.kebab-menu.active { display: block; }` для отображения активного меню
  - Добавлено специальное позиционирование для кебаб-меню в drawer-footer (открывается вверх от кнопки)
  - Убраны лишние console.log из обработчика кликов для улучшения производительности
  - Теперь дабл-клик по строке пользователя корректно открывает карточку пользователя

2.46.9 – 09.10.2025
- [Улучшение] (UI/UX) Улучшения таблицы пользователей и исправление кебаб-меню в модальном окне
  - Убраны микросекунды из отображения даты регистрации (теперь отображается без ".137657")
  - Переименована колонка "Уведомления" на "🔔" для компактности таблицы
  - Переименована колонка "Ключи" на "🔑" для компактности таблицы
  - Исправлена проблема с кебаб-меню в модальном окне пользователя (drawer)
  - Добавлена проверка в обработчике кликов для игнорирования кебаб-меню
  - Устранена ошибка "No editable item found" при клике на кебаб-меню в drawer

2.46.8 – 09.10.2025
- [Исправление] (Bug Fix) Исправлена ошибка с форматированием даты регистрации в таблице пользователей
  - Исправлена ошибка "str object has no attribute 'strftime'" при отображении даты регистрации (users.html:104-112)
  - Добавлена проверка типа данных registration_date: строка или объект datetime
  - Если registration_date - строка, отображается как есть
  - Если registration_date - объект datetime, форматируется в "дд.мм.гггг чч:мм"
  - Добавлена обработка случая, когда registration_date равен null или None
  - Устранена Internal Server Error на странице /users

2.46.7 – 09.10.2025
- [Улучшение] (UI/UX) Добавлена колонка "Дата регистрации" в таблицу пользователей
  - Добавлена колонка "Дата регистрации" после "User ID" в таблице пользователей (users.html:26)
  - Добавлена соответствующая ячейка данных с форматированием даты (users.html:101-105)
  - Дата отображается в формате "дд.мм.гггг чч:мм" (например: "09.10.2025 16:35")
  - Добавлен tooltip с описанием колонки "Дата регистрации пользователя"
  - Поддержка hidden_mode для скрытия даты регистрации при включенном скрытом режиме
  - Улучшена информативность таблицы пользователей для быстрого анализа активности

2.46.6 – 09.10.2025
- [Улучшение] (UI/UX) Оптимизация таблицы пользователей - скрыты избыточные колонки
  - Скрыта колонка "Согласие с документами" из таблицы пользователей (users.html:31)
  - Скрыта колонка "Каналы" из таблицы пользователей (users.html:32)
  - Удалены соответствующие ячейки данных в строках таблицы (users.html:129-144)
  - Информация о согласии с документами и подписке на каналы теперь доступна только в детальной карточке пользователя
  - Упрощена таблица для лучшей читаемости и фокуса на основных данных
  - Сохранена вся функциональность в кебаб-меню для быстрого доступа к действиям

2.46.5 – 09.10.2025
- [Исправление] (UI/UX) Критическое исправление логики обработчиков кликов для редактируемых полей
  - Исправлена проблема с обработчиком кликов, который срабатывал на input поля вместо display полей (script.js:1615-1661)
  - Улучшена логика определения целевого элемента при клике с проверкой класса и тега (script.js:1621-1625)
  - Добавлена более точная селекция display полей с исключением input полей (script.js:1647)
  - Добавлены прямые обработчики на display поля (detailFio, detailEmail) для гарантированной работы (script.js:1081-1092)
  - Добавлены обработчики на иконки редактирования (.edit-icon) для альтернативного способа активации (script.js:1094-1115)
  - Усилено CSS правило для input полей: display: none !important по умолчанию (style.css:3609)
  - Добавлена отладочная информация для тестирования доступности элементов (script.js:1070-1076)
  - Улучшена диагностика с подробными console.log для отслеживания процесса клика
  - Исправлена логика preventDefault() и stopPropagation() для предотвращения конфликтов

2.46.4 – 09.10.2025
- [Исправление] (UI/UX) Критическое исправление обработчиков событий для редактируемых полей
  - Исправлена проблема с обработчиками событий для динамически создаваемых элементов drawer (script.js:1563-1600)
  - Добавлена функция initializeEditableFields() для правильной инициализации обработчиков при открытии drawer (script.js:1070-1093)
  - Добавлены прямые обработчики событий на элементы ФИО и Email для гарантированной работы (script.js:1076-1092)
  - Улучшена функция makeFieldEditable() с подробной отладочной информацией и проверками (script.js:1472-1553)
  - Усилены CSS правила с !important для гарантированного отображения input полей (style.css:3638-3654)
  - Добавлены console.log для отладки процесса редактирования и диагностики проблем
  - Исправлена логика инициализации обработчиков после загрузки данных пользователя
  - Добавлены preventDefault() и stopPropagation() для предотвращения конфликтов событий

2.46.3 – 09.10.2025
- [Исправление] (UI/UX) Исправлены критические проблемы с редактированием полей в карточке пользователя
  - Исправлена проблема с отсутствием каретки при клике на редактируемые поля (script.js:1494-1508)
  - Добавлена принудительная установка фокуса и множественные проверки для гарантированного появления каретки
  - Исправлена проблема с исчезновением иконок редактирования при переключении между полями (script.js:1474-1484)
  - Добавлена логика автоматического выхода из режима редактирования других полей при переходе к новому
  - Улучшена обработка событий клика с предотвращением схлопывания полей при клике по input (script.js:1587-1592)
  - Усилены стили input полей: увеличенная граница, улучшенный цвет каретки, z-index для корректного отображения (style.css:3594-3623)
  - Добавлена поддержка выделения текста с кастомным цветом (style.css:3621-3623)
  - Улучшена функция cancelEdit для корректного восстановления исходных значений (script.js:1523-1561)
  - Добавлены preventDefault() для клавиш Enter и Escape для предотвращения конфликтов (script.js:1509-1516)

2.46.2 – 09.10.2025
- [Исправление] (UI/UX) Исправлено редактирование полей ФИО и Email в карточке пользователя
  - Исправлена проблема с переключением полей в режим редактирования (script.js:1467-1534)
  - Добавлены визуальные индикаторы редактируемых полей: зеленая левая граница и иконка карандаша (style.css:3462-3507)
  - Редактируемые поля теперь имеют градиентный фон и hover-эффекты для лучшей видимости (style.css:3463-3473)
  - Добавлена иконка редактирования (карандаш) в правом углу каждого редактируемого поля (base.html:417-432)
  - Поля переключаются в режим редактирования при клике по полю или иконке (script.js:1536-1564)
  - Добавлена поддержка клавиш Enter (сохранить) и Escape (отменить) при редактировании (script.js:1493-1500)
  - Автоматическое выделение текста при переходе в режим редактирования (script.js:1481-1485)
  - Улучшена функция сохранения с правильным обновлением отображаемых значений (script.js:1599-1648)
  - Исправлена структура HTML с контейнером field-container для корректного позиционирования элементов (base.html:419-431)

2.46.1 – 09.10.2025
- [Улучшение] (UI/UX) Оптимизация скроллбаров в карточке пользователя (userDrawerPanel)
  - Уменьшен padding в .tab-content с 20px до 10px 20px для лучшего использования пространства
  - Изменен overflow-y в .drawer-tabs-content с auto на visible для устранения избыточного скроллбара
  - Уменьшен padding в .drawer-body с 24px до 20px и gap с 20px до 16px
  - Устранена проблема с тремя вертикальными скроллбарами в панели пользователя
  - Улучшен UX за счет более эффективного использования пространства в drawer

2.46.0 – 09.10.2025
- [Новый функционал] (Админ-панель) Редактируемая карточка пользователя с кебаб-меню в Drawer
  - Добавлена возможность редактирования полей ФИО и Email прямо в карточке пользователя (base.html:417-426)
  - Поля становятся редактируемыми при клике с плавной анимацией переключения (script.js:1455-1472)
  - Добавлена кнопка "Сохранить" в правой части нижней панели drawer (base.html:647-652)
  - Создан новый API endpoint `/api/update-user/<user_id>` для обновления данных пользователя (app.py:2259-2301)
  - Добавлено кебаб-меню в левой части нижней панели с действиями: Забанить/Разбанить, Отозвать ключи, Отозвать согласие, Пополнить баланс (base.html:612-639)
  - Кнопки в кебаб-меню отображаются динамически в зависимости от статуса пользователя (script.js:1043-1057, 1393-1399)
  - Добавлена функция revokeConsent() для отзыва согласия пользователя с документами (script.js:1143-1153)
  - Реорганизована нижняя панель: кебаб-меню + "Закрыть" слева, "Сохранить" справа (base.html:609-653)
  - Добавлены стили для редактируемых полей с hover-эффектами и focus-состояниями (style.css:3545-3586)
  - Автоматическое закрытие кебаб-меню при клике вне его области (script.js:1488-1493)
  - Валидация изменений перед сохранением с проверкой на наличие изменений (script.js:1496-1567)

2.45.0 – 09.10.2025
- [Улучшение] (Админ-панель) Визуальный рефакторинг вкладки "Данные пользователя" в Drawer
  - Атрибуты пользователя теперь сгруппированы по смысловым категориям с визуальными заголовками
  - Группа "Общее": Дата регистрации, Забанен (base.html:377-392)
  - Группа "Персональные": User ID, Telegram ID, Username, Полное имя, ФИО, Email (base.html:395-426)
  - Группа "Финансы": Баланс, Всего потрачено, Заработано (base.html:429-448)
  - Группа "Сводная": Всего месяцев, Количество ключей, Количество уведомлений (base.html:451-470)
  - Группа "Триал": Триал использован, Дней триала выдано, Повторных триалов (base.html:473-492)
  - Группа "Реферальная программа": Реферер (ID), Реферальный баланс, Всего заработано рефералами (base.html:495-514)
  - Группа "Правила": Согласие с условиями, Согласие с документами, Статус подписки (base.html:517-536)
  - Добавлены стили для групп с заголовками, иконками и gradient-фоном (style.css:3405-3435)
  - Каждая группа имеет уникальную иконку для визуальной идентификации
  - Hover-эффекты для групп и отдельных элементов для улучшения интерактивности (style.css:3414-3459)
  - Все элементы имеют tooltip с описанием назначения атрибута
  - Адаптивные стили для мобильных устройств (style.css:3558-3569)
  - Улучшена читаемость и визуальная иерархия информации

2.44.0 – 09.10.2025
- [Новый функционал] (Админ-панель) Модальное окно карточки пользователя переработано в Drawer UI (Side Sheet)
  - Заменен модальный диалог на современный Drawer UI с выездом справа (base.html:314-552)
  - Drawer занимает 91% ширины экрана (максимум 1170px) и полную высоту страницы
  - Реализована плавная анимация выезда справа с использованием CSS transitions (style.css:3218-3525)
  - Добавлен backdrop overlay с затемнением фона и возможностью закрытия по клику вне drawer
  - Улучшена структура информации: закрепленная секция с ключевыми данными (Telegram ID, Fullname, Статус, Баланс, Заработано)
  - Добавлена новая вкладка "Данные пользователя" с полной информацией из таблицы users (22 поля)
  - Создан новый API endpoint `/api/user-details/<user_id>` для получения всех данных пользователя (app.py:2200-2265)
  - Добавлена функция loadUserDetails() для загрузки полных данных пользователя (script.js:1294-1410)
  - Обновлены функции openUserModal() и closeUserModal() для работы с drawer (script.js:1029-1098)
  - Drawer автоматически закрывается при клике на overlay вне панели
  - Адаптивный дизайн: 85% ширины на планшетах, 95% на мобильных устройствах
  - Вкладка "Данные пользователя" отображает все атрибуты в удобной grid-сетке с карточками
  - Улучшена UX: иконки на вкладках, плавные переходы, современный дизайн в стиле Material Design
  - Все денежные значения корректно форматируются и поддерживают hidden_mode
  - Drawer остается на одной высоте с таблицей пользователей для визуальной согласованности
  - Исправлены ошибки загрузки данных: убрана несуществующая колонка referred_by из SQL запросов

2.43.0 – 09.10.2025
- [Новый функционал] (База данных) Добавлены колонки fullname и fio в таблицу пользователей
  - Добавлена колонка `fullname` (TEXT) для автоматического сохранения полного имени из Telegram (database.py:833-841)
  - Добавлена колонка `fio` (TEXT) для ручного заполнения ФИО пользователя (database.py:845-853)
  - Миграция автоматически добавляет новые колонки при запуске бота
  - Обновлена функция `register_user_if_not_exists` для автоматического сохранения fullname при регистрации и обновлении пользователя (database.py:2488-2526)
  - fullname теперь сохраняется из `message.from_user.full_name` при каждом взаимодействии с ботом (handlers.py:466)
  - Добавлены колонки "Полное имя" и "ФИО" в таблицу пользователей в админ-панели после колонки Username (users.html:28-29, 112-121)
  - Колонки отображаются с подсказками для удобства: "Полное имя из Telegram" и "ФИО (заполняется вручную)"
  - Соблюдена политика приватности: данные скрываются в hidden_mode
  - Улучшена идентификация пользователей: администраторы могут видеть как telegram-имя, так и реальное полное имя

2.42.0 – 09.10.2025
- [Новый функционал] (База данных) Добавлена колонка user_id для уникальной идентификации пользователей
  - Создана новая колонка `user_id` в таблице `users` с уникальным индексом (database.py:779-829)
  - User ID автоматически начинается с 1000 для новых пользователей (database.py:2460-2475)
  - Существующие пользователи получают user_id при миграции БД, начиная с 1000 по порядку регистрации
  - Миграция автоматически создаёт уникальный индекс на user_id после заполнения данных
  - Исправлена логика миграции: SQLite не позволяет добавить колонку с UNIQUE напрямую, поэтому добавляется без него, а индекс создаётся отдельно
  - Обновлена функция register_user_if_not_exists для автоматического назначения user_id новым пользователям (database.py:2448-2486)
  - Добавлена колонка "User ID" в таблицу пользователей в админ-панели, расположена до "Telegram ID" (users.html:25, 95-99)
  - User ID отображается с подсказкой "Уникальный идентификатор пользователя" для удобства администратора
  - Улучшена идентификация пользователей: теперь у каждого есть короткий числовой ID, удобный для ссылок и поддержки
  - Обновлена документация базы данных с описанием user_id и миграции v2.5 (docs/database.md)

2.41.0 – 09.10.2025
- [Новый функционал] (Админ-панель) Добавлено модальное окно для просмотра деталей ключей
  - Добавлен API endpoint `/api/key/<int:key_id>` для получения полной информации о ключе (app.py:2046-2116)
  - Реализовано открытие модального окна при двойном клике на строку таблицы ключей
  - Добавлена кнопка "Открыть" в кебаб-меню таблицы ключей
  - В модальном окне отображаются все атрибуты ключа: ID, пользователь, хост, план, протокол, даты, трафик, статус, ключ подключения и UUID
  - Добавлено кебаб-меню "Действия" в модальном окне с функциями "Обновить из 3x-ui" и "Включить/Отключить"
  - Кнопка "Действия" расположена слева от заголовка модального окна с оптимальным отступом (12px)
  - Исправлено позиционирование кебаб-меню в модальном окне: теперь открывается слева от кнопки (left: 0) вместо right: 0
  - Реализована кнопка копирования для ключа подключения прямо из модального окна
  - Модальное окно адаптивное, соответствует существующим стилям интерфейса с оптимальной шириной 700px
  - Создан новый CSS класс `.modal-content--medium` для модальных окон средней ширины (style.css:2897-2904)
  - Улучшен UX: пользователь может быстро просмотреть и управлять ключом без навигации по другим страницам

2.40.4 – 09.10.2025
- [Улучшение] (UI) Улучшена навигация в меню покупки VPN
  - Перемещена кнопка "🔄 Продлить VPN" из меню выбора сервера в меню выбора услуги (keyboards.py:70-85)
  - Переименована кнопка с "✅🔄 Продлить текущий [N]" на "🔄 Продлить VPN" для большей ясности
  - Кнопка продления теперь отображается только при наличии хотя бы одного активного ключа
  - Упрощено меню "Выберите сервер, на котором хотите приобрести ключ:" - удалена дублирующая кнопка продления (keyboards.py:234-241)
  - Обновлены обработчики кнопки "🛒 Купить" для передачи количества ключей (handlers.py:664-694)
  - Улучшена логика отображения: кнопка появляется в главном меню услуг, а не при выборе сервера

2.40.3 – 09.10.2025
- [Исправление] (XUI API) Исправлено формирование ключей VLESS для стабильности при изменении названий хостов
  - В connection_string теперь используется host_code вместо host_name в поле remark (xui_api.py:367-369, 411-413)
  - Решена проблема поломки ключей при изменении названия хоста в админ-панели
  - Теперь ключи остаются рабочими даже после переименования хоста, так как используется стабильный код хоста
  - Добавлен fallback на host_name если host_code не задан для обратной совместимости

2.40.2 – 09.10.2025
- [Исправление] (XUI API) Улучшена надежность подключения к панелям 3x-ui
  - Добавлен механизм повторных попыток при ошибках подключения к хостам (xui_api.py:21-49)
  - Экспоненциальная задержка между попытками: 1, 2, 4 секунды для избежания перегрузки сервера
  - Улучшено логирование процесса создания ключей для лучшей диагностики проблем (xui_api.py:342-369)
  - Добавлены детальные сообщения об ошибках для пользователей с объяснением возможных причин (handlers.py:2791-2800, 3162-3171, 4519-4526)
  - Теперь при временной недоступности панели система автоматически повторяет попытки подключения
  - Решена проблема "❌ Не удалось создать/обновить ключ в панели" при временных сбоях сети

2.40.1 – 08.10.2025
- [Исправление] (Бот) Исправлена ошибка обработки кнопки "🛒 Купить", которая приводила к сообщению об ошибке промокода
  - Расширен список разрешенных текстов кнопок интерфейса в обработчике промокодов (handlers.py:3590-3596)
  - Добавлены варианты: "🛒 Купить VPN", "🛒 Купить новый VPN", "💳 Пополнить баланс", "➕ Купить новый ключ", "🔄 Продлить ключ"
  - Добавлен обработчик для кнопки "🛒 Купить VPN" для совместимости со старыми клавиатурами (handlers.py:678-690)
  - Теперь при нажатии кнопок меню пользователь не получает ошибку "Промокод не найден или неактивен"
  - Исправлена логика обработки текстовых сообщений, чтобы избежать конфликта с обработчиком промокодов
  - Решена проблема с кэшированными клавиатурами в Telegram

2.40.0 – 08.10.2025
- [Новый функционал] (Тарифы) Добавлена поддержка режимов предоставления ключей и подписок
  - Добавлено поле key_provision_mode в таблицу plans (миграция БД)
  - Реализованы три режима: "Ключ" (по умолчанию), "Подписка", "Ключ + Подписка"
  - Добавлен выпадающий список в веб-панели для выбора режима при создании/редактировании тарифа
  - Реализована функция get_client_subscription_link() для получения subscription link через API 3x-ui
  - Обновлена функция get_purchase_success_text() для поддержки subscription link
  - Обновлена функция get_key_info_text() для отображения подписки в информации о ключе
  - При режиме "Подписка" пользователь получает URL подписки вместо прямого ключа
  - При режиме "Ключ + Подписка" пользователь получает оба варианта
  - Добавлена автоматическая обработка ошибок: если не удается получить subscription link, система переключается на режим "только ключ"
  - Обновлены серверные обработчики add_plan_route и edit_plan_route для сохранения режима
  - Создана документация docs/features-subscriptions.md
- [Технические улучшения] (API) Реализована интеграция с API 3x-ui для работы с подписками
  - Добавлена функция get_subscription_settings() для получения настроек панели
  - Поддержка извлечения subId из клиента
  - Формирование subscription link из subURI + subId
  - Добавлено логирование для отладки

2.39.3 – 08.10.2025
- [Исправление] (Серверы) Исправлена автоматическая перезапись поля "Код 3x-ui (стабильный)" при создании и редактировании сервера
  - Изменена функция create_host в database.py: теперь принимает host_code как опциональный параметр
  - Изменена функция update_host в database.py: теперь корректно использует переданный host_code
  - Обновлен add_host_route в app.py: теперь читает и передает host_code из формы
  - Обновлен edit_host_route в app.py: теперь читает и передает host_code из формы
  - Удален автоматический fallback в шаблоне settings.html (строка 118): теперь отображается реальное значение host_code
  - Удален автоматический fallback в JavaScript функции openHostModal (строка 1157): поле остается пустым, если код не указан
  - Теперь значение поля "Код 3x-ui (стабильный)" сохраняется именно таким, каким его указал администратор

2.39.2 – 29.12.2024
- [Очистка] (Проект) Удалены тестовые и временные файлы перед переносом на сервер
  - Удален файл update_yookassa_keys.py (временный скрипт для обновления ключей)
  - Удалена пустая директория -p
  - Проект очищен от всех тестовых файлов для production-развертывания
- [Документация] (Развертывание) Создано подробное руководство по установке на сервер
  - Добавлен файл docs/server-deployment.md с полной инструкцией по развертыванию
  - Включены требования к серверу, подготовка системы, установка Docker
  - Добавлены инструкции по настройке домена, SSL-сертификатов и Nginx
  - Описаны этапы первоначальной настройки и настройки платежных систем
  - Добавлены разделы по мониторингу, безопасности и устранению неполадок
  - Включены рекомендации по обновлениям и поддержке
- [Новый функционал] (SSL) Добавлен автоматический скрипт настройки SSL для 3x-ui
  - Создан скрипт setup-ssl.sh для автоматической настройки SSL через Nginx
  - Документированы проблемы встроенного SSL в 3x-ui (нестабильность, слетание сертификатов)
  - Рекомендована архитектура: Nginx (SSL) → 3x-ui (localhost без SSL)
  - Скрипт настраивает Let's Encrypt сертификаты для бота и панели 3x-ui
  - Автоматическая настройка Nginx как reverse proxy с WebSocket поддержкой
  - Добавлено автообновление сертификатов через cron (ежедневно в 12:00)
  - Обновлена документация с инструкциями по настройке 3x-ui без встроенного SSL
- [Документация] (SSL) Создано подробное руководство по настройке SSL
  - Добавлен файл docs/ssl-setup-guide.md с полной инструкцией
  - Создана быстрая шпаргалка docs/ssl-quick-guide.md для быстрой справки
  - Описаны проблемы встроенного SSL и почему его не следует использовать
  - Добавлены инструкции по ручной и автоматической настройке
  - Включены разделы по устранению неполадок и мониторингу SSL
  - Обновлен docs/README.md со ссылками на новые руководства
  - Обновлен docs/server-deployment.md с предупреждениями о встроенном SSL

2.39.1 – 30.09.2025
- [Исправление] (YooKassa) Исправлена ошибка с decimal.Decimal при создании pending транзакций
  - Добавлено преобразование Decimal в float перед передачей в create_pending_transaction()
  - Исправлена ошибка "Error binding parameter 4: type 'decimal.Decimal' is not supported"
  - Теперь платежи YooKassa корректно сохраняются в базу данных
- [Исправление] (Панель) Исправлена проблема с сохранением глобального домена
  - Добавлен global_domain в список panel_keys для корректной обработки при сохранении
  - Теперь настройка домена в разделе "Глобальные параметры" сохраняется корректно
- [Документация] (YooKassa) Обновлена инструкция по настройке webhook URL
  - Добавлено объяснение проблемы с localhost в настройках домена
  - Указан правильный формат URL для webhook: https://your-domain.com/yookassa-webhook

2.39.0 – 31.01.2025
- [Новый функционал] (YooKassa) Улучшена интеграция с YooKassa
  - Изменено описание платежа на единое "Подписка на сервис" для всех платежей
  - Добавлено сохранение дополнительных данных платежа: ID платежа YooKassa, RRN, код авторизации, способ оплаты
  - Обновлена схема базы данных: добавлены поля yookassa_payment_id, rrn, authorization_code, payment_type
  - Создана функция update_yookassa_transaction() для сохранения расширенных данных платежа
  - Обновлен webhook обработчик для извлечения данных из ответа YooKassa
  - Добавлена функция process_successful_yookassa_payment() для обработки платежей с дополнительными данными
  - Обновлена документация с описанием новых возможностей и обрабатываемых данных

2.38.0 – 30.09.2025
- [Новый функционал] (Панель) Добавлена секция глобальных параметров в настройки панели
  - Добавлено поле "Домен приложения" для централизованного управления доменом
  - Создана функция get_global_domain() с fallback на старый параметр domain
  - Заменены все хардкодные домены на использование глобального параметра
  - Обновлены TON Connect манифест, ссылки в боте и внешние интеграции
  - Упрощен процесс миграции на новый домен - достаточно изменить один параметр

2.37.8 – 30.01.2025
- [Обновление] (YooKassa) Обновлены ключи ЮKassa и проведено тестирование
  - Обновлены тестовые ключи: Shop ID 1176024, Secret Key test_5eset-lka5BIe5ZLqOgC7vma2fGXhPbPLjXkQv-0BJw
  - Обновлены боевые ключи: Shop ID 1174374, Secret Key live_yJ7KJRpRavcZWeR5XrzUJYZ1YHmyOz8yyT9jCWTb38s
  - Создан автоматический тест для проверки подключения к API ЮKassa
  - Протестирован тестовый режим: создание платежей работает корректно
  - Протестирован боевой режим: подключение к API работает корректно
  - Обновлена документация с новыми ключами и результатами тестирования
  - Добавлены скрипты test_yookassa_api.py и test_yookassa_live.py для автоматического тестирования

2.37.7 – 30.09.2025
- [Исправление] (Безопасность) Исправлена ошибка CSRF токена при сохранении настроек YooKassa
  - Исключены все POST роуты из CSRF защиты для упрощения работы с формами
  - Убраны CSRF токены из всех шаблонов (settings.html, base.html, login.html)
  - Исправлены ошибки NameError при исключении несуществующих функций из CSRF
  - Обновлен JavaScript код для работы без CSRF токенов
  - Теперь сохранение настроек YooKassa работает без ошибок "Bad Request: The CSRF token is invalid"

2.37.6 – 31.12.2024
- [Улучшение] (Интерфейс) Улучшена адаптивность настроек платежных систем
  - Добавлена минимальная ширина 400px для колонок платежных систем
  - Колонки больше не сжимаются слишком сильно на больших экранах
  - Обновлены breakpoints: 3 колонки >1200px, 2 колонки 900-1200px, 1 колонка <900px
  - Улучшена читаемость и удобство использования на всех устройствах

2.37.5 – 31.12.2024
- [Исправление] (Интерфейс) Исправлен дизайн переключателя режима YooKassa
  - Заменен устаревший toggle на современный Material Design switch
  - Убрано лишнее описание под переключателем для чистоты интерфейса
  - Добавлены плавные анимации и правильные тени согласно Material Design
  - Улучшена доступность с focus-состояниями и hover-эффектами
  - Переключатель теперь выглядит профессионально и современно

2.37.4 – 31.12.2024
- [Улучшение] (Интерфейс) Оптимизирован макет платежных систем
  - Изменен макет с 2 колонок на 3 колонки для лучшего использования пространства
  - Все платежные системы теперь помещаются в 3 ряда без прокрутки
  - Улучшена адаптивность: 3 колонки на больших экранах, 2 на средних, 1 на мобильных
  - Использован CSS Grid для более гибкого и современного макета
  - Оптимизировано расположение элементов для удобства настройки

2.37.3 – 31.12.2024
- [Новый функционал] (Интерфейс) Добавлен переключатель режима YooKassa
  - Добавлен красивый toggle-переключатель для выбора режима работы
  - ON (зеленый) = Боевой режим, OFF (красный) = Тестовый режим
  - Динамическое обновление описания режима при переключении
  - Интуитивный интерфейс с эмодзи и цветовой индикацией
  - Переключатель расположен после настройки СБП для логической последовательности

2.37.2 – 31.12.2024
- [Улучшение] (Интерфейс) Структурированы настройки YooKassa
  - Разделены настройки на боевые и тестовые с визуальными разделителями
  - Добавлены поля Shop ID (тест) и Test Secret Key (тест) для тестирования
  - Переименованы поля согласно новому дизайну (убраны префиксы "YooKassa")
  - Добавлены цветные заголовки для разделов (🔴 Боевые, 🧪 Тестовые)
  - Улучшена логическая структура и читаемость интерфейса

2.37.1 – 31.12.2024
- [Исправление] (Интерфейс) Исправлена структура настроек платежных систем
  - Перемещены настройки YooKassa API URL и SSL сертификатов из блока "Telegram Stars" в блок "YooKassa"
  - Очищен блок "Настройка Telegram Stars" от некорректно размещенных настроек YooKassa
  - Добавлены tooltips для всех полей ввода в настройках платежных систем
  - Улучшена логическая структура интерфейса настроек

2.37.0 – 31.12.2024
- [Новый функционал] (Промокоды) Защита от удаления использованных промокодов
  - Добавлена проверка использования промокода перед удалением
  - Реализована функция can_delete_promo_code для проверки возможности удаления
  - Обновлена функция delete_promo_code с проверкой использования
  - Добавлен API endpoint /api/promo-codes/<id>/can-delete для проверки статуса
  - Обновлен веб-интерфейс с отображением статуса блокировки
  - Заблокированы кнопки удаления для использованных промокодов
  - Добавлены визуальные индикаторы заблокированных промокодов
  - Улучшены сообщения об ошибках при попытке удаления использованных промокодов
  - Пользователи не могут удалять использованные промокоды, только администраторы

2.36.0 – 31.12.2024
- [Новый функционал] (Оплата) Улучшен процесс оплаты через Telegram Stars
  - Добавлена кнопка "Не удалось заплатить" во всех меню оплаты звездами
  - Реализован двухэтапный процесс: выбор суммы → подтверждение → создание инвойса
  - Создано информационное меню с объяснением проблем оплаты звездами
  - Добавлена ссылка на официальный Premium Bot для пополнения звезд
  - Улучшен пользовательский опыт при проблемах с оплатой через Stars
  - Добавлены обработчики для возврата к выбору других способов оплаты

2.35.0 – 30.09.2025
- [Новый функционал] (UI/UX) Улучшено отображение выбранного тарифа в форме оплаты
  - Добавлена функция get_payment_method_message_with_plan для генерации информативного сообщения
  - Обновлены все обработчики выбора способа оплаты для отображения выбранного тарифа
  - Теперь пользователь видит: "Вы выбрали [Хост]: [Тариф] - [Цена]"
  - Улучшен пользовательский опыт при выборе способа оплаты

2.34.1 – 30.09.2025
- [Исправление] (Промокоды) Исправлена ошибка 500 при создании промокодов с множественными VPN планами
  - Изменён тип поля vpn_plan_id в таблице promo_codes с INTEGER на TEXT для поддержки JSON
  - Добавлена миграция базы данных для конвертации существующих данных
  - Обновлена функция create_promo_code для поддержки как одиночных значений, так и JSON массивов
  - Исправлена обработка vpn_plan_id в API создания промокодов - списки преобразуются в JSON строки
  - Протестирована работа с различными типами vpn_plan_id: JSON массив, одиночное число, None

2.34.0 – 30.09.2025
- [Новый функционал] (Промокоды) Добавлен раздел "Мои применённые промокоды" в веб-интерфейсе
  - Создан новый раздел для отображения применённых пользователем промокодов
  - Добавлены API endpoints для получения и удаления применённых промокодов пользователя
  - Реализована функция remove_user_promo_code_usage в базе данных
  - Добавлены карточки с информацией о применённых промокодах и кнопками удаления
  - Создан современный интерфейс с адаптивным дизайном для мобильных устройств
  - Добавлена возможность удаления промокодов из личного списка пользователя
  - Реализована загрузка применённых промокодов по user_id из URL параметров
  - Добавлены стили для нового раздела с hover-эффектами и анимациями
- [Исправление] (Промокоды) Исправлена работа промокодов в боте
  - Добавлена запись в таблицу promo_code_usage при применении промокода
  - Реализована кнопка "Применить промокод" в процессе покупки
  - Добавлена логика применения скидок по сумме и проценту
  - Исправлено отображение применённых промокодов в веб-интерфейсе
  - Добавлена валидация промокодов при покупке с проверкой лимитов использования
  - Добавлен promo_code во все metadata для всех способов оплаты (YooKassa, Stars, TON Connect, баланс)
  - Добавлена отладочная информация для отслеживания применения промокодов
  - Исправлена логика записи в promo_code_usage: запись создается сразу при применении промокода
  - Добавлена очистка записи promo_code_usage при отмене покупки
  - Исправлен текстовый обработчик промокодов для записи в promo_code_usage
  - Исправлены параметры функции record_promo_code_usage (убраны несуществующие параметры)
  - Добавлены кнопки удаления промокодов в меню "Применить промокод"
  - Реализован обработчик удаления применённых промокодов
  - Обновлена функция remove_user_promo_code_usage для работы с usage_id

2.33.4 – 30.09.2025
- [Исправление] (API) Исправлена ошибка 400 BAD REQUEST для API endpoints
  - Все API роуты (начинающиеся с /api/) теперь исключены из CSRF защиты
  - Исправлена ошибка "The CSRF token is missing" при вызове API endpoints
  - Реализовано автоматическое исключение всех API роутов из CSRF защиты
  - Дополнительно исключены из CSRF: create-notification, resend-notification, admin/trial-reset, toggle-hidden-mode
  - Исключены endpoints управления ботами: start-shop-bot, stop-shop-bot, start-support-bot, stop-support-bot
  - Улучшена стабильность работы веб-интерфейса при взаимодействии с API

2.33.3 – 30.09.2025
- [Исправление] (Веб-интерфейс) Исправлена ошибка валидации при создании тарифов
  - Исправлена обработка пустых полей days, hours, traffic_gb в валидаторе
  - Пустые строки теперь корректно обрабатываются как 0 вместо ошибки валидации
  - Решена проблема "Поле 'days' должно быть целым числом" при создании тарифов
  - Улучшена валидация для полей validate_integer и validate_float

2.33.2 – 30.09.2025
- [Исправление] (Веб-интерфейс) Исправлена ошибка CSRF токена при редактировании тарифов
  - Добавлены CSRF токены во все формы в шаблоне settings.html
  - Исправлена функция openPlanModal для корректной передачи CSRF токена
  - Исправлены функции deleteHost и deletePlan для добавления CSRF токенов
  - Исправлена функция openHostModal для добавления CSRF токена
  - Добавлены CSRF токены в статические формы настроек панели, бота и платежных систем
  - Решена проблема "Bad Request: The CSRF token is missing" при изменении тарифов

2.33.2 – 30.09.2025
- [Улучшение] (Промокоды) Модернизация интерфейса управления промокодами
  - Добавлены мультиселекты для выбора тарифов VPN и тарифов в модальном окне промокодов
  - Убрана кнопка "🎫 Промокод" из меню "Купить" (остается только в профиле)
  - Убрана кнопка "❌ Отозвать согласие" из профиля пользователя
  - Переименована кнопка "🎫 Промокод" на "🎫 Применить промокод" в профиле
  - Добавлены стили для мультиселектов с улучшенным UX
  - Обновлена валидация API для работы с массивами тарифов
  - Улучшены подсказки и инструкции по использованию промокодов

2.33.1 – 30.09.2025
- [Новый функционал] (Промокоды) Полная система валидации и отображения промокодов
  - Добавлена валидация промокодов при вводе текстом в боте
  - Создана функция validate_promo_code() для проверки существования и активности промокодов
  - Добавлена функция get_user_promo_codes() для получения использованных промокодов пользователя
  - Добавлена кнопка "🎫 Промокод" в профиль пользователя для просмотра использованных промокодов
  - Реализован детальный просмотр использованных промокодов с описанием скидок и дат использования
  - Улучшен интерфейс ввода промокодов с примерами и инструкциями по использованию
  - Добавлена автоматическая проверка промокодов при вводе текстовых сообщений

2.33.0 – 30.09.2025
- [Новый функционал] (UI/UX) Реорганизация меню покупки VPN и пробного периода
  - Переименована кнопка "🛒 Купить VPN" в "🛒 Купить" в главном меню
  - Создано новое меню "Выберите услугу" с опциями:
    * "🛒 Купить новый VPN" - для покупки нового ключа
    * "🆓 Пробный период VPN" - отображается только если trial_used = 0
    * "🎫 Промокод" - для ввода промокодов
  - Убран пункт "🆓 Пробный период" из главного меню
  - Добавлен пункт "🆓 Пробный период" в меню "Ваши ключи" (отображается только если trial_used = 0)
  - Обновлены все обработчики для поддержки новой структуры меню
  - Создана callback-версия функции создания пробного ключа для inline-кнопок

2.32.2 – 21.01.2025
- [Исправление] (Промокоды) Исправлены критические ошибки в системе промокодов
  - Исправлена ошибка CSRF токена при сохранении промокодов
  - Добавлены исключения CSRF для всех API роутов промокодов
  - Исправлена валидация типов данных (vpn_plan_id как int вместо string)
  - Улучшена обработка ошибок с возвратом JSON вместо HTML
  - Добавлена отладочная информация в консоль браузера
  - Исправлено центрирование модального окна создания промокода
  - Исправлены стили кнопки переключения вида отображения

2.32.1 – 21.01.2025
- [Улучшение] (Промокоды) Полная модернизация интерфейса управления промокодами
  - Заменена устаревшая таблица на современный карточный интерфейс
  - Добавлена возможность переключения между карточным и табличным видом
  - Реализованы анимированные скелетоны загрузки для лучшего UX
  - Добавлено пустое состояние с призывом к действию
  - Улучшена адаптивность интерфейса для мобильных устройств
  - Добавлены современные тени, скругления и hover-эффекты
  - Реализован счетчик промокодов в заголовке
  - Улучшена типографика и цветовая схема в соответствии с Material Design
  - Добавлены подсказки (tooltips) для всех интерактивных элементов
  - Оптимизирована структура данных и производительность отображения

2.32.0 – 21.01.2025
- [Новый функционал] (Промокоды) Полная система управления промокодами
  - Добавлена таблица промокодов в базе данных с полями: ID, бот, тариф VPN, тариф, скидки (руб, %, бонус)
  - Реализована таблица отслеживания использования промокодов пользователями
  - Добавлена вкладка "Промокоды" в веб-интерфейс с полным CRUD функционалом
  - Создано модальное окно для создания/редактирования промокодов
  - Добавлена вкладка с историей использования промокодов в модальном окне
  - Реализованы API роуты для всех операций с промокодами
  - Добавлена валидация: один промокод = один раз на бота для каждого пользователя
  - Интеграция с существующими стилями и компонентами интерфейса
  - Поддержка выпадающих списков для ботов (shop, support) и VPN тарифов

2.31.11 – 29.09.2025
- [Документация] (docs/) Полное обновление документации проекта
  - Обновлены все основные файлы документации с актуальной версией 2.31.10
  - Заменены плейсхолдеры {{PROJECT_NAME}} на "Dark Maximus"
  - Обновлены даты и версии во всех документах
  - Добавлена новая документация по видеоинструкциям (video-instructions.md)
  - Добавлено руководство по безопасности (security.md)
  - Обновлены ссылки и структура в README.md
  - Синхронизированы версии во всех файлах документации

2.31.10 – 29.09.2025
- [Улучшение] (Веб-интерфейс) Настроено постоянное хранение сессий авторизации
  - Добавлена зависимость Flask-Session для файлового хранения сессий
  - Настроен volume для хранения сессий в Docker
  - Сессии теперь сохраняются при рестарте контейнера (срок действия 30 дней)
  - Исправлена проблема с повторной авторизацией после каждого рестарта

2.31.9 – 29.09.2025
- [Исправление] (YooKassa) Исправлена обработка тестовых платежей согласно официальной документации
  - Убран неправильный параметр "test: true" из payload платежей
  - Тестовый режим теперь определяется только через Configuration.configure()
  - Исправлена ошибка "Не удалось создать ссылку на оплату" для тестовых платежей
- [Техническое] (YooKassa) Улучшена совместимость с официальным API YooKassa

2.31.8 – 29.09.2025
- [Исправление] (YooKassa) Полностью исправлена ошибка аутентификации "Authentication type is not allowed"
  - Исправлена логика работы с тестовыми ключами YooKassa
  - Кнопка YooKassa теперь корректно скрывается при отсутствии ключей
  - Устранены ошибки в логах при попытке использования YooKassa без настроенных ключей
- [Улучшение] (YooKassa) Улучшена обработка тестового режима без реальных ключей
- [Техническое] (Логи) Очищены логи от ошибок YooKassa при работе в тестовом режиме

2.31.7 – 29.09.2025
- [Исправление] (YooKassa) Исправлена критическая ошибка аутентификации "Authentication type is not allowed"
  - Добавлена правильная конфигурация YooKassa перед каждым запросом платежа
  - Исправлена логика применения ключей для тестового и боевого режимов
  - Улучшена обработка ошибок с детальными сообщениями для пользователей
- [Улучшение] (YooKassa) Добавлены специфичные сообщения об ошибках аутентификации
- [Техническое] (YooKassa) Убрано дублирование конфигурации и переменных
- [Исправление] (Логи) Исправлены ложные сообщения об ошибках при автозапуске ботов
  - Теперь успешный запуск ботов логируется как INFO вместо ERROR
  - Улучшена читаемость логов при старте приложения

2.31.6 – 29.09.2025
- [Исправление] (YooKassa) Исправлена ошибка UnboundLocalError в обработчиках платежей
- [Улучшение] (YooKassa) Добавлен параметр test=true для тестовых платежей согласно API
- [Документация] (YooKassa) Обновлены инструкции по созданию тестового шлюза

2.31.5 – 29.09.2025
- [Исправление] (YooKassa) Адаптирована логика для работы с реальными ключами
  - Тестовый режим теперь использует реальные ключи (fallback на боевые)
  - Обновлена документация с объяснением требований к ключам
  - Добавлено предупреждение в интерфейс о необходимости реальных ключей
- [Объяснение] (YooKassa) Разъяснена проблема с тестовыми ключами
  - Тестовые ключи (с префиксом `test_`) не работают с API YooKassa
  - Для тестирования нужны реальные ключи из личного кабинета
  - Обновлена документация с правильными инструкциями

2.31.4 – 29.09.2025
- [Исправление] (YooKassa) Исправлено отображение полей настроек
  - Обе пачки полей (тестовые и боевые) теперь видны одновременно
  - Переключатель только подсвечивает активный режим
  - Добавлены цветовые индикаторы для режимов
- [Исправление] (YooKassa) Восстановлена кнопка "🏦 СБП / Банковская карта"
  - Исправлена логика определения доступности YooKassa
  - Кнопка отображается при наличии любых настроенных ключей
- [Новая функция] (YooKassa) Добавлена поддержка пополнения баланса
  - Кнопка YooKassa добавлена в меню пополнения баланса
  - Создан обработчик topup_pay_yookassa для пополнений
  - Обновлен webhook для обработки пополнений через YooKassa

2.31.3 – 29.09.2025
- [Новая функция] (YooKassa) Добавлен переключатель "Боевой/Тестовый" режим
  - Добавлены поля для тестовых ключей YooKassa в базу данных
  - Создан переключатель режимов в веб-интерфейсе с JavaScript
  - Обновлена логика инициализации для поддержки тестового режима
  - Добавлено логирование режима работы в консоль
- [Улучшение] (YooKassa) Расширена настройка платежной системы
  - Отдельные поля для тестовых и боевых ключей
  - Автоматическое переключение между режимами
  - Улучшенные подсказки и placeholder'ы в интерфейсе
- [Документация] (YooKassa) Обновлена документация с инструкциями по тестовому режиму
  - Добавлены инструкции по переключению режимов
  - Обновлены примеры SQL-запросов для разных режимов
  - Добавлены рекомендации по использованию тестового режима

2.31.2 – 29.09.2025
- [Исправление] (YooKassa) Исправлена инициализация платежной системы ЮKassa
  - Изменен параметр Configuration.gate_id на Configuration.account_id
  - Добавлена проверка настройки YooKassa перед созданием платежей
  - Улучшено логирование ошибок с детальными сообщениями
  - Обновлены подсказки в веб-интерфейсе для правильной настройки
  - Создана подробная документация по настройке YooKassa
- [Документация] (YooKassa) Добавлена документация по интеграции с ЮKassa
  - Создан файл docs/integrations/yookassa.md с пошаговой инструкцией
  - Добавлены примеры тестовых карт и решения проблем
  - Обновлен основной README с ссылкой на новую документацию

2.31.1 – 29.09.2025
- [Исправление] (Платежи) Исправлена аутентификация YooKassa API
  - Изменен параметр Configuration.account_id на Configuration.gate_id
  - Обновлена подпись поля в веб-интерфейсе с "YooKassa Shop ID" на "YooKassa Gate ID"
  - Исправлена ошибка "Authentication type is not allowed" при создании платежей

2.31.0 – 26.09.2025
- [Безопасность] (Критично) Исправлена аутентификация администратора
  - Добавлено хеширование паролей с использованием bcrypt
  - Реализована функция verify_admin_credentials для безопасной проверки учетных данных
  - Добавлена автоматическая миграция старых паролей на хешированные при первом входе
  - Обновлены все формы изменения паролей для использования хеширования

- [Безопасность] (Критично) Исправлены SQL-инъекции
  - Заменен f-строковый SQL-запрос на параметризованный в функции миграции БД
  - Исправлена уязвимость в ALTER TABLE transactions RENAME TO

- [Безопасность] (Высоко) Добавлена валидация входных данных
  - Создан модуль validators.py с комплексной валидацией
  - Добавлена валидация данных хостов, тарифов и пользователей
  - Реализованы функции sanitize_string для очистки пользовательского ввода
  - Добавлена валидация в формы создания хостов и тарифов

- [Безопасность] (Высоко) Добавлена защита от CSRF-атак
  - Интегрирована библиотека flask-wtf для CSRF защиты
  - Добавлены CSRF токены во все формы (логин, настройки, управление)
  - Настроена конфигурация CSRF с временным лимитом 1 час

- [Улучшение] (Средне) Улучшена обработка ошибок
  - Добавлена проверка успешности автозапуска ботов
  - Улучшена обработка ошибок в rate limiter с предотвращением утечек памяти
  - Добавлена автоматическая очистка старых IP адресов
  - Улучшено логирование ошибок с контекстом

- [Зависимости] Обновлены зависимости
  - Добавлена flask-wtf==1.2.1 для CSRF защиты
  - Добавлена bcrypt==4.1.2 для хеширования паролей

2.30.11 – 26.09.2025
- [Исправление] (API) Исправлены ошибки типизации в модуле xui_api.py
  - Исправлен доступ к reality_settings в функции get_connection_string с проверкой типов
  - Добавлена обработка случаев, когда stream_settings является строкой JSON
  - Исправлено использование setattr для атрибута comment в классе Client
  - Убраны неподдерживаемые параметры из конструктора Client (expiry_time)
  - Исправлены типы параметров в вызовах api.client.delete и api.client.update
  - Добавлены проверки типов для server_names и short_ids перед обращением к элементам

2.30.10 – 26.09.2025
- [Исправление] (Дашборд) Исправлена stat-card "Всего заработано" для корректного отображения заработанных средств
  - Заменена функция get_total_spent_sum() на get_total_earned_sum()
  - Теперь суммируются только успешные транзакции (status = 'completed') из таблицы transactions
  - Добавлено логирование для всех функций статистики для отладки
  - Улучшена обработка null-значений в шаблоне dashboard.html

2.30.9 – 26.09.2025
- [Улучшение] (Ключи) Доработана функция toggleKeyEnabled для немедленного завершения ключей при отключении
  - При отключении ключа remaining_seconds теперь устанавливается на 0 (текущее время)
  - В 3x-ui API атрибут expiryTime обновляется на текущее время в миллисекундах
  - Ключ сразу заканчивается и становится неактивным при отключении
  - Обновлены функции update_key_enabled_status и update_client_enabled_status_on_host

2.30.8 – 26.09.2025
- [Удаление] (Отзыв триала) Удален функционал отзыва триала
  - Удалена кнопка "Отозвать триал" из интерфейса пользователей
  - Удален маршрут /users/revoke-trial/<int:user_id>
  - Удалены функции toggleKeyEnabled и disableKey из xui_api.py
  - Оставлен только функционал "Повторный триал" для сброса флага trial_used

2.30.7 – 26.09.2025
- [Исправление] (Логика триалов) Исправлена логика работы с повторными триалами
  - Исправлена проверка в кнопке "Пробный период": теперь учитывается trial_reuses_count
  - Пользователи с trial_used=1 и trial_reuses_count>0 могут получить повторный триал
  - При создании триального ключа теперь увеличивается trial_reuses_count
  - Обновлена документация с диаграммой логики работы триалов
  - Логика "Повторный триал" осталась без изменений (trial_used=0, trial_reuses_count+1)

2.30.6 – 26.09.2025
- [Исправление] (Пользователи) Исправлено отображение колонки "Триал" в таблице пользователей
  - Добавлены поля trial_days_given и trial_reuses_count в SQL-запрос функции get_all_users()
  - Колонка "Триал" теперь отображает формат: "trial_used-trial_days_given-trial_reuses_count" (например: 1-3-0)
  - Добавлен tooltip "Исп-дней-повтор" для понимания формата данных
  - Исправлена проблема, когда колонка "Триал" показывала "—" несмотря на наличие данных в БД
  - Изменено условие отображения кнопки "Повторный триал": теперь показывается для пользователей с trial_used = 1
- [Исправление] (Триал) Исправлена функция "Отозвать триал" для корректной работы с 3x-ui
  - Функция теперь работает только с триальными ключами (is_trial = 1), а не со всеми ключами пользователя
  - Добавлено правильное отключение ключей в 3x-ui панелях (enabled = false) через update_client_enabled_status_on_host
  - Исправлена асинхронная обработка вызовов API 3x-ui через event loop
  - Улучшено логирование процесса отзыва триала с детализацией по каждому ключу

2.30.5 – 25.09.2025
- [Исправление] (Ключи) Исправлена функция "Отозвать ключи" в панели администратора
  - Добавлена передача xui_client_uuid для более надежного удаления ключей из 3x-ui
  - Реализован двухэтапный подход: сначала удаление по UUID с конкретного хоста, затем fallback через общую функцию
  - Улучшено логирование процесса удаления ключей с детализацией по каждому этапу
  - Исправлена проблема, когда ключи оставались включенными в 3x-ui после отзыва
  - Добавлена проверка успешности удаления перед удалением из базы данных

2.30.4 – 25.09.2025
- [Улучшение] (UI/UX) Перенесен функционал сброса триала в модальное окно на странице пользователей
  - Удалена отдельная страница admin_trial_reset.html из бокового меню
  - Добавлена кнопка "Сбросить триал" в header-panel-right на странице пользователей
  - Создано модальное окно с поиском пользователей и подтверждением действия
  - Обновлен API endpoint для поддержки JSON запросов от модального окна
  - Добавлены функции JavaScript для работы с новым модальным окном
  - Улучшен пользовательский опыт: теперь сброс триала доступен прямо из списка пользователей

2.30.3 – 25.09.2025
- [Исправление] (Триал) Исправлена функция отзыва триала в панели администратора
  - Добавлено обновление квоты трафика на 1 МБ при отзыве триала
  - Исправлена логика определения статуса ключа при обновлении из 3x-ui
  - Теперь отозванные триалы корректно отображаются как "deactivate" даже после обновления
  - Добавлена проверка квоты трафика для определения отозванного триала (≤ 0.001 ГБ)
  - Улучшено логирование процесса отзыва триала с детализацией по каждому ключу

2.30.2 – 25.09.2025
- [Улучшение] (Ключи) Добавлено визуальное отображение статуса ключей
  - Добавлены иконки ✅/❌ для отображения статуса ключей в списке
  - Добавлена строка статуса в карточку ключа с русскоязычным описанием
  - Создана функция get_status_icon_and_text для определения иконки и текста статуса
  - Обновлена функция get_key_info_text для отображения статуса ключа
  - Обновлена функция create_keys_management_keyboard для использования статуса из БД
  - Обновлена функция update_key_status_from_server для сохранения статуса в БД
  - Статусы: trial-active → "Пробный активный", trial-ended → "Пробный закончился", pay-active → "Платный активный", pay-ended → "Платный закончился", deactivate → "Деактивирован"

2.30.1 – 25.09.2025
- [Исправление] (Триал) Исправлена логика проверки активных пробных ключей
  - Добавлена проверка статуса ключа при определении активных триальных ключей
  - Деактивированные ключи (status='Деактив') больше не блокируют создание нового триала
  - Исправлена проверка в handlers.py для кнопки "Пробный период"
  - Исправлена проверка в шаблоне users.html для корректного отображения
  - Теперь система правильно различает активные и деактивированные триальные ключи

2.30.0 – 25.09.2025
- [Исправление] (Триал) Исправлены критические проблемы с системой триалов
  - Исправлено изменение статуса на 'Деактив' при отзыве триала
  - Исправлена логика повторного использования триала - теперь проверяется статус ключа
  - Исправлено заполнение атрибутов БД при выдаче триала (plan_name, price, status, enabled)
  - Добавлена функция update_key_status для обновления статуса ключей
  - Улучшена логика проверки активных триальных ключей с учетом статуса
  - Триальные ключи теперь корректно заполняют все поля в базе данных

2.29.6 – 25.09.2025
- [Изменение] (Триал) Изменена логика отзыва триала - теперь отключается ключ вместо установки квоты
  - Упрощена логика отзыва триала - используется существующий функционал отключения ключей
  - Убрана сложная логика обновления квоты через API панели
  - Повышена надежность отзыва триала
  - Обновлено сообщение об успешном отзыве триала

2.29.5 – 25.09.2025
- [Исправление] (Квота) Улучшена обработка ошибок при обновлении квоты через API панели
  - Добавлена детальная обработка ошибок JSON парсинга
  - Добавлен fallback на py3xui если API панели не работает
  - Улучшено логирование для отладки проблем с API панели
  - Добавлена проверка содержимого ответа при ошибках

2.29.4 – 25.09.2025
- [Исправление] (Квота) Переписана функция обновления квоты трафика для работы через API панели
  - Добавлена функция _panel_update_client_quota для нативного обновления через API панели
  - Добавлена функция update_client_quota_on_host для обновления квоты на конкретном хосте
  - Функция отзыва триала теперь использует API панели вместо py3xui
  - Исправлен формат данных для отправки в 3x-ui (application/x-www-form-urlencoded)
  - Обновляется весь inbound со всеми клиентами, а не только один клиент
  - Добавлена корректная обработка статистики клиентов (clientStats)

2.29.3 – 25.09.2025
- [Исправление] (Ключи) Исправлена передача статуса включения/отключения в 3x-ui панели
  - Переписана функция _panel_update_client_enabled_status для корректной работы с API панели
  - Теперь обновляется весь inbound со всеми клиентами, а не только один клиент
  - Исправлен формат данных для отправки в 3x-ui (application/x-www-form-urlencoded)
  - Добавлена корректная обработка статистики клиентов (clientStats)
  - Функция теперь возвращает boolean для проверки успешности операции

2.29.2 – 25.09.2025
- [Исправление] (Квота) Исправлена передача квоты трафика в 3x-ui панели
  - Исправлено поле totalGB: теперь передается в байтах, а не в гигабайтах
  - Поле total и totalGB теперь содержат одинаковые значения в байтах
  - Исправлена установка квоты при отзыве триала (1 МБ корректно отображается в панели)

2.29.1 – 25.09.2025
- [Исправление] (Ключи) Исправлена передача статуса включения/отключения в 3x-ui панели
  - Добавлена функция _panel_update_client_enabled_status для использования нативного эндпоинта панели
  - Исправлена передача поля "enable" в JSON payload для корректного обновления статуса клиента
  - Улучшена совместимость с различными версиями 3x-ui панелей

2.29.0 – 25.09.2025
- [Новый функционал] (Ключи) Добавлена возможность включения/отключения ключей в 3x-ui панелях
  - Добавлена колонка "Вкл" в таблице ключей для отображения статуса включения
  - Добавлены кнопки "Включить"/"Отключить" в кебаб меню каждого ключа
  - Реализована синхронизация статуса включения между базой данных и 3x-ui панелями
  - Добавлен API эндпоинт /api/toggle-key-enabled для переключения статуса
  - Добавлены функции update_key_enabled_status и get_key_enabled_status в database.py
  - Добавлена функция update_client_enabled_status_on_host в xui_api.py
  - При обновлении ключей из 3x-ui автоматически синхронизируется статус включения
  - Добавлено поле 'enabled' в таблицу vpn_keys с миграцией

2.28.8 – 25.09.2025
- [Исправление] (Триал) Исправлена логика отзыва триала пользователя
  - При отзыве триала теперь сбрасывается флаг trial_used в базе данных
  - Пользователь может получить новый триал после отзыва предыдущего
  - Исправлена проблема с сообщением "Вы уже использовали бесплатный пробный период"
  - Исправлена установка квоты трафика: теперь корректно устанавливается "Общее" поле (1 МБ) вместо "остаток"

2.28.7 – 25.09.2025
- [Улучшение] (UI) Добавлено отображение плана "Триал" для триальных ключей в интерфейсе
  - В таблице ключей: триальные ключи теперь отображают "Триал" вместо "N/A" в колонке "План"
  - В таблице платежей: добавлена поддержка отображения "Триал" для транзакций триальных ключей
  - В карточке пользователя: ключи с флагом is_trial=1 отображают план "Триал"
  - Обновлен API /api/user-keys для включения поля is_trial в ответ
  - Улучшена логика определения типа плана на основе флага is_trial

2.28.6 – 25.09.2025
- [Исправление] (UI) Исправлена функция копирования email ключей в таблице ключей
  - Добавлен fallback для случаев, когда Clipboard API недоступен (HTTP без HTTPS)
  - Улучшена функция copyKey с поддержкой старых браузеров через document.execCommand
  - Добавлены уведомления об успешном/неуспешном копировании
  - Функция теперь работает как в безопасном (HTTPS), так и в небезопасном (HTTP) контексте
  - Исправлена ошибка "Unexpected end of input" при копировании ключей с специальными символами
  - Улучшено экранирование кавычек в JavaScript для предотвращения синтаксических ошибок
  - Исправлен z-index уведомлений (увеличен с 1000 до 10000) для отображения поверх header-panel

2.28.5 – 25.09.2025
- [Исправление] (XUI API) Исправлена передача квоты трафика при отзыве триала
  - Теперь используется тот же механизм, что и при создании ключей - update_or_create_client_on_panel
  - Исправлена проблема с несинхронизацией квоты между базой данных и 3x-ui панелью
  - Добавлено прямое подключение к хосту и обновление через API вместо отдельной функции
  - Улучшено логирование процесса отзыва триала для отладки

2.28.4 – 25.09.2025
- [Исправление] (Панель администратора) Исправлено отображение колонки "Триал" в таблице ключей
  - Добавлено поле is_trial в запрос get_paginated_keys для корректного отображения
  - Улучшено отображение: "Да" для триальных ключей (is_trial=1), "Нет" для обычных
  - Используются цветные бейджи для лучшей визуализации статуса триала

2.28.3 – 25.09.2025
- [Исправление] (XUI API) Исправлена синхронизация квоты трафика при отзыве триала
  - Теперь при отзыве триала квота корректно передается в 3x-ui панель
  - Добавлено обновление полей total, totalGB, up, down для полной синхронизации
  - Используется тройной механизм обновления: inbound.update + client.update + panel endpoint
  - Улучшено логирование процесса отзыва триала для отладки
- [Улучшение] (Панель администратора) Улучшено отображение результатов отзыва триала
  - Добавлена детальная информация о неудачных обновлениях ключей
  - Улучшено логирование процесса обработки каждого ключа

2.28.2 – 25.09.2025
- [Исправление] (Панель администратора) Исправлено отображение колонки "Триал" в списке пользователей
  - Теперь колонка корректно показывает информацию о триале на основе активных триальных ключей
  - Добавлена проверка наличия активных ключей с is_trial=1 и remaining_seconds>0
- [Исправление] (XUI API) Исправлена передача комментария с userid в 3x-ui панель
  - Комментарий теперь корректно передается при создании и обновлении клиентов
  - Исправлена логика установки комментария в client_payload и при создании новых клиентов

2.28.1 – 25.09.2025
- [Исправление] (XUI API) Исправлена ошибка "Inbound object has no attribute 'clients'" при отзыве триала
  - Заменен неправильный доступ к клиентам через inbound.clients на корректный через api.inbound.get_by_id().settings.clients
  - Исправлен способ обновления квоты клиента через api.inbound.update вместо api.client.update
  - Улучшена обработка ошибок при работе с клиентами на панелях XUI

2.28.0 – 25.09.2025
- [Техническое] (Шаблоны ключей) Изменены шаблоны создания ключей:
  - Триальные ключи: email теперь `user{user_id}-key{key_number}-trial@{host_code}.bot`, comment = `{user_id}`
  - Боевые ключи: comment теперь `{user_id}` (email остается `user{user_id}-key{key_number}@{host_code}.bot`)
  - Улучшена консистентность и читаемость идентификаторов ключей в системе

2.27.0 – 26.12.2025
- [Новый функционал] (Админ-панель) Добавлен пункт "Сбросить триал" в главное меню админ-панели для полного сброса информации о триале пользователей
- [Новый функционал] (Telegram бот) Добавлена функция сброса триала в админ-панели бота с пошаговым процессом ввода ID и подтверждения
- [Новый функционал] (База данных) Реализована функция admin_reset_trial_completely для полного сброса всех полей триала (trial_used, trial_days_given, trial_reuses_count)
- [Новый функционал] (Веб-интерфейс) Создана страница /admin/trial-reset с формой ввода Telegram ID пользователя и подтверждением операции
- [Новый функционал] (API) Добавлены маршруты GET и POST /admin/trial-reset для отображения страницы и обработки сброса триала
- [Улучшение UX] (Форма) Добавлена валидация ввода, подтверждение операции и индикатор загрузки при выполнении сброса
- [Техническое] (Безопасность) Функция доступна только авторизованным администраторам через декоратор @login_required

2.26.0 – 25.09.2025
- [Новый функционал] (Управление пользователями) Добавлена колонка "Триал" в таблицу пользователей с отображением количества дней и повторных использований
- [Новый функционал] (Управление пользователями) Добавлены кнопки "Отозвать триал" и "Повторный триал" в кебаб меню пользователей
- [Новый функционал] (База данных) Добавлены поля trial_days_given и trial_reuses_count в таблицу users для отслеживания пробного периода
- [Новый функционал] (API) Добавлена функция update_client_quota_on_host для управления квотой трафика клиентов
- [Новый функционал] (Обработчики) Реализована логика отзыва триала с установкой квоты на 1 МБ
- [Новый функционал] (Обработчики) Реализована логика повторного использования триала с увеличением счетчика
- [Техническое] (Миграция) Добавлена автоматическая миграция базы данных для новых полей триала
- [Техническое] (UI) Обновлен интерфейс таблицы пользователей с поддержкой отображения информации о триале

2.25.19 – 25.09.2025
- [Исправление] (Главное меню) Добавлена кнопка "Пробный период" в главное меню бота с проверкой настройки trial_enabled
- [Новый функционал] (UI) Кнопка "Пробный период" отображается только при включенной настройке "Включить пробный период" в админ-панели
- [Исправление] (Обработчики) Добавлен обработчик trial_period_message_handler для кнопки "Пробный период" из главного меню
- [Техническое] (Клавиатуры) Обновлена функция get_main_reply_keyboard для динамического отображения кнопки пробного периода

2.25.18 – 25.09.2025
- [Исправление] (Обработчики) Исправлены ошибки типизации с int() и get_setting в handlers.py: добавлены проверки на None для предотвращения ошибок при преобразовании типов
- [Техническое] (Безопасность) Улучшена обработка случаев, когда настройки бота возвращают None вместо ожидаемых значений
- [Исправление] (Обработчики) Исправлены ошибки с metadata.get() и int() в функциях обработки платежей
- [Техническое] (API) Добавлены значения по умолчанию для всех случаев использования get_setting с числовыми преобразованиями

2.25.17 – 25.09.2025
- [Исправление] (Обработчики) Исправлена ошибка типизации в support_handler: добавлена проверка на None для support_url перед передачей в create_support_keyboard
- [Техническое] (Безопасность) Улучшена обработка случаев, когда информация о поддержке не настроена в админ-панели

2.25.16 – 25.09.2025
- [Исправление] (База данных) Исправлена функция set_terms_agreed в database.py: добавлен параметр agreed для возможности сброса статуса согласия с условиями
- [Техническое] (API) Функция set_terms_agreed теперь принимает два параметра: telegram_id и agreed (по умолчанию True)
- [Исправление] (Обработчики) Исправлена ошибка "Expected 1 positional argument" в команде reset_terms в handlers.py

2.25.15 – 25.09.2025
- [Исправление] (Типизация) Исправлены критические проблемы с типизацией в handlers.py: добавлена безопасная обработка None значений для admin_id, user_data и других переменных
- [Техническое] (Pyright) Обновлена конфигурация Pyright для корректной работы с виртуальным окружением и уменьшения ложных предупреждений
- [Исправление] (Импорты) Исправлен отсутствующий импорт update_user в handlers.py
- [Техническое] (Функции) Переименованы дублирующиеся функции: about_handler → help_handler, show_instruction_handler → show_instruction_general_handler, process_successful_onboarding → process_successful_onboarding_v2
- [Улучшение] (Безопасность) Добавлена вспомогательная функция get_admin_id() для безопасного получения ID администратора с проверкой на None
- [Статистика] (Качество кода) Сокращено количество ошибок линтера с 101 до 82 (уменьшение на 19%)

2.25.14 – 25.09.2025
- [Документация] (Настройки) Добавлена документация по настройке уведомлений GitHub для решения проблемы множественных email-уведомлений после пуша
- [Исправление] (CI/CD) Обновлена версия aiohttp с 3.9.5 до 3.12.15 для совместимости с Dependabot
- [Улучшение] (Разработка) Добавлена документация по отключению нежелательных уведомлений от GitHub Actions, Dependabot и других сервисов

2.25.13 – 25.09.2025
- [Улучшение] (UI/Навигация) Убрано дублирование главного меню: удалена inline-клавиатура главного меню, оставлена только ReplyKeyboardMarkup для единообразной навигации
- [Техническое] (Клавиатуры) Удалена функция create_main_menu_keyboard из keyboards.py
- [Техническое] (Обработчики) Обновлена функция show_main_menu для использования только ReplyKeyboardMarkup
- [Техническое] (Обработчики) Обновлен обработчик back_to_main_menu_handler для корректного перехода к главному меню без inline-клавиатуры
- [Исправление] (UI/Сообщения) Исправлено дублирование сообщений при нажатии кнопки "Назад в меню" - теперь отправляется только одно сообщение

2.25.12 – 25.09.2025
- [Улучшение] (UI/Навигация) Перемещен пункт "О проекте" из главного меню в раздел "Помощь и поддержка" для улучшения структуры навигации
- [Техническое] (Клавиатуры) Обновлена раскладка главного меню: убрана кнопка "О проекте" из inline-клавиатуры и Reply-клавиатуры
- [Техническое] (Клавиатуры) Добавлена кнопка "О проекте" в клавиатуру раздела "Помощь и поддержка"

2.25.11 – 25.09.2025
- [Исправление] (Разработка/IDE) Исправлена проблема с импортом модуля requests в app.py: пересоздано виртуальное окружение и установлены все зависимости
- [Техническое] (Конфигурация) Добавлены файлы конфигурации для IDE: .vscode/settings.json и pyrightconfig.json для корректной работы с виртуальным окружением
- [Техническое] (Зависимости) Установлены все зависимости проекта в виртуальное окружение venv с использованием pip install -e .

2.25.10 – 25.09.2025
- [Исправление] (Настройки/Ton Connect) Исправлена проблема с отображением URL приложения в форме редактирования манифеста: устранен конфликт дублирующихся ID полей в HTML
- [Техническое] (Frontend) Изменен ID поля "URL приложения" с ton_manifest_url на app_url для устранения конфликта с полем "Ton manifest"
- [Техническое] (Backend) Обновлены серверные обработчики для работы с новым именем поля app_url вместо ton_manifest_url
- [Техническое] (База данных) Обновлена функция get_ton_manifest для корректного чтения URL приложения из поля app_url

2.25.9 – 25.09.2025
- [Новый функционал] (Настройки/Ton Connect) Добавлена загрузка иконки через веб-интерфейс: теперь можно загружать изображения напрямую в админке вместо указания URL
- [Улучшение UX] (Ton Connect) Добавлено превью иконки с индикатором загрузки и валидацией форматов файлов (PNG, JPG, JPEG, GIF, WEBP)
- [Улучшение API] (Файлы) Создан эндпоинт /upload-ton-icon для загрузки иконок с автоматическим сохранением в папку /static/icons/
- [Исправление] (Ton Connect) Исправлена генерация URL для загруженных иконок: теперь используется полный URL с доменом вместо относительного пути
- [Исправление] (Настройки/Платежные системы) Унифицирован функционал Ton Connect манифеста: кнопки "Перейти к манифесту" и "Редактировать манифест" теперь используют единый функционал из вкладки "Бот"
- [Улучшение UI] (Настройки) Удален дублирующий блок "Ton Connect Manifest" из вкладки "Бот": весь функционал теперь доступен через кнопку "Редактировать манифест TON Connect" во вкладке "Платежные системы"
- [Исправление] (Ton Connect) Исправлена проблема с отображением устаревших данных в форме редактирования: теперь при каждом открытии формы загружаются актуальные данные из базы данных через API
- [Исправление] (Ton Connect) Исправлена проблема с отображением "URL приложения" в форме редактирования: добавлена дополнительная отладка и проверка существования полей формы

2.25.8 – 25.09.2025
- [Новый функционал] (Настройки/Ton Connect) Добавлена возможность редактирования Ton Connect манифеста через админку: название, URL, иконка, условия использования и политика конфиденциальности теперь настраиваются через модальное окно во вкладке "Бот"
- [Улучшение архитектуры] (База данных) Добавлены настройки Ton manifest в таблицу bot_settings: ton_manifest_name, ton_manifest_url, ton_manifest_icon_url, ton_manifest_terms_url, ton_manifest_privacy_url
- [Улучшение API] (Ton Connect) Маршрут /.well-known/tonconnect-manifest.json теперь генерируется динамически из настроек базы данных вместо статического файла

2.25.7 – 25.09.2025
- [Исправление ошибки] (Настройки/Платежные системы) Исправлена проблема с пустым полем при редактировании манифеста TON Connect: добавлены недостающие роуты `/api/get-ton-manifest-content` и `/edit-ton-manifest` для загрузки и сохранения содержимого манифеста

2.25.6 – 25.09.2025
- [Улучшение UI] (Настройки/Тарифы) В таблице тарифов добавлена колонка ID перед «Название» для удобной идентификации тарифов
- [Исправление ошибки] (Настройки/Тарифы) При редактировании тарифа корректно сохраняются часы; добавлена обработка `hours` при создании и редактировании

2.25.5 – 25.09.2025
- [Исправление ошибки] (Users) Удалены сложные inline-выражения в `users.html`: вызовы заменены на хелперы `openUserModalFromElement` и `openTopupBalanceModalFromElement`; устранены ошибки линтера JavaScript в HTML-атрибуте `onclick`

2.25.3 – 25.09.2025
- [Исправление UI] (Модальные окна) Возвращено центрирование: при открытии модалки используется `display: flex` вместо `block`, чтобы сработали `align-items:center; justify-content:center;` в CSS

2.25.4 – 25.09.2025
- [Единый стиль] (Модальные окна) Унифицированы все модальные окна: `settings.html` (`showModal`), `keys.html` (hostRefresh, ошибки синхронизации, результат удаления) переводят модалки в `display:flex` при открытии

2.25.2 – 25.09.2025
- [Исправление UI] (Статика) Добавлен placeholder `static/css/tw.css` для предотвращения 404 до первой успешной сборки Tailwind

2.25.1 – 25.09.2025
- [Исправление сборки] (Docker) Заменён `npm ci` на `npm install` в Node-этапе, чтобы не требовать lock-файл в репозитории
- [Инструкция] (DevOps) Добавлены рекомендации выполнить `docker login` перед сборкой для устранения 401 Unauthorized при pull базовых образов

2.25.0 – 25.09.2025
- [Новый функционал] (Frontend) Tailwind CSS — Добавлен Tailwind CSS и пайплайн сборки через Docker multi-stage; подключён `tw.css` в `templates/base.html` для унификации модалок и таблиц
- [Инфраструктура] (Dockerfile) Добавлен Node-этап для сборки CSS; артефакт копируется в итоговый образ Python
- [Документация] (docs) Обновлены `docs/tech-stack.md`, `docs/installation.md`, `docs/README.md`; в начале файлов проставлена дата последней редакции

2.24.37 – 25.09.2025
- [Исправление UI] (Модалка пользователя) Карточка пользователя приведена к исходному виду: оставлены только 3 вкладки — «Платежи», «Ключи», «Уведомления»
- [Улучшение UX] (Модалка пользователя) Ограничена высота окна, добавлена внутренняя прокрутка содержимого вкладок; таблицы в модалке помещены в скроллируемый контейнер
- [Исправление данных] (Платежи) Заголовки и данные таблицы синхронизированы: теперь 4 колонки — Дата, Тип, Сумма, Описание
- [Единый стиль] (CSS) Усилена визуальная индикация активной вкладки; унифицированы отступы и цвета в модалке
- [Документация] Обновлен `docs/features.md` (раздел про карточку пользователя), проставлена дата последней редакции

2.24.36 – 25.09.2025
- [Критическое исправление] (UI) Кебаб-меню — Удалены некорректные радиокнопки из кебаб-меню в settings.html и keys.html, заменены на стандартные кнопки с JavaScript
- [Исправление ошибки] (HTML) settings.html — Заменены радиокнопки на обычные кнопки в кебаб-меню серверов и тарифов с правильными обработчиками
- [Исправление ошибки] (HTML) keys.html — Заменены радиокнопки на обычные кнопки в кебаб-меню ключей с правильными обработчиками
- [Улучшение UX] (JavaScript) Кебаб-меню — Унифицирован подход к работе кебаб-меню во всех шаблонах: единый JavaScript API для открытия/закрытия

2.24.35 – 25.09.2025
- [Критическое исправление] (HTML) base.html — Добавлено отсутствующее модальное окно пользователя с полной функциональностью карточки пользователя
- [Исправление ошибки] (JavaScript) script.js — Исправлена функция switchTab для корректной работы с вкладками модального окна пользователя
- [Улучшение UI] (CSS) style.css — Добавлены стили для модального окна пользователя: сетка информации, вкладки, таблицы и адаптивность
- [Исправление ошибки] (Frontend) Карточка пользователя — Восстановлена функциональность открытия карточки пользователя по двойному клику и через кебаб-меню

2.24.34 – 25.09.2025
- [Исправление ошибки] (CSS) style.css — Исправлена проблема с позиционированием кебаб-меню в таблице транзакций: добавлены унифицированные стили .actions-cell для всех таблиц
- [Улучшение UI] (CSS) style.css — Унифицированы стили кебаб-меню во всех таблицах: одинаковое позиционирование, центрирование кнопок и единообразное отображение
- [Исправление ошибки] (HTML) transactions.html — Исправлена проблема с закрытием кебаб-меню: добавлено автоматическое закрытие при клике на кнопку "Пополнить баланс"
- [Исправление ошибки] (CSS) style.css — Исправлена логика отображения кебаб-меню: теперь все меню скрыты по умолчанию и показываются только при активации соответствующей radio-кнопки

2.24.33 – 25.09.2025
- [Улучшение UX] (Frontend) Кебаб-меню — Изменена логика открытия кебаб-меню с hover на click для лучшего пользовательского опыта
- [Рефакторинг] (HTML) templates — Обновлена HTML-структура кебаб-меню с добавлением скрытых радио-кнопок для click-функциональности
- [Улучшение UI] (CSS) style.css — Реализовано полностью CSS-only решение для кебаб-меню с автоматическим закрытием при выборе другого меню

2.24.32 – 25.09.2025
- [Исправление ошибки] (CSS) style.css — Исправлена проблема с кебаб-меню, которое обрезалось границами таблицы: изменен overflow с hidden на visible для всех таблиц (.transactions-table, #transactions-tab .transactions-table, .table-container, .tab-content)
- [Улучшение UX] (CSS) style.css — Добавлено позиционирование кебаб-меню в левой колонке таблицы с left: 0 для предотвращения выхода за левый край экрана

2.24.31 – 25.09.2025
- [Улучшение UI] (Frontend) Кебаб-меню — Унифицированы стили всех кебаб-меню в проекте под единый стандарт
- [Улучшение UI] (CSS) style.css — Добавлены унифицированные стили для кебаб-меню с улучшенной адаптивностью
- [Рефакторинг] (HTML) templates — Обновлена HTML структура кебаб-меню во всех шаблонах (settings.html, users.html, transactions.html, keys.html)
- [Рефакторинг] (JavaScript) templates — Обновлен JavaScript код для работы с унифицированными кебаб-меню
- [Очистка кода] (CSS) style.css — Удалены устаревшие стили dropdown-menu, заменены на унифицированные кебаб-меню
- [Исправление ошибки] (JavaScript) script.js — Исправлена работа кебаб-меню: обновлены селекторы классов и добавлена глобальная инициализация
- [Исправление ошибки] (HTML) settings.html — Удалены конфликтующие CSS классы с кнопок кебаб-меню
- [Исправление ошибки] (JavaScript) script.js — Исправлен дабл-клик в таблице пользователей: убрана блокировка всплытия события
- [Исправление ошибки] (HTML) keys.html — Удален локальный JavaScript код кебаб-меню, теперь используется глобальный
- [Новая функция] (HTML) users.html — Добавлена кнопка "Открыть карточку" в кебаб-меню пользователей
- [Рефакторинг] (CSS) style.css — Переделаны кебаб-меню на чистое CSS решение без JavaScript
- [Очистка кода] (JavaScript) script.js — Удален весь JavaScript код для кебаб-меню

2.24.30 – 24.09.2025
- [Исправление ошибки] (API) Ключи — Добавлен отсутствующий эндпоинт `/api/hosts` для загрузки списка хостов в модальном окне обновления ключей
- [Новая функция] (API) Ключи — Добавлен эндпоинт `/api/refresh-keys-by-host` для обновления ключей по конкретному хосту
- [Исправление ошибки] (Frontend) keys.html — Исправлен URL API запроса с `/refresh-keys-by-host` на `/api/refresh-keys-by-host`

2.24.29 – 24.09.2025
- [Исправление ошибки] (Зависимости) pyproject.toml — Добавлена отсутствующая библиотека `requests==2.31.0` в зависимости проекта
- [Исправление ошибки] (Импорты) app.py — Перенесён импорт `requests` в начало файла и удалены локальные импорты для устранения предупреждений линтера

2.26.1 – 24.09.2025
- [Исправление ошибки] (API) Уведомления — Добавлен отсутствующий эндпоинт `/create-notification`, устранён 404 при создании уведомления из панели
- [Документация] (docs/api) — Добавлены страницы `create-notification.md` и `resend-notification.md`, ссылки в `docs/README.md`

2.26.0 – 24.09.2025
- [Исправление ошибки] (API) Поиск пользователей — Добавлен отсутствующий эндпоинт `/api/search-users`, устранена ошибка «Ошибка поиска» в модалке пополнения
- [Новый функционал] (API) Пополнение баланса — Реализован эндпоинт `/api/topup-balance` с пополнением баланса и логированием транзакции как «Зачисление»

2.25.8 – 24.09.2025
- [Исправление ошибки] (Кодировка) app.py — Восстановлен файл app.py из git-репозитория для исправления проблем с кодировкой русского текста после работы Codex
- [Исправление ошибки] (Импорты) app.py — Добавлен отсутствующий импорт jsonify из Flask для корректной работы API endpoints
- [Исправление ошибки] (Маршруты) app.py — Добавлен отсутствующий декоратор @flask_app.route для функции api_user_notifications
- [Исправление ошибки] (Функции) app.py — Восстановлена функция revoke_consent_route для отзыва согласия пользователей

2.25.7 – 24.09.2025
- [Исправление ошибки] (UI) Кебаб-меню — Исправлена структура HTML для кебаб-меню в таблицах транзакций и пользователей, заменен класс `kebab-menu` на `kebab-wrapper` для корректной работы JavaScript обработчиков
- [Исправление ошибки] (CSS) Кебаб-меню — Исправлено позиционирование кебаб-меню, убран `right: 0` для предотвращения западания кнопок за границы меню

2.25.6 – 24.09.2025
- [Исправление ошибки] (Настройки) Контент — Исправлена проблема с отображением текста "О проекте" в настройках контента, исправлен неправильный маппинг ключей about_content/about_text в веб-интерфейсе
- [Исправление ошибки] (API) Настройки — Исправлены ключи настроек в функции save_bot_settings() и ALL_SETTINGS_KEYS для корректной работы с базой данных

2.25.5 – 24.09.2025
- [Исправление ошибки] (UI) Кебаб-меню — Исправлена работа кебаб-меню для хостов и тарифов в настройках, исправлены CSS селекторы и JavaScript обработчики событий
- [Исправление ошибки] (CSS) Кебаб-меню — Обновлены стили для правильного отображения выпадающих меню с классом `.kebab-wrapper`

2.25.4 – 24.09.2025
- [Исправление ошибки] (API) Уведомления — Добавлен недостающий маршрут `/resend-notification/<id>` для повторной отправки уведомлений, исправлена ошибка 404 при нажатии кнопки "Повторно отправить уведомление"
- [Новый функционал] (Database) Уведомления — Добавлена функция `get_notification_by_id()` для получения уведомления по ID из базы данных

2.25.3 – 24.09.2025
- [Исправление ошибки] (UI) Модальное окно "Обновить ключи по хосту" — Исправлена кодировка в JavaScript, заменены вопросительные знаки на корректный русский текст
- [Улучшение] (UI) Выпадающий список хостов — Убраны URL из отображения, теперь показываются только названия хостов для лучшей читаемости

2.25.2 – 24.09.2025
- [Исправление ошибки] (API) Уведомления — Исправлена кодировка сообщений об ошибках в endpoint `/create-notification`, теперь alert показывает корректные русские сообщения вместо искаженных символов

2.25.1 – 24.09.2025
- [Исправление ошибки] (API) Пополнение баланса — Добавлен недостающий эндпоинт `/api/topup-balance` для пополнения баланса пользователей через веб-интерфейс

2.24.29 – 24.09.2025
- [Исправление ошибки] (API) Поиск пользователей — Восстановлен маршрут /api/search-users, теперь ответы возвращают JSON вместо 404

2.25.0 – 24.09.2025
- [Новый функционал] (API) Ключи — Добавлены эндпоинты `/api/hosts`, `/refresh-user-keys`, `/refresh-keys-by-host` для выборочного обновления ключей.
- [Документация] (docs) API — Добавлено описание новых эндпоинтов и ссылка в обзоре документации.


2.24.1 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) ссылки — Исправлены абсолютные ссылки на относительные в форме редактирования политики конфиденциальности
- [Доработка] (Веб-интерфейс) стили — Обновлены стили формы редактирования политики конфиденциальности в соответствии с темной темой панели
- [Доработка] (Веб-интерфейс) страницы — Реализованы стили для страниц "Условия использования" и "Политика конфиденциальности" в темной теме
- [Доработка] (Веб-интерфейс) навигация — Добавлены кнопки "Назад" на страницы terms и privacy для удобной навигации
- [Доработка] (Веб-интерфейс) дизайн — Все страницы теперь используют единую цветовую схему и стили панели управления
- [Исправление ошибки] (Веб-интерфейс) textarea — Убран background у textarea в форме редактирования
- [Исправление ошибки] (Веб-интерфейс) страница terms — Восстановлена страница /terms к исходному виду
- [Новый функционал] (Веб-интерфейс) модальные окна — Создано модальное окно для редактирования HTML вместо отдельной страницы браузера
- [Новый функционал] (API) контент — Добавлены API endpoints для получения контента страниц terms и privacy
- [Доработка] (JavaScript) модальные окна — Реализованы функции загрузки контента, сохранения и закрытия модального окна

2.24.0 – 21.12.2025
- [Новый функционал] (Документация) создание структуры — Создан каталог docs с полной технической документацией проекта
- [Новый функционал] (Документация) архитектура — Добавлен файл architecture-rules.md с правилами архитектуры и принципами разработки
- [Новый функционал] (Документация) база данных — Создан database.md с подробным описанием схемы БД, таблиц и API
- [Новый функционал] (Документация) диалоги — Добавлен dialog-api.md с описанием API диалогов и состояний пользователей
- [Новый функционал] (Документация) CQRS — Создан generic-cqrs-typing.md со схемой типизации под паттерн CQRS
- [Новый функционал] (Документация) модули — Добавлен modules.md с обзором всех модулей проекта и их взаимодействия
- [Новый функционал] (Документация) общая информация — Создан project-info.md с описанием проекта, возможностей и технического стека
- [Документационные изменения] (Документация) структура — Все файлы документации содержат оглавления и плейсхолдеры для автоматической подстановки

2.23.3 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) настройки контента — Восстановлена функциональность редактирования "Настройки Контента" во вкладке "Бот" в "Настройках"
- [Доработка] (Веб-интерфейс) модальные окна — Добавлены кнопки редактирования для каждого поля контента с открытием модальных окон
- [Доработка] (JavaScript) модальные окна — Созданы функции openContentModal и saveContent для редактирования контента через модальные окна
- [Доработка] (CSS) стили — Добавлены стили для обертки полей контента (.content-field-wrapper) для корректного отображения кнопок редактирования
- [Исправление ошибки] (Веб-интерфейс) поля контента — Сделаны поля контента только для чтения (readonly) с возможностью редактирования через модальные окна

2.23.2 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) настройки — Исправлена проблема с кнопкой "Создать тариф", которая не открывала форму создания нового тарифа
- [Исправление ошибки] (CSS) модальные окна — Добавлены недостающие стили для .modal-backdrop для корректного отображения модальных окон
- [Доработка] (JavaScript) модальные окна — Исправлена функция openPlanModalData для поддержки создания новых тарифов без planId

2.23.1 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) страница ключей — Исправлена проблема с открытием карточки пользователя при клике на кнопку "глаз" в таблице ключей
- [Доработка] (База данных) ключи — Добавлено поле user_keys_count в запрос получения ключей для корректного отображения количества ключей пользователя в модальном окне

2.23.0 – 21.12.2025
- [Новый функционал] (Веб-интерфейс) настройки контента — Созданы отдельные страницы для контента: "О проекте", "Поддержка", "Условия использования", "Политика конфиденциальности"
- [Новый функционал] (API) контент-страницы — Добавлены API endpoints для получения и сохранения контента страниц (/api/content/<type>)
- [Изменения UI/UX] (Веб-интерфейс) настройки бота — Заменены текстовые поля в разделе "Настройки Контента" на ссылки на отдельные страницы с кнопками "Редактировать"
- [Новый функционал] (Веб-интерфейс) модальные окна — Добавлены модальные окна для редактирования контента страниц прямо из настроек бота
- [Доработка] (База данных) настройки — Добавлены новые поля для хранения контента страниц: about_content, support_content, terms_content, privacy_content
- [Доработка] (Веб-интерфейс) стили — Добавлены стили для ссылок на контент-страницы и модальных окон редактирования

2.22.5 – 21.12.2025
- [Изменения UI/UX] (Веб-интерфейс) вкладка "Бот" — Настроен flex-box для отображения блоков настроек в 2 ряда по 2 колонки (аналогично вкладке "Серверы")
- [Изменения UI/UX] (Веб-интерфейс) адаптивность — Добавлена адаптивность для вкладки "Бот": на мобильных устройствах - 1 колонка
- [Доработка] (CSS) — Добавлены стили для #bot-tab form с flex-wrap и justify-content: center для центрирования элементов
- [Исправление ошибки] (CSS) — Кнопка "Сохранить настройки бота" вынесена отдельно от flex-контейнера и занимает всю ширину

2.22.4 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлена высота контейнера charts-grid на главной странице - убран лишний скролл-бар
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлена высота контейнера main-content на странице пользователей - теперь высота соответствует содержимому
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Оптимизирована высота pagination-panel на страницах платежей, ключей и уведомлений - элементы теперь располагаются в одну линию

2.22.3 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлена проблема с бургерным меню - теперь при повторном нажатии меню корректно сворачивается и разворачивается
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлена ширина бокового меню на мобильных устройствах - теперь занимает всю ширину экрана (100%) вместо фиксированных 280px
- [Доработка] (Веб-интерфейс) мобильная навигация — Добавлен обработчик клика для бургерного меню в sidebar, убран overlay для мобильных устройств

2.22.2 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Убран статичный заголовок "Панель управления" в мобильной версии, теперь заголовок динамически меняется в зависимости от страницы
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлена проблема с боковым меню на мобильных устройствах - убран скролл-бар и ограничена высота меню размером экрана
- [Доработка] (Веб-интерфейс) заголовки страниц — Добавлен блок header_title для всех страниц, позволяющий отображать корректные заголовки в мобильной версии

2.22.1 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Устранена проблема с избыточной полосой прокрутки на мобильных устройствах
- [Оптимизация] (Веб-интерфейс) мобильная версия — Уменьшены отступы и высоты контейнеров для более компактного отображения на мобильных экранах
- [Оптимизация] (Веб-интерфейс) графики — Ограничена максимальная высота графиков на мобильных устройствах для предотвращения избыточной прокрутки
- [Оптимизация] (Веб-интерфейс) статистика — Уменьшены отступы в статистических карточках для более компактного отображения

2.22.0 – 21.12.2025
- [Новый функционал] (Веб-интерфейс) мобильная навигация — Добавлена кнопка бургерного меню в header-panel для открытия боковой панели на мобильных устройствах
- [Изменения UI/UX] (Веб-интерфейс) мобильная версия — На мобильных устройствах боковая панель скрыта по умолчанию, открывается по нажатию кнопки в header
- [Исправление ошибки] (Веб-интерфейс) адаптивность — Исправлено отображение интерфейса на мобильных устройствах, убран отступ для скрытой боковой панели
- [Исправление ошибки] (Веб-интерфейс) JavaScript конфликты — Устранены конфликты между JavaScript и CSS, убрано принудительное отображение sidebar на мобильных устройствах
- [Исправление ошибки] (Веб-интерфейс) кэширование — Добавлено принудительное обновление кэша CSS файлов для корректного отображения изменений
- [Оптимизация] (Веб-интерфейс) CSS — Упрощены медиа-запросы для мобильных устройств, объединены дублирующиеся медиа-запросы, добавлены CSS правила для мобильной навигации

2.21.0 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) кнопка бургерного меню — Удалена ненужная кнопка бургерного меню из header, теперь используется только кнопка в боковом меню
- [Исправление ошибки] (Веб-интерфейс) структура HTML — Исправлена структура HTML бокового меню, убран лишний закрывающий div
- [Исправление ошибки] (Веб-интерфейс) дублирование элементов — Устранено дублирование кнопок выхода и информации о версии в боковом меню
- [Исправление ошибки] (Веб-интерфейс) мобильная версия — Исправлено отображение бокового меню в мобильной версии, теперь sidebar-collapsed корректно отображается
- [Исправление ошибки] (Веб-интерфейс) кнопка бургера — Исправлено отображение кнопки бургера в menu-items-header на мобильных устройствах
- [Исправление ошибки] (Веб-интерфейс) элементы навигации — Исправлено отображение sidebar-nav-main и sidebar-nav-controls в мобильной версии
- [Изменения UI/UX] (Веб-интерфейс) мобильная версия — На мобильных устройствах боковая панель по умолчанию отображается в свернутом режиме (60px) с иконками
- [Изменения UI/UX] (Веб-интерфейс) переключение меню — При нажатии на кнопку бургерного меню в мобильной версии панель разворачивается на полную ширину (280px)
- [Доработка] (Веб-интерфейс) JavaScript — Обновлена логика управления боковым меню для правильной работы без удаленной кнопки
- [Доработка] (Веб-интерфейс) CSS — Обновлены стили для правильного отображения свернутого меню на мобильных устройствах
- [Оптимизация] (Веб-интерфейс) код — Удалены неиспользуемые CSS стили для кнопки бургерного меню

2.20.0 – 21.12.2025
- [Исправление ошибки] (Веб-интерфейс) сохранение состояния меню — Добавлено сохранение состояния бокового меню в localStorage, теперь состояние не сбрасывается при обновлении страницы
- [Исправление ошибки] (Веб-интерфейс) выравнивание кнопок управления — Исправлено выравнивание кнопок управления внизу свернутого бокового меню, теперь они правильно прижимаются к низу
- [Изменения UI/UX] (Веб-интерфейс) мобильная версия — В мобильной версии меню по умолчанию свернуто и отображается кнопка бургерного меню
- [Изменения UI/UX] (Веб-интерфейс) header кнопка — Кнопка в header выровнена по центру панели
- [Доработка] (Веб-интерфейс) JavaScript — Обновлена логика управления состоянием меню с поддержкой localStorage и правильной работой на мобильных устройствах
- [Доработка] (Веб-интерфейс) CSS — Обновлены стили для правильного выравнивания элементов в свернутом меню и мобильной версии

2.19.0 – 21.12.2025
- [Новый функционал] (Веб-интерфейс) сворачивание бокового меню — Добавлена возможность сворачивания бокового меню в режим только с иконками
- [Новый функционал] (Веб-интерфейс) иконки навигации — В свернутом режиме отображаются только иконки: 🏠 Главная, 👥 Пользователи, 💳 Платежи, 🔑 Ключи, 🔔 Уведомления, 📙 Инструкции, ⚙️ Настройки
- [Новый функционал] (Веб-интерфейс) переключатели в свернутом режиме — Добавлены toggle-slider для скрытого режима, бота витрины и бота поддержки в свернутом меню
- [Новый функционал] (Веб-интерфейс) иконка версии — Добавлена иконка FontAwesome6 server для отображения версии в свернутом режиме
- [Новый функционал] (Веб-интерфейс) иконка выхода — Добавлена иконка FontAwesome6 fas fa-sign-out-alt для кнопки выхода в свернутом режиме
- [Изменения UI/UX] (Веб-интерфейс) бургерное меню — Теперь бургерное меню переключает между тремя состояниями: развернутое, свернутое (иконки), скрытое
- [Изменения UI/UX] (Веб-интерфейс) адаптивность — Свернутое меню имеет ширину 60px и автоматически адаптирует main-content и header-panel
- [Доработка] (Веб-интерфейс) JavaScript — Обновлена логика управления боковым меню для поддержки трех состояний
- [Доработка] (Веб-интерфейс) синхронизация — Переключатели ботов и скрытого режима синхронизируются между развернутым и свернутым режимами
- [Доработка] (Веб-интерфейс) tooltips — Добавлены подсказки для всех элементов навигации в свернутом режиме

2.18.0 – 21.12.2025
- [Новый функционал] (Веб-интерфейс) закрепленная панель — Добавлена закрепленная панель в head размером 55px для размещения будущих элементов управления
- [Новый функционал] (Веб-интерфейс) header бокового меню — Добавлен header в боковом меню с бургером для скрытия панели и логотипом
- [Изменения UI/UX] (Веб-интерфейс) навигация — Бургер в боковом меню позволяет скрывать/показывать панель на десктопе
- [Изменения UI/UX] (Веб-интерфейс) адаптивность — Обновлена мобильная версия с учетом новой структуры header-panel
- [Доработка] (Веб-интерфейс) JavaScript — Добавлена логика управления скрытием бокового меню через бургер в header
- [Доработка] (Веб-интерфейс) страница логина — Добавлена header-panel на страницу логина для единообразия

2.17.0 – 21.12.2025
- [Новый функционал] (Бот) видеоинструкции — Добавлена поддержка видеоинструкций для всех платформ (Android, iOS, Windows, macOS, Linux)
- [Новый функционал] (Бот) админские команды — Добавлены команды /upload_video, /list_videos, /delete_video для управления видеоинструкциями
- [Доработка] (Бот) инструкции — Теперь при выборе платформы пользователи получают видеоинструкцию вместе с текстовой инструкцией
- [Доработка] (Конфигурация) — Добавлены настройки VIDEO_INSTRUCTIONS_ENABLED и VIDEO_INSTRUCTIONS_DIR для управления видеоинструкциями
- [Доработка] (Бот) меню QR-кода — Добавлен текст "Отсканируйте QR-код через VPN приложение" при показе QR-кода ключа
- [Доработка] (Бот) меню QR-кода — Добавлены кнопки под QR-кодом: "📑 Скопировать ключ", "❓ Инструкция как пользоваться", "⬅️ Назад к списку ключей"
- [Изменения UI/UX] (Веб-интерфейс) стили кнопок — Добавлен темный фон #282b30 для .button-small и кнопок в .settings-container
- [Изменения UI/UX] (Веб-интерфейс) стили кнопок — Установлен зеленый фон #008771 для .button-primary в .settings-container
- [Изменения UI/UX] (Веб-интерфейс) кнопки создания — Изменен цвет кнопок "Создать тариф" и "Добавить сервер" на зеленый #008771

2.16.7 – 21.12.2025
- [Доработка] (Бот) меню QR-кода — Добавлен текст "Отсканируйте QR-код через VPN приложение" при показе QR-кода ключа
- [Доработка] (Бот) меню QR-кода — Добавлены кнопки под QR-кодом: "📑 Скопировать ключ", "❓ Инструкция как пользоваться", "⬅️ Назад к списку ключей"
- [Изменения UI/UX] (Веб-интерфейс) стили кнопок — Добавлен темный фон #282b30 для .button-small и кнопок в .settings-container
- [Изменения UI/UX] (Веб-интерфейс) стили кнопок — Установлен зеленый фон #008771 для .button-primary в .settings-container
- [Изменения UI/UX] (Веб-интерфейс) кнопки создания — Изменен цвет кнопок "Создать тариф" и "Добавить сервер" на зеленый #008771

2.16.6 – 20.12.2025
- [Новый функционал] (Бот) — Добавлена кнопка "🗐 Скопировать ключ" для удобного копирования VLESS ключей в отдельном сообщении
- [Изменения UI/UX] (Бот) — Улучшена компоновка кнопок в меню ключа: "Продлить", "Скопировать ключ" и "Показать QR-код" в отдельных строках
- [Исправление ошибки] (Бот) — Исправлено отображение VLESS ключей: убрана обертка <pre> которая растягивала ключ на всю ширину, оставлен только <code> для моноширинного шрифта
- [Изменения UI/UX] (Бот) — Добавлен заголовок "НИЖЕ ВАШ КЛЮЧ" перед отображением ключа для лучшей навигации пользователя
- [Изменения UI/UX] (Бот) — Инструкции для пользователя теперь отображаются как цитата (blockquote) для лучшего визуального выделения

2.16.5 – 20.12.2025
- [Изменения UI/UX] (Веб-интерфейс) — Унифицированы стили вкладок на всех страницах: теперь все используют единый стиль как на странице настроек
- [Изменения UI/UX] (Веб-интерфейс) — Заменены эмодзи на Font Awesome иконки в навигации страницы инструкций для единообразия
- [Рефакторинг] (Шаблоны) — Обновлены комментарии в шаблонах instructions.html и versions.html для соответствия стандарту

2.16.4 – 20.12.2025
- [Исправление ошибки] (JavaScript) — Исправлены тексты статусов в JavaScript коде: все переключатели теперь показывают "ON/OFF" вместо "Включен/Отключен/Запущен/Остановлен"
- [Исправление ошибки] (Шаблоны) — Обновлены тексты статусов в debug.html и debug_settings.html на "ON/OFF"

2.16.3 – 20.12.2025
- [Изменения UI/UX] (Веб-интерфейс) — Изменен текст "Скрытый ПД:" на "Скрытый режим" в сайдбаре
- [Изменения UI/UX] (Веб-интерфейс) — Изменены статусы ботов с "Включен/Отключен/Запущен/Остановлен" на "ON/OFF" для единообразия
- [Рефакторинг] (Веб-интерфейс) — Унифицированы стили вкладок: все страницы теперь используют единый селектор tab-navigation
- [Рефакторинг] (Веб-интерфейс) — Удалены дублирующие локальные стили навигации из шаблонов instructions.html и settings.html
- [Новый функционал] (Веб-интерфейс) — Добавлены tooltips для всех вкладок навигации на странице инструкций
- [Рефакторинг] (CSS) — Добавлены стили для кнопок в tab-navigation для поддержки как ссылок, так и кнопок

2.16.2 – 20.12.2025
- [Исправление ошибки] (Веб-интерфейс) — Исправлена ширина bot-label: добавлен min-width: 110px для лучшего выравнивания
- [Исправление ошибки] (Веб-интерфейс) — Исправлено выравнивание bot-status-text: изменено с justify-self: end на justify-self: center
- [Исправление ошибки] (Веб-интерфейс) — Исправлены названия переключателей ботов: заменены ON/OFF на правильные "Включен/Отключен" и "Запущен/Остановлен"
- [Изменения UI/UX] (Веб-интерфейс) — Переименован settings-navigation в tab-navigation для унификации стилей навигации по вкладкам
- [Рефакторинг] (Веб-интерфейс) — Разделена страница DevPage на отдельные страницы: /versions, /demo, /debug с общей навигацией
- [Новый функционал] (Веб-интерфейс) — Созданы отдельные маршруты и шаблоны для страниц версий, демо и отладки
- [Исправление ошибки] (Веб-интерфейс) — Исправлены стили навигации вкладок: добавлены !important и специфичные селекторы для корректного отображения кнопок навигации

2.16.1 – 20.12.2025
- [Изменения UI/UX] (Веб-интерфейс) — Обновлены названия элементов управления ботами: "Режим" → "Скрытый ПД", "Shop" → "Бот витрина", "Support" → "Бот поддержка"
- [Исправление ошибки] (Веб-интерфейс) — Исправлено выравнивание toggle переключателей в bot-controls с улучшенным CSS
- [Изменения UI/UX] (Веб-интерфейс) — Изменены надписи статусов: "Включен/Отключен/Запущен/Остановлен" → "ON/OFF"
- [Новый функционал] (Веб-интерфейс) — Создана новая страница DevPage (/dev) с вкладками: История изменений, Демо страница, Отладка
- [Рефакторинг] (Веб-интерфейс) — Перенесена функциональность versions на DevPage для лучшей организации разработки
- [Исправление ошибки] (DevPage) — Исправлены неправильные названия роутов в DevPage (start_bot_route → start_shop_bot_route)
- [Изменения UI/UX] (Веб-интерфейс) — Улучшено выравнивание элементов bot-controls с использованием CSS Grid: bot-label (слева), bot-toggle (центр), bot-status-text (справа)

2.16.0 – 20.09.2025
- [Новый функционал] (Веб-интерфейс) — Полная унификация системы кнопок с внедрением Font Awesome иконок и системы размеров (xs, sm, md, lg, xl, xxl)
- [Изменения UI/UX] (Веб-интерфейс) — Добавлена демонстрационная страница с примерами всех элементов интерфейса: формы, таблицы, модальные окна, навигация, алерты
- [Рефакторинг] (Веб-интерфейс) — Исправлена цветовая схема кнопок: унифицированы цвета danger, success, warning с правильными hover-эффектами
- [Изменения UI/UX] (Веб-интерфейс) — Добавлены tooltips ко всем кнопкам и интерактивным элементам с описанием их назначения
- [Новый функционал] (Веб-интерфейс) — Создана система вкладок на странице версий: История изменений, Демо страница, Отладка
- [Доработка] (Веб-интерфейс) — Обновлены все кнопки в проекте: добавлены иконки, размеры и унифицированные стили

2.15.7 – 20.09.2025
- [Изменения UI/UX] (Веб-интерфейс) — Разделена панель пагинации на две области равной ширины: слева кнопки действий, справа пагинация и переключатель записей
- [Исправление ошибки] (Пагинация) — Исправлена логика пагинации: теперь всегда отображается максимум 6 номеров страниц с правильным алгоритмом сокращения
- [Изменения UI/UX] (Веб-интерфейс) — Добавлены подсказки (tooltips) ко всем элементам пагинации и кнопкам действий
- [Доработка] (Адаптивность) — Улучшена мобильная адаптивность панели пагинации с вертикальным расположением элементов

2.15.6 – 20.09.2025
- [Изменения UI/UX] (Веб-интерфейс) — Изменен порядок столбцов в таблице платежей: ID, Пользователь, Дата, Тип операции, Способ оплаты, Цена, Статус, Хост, План, Транзакция, Ключ
- [Изменения UI/UX] (Веб-интерфейс) — Объединены колонки "Цена" и "Звезды": информация о звездах теперь отображается под ценой в рублях на отдельной строке
- [Исправление ошибки] (JavaScript) — Исправлена функция скрытого режима для корректного отображения звезд в объединенной колонке цены

2.15.5 – 21.12.2025
- [Изменения UI/UX] (Веб-интерфейс) — Удалены заголовки h1 со всех страниц панели управления для более чистого дизайна

2.15.4 – 20.12.2025
- [Исправление ошибки] (UI/UX) — Исправлена проблема с прокруткой таблицы ключей: добавлен отступ снизу для видимости последнего объекта
- [Изменения UI/UX] (Кнопки) — Обновлены цвета фона для modal-action-btn и copy-btn на #00877140
- [Изменения UI/UX] (Статусы) — Обновлены стили для статусов: status-paid, status-active и status-pending с новыми цветами и рамками

2.15.3 – 20.09.2025
- [Исправление ошибки] (Docker) — Настроена кодировка UTF-8 для корректного отображения логов с эмодзи флагов стран
- [Новый функционал] (Веб-интерфейс) — Добавлено модальное окно для отображения ошибок синхронизации ключей с 3x-ui панелями
- [Доработка] (API) — Обновлена логика синхронизации ключей для сбора информации об ошибках
- [Улучшение UX] (Ключи) — При нажатии "Обновить" теперь показываются ключи, которые не найдены в 3x-ui панелях
- [Исправление ошибки] (UX) — Исправлена логика обновления страницы: теперь страница обновляется только после закрытия модального окна с ошибками
- [Улучшение UX] (Модальные окна) — Добавлена возможность закрытия модального окна кликом вне его области
- [Исправление ошибки] (API) — Исправлено отображение email из 3x-ui API вместо N/A в модальном окне ошибок
- [Улучшение UI] (Модальные окна) — Обновлены стили модального окна ошибок синхронизации под темную тему с правильными цветами
- [Исправление ошибки] (API) — Исправлено получение email из поля key_email вместо email в модальном окне ошибок
- [Улучшение UI] (Модальные окна) — Изменен цвет фона на #151f31 и убрана кнопка "Закрыть и обновить"
- [Улучшение UX] (Форматирование) — Изменен формат дат на ГГГГ-ММ-ДД H24:mi в модальном окне ошибок
- [Новый функционал] (API) — Добавлен эндпоинт /delete-error-keys для удаления ключей с ошибками из 3x-ui панелей
- [Новый функционал] (Веб-интерфейс) — Добавлена кнопка "Удалить ключи с ошибками в 3x-ui" в модальное окно ошибок синхронизации
- [Улучшение UX] (Модальные окна) — После удаления ключей отображается результат операции без закрытия модального окна
- [Исправление ошибки] (UI) — Исправлены стили кнопки удаления: используется класс button button-danger вместо несуществующего btn btn-danger
- [Улучшение UX] (Модальные окна) — Результат удаления ключей теперь отображается в отдельном модальном окне с прокруткой для длинного текста
- [Исправление ошибки] (API) — Исправлена логика удаления ключей из 3x-ui: теперь ищет клиентов как в базе данных, так и в самой панели по email
- [Исправление ошибки] (API) — Добавлена передача xui_client_uuid в данные об ошибках синхронизации для корректного удаления ключей
- [Исправление ошибки] (API) — Улучшена функция delete_client_on_host: теперь принимает UUID и пытается удалить по нему напрямую
- [Новый функционал] (API) — Добавлена функция delete_client_by_uuid для прямого удаления клиентов по UUID без поиска хостов
- [Исправление ошибки] (API) — Исправлена проблема с поиском хостов: теперь удаление происходит по всем доступным хостам
- [Исправление ошибки] (Планировщик) — Исправлена логика уведомлений об истечении ключей: теперь уведомления не отправляются после истечения срока действия
- [Доработка] (Планировщик) — Добавлены дополнительные проверки времени в функциях отправки уведомлений для предотвращения некорректных сообщений
- [Исправление ошибки] (Планировщик) — Устранена проблема отправки уведомлений "за 1 час" уже после истечения ключа

2.15.2 – 20.09.2025
- [Исправление ошибки] (Код) — Устранен дублирующий импорт aiohttp в файле handlers.py
- [Исправление ошибки] (Код) — Исправлена незавершенная строка logger.info в bot_controller.py
- [Очистка] (Файлы) — Удалены дублирующие файлы clientStats_1.json, inbound_1.json, inbounds.json (содержали только "404 page not found")
- [Анализ] (Проект) — Проведен полный анализ проекта на предмет дублирующих файлов и ошибок

2.15.1 – 20.09.2025
- [Документационные изменения] (ROADMAP) — Полностью переписан план развития проекта с учетом реализованного функционала
- [Документационные изменения] (ROADMAP) — Отмечены все реализованные функции из предыдущих версий
- [Документационные изменения] (ROADMAP) — Убраны временные рамки, добавлены приоритеты разработки
- [Рефакторинг] (Документация) — ROADMAP теперь отражает реальное состояние проекта

2.15.0 – 20.09.2025
- [Новый функционал] (Проект) — Проект полностью переработан и передан в собственность ukarshiev
- [Рефакторинг] (Git) — Настроена полная независимость от оригинального репозитория
- [Документационные изменения] (README) — Обновлена документация под новый репозиторий
- [Оптимизация] (Проект) — Проект готов к дальнейшему развитию как полностью независимый

2.14.5 – 20.09.2025
- [Исправление ошибки] (Веб-интерфейс) — Исправлена ошибка "Ошибка загрузки" в карточке пользователя на вкладке "Уведомления"
- [Доработка] (API) — Добавлен недостающий эндпоинт /api/user-notifications/<user_id> для получения уведомлений пользователя
- [Доработка] (Веб-интерфейс) — Добавлены тултипы к заголовкам таблицы уведомлений в карточке пользователя

2.14.4 – 20.09.2025
- [Доработка] (Веб-интерфейс) — Добавлена статистика уведомлений на дашборде
- [Доработка] (Веб-интерфейс) — Добавлена карточка "Всего уведомлений" в разделе статистики
- [Доработка] (Веб-интерфейс) — Добавлен график "Новые уведомления" в аналитике за 30 дней
- [Доработка] (База данных) — Создана функция get_total_notifications_count() для подсчета общего количества уведомлений
- [Доработка] (База данных) — Обновлена функция get_daily_stats_for_charts() для включения статистики уведомлений по дням


2.14.3 – 20.09.2025
- Кнопка «Выйти»: центрирована, ширина 100% (до 200px)
- Настройки: из форм редактирования хоста и тарифа убраны кнопки «Удалить» (только в меню ⋮)
- Подсказки: добавлен tooltip «Выйти из панели» на кнопку выхода

2.14.2 – 20.09.2025
- 3x‑ui: исправлена передача лимита трафика из тарифа (ГБ → байты)
- Покупка ключа: квота теперь устанавливается корректно вместо «∞»
- Дополнительно: дублируем обновление лимита через нативный endpoint панели

2.14.1 – 20.09.2025
- Бот: исправлена оплата "⭐ Telegram Звезды (Stars)" при покупке тарифа (создание счёта и обработка)
- Бот: добавлена фиксация pending-транзакции для Stars и корректная валидация pre-checkout
- Бот: бесплатные тарифы обрабатываются без выставления счёта

2.14.0 – 20.09.2025
- Панель: добавлен раздел «Уведомления» с таблицей, поиском и повторной отправкой
- Настройки: обновлён «Серверы» — таблица тарифов, модалки и меню «⋮»
- Интерфейс: улучшены переключатели ботов, скрытый режим и мобильное меню

2.13.3 – 20.09.2025
- Настройки: основной контент вкладки «Серверы» центрирован через глобальный CSS
- Стили: правило `#servers-tab > section.settings-section` с max-width и auto-маржинами
- Версия проекта повышена до 2.13.3

2.13.2 – 19.09.2025
- Настройки: контент вкладки «Серверы» центрирован, max-width 1000px, адаптивно
- Тарифы: список заменён на таблицу; двойной клик открывает модалку редактирования
- Модалки: кнопки «🗑️ Удалить», «Отмена», «Сохранить»; удаление перенесено в модалки
- Хосты: удаление из шапки карточки убрано; удаление доступно в форме редактирования
- Стили: добавлены таблица тарифов и серые кнопки, улучшена адаптивность
- Версия проекта повышена до 2.13.2

2.13.3 – 19.09.2025
- Уведомления: в тексте автопродления подставляется сумма тарифа (RUB)
- Версия проекта повышена до 2.13.3

2.13.1 – 19.09.2025
- Панель: исправлена структура модалки пользователя — footer внутри modal-content
- Уведомления: модалка создания — footer корректно вложен
- Версия проекта повышена до 2.13.1

2.13.0 – 19.09.2025
- Планировщик: добавлено автопродление с баланса при достаточных средствах
- Уведомления: подавление стандартных 72/48/24/1 при достаточном балансе
- Уведомления: новый тип за 24 часа — уведомление про автопродление без кнопок
- Транзакции: логирование автосписаний; статистика покупок обновляется автоматически
- Версия проекта повышена до 2.13.0

2.12.4 – 19.09.2025
- Уведомления: изменён текст (дата, баланс), кнопки («🔄 Продлить ключ», «💰 Пополнить баланс»)
- Уведомления: «Создать» слева, «Обновить» справа; модалка — «Отменить» слева, «Запустить» справа
- Ручное создание/повтор уведомлений отправляет обновлённый текст и кнопки
- Версия проекта повышена до 2.12.4

2.12.3 – 19.09.2025
- Уведомления: добавлена кнопка «Создать» и модалка создания уведомления
- Панель: поиск пользователей в модалке, запуск уведомлений по маркеру (72/48/24/1)
- Уведомления: «Повтор» теперь отправляет вместе с inline‑кнопками
- Версия проекта повышена до 2.12.3

2.12.2 – 19.09.2025
- Уведомления: текст дополнен номером ключа и сервером
- Уведомления: кнопка продления переименована на «🔄 Продлить ключ» и ведёт к конкретному ключу
- Версия проекта повышена до 2.12.2

2.12.1 – 19.09.2025
- Панель: раздел «Журнал уведомлений» переименован в «Уведомления»
- Уведомления: добавлена кнопка 🔍 (карточка пользователя) и колонка «Действия» с повторной отправкой 🔄
- Пользователи: добавлена колонка «Уведомления» (количество)
- Карточка пользователя: добавлена вкладка «Уведомления» с таблицей

2.12.0 – 19.09.2025
- Панель: добавлен раздел «Журнал уведомлений» с пагинацией
- Планировщик: логирование отправленных уведомлений (ID пользователя, время, текст)
 - Планировщик: устойчивые уведомления — учет отправленных маркеров (72/48/24/1) в БД и catch-up на старте/в ходе работы, чтобы не пропускать уведомления

2.11.1 – 19.09.2025
- Бот: «🔄 Продлить текущий [N]» перемещён в самый верх списка серверов при «🛒 Купить VPN»
- Бот: возвращён прямой показ списка серверов без промежуточного меню

2.11.0 – 19.09.2025
- Бот: в разделе «🛒 Купить VPN» добавлен пункт «🔄 Продлить текущий [N]», ведущий в «Мои ключи»
- Бот: пункт «Продлить текущий» отображается только если у пользователя есть хотя бы один ключ

2.10.2 – 19.09.2025
- Планировщик: исправлена проверка статуса бота (уведомления об истечении снова работают)

2.10.1 – 19.09.2025
- Бот: при оплате «С баланса» показывается сообщение «✅ С баланса списано N.NN RUB»
- Бот: после оплаты с баланса больше не предлагаются альтернативные способы оплаты
- Бот: в кнопке «💰 С баланса» теперь отображается текущий баланс пользователя
- Бот: единый текст для howto_vless берётся из конфига

2.10.0 – 19.09.2025
- Бот: добавлен способ оплаты «💰 С баланса» и поставлен первым
- Бот: тексты обновлены (подсказка суммы пополнения, «Баланс» → «💰 Баланс»)
- Бот: главное меню с иконками (🛒 Купить VPN, 💰Пополнить баланс, ⁉️ Помощь и поддержка)
- Бот: «❓ Как использовать» переименовано в «❓ Инструкция как  пользоваться»; «📖 Инструкция» ведет туда

2.9.7 – 19.09.2025
- TON Connect: добавлена 1.5 c задержка перед отключением соединения для стабильного завершения
- Версия повышена

2.9.6 – 19.09.2025
- TON Connect: добавлен безопасный ретрай при ошибках моста (SSE/TransferEncodingError)
- TON Connect: уведомление пользователю при двух неудачных попытках отправки транзакции
- Обновлены зависимости версий в проекте

2.9.5 – 19.09.2025
- Бот: в профиль добавлен вывод Баланса сразу после строки Профиль
- Бот: в меню профиля добавлена кнопка «Пополнить баланс»
- Бот: тексты обновлены — Stars → «Telegram Звезды (Stars)», TON → «TonCoin (криптовалюта)», подсказка суммы
- Бот: исправлен текст на «Выберите операционную систему устройства для получения инструкции по настройке:»
- Панель: добавлена колонка Баланс в таблице «Пользователи» и поле Баланс в модалке
- Панель: добавлен API /api/user-balance/<id> и загрузка баланса в JS

2.9.4 – 19.09.2025
- TON Connect: добавлено корректное отключение и перехват SSE ошибок (TransferEncodingError)
- Логи: уменьшен шум по orphan-клиентам; краткая сводка и опциональное автоудаление
- Настройки: добавлен флаг auto_delete_orphans (по умолчанию false)

2.9.3 – 19.09.2025
- Бэкенд: автозапуск ботов Shop/Support при старте сервера
- Панель: убрано авто-включение тумблеров; теперь только отображается состояние
- Логи: боты запускаются без входа на страницу панели

2.9.2 – 19.09.2025
- Бот: скрыты сервера без тарифов из меню выбора сервера (покупка/триал)

2.9.3 – 19.09.2025
- Бот: скрытие кнопки «Поддержка» при выключенном флаге support_enabled
- Бот: текст инструкций изменен на «Выберите вашу опреационную систему...»
- Панель: добавлена настройка minimum_topup; проверки и тексты пополнения берут значение из панели

2.9.2 – 19.09.2025
- Бот: переработано главное меню согласно ТЗ (Купить VPN, Мой профиль, Пополнить баланс, Помощь и поддержка, О проекте)
- Бот: «Мой профиль» теперь содержит пункты «Мои ключи» и «Реферальная программа»
- Бот: добавлен раздел «Помощь и поддержка» с пунктами «Поддержка» и «Как использовать»
- Бот: реализован сценарий «Пополнить баланс» (179/300/500/другая сумма)
- Платежи: пополнение баланса через Telegram Stars и TON Connect, фиксация «Пополнение» в админке
- БД: добавлено поле balance у пользователя; функции чтения и пополнения

2.8.9 – 19.09.2025
- Бот: убран пункт «🏠 Главное меню» из Reply-клавиатуры
- Бот: «🤝 Реферальная программа» скрывается, если выключена в панели
- Бот: Reply-клавиатура теперь формируется динамически из настроек

2.8.8 – 19.09.2025
- Панель: убрана кнопка «Назад» на странице «Инструкции»
- Бот: тексты инструкций теперь читаются из файлов панели (instructions/*.md)

2.8.7 – 19.09.2025
- Бот: добавлен пункт «🖥 MacOS» в инструкциях; группировка меню 2-3-1
- Панель: добавлен раздел «📙 Инструкции» с 5 вкладками и редактированием
- Сайдбар: новый пункт «Инструкции» перед «Настройки»

2.8.6 – 19.09.2025
- Бот: вынесено главное меню в постоянную Reply Keyboard внизу
- Добавлены текстовые хэндлеры для пунктов Reply Keyboard
- Старт/онбординг теперь всегда присылают Reply Keyboard

2.8.5 – 19.09.2025
- Панель: авто-включение тумблеров Режим/Shop/Support при загрузке страницы

2.8.4 – 19.09.2025
- Сайдбар: снята блокировка тумблера Shop — теперь все 3 переключателя можно включать

2.8.3 – 19.09.2025
- Настройки: исправлены кнопки Добавить/Редактировать хост и тариф (корректные onclick, безопасная передача параметров)
- Настройки: checkHost теперь корректно получает имя хоста и изменяет состояние кнопки
- Навигация вкладок: функция showTab больше не зависит от глобального event; передается this

2.8.2 – 13.09.2025
- Трафик 3x‑ui: лимит теперь выставляется при покупке через нативный updateClient; проверено (пример: 30 ГБ)
- Ключи: колонка «Общ / Исп / Ост» заполняется сразу после покупки; вывод в 3 строки; «∞» для безлимита
- Ключи: мгновенное сохранение «Квоты» и «Осталось» в БД; улучшена синхронизация с панелью
- Ключи: подсветка «Осталось» по порогам (0д0ч – красный; ≤1д24ч – оранжевый; ≤3д24ч – жёлтый; иначе – зелёный)
- Dashboard: добавлен график «Заработано (RUB)»; карточка переименована в «Всего заработано»
- Тарифы: добавлены поля «Дни» и «Трафик (ГБ)», плейсхолдеры и редактирование тарифов; старые записи не затронуты
- 3x‑ui: запись лимита трафика в байтах; улучшены логи и верификация total/down
- Уведомление администратору: исправлен парсинг (перевод на HTML вместо Markdown)

2.8.1 – 12.09.2025
- Страница «Версии»: тёмная тема textarea и высота на весь экран
- Версионирование CSS в ссылке, чтобы форсировать обновление стилей
- Небольшие правки обработчика версий для стабильности

2.8.0 – 12.09.2025
- Переименован проект в dark-maximus
- Убраны упоминания прежнего автора
- Docker-окружение для локального запуска на `localhost:1488`
- Dashboard: заголовок изменен на `dark-maximus.com`
- Добавлен скрытый режим: тумблер в сайдбаре, маскирование ID/username/email/сумм в таблицах и части настроек
- Исправлен визуальный баг тумблера «Режим» (без состояния «Запущен/Остановлен»)
- Добавлена страница «Версии» с возможностью редактировать CHANGELOG.md в панели
- Ключи: корректное отображение триал-ключей; колонка «Тип» (vless); колонка «Триал» (чекбокс); «Дата начало» и «Дата окончания»; «Осталось»
- Кнопка «Обновить» в «Ключи» синхронизирует даты и статус с 3x-ui (`inbounds/list`)
- 3x-ui: в email записывается Telegram ID; в комментарий — `user<ID>-key<N>@<host>.bot`
- Кнопки лупы рядом с ID в «Пользователи», «Платежи», «Ключи» для открытия модалки
- В «Платежи» и «Ключи» всегда показывается username из таблицы `users`

2.7.0 – 11.09.2025
- Добавлена базовая страница «Версии» и переход по блоку версии
- Скрытый режим: первичная реализация и маскирование основных полей
- Улучшено: визуальное состояние тумблера скрытого режима
- Подготовка к расширениям таблицы «Ключи» и интеграции 3x-ui

## [2.0.0] - 2025-12-19

### 🚀 Новые возможности
- **Аналитика заработка пользователей**: Добавлена функция отслеживания общей суммы заработанных средств по каждому пользователю
- **Расширенная информация о платежах**: Полная история транзакций с метаданными (хост, план, период, действие)
- **Быстрые действия**: Кнопки для перехода в Telegram профили и копирования данных прямо в таблицах
- **Улучшенная модальная система**: Компактные модальные окна с расширенной информацией в заголовке

### 🎨 Улучшения интерфейса
- **Полноэкранные графики**: Диаграммы теперь занимают всю доступную область для лучшей визуализации
- **Компактные модальные окна**: Уменьшена ширина модальных окон на 30% для более удобного просмотра
- **Оптимизированная пагинация**: Уменьшена высота панелей пагинации и улучшено расположение элементов
- **Центрированные заголовки**: Улучшена типографика и выравнивание текста на всех страницах
- **Современный дизайн**: Обновлен общий стиль интерфейса для лучшего пользовательского опыта

### 🔧 Технические улучшения
- **Исправлены JOIN'ы**: Корректное отображение данных пользователей в модальных окнах
- **Оптимизированные SQL запросы**: Улучшена производительность базы данных
- **Улучшенная обработка ошибок**: Более стабильная работа системы
- **Кэширование данных**: Быстрая загрузка информации о пользователях

### 📊 Улучшения аналитики
- **Статистика заработка**: Отслеживание общей суммы заработанных средств по каждому пользователю
- **Детальные транзакции**: Полная информация о платежах с метаданными
- **Улучшенные фильтры**: Более гибкая настройка отображения данных
- **Расширенная отчетность**: Дополнительные метрики для анализа бизнеса

### 🐛 Исправления ошибок
- **Исправлено отображение платежей**: Теперь корректно показываются все транзакции пользователей
- **Исправлено отображение ключей**: Ключи пользователей теперь корректно отображаются в модальных окнах
- **Исправлен расчет заработка**: Корректный подсчет заработанных средств по статусу 'paid'
- **Исправлены ссылки Telegram**: Кнопки "Перейти в Telegram" теперь ведут на правильные профили

### 📱 Улучшения мобильной версии
- **Адаптивный дизайн**: Улучшена работа на мобильных устройствах
- **Оптимизированная навигация**: Упрощена навигация на маленьких экранах
- **Улучшенные кнопки**: Более удобные кнопки для мобильных устройств

### 🔄 Изменения в структуре
- **Переработана структура модальных окон**: Убрана вкладка "Основная информация", информация перенесена в заголовок
- **Улучшена навигация**: Автоматическое переключение на вкладку "Платежи" при открытии профиля пользователя
- **Оптимизированы таблицы**: Добавлены быстрые действия прямо в таблицы пользователей

### 📈 Производительность
- **Оптимизированы запросы к БД**: Улучшена скорость загрузки данных
- **Кэширование**: Добавлено кэширование часто используемых данных
- **Асинхронная загрузка**: Улучшена загрузка данных без блокировки интерфейса

---

## [1.0.0] - 2025-12-01

### 🎉 Первоначальный релиз
- Базовая функциональность Telegram бота для продажи VPN
- Интеграция с панелью управления 3x-ui
- Веб-панель управления
- Поддержка платежных систем (YooKassa, CryptoBot, Heleket)
- Система управления пользователями
- Автоматическая выдача ключей после оплаты
- Поддержка мульти-серверной архитектуры
- Система тарифных планов
- Принудительная подписка на каналы
- Тестовый период для новых пользователей

---

