# ============================================================================
# PowerShell Profile - UTF-8 Configuration
# ============================================================================
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ UTF-8 –¥–ª—è PowerShell, Git –∏ –∫–æ–Ω—Å–æ–ª–∏ Windows
# –≠—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ PowerShell
# ============================================================================

# ----------------------------------------------------------------------------
# 1. –ù–ê–°–¢–†–û–ô–ö–ê –ö–û–î–ò–†–û–í–ö–ò POWERSHELL
# ----------------------------------------------------------------------------
Write-Host "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ UTF-8..." -ForegroundColor Cyan

try {
    # –°–æ–∑–¥–∞—ë–º UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫—É –±–µ–∑ BOM (Byte Order Mark)
    $utf8NoBom = New-Object System.Text.UTF8Encoding $false
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É –¥–ª—è –≤–≤–æ–¥–∞ –∏ –≤—ã–≤–æ–¥–∞ –∫–æ–Ω—Å–æ–ª–∏
    [Console]::InputEncoding = $utf8NoBom
    [Console]::OutputEncoding = $utf8NoBom
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É –¥–ª—è –ø–∞–π–ø–æ–≤ (–ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏)
    $OutputEncoding = $utf8NoBom
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ UTF-8 (65001)
    chcp 65001 | Out-Null
    
    Write-Host "  ‚úì –ö–æ–¥–∏—Ä–æ–≤–∫–∞ PowerShell: UTF-8" -ForegroundColor Green
} catch {
    Write-Warning "  ‚úó –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ PowerShell: $_"
}

# ----------------------------------------------------------------------------
# 2. –ù–ê–°–¢–†–û–ô–ö–ê –ö–û–î–ò–†–û–í–ö–ò –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ –î–õ–Ø CMDLETS
# ----------------------------------------------------------------------------
try {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥–ª–µ—Ç–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º Encoding
    $PSDefaultParameterValues['*:Encoding'] = 'utf8'
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –¥–ª—è Out-File –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (>, >>)
    $PSDefaultParameterValues['Out-File:Encoding'] = 'utf8'
    
    Write-Host "  ‚úì –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–æ–º–∞–Ω–¥–ª–µ—Ç–æ–≤: UTF-8" -ForegroundColor Green
} catch {
    Write-Warning "  ‚úó –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥–ª–µ—Ç–æ–≤: $_"
}

# ----------------------------------------------------------------------------
# 3. –ù–ê–°–¢–†–û–ô–ö–ê GIT –î–õ–Ø –†–ê–ë–û–¢–´ –° UTF-8
# ----------------------------------------------------------------------------
try {
    # –û—Ç–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ-ASCII —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤
    git config --global core.quotepath false 2>$null
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –¥–ª—è –∫–æ–º–º–∏—Ç–æ–≤
    git config --global i18n.commitencoding utf-8 2>$null
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –¥–ª—è –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥ git log, git diff –∏ —Ç.–¥.
    git config --global i18n.logoutputencoding utf-8 2>$null
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTF-8 –¥–ª—è Git GUI
    git config --global gui.encoding utf-8 2>$null
    
    # –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏–π —Å—Ç—Ä–æ–∫ (–∏–∑–±–µ–≥–∞–µ–º –ø—Ä–æ–±–ª–µ–º)
    git config --global core.autocrlf false 2>$null
    
    Write-Host "  ‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Git: UTF-8" -ForegroundColor Green
} catch {
    Write-Warning "  ‚úó –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Git: $_"
}

# ----------------------------------------------------------------------------
# 4. –ù–ê–°–¢–†–û–ô–ö–ê –ü–ï–†–ï–ú–ï–ù–ù–´–• –û–ö–†–£–ñ–ï–ù–ò–Ø
# ----------------------------------------------------------------------------
try {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É –¥–ª—è —É—Ç–∏–ª–∏—Ç—ã LESS (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ git diff, git log)
    $env:LESSCHARSET = 'utf-8'
    
    Write-Host "  ‚úì –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: UTF-8" -ForegroundColor Green
} catch {
    Write-Warning "  ‚úó –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è: $_"
}

# ----------------------------------------------------------------------------
# 5. –ü–†–û–í–ï–†–ö–ê –¢–ï–ö–£–©–ò–• –ù–ê–°–¢–†–û–ï–ö
# ----------------------------------------------------------------------------
Write-Host ""
Write-Host "–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏:" -ForegroundColor Cyan
Write-Host "  Input Encoding:  $([Console]::InputEncoding.EncodingName)" -ForegroundColor Gray
Write-Host "  Output Encoding: $([Console]::OutputEncoding.EncodingName)" -ForegroundColor Gray
Write-Host "  PowerShell Output: $($OutputEncoding.EncodingName)" -ForegroundColor Gray
Write-Host ""

# ----------------------------------------------------------------------------
# 6. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ë–´–°–¢–†–û–ô –ü–†–û–í–ï–†–ö–ò –ö–û–î–ò–†–û–í–ö–ò
# ----------------------------------------------------------------------------
function Test-UTF8Encoding {
    <#
    .SYNOPSIS
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–∏
    
    .DESCRIPTION
    –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
    #>
    
    Write-Host "–¢–µ—Å—Ç –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8..." -ForegroundColor Cyan
    
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
    Write-Host "`n1. –¢–µ—Å—Ç –∫–æ–Ω—Å–æ–ª–∏:" -ForegroundColor Yellow
    Write-Host "   –†—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! üöÄ" -ForegroundColor Green
    Write-Host "   –ö–æ–¥–∏—Ä–æ–≤–∫–∞: $([Console]::OutputEncoding.EncodingName)" -ForegroundColor Gray
    
    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ Git
    Write-Host "`n2. –¢–µ—Å—Ç Git:" -ForegroundColor Yellow
    $gitEncoding = git config --global i18n.commitencoding 2>$null
    if ($gitEncoding) {
        Write-Host "   ‚úì Git commit encoding: $gitEncoding" -ForegroundColor Green
    } else {
        Write-Host "   ‚úó Git commit encoding –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" -ForegroundColor Red
    }
    
    $gitLogEncoding = git config --global i18n.logoutputencoding 2>$null
    if ($gitLogEncoding) {
        Write-Host "   ‚úì Git log encoding: $gitLogEncoding" -ForegroundColor Green
    } else {
        Write-Host "   ‚úó Git log encoding –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" -ForegroundColor Red
    }
    
    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ PowerShell –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    Write-Host "`n3. –¢–µ—Å—Ç PowerShell:" -ForegroundColor Yellow
    if ($PSDefaultParameterValues['*:Encoding'] -eq 'utf8') {
        Write-Host "   ‚úì Default encoding: UTF-8" -ForegroundColor Green
    } else {
        Write-Host "   ‚úó Default encoding –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" -ForegroundColor Red
    }
    
    Write-Host "`n–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!" -ForegroundColor Cyan
}

# ----------------------------------------------------------------------------
# 7. –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ë–´–°–¢–†–û–ì–û –ö–û–ú–ú–ò–¢–ê –° –ü–†–ê–í–ò–õ–¨–ù–û–ô –ö–û–î–ò–†–û–í–ö–û–ô
# ----------------------------------------------------------------------------
function gitc {
    <#
    .SYNOPSIS
    –°–æ–∑–¥–∞—ë—Ç Git –∫–æ–º–º–∏—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π UTF-8 –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
    
    .DESCRIPTION
    –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è git commit, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–¥–∏—Ä–æ–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è
    –¥–∞–∂–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
    
    .PARAMETER Message
    –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–∏—Ä–∏–ª–ª–∏—Ü—É)
    
    .PARAMETER All
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (git add -a)
    
    .EXAMPLE
    gitc "–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
    
    .EXAMPLE
    gitc "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞" -All
    #>
    
    [CmdletBinding()]
    param(
        [Parameter(Mandatory=$true, Position=0)]
        [string]$Message,
        
        [Parameter(Mandatory=$false)]
        [switch]$All
    )
    
    try {
        # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ UTF-8 –±–µ–∑ BOM
        $tempFile = [System.IO.Path]::GetTempFileName()
        $utf8NoBom = New-Object System.Text.UTF8Encoding $false
        [System.IO.File]::WriteAllText($tempFile, $Message, $utf8NoBom)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É git commit
        if ($All) {
            git add -A
            Write-Host "–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è" -ForegroundColor Gray
        }
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–º–∏—Ç —á–µ—Ä–µ–∑ —Ñ–∞–π–ª
        git commit -F $tempFile
        
        if ($LASTEXITCODE -eq 0) {
            Write-Host "‚úì –ö–æ–º–º–∏—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!" -ForegroundColor Green
        }
    } catch {
        Write-Error "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞: $_"
    } finally {
        # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        if (Test-Path $tempFile) {
            Remove-Item $tempFile -Force -ErrorAction SilentlyContinue
        }
    }
}

# ----------------------------------------------------------------------------
# –ó–ê–í–ï–†–®–ï–ù–ò–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò
# ----------------------------------------------------------------------------
Write-Host "‚úì –ü—Ä–æ—Ñ–∏–ª—å PowerShell –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!" -ForegroundColor Green
Write-Host ""
Write-Host "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:" -ForegroundColor Cyan
Write-Host "  Test-UTF8Encoding  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏" -ForegroundColor Gray
Write-Host "  gitc <—Å–æ–æ–±—â–µ–Ω–∏–µ>   - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π" -ForegroundColor Gray
Write-Host ""

