<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–æ—Ç–æ–º{% endblock %}</title>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='css/style.css', v=project_version or '1') }}?t=20241221"
		/>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='css/tw.css', v=project_version or '1') }}"
		/>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Flatpickr Date Picker -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
		<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
		<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
		<!-- Font Awesome Icons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<!-- Favicon -->
		<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
	</head>
    <body class="{% block body_class %}{% endblock %}">
		<!-- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤ head -->
		<header class="header-panel">
			<div class="header-panel-left">
				<!-- –ë–ª–æ–∫ –º–µ–Ω—é –∏ –ª–æ–≥–æ—Ç–∏–ø–∞, –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω–Ω—ã–π –∏–∑ sidebar –≤ header (—Å–ª–µ–≤–∞) -->
				<div class="menu-items-header menu-items-header--in-header">
					<button class="sidebar-burger" id="sidebarBurger" title="–°–∫—Ä—ã—Ç—å –±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é">
						<span></span>
						<span></span>
						<span></span>
					</button>
					<div class="sidebar-logo">
						<img src="{{ url_for('static', filename='logo.svg') }}" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-img">
					</div>
				</div>
				<button class="header-burger" id="headerBurger" title="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
					<span></span>
					<span></span>
					<span></span>
				</button>
				<div class="header-title">{% block header_title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}</div>
			</div>
			<div class="header-panel-right">
				{% block header_buttons %}{% endblock %}
			</div>
		</header>
		
        <div class="container {% block container_class %}{% endblock %}">
			<!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
			<aside class="sidebar" id="sidebar">
				
				<nav class="sidebar-nav">
					<a
						href="{{ url_for('dashboard_page') }}"
						class="nav-link {% if request.endpoint == 'dashboard_page' %}active{% endif %}"
						title="–ì–ª–∞–≤–Ω–∞—è"
					>
						<span class="nav-icon">üè†</span>
						<span class="nav-text">–ì–ª–∞–≤–Ω–∞—è</span>
					</a>
					<a
						href="{{ url_for('users_page') }}"
						class="nav-link {% if request.endpoint == 'users_page' %}active{% endif %}"
						title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
					>
						<span class="nav-icon">üë•</span>
						<span class="nav-text">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
					</a>
					<a
						href="{{ url_for('transactions_page') }}"
						class="nav-link {% if request.endpoint == 'transactions_page' %}active{% endif %}"
						title="–ü–ª–∞—Ç–µ–∂–∏"
					>
						<span class="nav-icon">üí≥</span>
						<span class="nav-text">–ü–ª–∞—Ç–µ–∂–∏</span>
					</a>
					<a
						href="{{ url_for('keys_page') }}"
						class="nav-link {% if request.endpoint == 'keys_page' %}active{% endif %}"
						title="–ö–ª—é—á–∏"
					>
						<span class="nav-icon">üîë</span>
						<span class="nav-text">–ö–ª—é—á–∏</span>
					</a>
					<a
						href="{{ url_for('promo_codes_page') }}"
						class="nav-link {% if request.endpoint == 'promo_codes_page' %}active{% endif %}"
						title="–ü—Ä–æ–º–æ–∫–æ–¥—ã"
					>
						<span class="nav-icon">üé´</span>
						<span class="nav-text">–ü—Ä–æ–º–æ–∫–æ–¥—ã</span>
					</a>
					<a
						href="{{ url_for('notifications_page') }}"
						class="nav-link {% if request.endpoint == 'notifications_page' %}active{% endif %}"
						title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
					>
						<span class="nav-icon">üîî</span>
						<span class="nav-text">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
					</a>
					<a
						href="{{ url_for('instructions_page') }}"
						class="nav-link {% if request.endpoint == 'instructions_page' %}active{% endif %}"
						title="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
					>
						<span class="nav-icon">üìô</span>
						<span class="nav-text">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</span>
					</a>
					<a
						href="{{ url_for('wiki_editor_page') }}"
						class="nav-link {% if request.endpoint in ['wiki_editor_page', 'wiki_editor_edit'] %}active{% endif %}"
						title="Wiki —Ä–µ–¥–∞–∫—Ç–æ—Ä"
					>
						<span class="nav-icon">üìö</span>
						<span class="nav-text">Wiki —Ä–µ–¥–∞–∫—Ç–æ—Ä</span>
					</a>
					<a
						href="{{ url_for('settings_page') }}"
						class="nav-link {% if request.endpoint == 'settings_page' %}active{% endif %}"
						title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
					>
						<span class="nav-icon">‚öôÔ∏è</span>
						<span class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
					</a>
				</nav>

				<!-- –°–≤–µ—Ä–Ω—É—Ç–æ–µ –º–µ–Ω—é —Å –∏–∫–æ–Ω–∫–∞–º–∏ -->
				<nav class="sidebar-nav sidebar-nav-collapsed" style="display: none;">
					<!-- –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
					<div class="sidebar-nav-main">
						<a
							href="{{ url_for('dashboard_page') }}"
							class="nav-link {% if request.endpoint == 'dashboard_page' %}active{% endif %}"
							title="–ì–ª–∞–≤–Ω–∞—è"
						>
							<span class="nav-icon">üè†</span>
						</a>
						<a
							href="{{ url_for('users_page') }}"
							class="nav-link {% if request.endpoint == 'users_page' %}active{% endif %}"
							title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
						>
							<span class="nav-icon">üë•</span>
						</a>
						<a
							href="{{ url_for('transactions_page') }}"
							class="nav-link {% if request.endpoint == 'transactions_page' %}active{% endif %}"
							title="–ü–ª–∞—Ç–µ–∂–∏"
						>
							<span class="nav-icon">üí≥</span>
						</a>
						<a
							href="{{ url_for('keys_page') }}"
							class="nav-link {% if request.endpoint == 'keys_page' %}active{% endif %}"
							title="–ö–ª—é—á–∏"
						>
							<span class="nav-icon">üîë</span>
						</a>
						<a
							href="{{ url_for('promo_codes_page') }}"
							class="nav-link {% if request.endpoint == 'promo_codes_page' %}active{% endif %}"
							title="–ü—Ä–æ–º–æ–∫–æ–¥—ã"
						>
							<span class="nav-icon">üé´</span>
						</a>
						<a
							href="{{ url_for('notifications_page') }}"
							class="nav-link {% if request.endpoint == 'notifications_page' %}active{% endif %}"
							title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
						>
							<span class="nav-icon">üîî</span>
						</a>
						<a
							href="{{ url_for('instructions_page') }}"
							class="nav-link {% if request.endpoint == 'instructions_page' %}active{% endif %}"
							title="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"
						>
							<span class="nav-icon">üìô</span>
						</a>
						<a
							href="{{ url_for('wiki_editor_page') }}"
							class="nav-link {% if request.endpoint in ['wiki_editor_page', 'wiki_editor_edit'] %}active{% endif %}"
							title="Wiki —Ä–µ–¥–∞–∫—Ç–æ—Ä"
						>
							<span class="nav-icon">üìö</span>
						</a>
						<a
							href="{{ url_for('settings_page') }}"
							class="nav-link {% if request.endpoint == 'settings_page' %}active{% endif %}"
							title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
						>
							<span class="nav-icon">‚öôÔ∏è</span>
						</a>
					</div>
					
					<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤–Ω–∏–∑—É) -->
					<div class="sidebar-nav-controls">
						<!-- –°–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º -->
						<div class="nav-link nav-toggle" title="–°–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º">
							<label class="bot-toggle">
								<input type="checkbox" 
									   class="bot-checkbox"
									   id="hiddenModeToggleCollapsed"
									   {% if hidden_mode %}checked{% endif %}>
								<span class="toggle-slider"></span>
							</label>
						</div>
						<!-- –ë–æ—Ç –≤–∏—Ç—Ä–∏–Ω–∞ -->
						<div class="nav-link nav-toggle" title="–ë–æ—Ç –≤–∏—Ç—Ä–∏–Ω–∞">
							<label class="bot-toggle">
								<input type="checkbox" 
									   class="bot-checkbox" 
									   data-bot="shop"
									   {% if bot_status.shop_bot_running %}checked{% endif %}>
								<span class="toggle-slider"></span>
							</label>
						</div>
						<!-- –ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
						<div class="nav-link nav-toggle" title="–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏">
							<label class="bot-toggle">
								<input type="checkbox" 
									   class="bot-checkbox" 
									   data-bot="support"
									   {% if bot_status.support_bot_running %}checked{% endif %}>
								<span class="toggle-slider"></span>
							</label>
						</div>
						<!-- –í–µ—Ä—Å–∏—è -->
						<a
							href="{{ url_for('dev_page') }}"
							class="nav-link"
							title="–í–µ—Ä—Å–∏—è: {{ project_version or 'N/A' }}"
						>
							<i class="fas fa-server"></i>
						</a>
						<!-- –í—ã–π—Ç–∏ -->
						<form action="{{ url_for('logout_page') }}" method="post" class="nav-link-form">
							<button type="submit" class="nav-link nav-button" title="–í—ã–π—Ç–∏ –∏–∑ –ø–∞–Ω–µ–ª–∏">
								<i class="fas fa-sign-out-alt"></i>
							</button>
						</form>
					</div>
				</nav>

				<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏ -->
				<div class="bot-controls">
					<div class="bot-control">
						<div class="bot-status">
							<div class="bot-label-row">
								<span class="bot-label">–°–∫—Ä—ã—Ç—ã–π —Ä–µ–∂–∏–º:</span>
								<label class="bot-toggle">
									<input type="checkbox" 
										   class="bot-checkbox"
										   id="hiddenModeToggle"
										   {% if hidden_mode %}checked{% endif %}>
									<span class="toggle-slider"></span>
								</label>
								<span id="hiddenModeStatus" class="bot-status-text {% if hidden_mode %}status-running{% else %}status-stopped{% endif %}">
									{% if hidden_mode %}ON{% else %}OFF{% endif %}
								</span>
							</div>
						</div>
					</div>
					<div class="bot-control">
						<div class="bot-status">
							<div class="bot-label-row">
								<span class="bot-label">–ë–æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞</span>
                                <label class="bot-toggle">
                                    <input type="checkbox" 
                                           class="bot-checkbox" 
                                           data-bot="shop"
                                           {% if bot_status.shop_bot_running %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
								<span class="bot-status-text {% if bot_status.shop_bot_running %}status-running{% else %}status-stopped{% endif %}">
									{% if bot_status.shop_bot_running %}ON{% else %}OFF{% endif %}
								</span>
							</div>
						</div>
					</div>

					<div class="bot-control">
						<div class="bot-status">
							<div class="bot-label-row">
								<span class="bot-label">–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞:</span>
								<label class="bot-toggle">
									<input type="checkbox" 
										   class="bot-checkbox" 
										   data-bot="support"
										   {% if bot_status.support_bot_running %}checked{% endif %}>
									<span class="toggle-slider"></span>
								</label>
								<span class="bot-status-text {% if bot_status.support_bot_running %}status-running{% else %}status-stopped{% endif %}">
									{% if bot_status.support_bot_running %}ON{% else %}OFF{% endif %}
								</span>
							</div>
						</div>
					</div>

				<div class="version-block">
					<a href="{{ url_for('dev_page') }}" class="version-info" style="text-decoration: none;" title="–í–µ—Ä—Å–∏—è: {{ project_version or 'N/A' }}">
						<div class="version-text">–í–µ—Ä—Å–∏—è: {{ project_version or 'N/A' }}</div>
					</a>
				</div>

				<div class="user-session-controls">
					<form action="{{ url_for('logout_page') }}" method="post" class="logout-form">
						<button type="submit" class="button button-logout" data-size="sm" title="–í—ã–π—Ç–∏ –∏–∑ –ø–∞–Ω–µ–ª–∏">
							<i class="fas fa-sign-out-alt"></i>
							–í—ã–π—Ç–∏
						</button>
					</form>
				</div>
			</aside>

			<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
			<main class="main-content">
				{% with messages = get_flashed_messages(with_categories=true) %} {% if
				messages %} {% for category, message in messages %}
				<div class="flash flash-{{ category }}">
					<span class="flash-message">{{ message }}</span>
					<button class="flash-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ" title="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">&times;</button>
				</div>
				{% endfor %} {% endif %} {% endwith %}

				{% block content %}{% endblock %}
			</main>
		</div>

		<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
		<!-- User Drawer (Side Sheet) -->
		<div id="userDrawer" class="drawer-overlay" style="display: none;">
			<div class="drawer" id="userDrawerPanel">
				<div class="drawer-header">
					<h3>–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
					<button class="drawer-close" onclick="closeUserModal()" title="–ó–∞–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
						<i class="fas fa-times"></i>
					</button>
				</div>
				
				<div class="drawer-body">
					<!-- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
					<div class="user-info-section">
						<div class="user-info-grid">
							<div class="user-info-item">
								<label>Telegram ID:</label>
								<span id="modalUserId" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–ü–æ–ª–Ω–æ–µ –∏–º—è:</label>
								<span id="modalFullname" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–°—Ç–∞—Ç—É—Å:</label>
								<span id="modalStatus" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–ë–∞–ª–∞–Ω—Å:</label>
								<span id="modalBalance" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</label>
								<span id="modalEarned" class="user-info-value"></span>
							</div>
						</div>
					</div>

					<!-- –í–∫–ª–∞–¥–∫–∏ -->
					<div class="drawer-tabs">
						<button class="tab-button active" onclick="switchTab('userdata')" title="–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							<i class="fas fa-user"></i>
							–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
						</button>
						<button class="tab-button" onclick="switchTab('payments')" title="–ü–ª–∞—Ç–µ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							<i class="fas fa-credit-card"></i>
							–ü–ª–∞—Ç–µ–∂–∏
						</button>
						<button class="tab-button" onclick="switchTab('keys')" title="–ö–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							<i class="fas fa-key"></i>
							–ö–ª—é—á–∏
						</button>
						<button class="tab-button" onclick="switchTab('notifications')" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							<i class="fas fa-bell"></i>
							–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
						</button>
					</div>

					<!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
					<div class="drawer-tabs-content">
						<!-- –í–∫–ª–∞–¥–∫–∞: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
						<div class="tab-content active" id="tab-userdata">
							
							<!-- –ì—Ä—É–ø–ø–∞: –û–±—â–µ–µ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-info-circle"></i>
									<span>–û–±—â–µ–µ</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ">
										<label>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</label>
										<span id="detailRegistrationDate">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—Ç–∞—Ç—É—Å –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–ó–∞–±–∞–Ω–µ–Ω:</label>
										<span id="detailIsBanned">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-user"></i>
									<span>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>User ID:</label>
										<span id="detailUserId">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram">
										<label>Telegram ID:</label>
										<span id="detailTelegramId">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram">
										<label>Username:</label>
										<span id="detailUsername">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ü–æ–ª–Ω–æ–µ –∏–º—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è Telegram">
										<label>–ü–æ–ª–Ω–æ–µ –∏–º—è:</label>
										<span id="detailFullname">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)">
										<label>–§–ò–û:</label>
										<input type="text" id="detailFioInput" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û" title="–í–≤–µ–¥–∏—Ç–µ –§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<span id="detailFio" style="display: none;">‚Äî</span>
									</div>
									<div class="user-detail-item" title="Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>Email:</label>
										<input type="email" id="detailEmailInput" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ email" title="–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<span id="detailEmail" style="display: none;">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ì—Ä—É–ø–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–ì—Ä—É–ø–ø–∞:</label>
										<select id="detailGroupInput" class="form-select" title="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
											<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
										</select>
										<span id="detailGroup" style="display: none;">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –§–∏–Ω–∞–Ω—Å—ã -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-wallet"></i>
									<span>–§–∏–Ω–∞–Ω—Å—ã</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–ë–∞–ª–∞–Ω—Å:</label>
										<span id="detailBalance" data-field="balance">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–û–±—â–∞—è —Å—É–º–º–∞ —Ç—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ:</label>
										<span id="detailTotalSpent" data-field="total_spent">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—É–º–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º">
										<label>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</label>
										<span id="detailEarned" data-field="earned">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å –±–∞–ª–∞–Ω—Å–∞">
										<label>–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ:</label>
										<span id="detailAutoRenewal" data-field="auto_renewal_enabled">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –°–≤–æ–¥–Ω–∞—è -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-chart-line"></i>
									<span>–°–≤–æ–¥–Ω–∞—è</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –º–µ—Å—è—Ü–µ–≤">
										<label>–í—Å–µ–≥–æ –º–µ—Å—è—Ü–µ–≤:</label>
										<span id="detailTotalMonths">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π:</label>
										<span id="detailKeysCount">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</label>
										<span id="detailNotificationsCount">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –¢—Ä–∏–∞–ª -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-gift"></i>
									<span>–¢—Ä–∏–∞–ª</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ —Ç—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥">
										<label>–¢—Ä–∏–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω:</label>
										<span id="detailTrialUsed">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Ç—Ä–∏–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞">
										<label>–î–Ω–µ–π —Ç—Ä–∏–∞–ª–∞ –≤—ã–¥–∞–Ω–æ:</label>
										<span id="detailTrialDaysGiven">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Ç—Ä–∏–∞–ª–æ–≤">
										<label>–ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Ç—Ä–∏–∞–ª–æ–≤:</label>
										<span id="detailTrialReusesCount">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-users"></i>
									<span>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≥–ª–∞—Å–∏–ª">
										<label>–†–µ—Ñ–µ—Ä–µ—Ä (ID):</label>
										<span id="detailReferredBy">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–¢–µ–∫—É—â–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å">
										<label>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:</label>
										<span id="detailReferralBalance" data-field="referral_balance">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–û–±—â–∞—è —Å—É–º–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ">
										<label>–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏:</label>
										<span id="detailReferralBalanceAll" data-field="referral_balance_all">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –ü—Ä–∞–≤–∏–ª–∞ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-file-contract"></i>
									<span>–ü—Ä–∞–≤–∏–ª–∞</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è">
										<label>–°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏:</label>
										<span id="detailAgreedToTerms">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°–æ–≥–ª–∞—Å–∏–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ —Å–µ—Ä–≤–∏—Å–∞">
										<label>–°–æ–≥–ª–∞—Å–∏–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:</label>
										<span id="detailAgreedToDocuments">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã">
										<label>–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:</label>
										<span id="detailSubscriptionStatus">‚Äî</span>
									</div>
								</div>
							</div>

						</div>

						<!-- –í–∫–ª–∞–¥–∫–∞: –ü–ª–∞—Ç–µ–∂–∏ -->
						<div class="tab-content" id="tab-payments">
							<div class="drawer-table-container">
								<table class="drawer-table">
									<thead>
										<tr>
											<th>–î–∞—Ç–∞</th>
											<th>–¢–∏–ø</th>
											<th>–°—É–º–º–∞</th>
											<th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
										</tr>
									</thead>
									<tbody id="modalPaymentsTable">
										<tr>
											<td colspan="4" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<!-- –í–∫–ª–∞–¥–∫–∞: –ö–ª—é—á–∏ -->
						<div class="tab-content" id="tab-keys">
							<div class="drawer-table-container">
								<table class="drawer-table">
									<thead>
										<tr>
											<th>ID –∫–ª—é—á–∞</th>
											<th>–•–æ—Å—Ç</th>
											<th>–ü–ª–∞–Ω</th>
											<th>–ö–ª—é—á</th>
											<th>–î–∞—Ç–∞</th>
										</tr>
									</thead>
									<tbody id="modalKeysTable">
										<tr>
											<td colspan="5" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<!-- –í–∫–ª–∞–¥–∫–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
						<div class="tab-content" id="tab-notifications">
							<div class="drawer-table-container">
								<table class="drawer-table">
									<thead>
										<tr>
											<th>–î–∞—Ç–∞</th>
											<th>–¢–∏–ø</th>
											<th>–¢–µ–∫—Å—Ç</th>
											<th>–°—Ç–∞—Ç—É—Å</th>
										</tr>
									</thead>
									<tbody id="modalNotificationsTable">
										<tr>
											<td colspan="4" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Footer —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
				<div class="drawer-footer">
					<!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∫–µ–±–∞–±-–º–µ–Ω—é –∏ –∑–∞–∫—Ä—ã—Ç—å -->
					<div class="drawer-footer-left">
						<!-- –ö–µ–±–∞–±-–º–µ–Ω—é -->
						<div class="kebab-wrapper">
							<button class="kebab-btn" onclick="toggleDrawerKebabMenu('drawer-kebab-menu')" title="–î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º">
								<i class="fas fa-ellipsis-v"></i>
							</button>
							<div class="kebab-menu" id="drawer-kebab-menu">
								<button type="button" class="kebab-item" onclick="closeDrawerKebabMenu(); banUser()" id="drawerBanButton" style="display: none;" title="–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
									<i class="fas fa-lock"></i>
									<span>–ó–∞–±–∞–Ω–∏—Ç—å</span>
								</button>
								<button type="button" class="kebab-item" onclick="closeDrawerKebabMenu(); unbanUser()" id="drawerUnbanButton" style="display: none;" title="–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
									<i class="fas fa-unlock"></i>
									<span>–†–∞–∑–±–∞–Ω–∏—Ç—å</span>
								</button>
								<button type="button" class="kebab-item" onclick="closeDrawerKebabMenu(); revokeKeys()" title="–û—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
									<i class="fas fa-key"></i>
									<span>–û—Ç–æ–∑–≤–∞—Ç—å –∫–ª—é—á–∏</span>
								</button>
								<button type="button" class="kebab-item" onclick="closeDrawerKebabMenu(); revokeConsent()" id="drawerRevokeConsentButton" style="display: none;" title="–û—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏">
									<i class="fas fa-user-times"></i>
									<span>–û—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ</span>
								</button>
								<button type="button" class="kebab-item" onclick="closeDrawerKebabMenu(); openTopupBalanceModal()" title="–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
									<i class="fas fa-plus-circle"></i>
									<span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</span>
								</button>
							</div>
						</div>
						
						<button type="button" class="button button-secondary" onclick="closeUserModal()" title="–ó–∞–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							–ó–∞–∫—Ä—ã—Ç—å
						</button>
					</div>
					
					<!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
					<div class="drawer-footer-right">
						<button type="button" class="button button-primary" id="saveUserButton" onclick="saveUserChanges()" style="display: inline-block;" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
							<i class="fas fa-save"></i>
							–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Transaction Drawer (Side Sheet) -->
		<div id="transactionDrawer" class="drawer-overlay" style="display: none;">
			<div class="drawer" id="transactionDrawerPanel">
				<div class="drawer-header">
					<h3>–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞</h3>
					<button class="drawer-close" onclick="closeTransactionModal()" title="–ó–∞–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞">
						<i class="fas fa-times"></i>
					</button>
				</div>
				
				<div class="drawer-body">
					<!-- –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
					<div class="user-info-section">
						<div class="user-info-grid">
							<div class="user-info-item">
								<label>ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</label>
								<span id="txModalId" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–°—Ç–∞—Ç—É—Å:</label>
								<span id="txModalStatus" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–°—É–º–º–∞:</label>
								<span id="txModalAmount" class="user-info-value"></span>
							</div>
							<div class="user-info-item">
								<label>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
								<span id="txModalPaymentMethod" class="user-info-value"></span>
							</div>
						</div>
					</div>

					<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
					<div class="drawer-tabs-content">
						<div class="tab-content active">
							
							<!-- –ì—Ä—É–ø–ø–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-user"></i>
									<span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>User ID:</label>
										<span id="txDetailUserId">‚Äî</span>
									</div>
									<div class="user-detail-item" title="Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
										<label>Username:</label>
										<span id="txDetailUsername">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –ü–ª–∞—Ç–µ–∂ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-credit-card"></i>
									<span>–ü–ª–∞—Ç–µ–∂</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
										<label>ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</label>
										<span id="txDetailId">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
										<label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</label>
										<span id="txDetailDate">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏">
										<label>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:</label>
										<span id="txDetailOperationType">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã">
										<label>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
										<span id="txDetailPaymentMethod">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö">
										<label>–°—É–º–º–∞ (RUB):</label>
										<span id="txDetailAmountRub">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—É–º–º–∞ –≤ –≤–∞–ª—é—Ç–µ –ø–ª–∞—Ç–µ–∂–∞">
										<label>–°—É–º–º–∞ (–≤–∞–ª—é—Ç–∞):</label>
										<span id="txDetailAmountCurrency">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã">
										<label>–í–∞–ª—é—Ç–∞:</label>
										<span id="txDetailCurrencyName">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
										<label>–°—Ç–∞—Ç—É—Å:</label>
										<span id="txDetailStatus">‚Äî</span>
									</div>
									<div class="user-detail-item" title="ID –ø–ª–∞—Ç–µ–∂–∞ –≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ">
										<label>ID –ø–ª–∞—Ç–µ–∂–∞:</label>
										<span id="txDetailPaymentId">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-receipt"></i>
									<span>–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–•–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
										<label>–•–µ—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</label>
										<span id="txDetailHash">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É">
										<label>–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É:</label>
										<span id="txDetailPaymentLink">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-shopping-cart"></i>
									<span>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" title="–•–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞">
										<label>–•–æ—Å—Ç:</label>
										<span id="txDetailHost">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞">
										<label>–ü–ª–∞–Ω:</label>
										<span id="txDetailPlan">‚Äî</span>
									</div>
									<div class="user-detail-item" title="–ö–ª—é—á –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è" style="grid-column: 1 / -1;">
										<label>–ö–ª—é—á:</label>
										<span id="txDetailConnectionString" style="word-break: break-all; font-size: 12px;">‚Äî</span>
									</div>
								</div>
							</div>

							<!-- –ì—Ä—É–ø–ø–∞: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
							<div class="user-data-group">
								<div class="user-data-group-header">
									<i class="fas fa-database"></i>
									<span>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</span>
								</div>
								<div class="user-details-grid">
									<div class="user-detail-item" style="grid-column: 1 / -1;" title="JSON –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏">
										<label>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (JSON):</label>
										<pre id="txDetailMetadata" style="padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; max-height: 300px;">‚Äî</pre>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
				
				<div class="drawer-footer">
					<!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∫–µ–±–∞–± –º–µ–Ω—é –∏ –∑–∞–∫—Ä—ã—Ç—å -->
					<div class="drawer-footer-left">
						<button type="button" class="button button-secondary" onclick="closeTransactionModal()" title="–ó–∞–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞">
							–ó–∞–∫—Ä—ã—Ç—å
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Key Drawer -->
		{% include 'key_drawer.html' %}

		<script>
		// ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ì–†–£–ü–ü–ê–ú–ò –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ====================
		
		let currentUserGroups = [];
		let currentUserId = null;
		
		// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≥—Ä—É–ø–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
		async function loadUserGroups() {
			try {
				const response = await fetch('/api/user-groups');
				const data = await response.json();
				
				if (data.success) {
					currentUserGroups = data.groups;
					
					// –ó–∞–ø–æ–ª–Ω—è–µ–º select –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
					const groupSelect = document.getElementById('detailGroupInput');
					if (groupSelect) {
						groupSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>';
						data.groups.forEach(group => {
							const option = document.createElement('option');
							option.value = group.group_id;
							option.textContent = group.group_name;
							groupSelect.appendChild(option);
						});
					}
					
					return data.groups;
				} else {
					console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', data.error);
					return [];
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
				return [];
			}
		}
		
		// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
		async function changeUserGroup(userId, currentGroupName, currentGroupId) {
			currentUserId = userId;
			
			const groups = await loadUserGroups();
			if (groups.length === 0) {
				alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –≥—Ä—É–ø–ø');
				return;
			}
			
			const modal = document.createElement('div');
			modal.className = 'modal-backdrop';
			modal.innerHTML = `
				<div class="modal">
					<div class="modal-content">
						<div class="modal-header">
							<h3>–ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
							<span class="close" onclick="closeModal()">&times;</span>
						</div>
						<div class="modal-body">
							<div class="form-group">
								<label for="user-group-select">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É:</label>
								<select id="user-group-select" title="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
									${groups.map(group => `
										<option value="${group.group_id}" ${group.group_id === currentGroupId ? 'selected' : ''}>
											${group.group_name} ${group.is_default ? '(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)' : ''}
										</option>
									`).join('')}
								</select>
							</div>
							<div class="form-group">
								<label>–¢–µ–∫—É—â–∞—è –≥—Ä—É–ø–ø–∞:</label>
								<span class="current-group">${currentGroupName || 'N/A'}</span>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="button button-secondary" onclick="closeModal()" title="–û—Ç–º–µ–Ω–∏—Ç—å">
								<i class="fas fa-times"></i>
								–û—Ç–º–µ–Ω–∏—Ç—å
							</button>
							<button type="button" class="button button-primary" onclick="saveUserGroupChange()" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è">
								<i class="fas fa-save"></i>
								–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
							</button>
						</div>
					</div>
				</div>
			`;
			
			document.body.appendChild(modal);
		}
		
		// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
		async function changeUserGroupFromModal() {
			if (!currentUserId) {
				alert('–û—à–∏–±–∫–∞: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
				return;
			}
			
			// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –≥—Ä—É–ø–ø—É –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
			const currentGroupElement = document.getElementById('detailGroup');
			const currentGroupName = currentGroupElement ? currentGroupElement.textContent : 'N/A';
			
			await changeUserGroup(currentUserId, currentGroupName, null);
		}
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
		async function saveUserGroupChange() {
			const groupSelect = document.getElementById('user-group-select');
			const newGroupId = groupSelect ? parseInt(groupSelect.value) : null;
			
			if (!newGroupId || !currentUserId) {
				alert('–û—à–∏–±–∫–∞: –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –≥—Ä—É–ø–ø–∞ –∏–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
				return;
			}
			
			try {
				const response = await fetch(`/api/users/${currentUserId}/group`, {
					method: 'PUT',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ group_id: newGroupId })
				});
				
				const result = await response.json();
				
				if (result.success) {
					closeModal();
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
					const groupBadge = document.querySelector(`[data-user-id="${currentUserId}"] .group-badge`);
					if (groupBadge) {
						const selectedGroup = currentUserGroups.find(g => g.group_id === newGroupId);
						if (selectedGroup) {
							groupBadge.textContent = selectedGroup.group_name;
						}
					}
					
					// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
					const detailGroup = document.getElementById('detailGroup');
					if (detailGroup) {
						const selectedGroup = currentUserGroups.find(g => g.group_id === newGroupId);
						if (selectedGroup) {
							detailGroup.textContent = selectedGroup.group_name;
						}
					}
					
					showNotification(result.message, 'success');
				} else {
					alert('–û—à–∏–±–∫–∞: ' + result.error);
				}
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
				alert('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
			}
		}
		
		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
		function updateUserGroupInModal(userData) {
			const detailGroup = document.getElementById('detailGroup');
			if (detailGroup && userData.group_name) {
				detailGroup.textContent = userData.group_name;
			}
		}
		
		// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
		function showNotification(message, type = 'info') {
			// –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
			const notification = document.createElement('div');
			notification.className = `notification notification-${type}`;
			notification.innerHTML = `
				<div class="notification-content">
					<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
					<span>${message}</span>
				</div>
			`;
			
			// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
			notification.style.cssText = `
				position: fixed;
				top: 20px;
				right: 20px;
				background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
				color: white;
				padding: 15px 20px;
				border-radius: 8px;
				box-shadow: 0 4px 12px rgba(0,0,0,0.3);
				z-index: 10000;
				animation: slideInRight 0.3s ease-out;
			`;
			
			document.body.appendChild(notification);
			
			// –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
			setTimeout(() => {
				notification.style.animation = 'slideOutRight 0.3s ease-in';
				setTimeout(() => {
					if (notification.parentNode) {
						notification.parentNode.removeChild(notification);
					}
				}, 300);
			}, 3000);
		}
		
		// –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
		const style = document.createElement('style');
		style.textContent = `
			@keyframes slideInRight {
				from { transform: translateX(100%); opacity: 0; }
				to { transform: translateX(0); opacity: 1; }
			}
			@keyframes slideOutRight {
				from { transform: translateX(0); opacity: 1; }
				to { transform: translateX(100%); opacity: 0; }
			}
			.notification-content {
				display: flex;
				align-items: center;
				gap: 10px;
			}
		`;
		document.head.appendChild(style);
		
		// ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú SHARE ====================
		
		// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ Share
		function openShareModal() {
			document.getElementById('shareModal').style.display = 'flex';
			loadShareModalData();
		}
		
		// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ Share
		function closeShareModal() {
			document.getElementById('shareModal').style.display = 'none';
			clearShareForm();
		}
		
		// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ Share
		async function loadShareModalData() {
			try {
				// –ó–∞–≥—Ä—É–∑–∫–∞ –±–æ—Ç–æ–≤
				const botsResponse = await fetch('/api/bots');
				const botsData = await botsResponse.json();
				const botSelect = document.getElementById('shareBot');
				botSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞</option>';
				botsData.bots.forEach(bot => {
					const option = document.createElement('option');
					option.value = bot.bot;
					option.setAttribute('data-username', bot.username);
					option.textContent = bot.name;
					botSelect.appendChild(option);
				});
				
				// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø
				const groupsResponse = await fetch('/api/user-groups');
				const groupsData = await groupsResponse.json();
				const groupSelect = document.getElementById('shareGroup');
				groupSelect.innerHTML = '<option value="">–ë–µ–∑ –≥—Ä—É–ø–ø—ã</option>';
				groupsData.groups.forEach(group => {
					const option = document.createElement('option');
					option.value = group.group_code;
					option.textContent = group.group_name;
					groupSelect.appendChild(option);
				});
			} catch (error) {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
				showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
			}
		}
		
		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –±–æ—Ç–∞
		document.addEventListener('DOMContentLoaded', function() {
			const botSelect = document.getElementById('shareBot');
			if (botSelect) {
				botSelect.addEventListener('change', async function() {
					const selectedBot = this.value;
					const promoSelect = document.getElementById('sharePromo');
					
					if (!selectedBot) {
						promoSelect.innerHTML = '<option value="">–ë–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞</option>';
						return;
					}
					
					try {
						const response = await fetch(`/api/promo-codes/by-bot?bot=${selectedBot}`);
						const data = await response.json();
						promoSelect.innerHTML = '<option value="">–ë–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞</option>';
						data.promo_codes.forEach(promo => {
							const option = document.createElement('option');
							option.value = promo.code;
							option.textContent = promo.code;
							promoSelect.appendChild(option);
						});
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:', error);
					}
				});
			}
		});
		
		// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è deeplink
		function updateShareLink() {
			const botSelect = document.getElementById('shareBot');
			const selectedBot = botSelect.options[botSelect.selectedIndex];
			const botUsername = selectedBot ? selectedBot.getAttribute('data-username') : '';
			const groupCode = document.getElementById('shareGroup').value;
			const promoCode = document.getElementById('sharePromo').value;
			
			if (!botUsername) {
				document.getElementById('shareLink').value = '';
				return;
			}
			
			// –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Å—ã–ª–∫—É
			if (!groupCode && !promoCode) {
				document.getElementById('shareLink').value = `https://t.me/${botUsername}`;
				return;
			}
			
			// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ API —Å base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
			fetch('/api/generate-deeplink', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({
					bot_username: botUsername,
					group_code: groupCode || null,
					promo_code: promoCode || null,
					referrer_id: null
				})
			})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					document.getElementById('shareLink').value = data.link;
				} else {
					console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏:', data.error);
					// Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
					document.getElementById('shareLink').value = `https://t.me/${botUsername}?start=error_${data.error}`;
				}
			})
			.catch(error => {
				console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:', error);
				// Fallback –Ω–∞ –±–∞–∑–æ–≤—É—é —Å—Å—ã–ª–∫—É
				document.getElementById('shareLink').value = `https://t.me/${botUsername}`;
			});
		}
		
		// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
		function copyShareLink() {
			const linkInput = document.getElementById('shareLink');
			if (linkInput.value) {
				linkInput.select();
				document.execCommand('copy');
				showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞', 'success');
			} else {
				showNotification('–°—Å—ã–ª–∫–∞ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞', 'error');
			}
		}
		
		// –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã Share
		function clearShareForm() {
			document.getElementById('shareBot').value = '';
			document.getElementById('shareGroup').value = '';
			document.getElementById('sharePromo').value = '';
			document.getElementById('shareLink').value = '';
		}
		</script>

		<script>
			window.panelTimeZone = {{ (panel_timezone or 'Europe/Moscow') | tojson }};
			window.panelTimeZoneOffset = {{ (panel_timezone_offset or 'UTC+3') | tojson }};
		</script>

		<script src="{{ url_for('static', filename='js/script.js') }}"></script>
		{% block scripts %}{% endblock %}
	</body>
</html>
