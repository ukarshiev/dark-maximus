{% extends "base.html" %} {% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–æ—Ç–∞ –∏ –•–æ—Å—Ç–æ–≤{% endblock %}
{% block content %}

<h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–æ–¥–º–µ–Ω—é -->
    <div class="settings-navigation">
    	<button class="nav-button active" onclick="showTab('servers', this)">üñ•Ô∏è –°–µ—Ä–≤–µ—Ä—ã</button>
    	<button class="nav-button" onclick="showTab('panel', this)">‚öôÔ∏è –ü–∞–Ω–µ–ª—å</button>
    	<button class="nav-button" onclick="showTab('bot', this)">ü§ñ –ë–æ—Ç</button>
    	<button class="nav-button" onclick="showTab('payments', this)">üí≥ –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</button>
    </div>

<div class="settings-container">
	
	<!-- –í–∫–ª–∞–¥–∫–∞ "–°–µ—Ä–≤–µ—Ä—ã" -->
	<div id="servers-tab" class="settings-tab active">
		<section class="settings-section">
			<h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –•–æ—Å—Ç–∞–º–∏ (–°–µ—Ä–≤–µ—Ä–∞–º–∏)</h2>

            <div class="host-card">
                <div class="host-header">
                    <h4>–•–æ—Å—Ç—ã</h4>
                    <div class="host-actions">
                        <button type="button" class="button button-primary button-small button-icon" title="–î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç" onclick="openHostModal()">‚ûï</button>
                    </div>
                </div>
                <form action="{{ url_for('add_host_route') }}" method="post" style="display:none" id="hiddenAddHostForm">
					<div class="form-group">
						<label for="host_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞:</label>
						<input
							type="text"
							id="host_name"
							name="host_name"
							required
							maxlength="26"
						/>
					</div>
					<div class="form-group">
						<label for="host_url">URL –ø–∞–Ω–µ–ª–∏ XUI:</label>
						<input
							type="url"
							id="host_url"
							name="host_url"
							placeholder="http://123.45.67.89:54321"
							required
						/>
					</div>
					<div class="form-group">
						<label for="host_username">–õ–æ–≥–∏–Ω XUI:</label>
						<input
							type="text"
							id="host_username"
							name="host_username"
							required
						/>
					</div>
					<div class="form-group password-wrapper">
						<label for="host_pass">–ü–∞—Ä–æ–ª—å XUI:</label>
						<input type="password" id="host_pass" name="host_pass" required />
						<button type="button" class="toggle-password">üëÅÔ∏è</button>
					</div>
					<div class="form-group">
						<label for="host_inbound_id">ID –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</label>
						<input
							type="number"
							id="host_inbound_id"
							name="host_inbound_id"
							required
						/>
					</div>
					<button type="submit" class="button button-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
			</div>

			{% if hosts %} {% for host in hosts %}
			<div class="host-card">
                <div class="host-header">
                    <h3>{{ host.host_name }}</h3>
                    <div class="host-actions">
                        <button class="button button-small button-icon" type="button" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ö–æ—Å—Ç" onclick="openHostModalData(this)" data-host-name="{{ host.host_name }}" data-host-url="{{ host.host_url }}" data-host-username="{{ host.host_username }}" data-host-inbound-id="{{ host.host_inbound_id }}">‚úèÔ∏è</button>
                        <button class="button button-small button-icon" type="button" title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ" onclick="checkHost(this.getAttribute('data-host-name'), this)" data-host-name="{{ host.host_name }}">üîå</button>
                        <form action="{{ url_for('delete_host_route', host_name=host.host_name) }}" method="post" data-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ö–æ—Å—Ç –∏ –≤—Å–µ –µ–≥–æ —Ç–∞—Ä–∏—Ñ—ã?" style="display:inline-block">
                            <button type="submit" class="button button-danger button-small button-icon" title="–£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç">üóëÔ∏è</button>
                        </form>
                    </div>
				</div>
				<p><strong>URL:</strong> <span data-field="host_url" data-original="{{ host.host_url }}">{{ hidden_mode and '***' or host.host_url }}</span></p>
				<div class="plans-section">
                    <div class="host-header" style="margin-bottom:8px;">
                        <h4>–¢–∞—Ä–∏—Ñ—ã</h4>
                        <div class="host-actions">
                            <button class="button button-primary button-small button-icon" type="button" title="–î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ" onclick="openPlanModalData(this)" data-host-name="{{ host.host_name }}">‚ûï</button>
                        </div>
                    </div>
					{% if host.plans %}
					<ul class="plan-list">
						{% for plan in host.plans %}
						<li>
							<span>
								{{ plan.plan_name }} - {{ plan.price|round(0) }} RUB
								{% set months = plan.get('months', 0) %}
								{% set days = plan.get('days', 0) %}
								{% set traffic = plan.get('traffic_gb', 0) %}
								{% if months and months|int > 0 %} ¬∑ {{ months }} –º–µ—Å{% endif %}
								{% if days and days|int > 0 %} ¬∑ {{ days }} –¥–Ω{% endif %}
								 ¬∑ –¢—Ä–∞—Ñ–∏–∫: {{ traffic and (traffic|round(2) ~ ' –ì–ë') or '‚àû' }}
							</span>
                            <div class="host-actions" style="margin-top:6px;">
                                <button class="button button-small button-icon" type="button" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ" onclick="openPlanModalData(this)" data-plan-id="{{ plan.plan_id }}" data-plan-name="{{ plan.plan_name }}" data-plan-months="{{ plan.months }}" data-plan-days="{{ plan.get('days', 0) }}" data-plan-price="{{ plan.price }}" data-plan-traffic="{{ plan.get('traffic_gb', 0) }}" data-host-name="{{ host.host_name }}">‚úèÔ∏è</button>
                                <form action="{{ url_for('delete_plan_route', plan_id=plan.plan_id) }}" method="post" class="form-inline" style="display:inline-block;">
                                    <button type="submit" class="button button-danger button-tiny button-icon" title="–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ">üóëÔ∏è</button>
                                </form>
                            </div>
							</form>
						</li>
						{% endfor %}
					</ul>
					{% else %}
					<p>–¢–∞—Ä–∏—Ñ—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
					{% endif %}
                    <h5 style="display:none">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ:</h5>
				</div>
			</div>
			{% endfor %} {% else %}
			<p>–•–æ—Å—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
			{% endif %}
		</section>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ü–∞–Ω–µ–ª—å" -->
	<div id="panel-tab" class="settings-tab">
		<form action="{{ url_for('save_panel_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–∞–Ω–µ–ª–∏</h2>
				<div class="form-group">
					<label for="panel_login">–õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø–∞–Ω–µ–ª—å:</label>
					<input
						type="text"
						id="panel_login"
						name="panel_login"
						value="{{ settings.panel_login or '' }}"
						required
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="panel_password"
						>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å):</label
					>
					<input type="password" id="panel_password" name="panel_password" />
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
			</section>
			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–Ω–µ–ª–∏
			</button>
		</form>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ë–æ—Ç" -->
	<div id="bot-tab" class="settings-tab">
		<form action="{{ url_for('save_bot_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–æ—Ç–∞</h2>
				<div class="form-group password-wrapper">
					<label for="telegram_bot_token">–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
					<input
						type="password"
						id="telegram_bot_token"
						name="telegram_bot_token"
						value="{{ settings.telegram_bot_token or '' }}"
						required
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="telegram_bot_username">Username –±–æ—Ç–∞ (–±–µ–∑ @):</label>
					<input
						type="text"
						id="telegram_bot_username"
						name="telegram_bot_username"
						value="{{ hidden_mode and '' or (settings.telegram_bot_username or '') }}"
						required
					/>
				</div>
				<div class="form-group">
					<label for="admin_telegram_id">Telegram ID –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
					<input
						type="text"
						id="admin_telegram_id"
						name="admin_telegram_id"
						value="{{ hidden_mode and '' or (settings.admin_telegram_id or '') }}"
						required
					/>
				</div>
			</section>
		<section class="settings-section">
			<h2>–ü–ª–∞—Ç–µ–∂–∏ –≤ –±–æ—Ç–µ</h2>
			<div class="form-group">
				<label for="minimum_topup">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (RUB):</label>
				<input type="number" step="1" id="minimum_topup" name="minimum_topup" value="{{ settings.minimum_topup or '50' }}" />
				<small class="text-muted">–≠—Ç–∞ —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ "–í–≤–µ—Å—Ç–∏ –¥—Ä—É–≥—É—é —Å—É–º–º—É".</small>
			</div>
		</section>
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ë–æ—Ç–∞-–°–∞–ø–ø–æ—Ä—Ç–∞</h2>
                <div class="form-group form-group-checkbox">
                    <input type="hidden" name="support_enabled" value="false" />
                    <input type="checkbox" id="support_enabled" name="support_enabled" value="true" {% if settings.support_enabled == 'true' %}checked{% endif %}>
                    <label for="support_enabled">–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</label>
                </div>
				<div class="form-group">
					<label for="support_user">URL –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ –ë–æ—Ç–∞-–°–∞–ø–ø–æ—Ä—Ç–∞:</label>
					<input
						type="text"
						id="support_user"
						name="support_user"
						value="{{ settings.support_user or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="support_bot_token"
						>–¢–æ–∫–µ–Ω Support-–±–æ—Ç–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):</label
					>
					<input
						type="password"
						id="support_bot_token"
						name="support_bot_token"
						value="{{ settings.support_bot_token or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="support_group_id"
						>ID –ì—Ä—É–ø–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä—É–º–∞
						(Topics)):</label
					>
					<input
						type="text"
						id="support_group_id"
						name="support_group_id"
						value="{{ settings.support_group_id or '' }}"
					/>
				</div>
			</section>
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="enable_referrals" value="false" />
					<input type="checkbox" id="enable_referrals" name="enable_referrals"
					value="true" {% if settings.enable_referrals == 'true' %}checked{%
					endif %}>
					<label for="enable_referrals">–í–∫–ª—é—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É</label>
				</div>
				<div class="form-group">
					<label for="minimum_withdrawal">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞:</label>
					<input
						type="number"
						id="minimum_withdrawal"
						name="minimum_withdrawal"
						value="{{ settings.minimum_withdrawal or '10' }}"
					/>
				</div>
				<div class="form-group">
					<label for="referral_percentage"
						>–ü—Ä–æ—Ü–µ–Ω—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É (%):</label
					>
					<input
						type="number"
						id="referral_percentage"
						name="referral_percentage"
						value="{{ settings.referral_percentage or '10' }}"
					/>
				</div>
				<div class="form-group">
					<label for="referral_discount"
						>–°–∫–∏–¥–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É (%):</label
					>
					<input
						type="number"
						id="referral_discount"
						name="referral_discount"
						value="{{ settings.referral_discount or '5' }}"
					/>
				</div>
			</section>

			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
				<div class="form-group">
					<label for="about_text">–¢–µ–∫—Å—Ç "–û –ø—Ä–æ–µ–∫—Ç–µ":</label>
					<textarea id="about_text" name="about_text" rows="3">{{
							settings.about_text or ""
						}}</textarea>
				</div>
				<div class="form-group">
					<label for="support_text">–¢–µ–∫—Å—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥–¥–µ—Ä–∂–∫–∞":</label>
					<textarea id="support_text" name="support_text" rows="3">{{
							settings.support_text or ""
						}}</textarea>
				</div>
				<div class="form-group">
					<label for="terms_url">URL "–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è":</label>
					<input
						type="url"
						id="terms_url"
						name="terms_url"
						value="{{ settings.terms_url or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="privacy_url">URL "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏":</label>
					<input
						type="url"
						id="privacy_url"
						name="privacy_url"
						value="{{ settings.privacy_url or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="channel_url"
						>URL Telegram-–∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä. https://t.me/nnstorenews):</label
					>
					<input
						type="url"
						id="channel_url"
						name="channel_url"
						value="{{ settings.channel_url or '' }}"
					/>
				</div>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="force_subscription" value="false" />
					<input type="checkbox" id="force_subscription"
					name="force_subscription" value="true" {% if
					settings.force_subscription == 'true' %}checked{% endif %}>
					<label for="force_subscription"
						>–¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</label
					>
				</div>
			</section>

			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="trial_enabled" value="false" />
					<input type="checkbox" id="trial_enabled" name="trial_enabled"
					value="true" {% if settings.trial_enabled == 'true' %}checked{% endif
					%}>
					<label for="trial_enabled">–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥</label>
				</div>
				<div class="form-group">
					<label for="trial_duration_days"
						>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–≤ –¥–Ω—è—Ö):</label
					>
					<input
						type="number"
						id="trial_duration_days"
						name="trial_duration_days"
						value="{{ settings.trial_duration_days or '3' }}"
					/>
				</div>
			</section>
			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
			</button>
		</form>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã" -->
	<div id="payments-tab" class="settings-tab">
		<form action="{{ url_for('save_payment_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–ª–∞—Ç–µ–∂–Ω—ã—Ö –°–∏—Å—Ç–µ–º</h2>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa</h2>
				<div class="form-group">
					<label for="receipt_email">–ü–æ—á—Ç–∞ –¥–ª—è —á–µ–∫–æ–≤:</label>
					<input
						type="text"
						id="receipt_email"
						name="receipt_email"
						value="{{ settings.receipt_email or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="yookassa_shop_id">YooKassa Shop ID:</label>
					<input
						type="text"
						id="yookassa_shop_id"
						name="yookassa_shop_id"
						value="{{ settings.yookassa_shop_id or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="yookassa_secret_key">YooKassa Secret Key:</label>
					<input
						type="password"
						id="yookassa_secret_key"
						name="yookassa_secret_key"
						value="{{ settings.yookassa_secret_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="sbp_enabled" value="false" />
					<input type="checkbox" id="sbp_enabled" name="sbp_enabled"
					value="true" {% if settings.sbp_enabled == 'true' %}checked{% endif
					%}>
					<label for="sbp_enabled">–í–∫–ª—é—á–∏—Ç—å –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ –°–ë–ü</label>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CryptoBot</h2>
				<div class="form-group password-wrapper">
					<label for="cryptobot_token">CryptoBot Token:</label>
					<input
						type="password"
						id="cryptobot_token"
						name="cryptobot_token"
						value="{{ settings.cryptobot_token or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Heleket</h2>
				<div class="form-group">
					<label for="heleket_merchant_id">Heleket Merchant ID:</label>
					<input
						type="text"
						id="heleket_merchant_id"
						name="heleket_merchant_id"
						value="{{ settings.heleket_merchant_id or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="heleket_api_key">Heleket API Key:</label>
					<input
						type="password"
						id="heleket_api_key"
						name="heleket_api_key"
						value="{{ settings.heleket_api_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="domain">–í–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, my-shop.com):</label>
					<input
						type="text"
						id="domain"
						name="domain"
						value="{{ settings.domain or '' }}"
					/>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ TonConnect</h2>
				<div class="form-group">
					<label for="ton_wallet_address">Ton Wallet:</label>
					<input
						type="text"
						id="ton_wallet_address"
						name="ton_wallet_address"
						value="{{ settings.ton_wallet_address or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="tonapi_key">TonAPI Key:</label>
					<input
						type="password"
						id="tonapi_key"
						name="tonapi_key"
						value="{{ settings.tonapi_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Stars</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="stars_enabled" value="false" />
					<input type="checkbox" id="stars_enabled" name="stars_enabled"
					value="true" {% if settings.stars_enabled == 'true' %}checked{% endif %}>
					<label for="stars_enabled">–í–∫–ª—é—á–∏—Ç—å –æ–ø–ª–∞—Ç—É –∑–≤–µ–∑–¥–∞–º–∏ Telegram</label>
				</div>
				<div class="form-group">
					<label for="stars_conversion_rate">–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (—Ä—É–±–ª–µ–π –∑–∞ 1 –∑–≤–µ–∑–¥—É):</label>
					<div style="display: flex; gap: 10px; align-items: center;">
						<input
							type="number"
							step="0.01"
							id="stars_conversion_rate"
							name="stars_conversion_rate"
							value="{{ settings.stars_conversion_rate or '1.79' }}"
							placeholder="1.79"
							style="flex: 1;"
						/>
						<button type="button" onclick="updateStarsRate()" class="button button-small" style="white-space: nowrap;">
							üîÑ –û–±–Ω–æ–≤–∏—Ç—å
						</button>
					</div>
					<small class="text-muted">
						üí° <strong>–ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å:</strong><br>
						‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫—É—Ä—Å –≤ Telegram: 100 –∑–≤–µ–∑–¥ = 179 —Ä—É–±–ª–µ–π<br>
						‚Ä¢ –ó–Ω–∞—á–∏—Ç 1 –∑–≤–µ–∑–¥–∞ = 1.79 —Ä—É–±–ª–µ–π<br>
						‚Ä¢ –≠—Ç–æ—Ç –∫—É—Ä—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏<br>
						‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å (1.79)
					</small>
				</div>
			</section>

			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
			</button>
		</form>
	</div>

</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.settings-navigation {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 10px;
}

.nav-button {
    padding: 12px 20px;
    border: none;
    background: #3a4147;
    color: #ffffff;
    cursor: pointer;
    border-radius: 8px 8px 0 0;
    font-weight: 500;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
}

.nav-button:hover {
    background: #4a5058;
    transform: translateY(-2px);
}

.nav-button.active {
    background: #007bff;
    color: white;
    border-bottom: 3px solid #0056b3;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
.settings-tab {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.settings-tab.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Settings Dark Theme v2.2 - Added tab navigation & moved content settings */
/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
.settings-container {
    background: #2d3238;
    border-radius: 8px;
    padding: 20px;
    margin-top: 10px;
    color: #ffffff;
}

.settings-section {
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    color: #ffffff;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
.settings-container .button {
    background: #007bff;
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s ease;
}

.settings-container .button:hover {
    background: #0056b3;
}

.settings-container .button-small {
    padding: 8px 16px;
    font-size: 14px;
}

.settings-container .button-primary {
    background: #28a745;
}

.settings-container .button-primary:hover {
    background: #1e7e34;
}

.settings-container .button-danger {
    background: #dc3545;
}

.settings-container .button-danger:hover {
    background: #c82333;
}

.host-header{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
}
.host-actions{ display:flex; gap:8px; }
.button-icon{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; padding:0; }

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
.settings-container input,
.settings-container textarea,
.settings-container select {
    background: #3a4147;
    color: #ffffff;
    border: 1px solid #4a5058;
    border-radius: 4px;
    padding: 8px 12px;
}

.settings-container input:focus,
.settings-container textarea:focus,
.settings-container select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–µ–π–±–ª–æ–≤ */
.settings-container label {
    color: #ffffff;
    font-weight: 500;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
.settings-container .text-muted {
    color: #bdc3c7 !important;
}
</style>

<script>
    function showTab(tabName, el) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const tabs = document.querySelectorAll('.settings-tab');
    tabs.forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    const buttons = document.querySelectorAll('.nav-button');
    buttons.forEach(button => {
        button.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
        if (el) { el.classList.add('active'); }
}

function updateStarsRate() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram
    document.getElementById('stars_conversion_rate').value = '1.79';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alert('–ö—É—Ä—Å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ 1.79 —Ä—É–±–ª–µ–π –∑–∞ 1 –∑–≤–µ–∑–¥—É.\n\n–≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ:\n100 –∑–≤–µ–∑–¥ = 179 —Ä—É–±–ª–µ–π\n\n–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –≤ Telegram.');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    showTab('{{ active_tab or "servers" }}');
    // –ü—Ä–æ—Å—Ç–∞–≤–∏–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–µ
    const currentBtn = Array.from(document.querySelectorAll('.nav-button'))
        .find(btn => btn.getAttribute('onclick') && btn.getAttribute('onclick').includes("'{{ active_tab or "servers" }}'"));
    if (currentBtn) { currentBtn.classList.add('active'); }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–æ–º
async function checkHost(hostName, btn){
    try{
        if(btn){ btn.disabled = true; btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...'; }
        const form = new FormData();
        form.append('host_name', hostName);
        const res = await fetch('/check-host', {method:'POST', body: form});
        const data = await res.json();
        alert((data.status==='success'?'‚úÖ ':'‚ùå ') + (data.message || ''));
    }catch(e){
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏');
    }finally{
        if(btn){ btn.disabled = false; btn.textContent = 'üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å'; }
    }
}

// –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Ö–æ—Å—Ç–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
function openHostModal(name='', url='', user='', pass='', inbound=''){
    const html = `
    <div class="modal-backdrop">
      <div class="modal" style="display:block;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>${name? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ö–æ—Å—Ç' : '–î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç'}</h3>
            <span class="close" onclick="closeModal()">&times;</span>
          </div>
          <div class="modal-body">
            <form method="post" action="${name? '/edit-host' : '/add-host'}">
              ${name? `<input type="hidden" name="old_host_name" value="${name}">` : ''}
              <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="host_name" value="${name}" required></div>
              <div class="form-group"><label>URL –ø–∞–Ω–µ–ª–∏ XUI</label><input type="url" name="host_url" value="${url}" placeholder="https://host:port/secret" required></div>
              <div class="form-group"><label>–õ–æ–≥–∏–Ω</label><input type="text" name="host_username" value="${user}" required></div>
              <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" name="host_pass" value="${pass||''}" required></div>
              <div class="form-group"><label>ID –∏–Ω–±–∞—É–Ω–¥–∞</label><input type="number" name="host_inbound_id" value="${inbound}" required></div>
              <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button type="button" class="button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="button button-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>`;
    showModal(html);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ data-* –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ö–æ—Å—Ç–∞
function openHostModalData(el){
    if(!el) return;
    const name = el.getAttribute('data-host-name') || '';
    const url = el.getAttribute('data-host-url') || '';
    const user = el.getAttribute('data-host-username') || '';
    const inbound = el.getAttribute('data-host-inbound-id') || '';
    openHostModal(name, url, user, '', inbound);
}

// –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
function openPlanModal(planId, name, months, days, price, traffic, hostName){
    const isEdit = !!planId;
    const action = isEdit ? `/edit-plan/${planId}` : '/add-plan';
    const hiddenHost = isEdit ? '' : `<input type="hidden" name="host_name" value="${hostName}">`;
    const html = `
    <div class="modal-backdrop">
      <div class="modal" style="display:block;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>${isEdit? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ' : '–î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ'}</h3>
            <span class="close" onclick="closeModal()">&times;</span>
          </div>
          <div class="modal-body">
            <form method="post" action="${action}">
              ${hiddenHost}
              <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="plan_name" value="${name||''}" placeholder="–ù–∞–ø—Ä. –ë–∞–∑–æ–≤—ã–π" required></div>
              <div class="form-group"><label>–ú–µ—Å—è—Ü—ã</label><input type="number" name="months" value="${months||''}" placeholder="0"></div>
              <div class="form-group"><label>–î–Ω–∏</label><input type="number" name="days" value="${days||''}" placeholder="0"></div>
              <div class="form-group"><label>–¶–µ–Ω–∞ (RUB)</label><input type="number" step="0.01" name="price" value="${price||''}" placeholder="0" required></div>
              <div class="form-group"><label>–¢—Ä–∞—Ñ–∏–∫ (–ì–ë)</label><input type="number" step="0.01" name="traffic_gb" value="${traffic||''}" placeholder="0 (–±–µ–∑–ª–∏–º–∏—Ç)"></div>
              <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button type="button" class="button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="button button-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>`;
    showModal(html);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ç–∞—Ä–∏—Ñ–∞ (add/edit) —á–µ—Ä–µ–∑ data-*
function openPlanModalData(el){
    if(!el) return;
    const planId = el.getAttribute('data-plan-id');
    const hostName = el.getAttribute('data-host-name') || '';
    if (planId) {
        const name = el.getAttribute('data-plan-name') || '';
        const months = el.getAttribute('data-plan-months') || '';
        const days = el.getAttribute('data-plan-days') || '';
        const price = el.getAttribute('data-plan-price') || '';
        const traffic = el.getAttribute('data-plan-traffic') || '';
        openPlanModal(planId, name, months, days, price, traffic, hostName);
    } else {
        openPlanModal(null, '', '', '', '', '', hostName);
    }
}

function showModal(html){
    const wrap = document.createElement('div');
    wrap.innerHTML = html;
    document.body.appendChild(wrap);
    const modal = wrap.querySelector('.modal');
    if (modal) modal.style.display = 'block';
}
function closeModal(){
    const el = document.querySelector('.modal-backdrop');
    if(el) el.remove();
}
</script>

{% endblock %}
