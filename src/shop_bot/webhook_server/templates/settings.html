{% extends "base.html" %} {% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–æ—Ç–∞ –∏ –•–æ—Å—Ç–æ–≤{% endblock %}
{% block content %}

<h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–æ–¥–º–µ–Ω—é -->
    <div class="settings-navigation">
    	<button class="nav-button active" onclick="showTab('servers', this)">üñ•Ô∏è –°–µ—Ä–≤–µ—Ä—ã</button>
    	<button class="nav-button" onclick="showTab('panel', this)">‚öôÔ∏è –ü–∞–Ω–µ–ª—å</button>
    	<button class="nav-button" onclick="showTab('bot', this)">ü§ñ –ë–æ—Ç</button>
    	<button class="nav-button" onclick="showTab('payments', this)">üí≥ –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</button>
    </div>

<div class="settings-container">
	
	<!-- –í–∫–ª–∞–¥–∫–∞ "–°–µ—Ä–≤–µ—Ä—ã" -->
	<div id="servers-tab" class="settings-tab active">
		<section class="settings-section">
			<div class="host-header section-top">
				<h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏</h2>
				<div class="host-actions">
					<button type="button" class="button button-primary" title="–î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç" onclick="openHostModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
				</div>
			</div>
			<form action="{{ url_for('add_host_route') }}" method="post" style="display:none" id="hiddenAddHostForm">
				<div class="form-group">
					<label for="host_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞:</label>
					<input
						type="text"
						id="host_name"
						name="host_name"
						required
						maxlength="26"
					/>
				</div>
				<div class="form-group">
					<label for="host_url">URL –ø–∞–Ω–µ–ª–∏ XUI:</label>
					<input
						type="url"
						id="host_url"
						name="host_url"
						placeholder="http://123.45.67.89:54321"
						required
					/>
				</div>
				<div class="form-group">
					<label for="host_username">–õ–æ–≥–∏–Ω XUI:</label>
					<input
						type="text"
						id="host_username"
						name="host_username"
						required
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="host_pass">–ü–∞—Ä–æ–ª—å XUI:</label>
					<input type="password" id="host_pass" name="host_pass" required />
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
                <div class="form-group">
					<label for="host_inbound_id">ID –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</label>
					<input
						type="number"
						id="host_inbound_id"
						name="host_inbound_id"
						required
					/>
				</div>
                <div class="form-group">
                    <label for="host_code">–ö–æ–¥ 3x-ui (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –¥–ª—è email):</label>
                    <input type="text" id="host_code" name="host_code" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: amsterdam" />
                    <small class="text-muted">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–¥—Ä–µ—Å–µ email –∫–ª—é—á–∞ –≤–º–µ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.</small>
                </div>
				<button type="submit" class="button button-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
			</form>

			{% if hosts %}
			<div class="servers-grid">
			{% for host in hosts %}
			<div class="host-card">
                <div class="host-header">
                    <h3>{{ host.host_name }}</h3>
					<div class="host-actions">
						<button class="button button-small create-plan-btn" type="button" title="–°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ" onclick="openPlanModalData(this)" data-host-name="{{ host.host_name }}">‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ</button>
						<div class="kebab-wrapper">
							<button class="button button-small button-icon kebab-btn" type="button" title="–î–µ–π—Å—Ç–≤–∏—è">‚ãÆ</button>
							<div class="kebab-menu">
								<button type="button" class="kebab-item" onclick="checkHost('{{ host.host_name }}')">üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
                                <button type="button" class="kebab-item" onclick="openHostModalData(this)" data-host-name="{{ host.host_name }}" data-host-url="{{ host.host_url }}" data-host-username="{{ host.host_username }}" data-host-inbound-id="{{ host.host_inbound_id }}" data-host-code="{{ host.host_code or (host.host_name|replace(' ', '')|lower) }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
								<button type="button" class="kebab-item danger" onclick="deleteHost('{{ host.host_name }}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
							</div>
						</div>
					</div>
				</div>
				<div class="plans-section">
                    {% if host.plans %}
                    <div class="plans-table-wrap">
                        <table class="plans-table" data-host-name="{{ host.host_name }}">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–°—Ä–æ–∫</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–¢—Ä–∞—Ñ–∏–∫</th>
                                    <th style="width:70px; text-align:right;">–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for plan in host.plans %}
                                {% set months = plan.get('months', 0) %}
                                {% set days = plan.get('days', 0) %}
                                {% set hours = plan.get('hours', 0) %}
                                {% set traffic = plan.get('traffic_gb', 0) %}
                                <tr class="plan-row"
                                    data-plan-id="{{ plan.plan_id }}"
                                    data-plan-name="{{ plan.plan_name }}"
                                    data-plan-months="{{ months }}"
                                    data-plan-days="{{ days }}"
                                    data-plan-price="{{ plan.price }}"
                                    data-plan-hours="{{ hours }}"
                                    data-plan-traffic="{{ traffic }}"
                                    data-host-name="{{ host.host_name }}"
                                >
                                    <td>{{ plan.plan_name }}</td>
                                    <td>
                                        {% if months and months|int > 0 %}{{ months }} –º–µ—Å{% endif %}
                                        {% if days and days|int > 0 %}{% if months and months|int > 0 %} ¬∑ {% endif %}{{ days }} –¥–Ω{% endif %}
                                        {% if hours and hours|int > 0 %}{% if (months and months|int > 0) or (days and days|int > 0) %} ¬∑ {% endif %}{{ hours }} —á{% endif %}
                                        {% if (not months or months|int == 0) and (not days or days|int == 0) and (not hours or hours|int == 0) %}‚Äî{% endif %}
                                    </td>
                                    <td>{{ plan.price|round(0) }} RUB</td>
                                    <td>{{ traffic and (traffic|round(2) ~ ' –ì–ë') or '‚àû' }}</td>
								<td style="text-align:right; position:relative;">
									<div class="kebab-wrapper">
										<button class="button button-small button-icon kebab-btn" type="button" title="–î–µ–π—Å—Ç–≤–∏—è">‚ãÆ</button>
										<div class="kebab-menu">
                                            <button type="button" class="kebab-item"
                                                onclick="openPlanModalData(this)"
                                                data-plan-id="{{ plan.plan_id }}" data-plan-name="{{ plan.plan_name }}" data-plan-months="{{ months }}" data-plan-days="{{ days }}" data-plan-hours="{{ hours }}" data-plan-price="{{ plan.price }}" data-plan-traffic="{{ traffic }}" data-host-name="{{ host.host_name }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
											<button type="button" class="kebab-item danger" onclick="deletePlan('{{ plan.plan_id }}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
										</div>
									</div>
								</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>–¢–∞—Ä–∏—Ñ—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
                    {% endif %}
                    <h5 style="display:none">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ:</h5>
				</div>
			</div>
			{% endfor %}
			</div>
			{% else %}
			<p>–•–æ—Å—Ç—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
			{% endif %}
		</section>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ü–∞–Ω–µ–ª—å" -->
	<div id="panel-tab" class="settings-tab">
		<form action="{{ url_for('save_panel_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–∞–Ω–µ–ª–∏</h2>
				<div class="form-group">
					<label for="panel_login">–õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ø–∞–Ω–µ–ª—å:</label>
					<input
						type="text"
						id="panel_login"
						name="panel_login"
						value="{{ settings.panel_login or '' }}"
						required
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="panel_password"
						>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å):</label
					>
					<input type="password" id="panel_password" name="panel_password" />
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
			</section>
			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–Ω–µ–ª–∏
			</button>
		</form>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ë–æ—Ç" -->
	<div id="bot-tab" class="settings-tab">
		<form action="{{ url_for('save_bot_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–æ—Ç–∞</h2>
				<div class="form-group password-wrapper">
					<label for="telegram_bot_token">–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
					<input
						type="password"
						id="telegram_bot_token"
						name="telegram_bot_token"
						value="{{ settings.telegram_bot_token or '' }}"
						required
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="telegram_bot_username">Username –±–æ—Ç–∞ (–±–µ–∑ @):</label>
					<input
						type="text"
						id="telegram_bot_username"
						name="telegram_bot_username"
						value="{{ hidden_mode and '' or (settings.telegram_bot_username or '') }}"
						required
					/>
				</div>
				<div class="form-group">
					<label for="admin_telegram_id">Telegram ID –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
					<input
						type="text"
						id="admin_telegram_id"
						name="admin_telegram_id"
						value="{{ hidden_mode and '' or (settings.admin_telegram_id or '') }}"
						required
					/>
				</div>
			</section>
		<section class="settings-section">
			<h2>–ü–ª–∞—Ç–µ–∂–∏ –≤ –±–æ—Ç–µ</h2>
			<div class="form-group">
				<label for="minimum_topup">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (RUB):</label>
				<input type="number" step="1" id="minimum_topup" name="minimum_topup" value="{{ settings.minimum_topup or '50' }}" />
				<small class="text-muted">–≠—Ç–∞ —Å—É–º–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ "–í–≤–µ—Å—Ç–∏ –¥—Ä—É–≥—É—é —Å—É–º–º—É".</small>
			</div>
		</section>
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ë–æ—Ç–∞-–°–∞–ø–ø–æ—Ä—Ç–∞</h2>
                <div class="form-group form-group-checkbox">
                    <input type="hidden" name="support_enabled" value="false" />
                    <input type="checkbox" id="support_enabled" name="support_enabled" value="true" {% if settings.support_enabled == 'true' %}checked{% endif %}>
                    <label for="support_enabled">–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</label>
                </div>
				<div class="form-group">
					<label for="support_user">URL –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ –ë–æ—Ç–∞-–°–∞–ø–ø–æ—Ä—Ç–∞:</label>
					<input
						type="text"
						id="support_user"
						name="support_user"
						value="{{ settings.support_user or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="support_bot_token"
						>–¢–æ–∫–µ–Ω Support-–±–æ—Ç–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):</label
					>
					<input
						type="password"
						id="support_bot_token"
						name="support_bot_token"
						value="{{ settings.support_bot_token or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="support_group_id"
						>ID –ì—Ä—É–ø–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä—É–º–∞
						(Topics)):</label
					>
					<input
						type="text"
						id="support_group_id"
						name="support_group_id"
						value="{{ settings.support_group_id or '' }}"
					/>
				</div>
			</section>
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="enable_referrals" value="false" />
					<input type="checkbox" id="enable_referrals" name="enable_referrals"
					value="true" {% if settings.enable_referrals == 'true' %}checked{%
					endif %}>
					<label for="enable_referrals">–í–∫–ª—é—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É</label>
				</div>
				<div class="form-group">
					<label for="minimum_withdrawal">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞:</label>
					<input
						type="number"
						id="minimum_withdrawal"
						name="minimum_withdrawal"
						value="{{ settings.minimum_withdrawal or '10' }}"
					/>
				</div>
				<div class="form-group">
					<label for="referral_percentage"
						>–ü—Ä–æ—Ü–µ–Ω—Ç –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É (%):</label
					>
					<input
						type="number"
						id="referral_percentage"
						name="referral_percentage"
						value="{{ settings.referral_percentage or '10' }}"
					/>
				</div>
				<div class="form-group">
					<label for="referral_discount"
						>–°–∫–∏–¥–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É (%):</label
					>
					<input
						type="number"
						id="referral_discount"
						name="referral_discount"
						value="{{ settings.referral_discount or '5' }}"
					/>
				</div>
			</section>

			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
				<div class="form-group">
					<label for="about_text">–¢–µ–∫—Å—Ç "–û –ø—Ä–æ–µ–∫—Ç–µ":</label>
					<textarea id="about_text" name="about_text" rows="3">{{
							settings.about_text or ""
						}}</textarea>
				</div>
				<div class="form-group">
					<label for="support_text">–¢–µ–∫—Å—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü–æ–¥–¥–µ—Ä–∂–∫–∞":</label>
					<textarea id="support_text" name="support_text" rows="3">{{
							settings.support_text or ""
						}}</textarea>
				</div>
				<div class="form-group">
					<label for="terms_url">URL "–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è":</label>
					<input
						type="url"
						id="terms_url"
						name="terms_url"
						value="{{ settings.terms_url or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="privacy_url">URL "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏":</label>
					<input
						type="url"
						id="privacy_url"
						name="privacy_url"
						value="{{ settings.privacy_url or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="channel_url"
						>URL Telegram-–∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä. https://t.me/nnstorenews):</label
					>
					<input
						type="url"
						id="channel_url"
						name="channel_url"
						value="{{ settings.channel_url or '' }}"
					/>
				</div>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="force_subscription" value="false" />
					<input type="checkbox" id="force_subscription"
					name="force_subscription" value="true" {% if
					settings.force_subscription == 'true' %}checked{% endif %}>
					<label for="force_subscription"
						>–¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∫–∞–Ω–∞–ª</label
					>
				</div>
			</section>

			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="trial_enabled" value="false" />
					<input type="checkbox" id="trial_enabled" name="trial_enabled"
					value="true" {% if settings.trial_enabled == 'true' %}checked{% endif
					%}>
					<label for="trial_enabled">–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥</label>
				</div>
				<div class="form-group">
					<label for="trial_duration_days"
						>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (–≤ –¥–Ω—è—Ö):</label
					>
					<input
						type="number"
						id="trial_duration_days"
						name="trial_duration_days"
						value="{{ settings.trial_duration_days or '3' }}"
					/>
				</div>
			</section>
			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
			</button>
		</form>
	</div>

	<!-- –í–∫–ª–∞–¥–∫–∞ "–ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã" -->
	<div id="payments-tab" class="settings-tab">
		<form action="{{ url_for('save_payment_settings') }}" method="post">
			<section class="settings-section">
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü–ª–∞—Ç–µ–∂–Ω—ã—Ö –°–∏—Å—Ç–µ–º</h2>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa</h2>
				<div class="form-group">
					<label for="receipt_email">–ü–æ—á—Ç–∞ –¥–ª—è —á–µ–∫–æ–≤:</label>
					<input
						type="text"
						id="receipt_email"
						name="receipt_email"
						value="{{ settings.receipt_email or '' }}"
					/>
				</div>
				<div class="form-group">
					<label for="yookassa_shop_id">YooKassa Shop ID:</label>
					<input
						type="text"
						id="yookassa_shop_id"
						name="yookassa_shop_id"
						value="{{ settings.yookassa_shop_id or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="yookassa_secret_key">YooKassa Secret Key:</label>
					<input
						type="password"
						id="yookassa_secret_key"
						name="yookassa_secret_key"
						value="{{ settings.yookassa_secret_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="sbp_enabled" value="false" />
					<input type="checkbox" id="sbp_enabled" name="sbp_enabled"
					value="true" {% if settings.sbp_enabled == 'true' %}checked{% endif
					%}>
					<label for="sbp_enabled">–í–∫–ª—é—á–∏—Ç—å –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ –°–ë–ü</label>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CryptoBot</h2>
				<div class="form-group password-wrapper">
					<label for="cryptobot_token">CryptoBot Token:</label>
					<input
						type="password"
						id="cryptobot_token"
						name="cryptobot_token"
						value="{{ settings.cryptobot_token or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Heleket</h2>
				<div class="form-group">
					<label for="heleket_merchant_id">Heleket Merchant ID:</label>
					<input
						type="text"
						id="heleket_merchant_id"
						name="heleket_merchant_id"
						value="{{ settings.heleket_merchant_id or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="heleket_api_key">Heleket API Key:</label>
					<input
						type="password"
						id="heleket_api_key"
						name="heleket_api_key"
						value="{{ settings.heleket_api_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<div class="form-group">
					<label for="domain">–í–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, my-shop.com):</label>
					<input
						type="text"
						id="domain"
						name="domain"
						value="{{ settings.domain or '' }}"
					/>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ TonConnect</h2>
				<div class="form-group">
					<label for="ton_wallet_address">Ton Wallet:</label>
					<input
						type="text"
						id="ton_wallet_address"
						name="ton_wallet_address"
						value="{{ settings.ton_wallet_address or '' }}"
					/>
				</div>
				<div class="form-group password-wrapper">
					<label for="tonapi_key">TonAPI Key:</label>
					<input
						type="password"
						id="tonapi_key"
						name="tonapi_key"
						value="{{ settings.tonapi_key or '' }}"
					/>
					<button type="button" class="toggle-password">üëÅÔ∏è</button>
				</div>
				<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Stars</h2>
				<div class="form-group form-group-checkbox">
					<input type="hidden" name="stars_enabled" value="false" />
					<input type="checkbox" id="stars_enabled" name="stars_enabled"
					value="true" {% if settings.stars_enabled == 'true' %}checked{% endif %}>
					<label for="stars_enabled">–í–∫–ª—é—á–∏—Ç—å –æ–ø–ª–∞—Ç—É –∑–≤–µ–∑–¥–∞–º–∏ Telegram</label>
				</div>
				<div class="form-group">
					<label for="stars_conversion_rate">–ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ (—Ä—É–±–ª–µ–π –∑–∞ 1 –∑–≤–µ–∑–¥—É):</label>
					<div style="display: flex; gap: 10px; align-items: center;">
						<input
							type="number"
							step="0.01"
							id="stars_conversion_rate"
							name="stars_conversion_rate"
							value="{{ settings.stars_conversion_rate or '1.79' }}"
							placeholder="1.79"
							style="flex: 1;"
						/>
						<button type="button" onclick="updateStarsRate()" class="button button-small" style="white-space: nowrap;">
							üîÑ –û–±–Ω–æ–≤–∏—Ç—å
						</button>
					</div>
					<small class="text-muted">
						üí° <strong>–ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å:</strong><br>
						‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫—É—Ä—Å –≤ Telegram: 100 –∑–≤–µ–∑–¥ = 179 —Ä—É–±–ª–µ–π<br>
						‚Ä¢ –ó–Ω–∞—á–∏—Ç 1 –∑–≤–µ–∑–¥–∞ = 1.79 —Ä—É–±–ª–µ–π<br>
						‚Ä¢ –≠—Ç–æ—Ç –∫—É—Ä—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏<br>
						‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å" —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å (1.79)
					</small>
				</div>
			</section>

			
			<button type="submit" class="button button-primary">
				–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
			</button>
		</form>
	</div>

</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.settings-navigation {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 10px;
}

.nav-button {
    padding: 12px 20px;
    border: none;
    background: var(--bg-surface);
    color: #ffffff;
    cursor: pointer;
    border-radius: 8px 8px 0 0;
    font-weight: 500;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
}

.nav-button:hover {
    background: var(--bg-hover);
    transform: translateY(-2px);
}

.nav-button.active {
    background: var(--primary-color);
    color: white;
    border-bottom: 3px solid var(--primary-hover);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
.settings-tab {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.settings-tab.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Settings Dark Theme v2.2 - Added tab navigation & moved content settings */
/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
.settings-container {
    border-radius: 8px;
    padding: 20px;
    margin-top: 10px;
    color: #ffffff;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–µ–∫—Ü–∏–∏ –°–µ—Ä–≤–µ—Ä—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –¥–ª—è 2 –∫–æ–ª–æ–Ω–æ–∫ */
#servers-tab > section.settings-section {
    width: clamp(600px, 90vw, 1500px);
    min-width: 600px;
    max-width: 1500px;
    margin-left: auto;
    margin-right: auto;
}

.settings-section {
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    color: #ffffff;
}

/* –°–µ—Ç–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤: –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–æ 700px, —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ */
.servers-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
}

.servers-grid .host-card {
    flex: 0 1 700px;
    width: 700px;
    max-width: 100%;
    margin: 0;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
.settings-container .button {
    background: var(--primary-color);
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s ease;
}

.settings-container .button:hover {
    background: var(--primary-hover);
}

.settings-container .button-small {
    padding: 8px 16px;
    font-size: 14px;
}

.settings-container .button-primary {
    background: #28a745;
}

.settings-container .button-primary:hover {
    background: #1e7e34;
}

.settings-container .button-danger {
    background: #dc3545;
}

.settings-container .button-danger:hover {
    background: #c82333;
}

.host-header{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
}
.host-actions{ display:flex; gap:8px; padding:10px;}
.button-icon{ width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center; padding:0; }

/* –°–µ—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ (–û—Ç–º–µ–Ω–∞) */
/* –û—Ç–º–µ–Ω–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ .button.button-secondary */

/* –¢–∞–±–ª–∏—Ü–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ */
.plans-table-wrap { overflow-x: visible; }
@media (max-width: 900px) { .plans-table-wrap { overflow-x: auto; } }
.plans-table {
    width: 100%;
    border-collapse: collapse;
}
.plans-table th, .plans-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #3a4147;
    text-align: left;
}
.plans-table thead th { background: #32383f; position: sticky; top: 0; }
.plans-table tbody tr:hover { background: #363c43; cursor: pointer; }

/* –§—É—Ç–µ—Ä –º–æ–¥–∞–ª–∫–∏ —Å —Ç—Ä–µ–º—è –∫–Ω–æ–ø–∫–∞–º–∏ */
.modal-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-top: 8px;
}
.modal-actions .button { flex: 1; }

@media (max-width: 600px) {
    .modal-actions { flex-direction: column; }
    .modal-actions .button { width: 100%; }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
.settings-container input,
.settings-container textarea,
.settings-container select {
    background: #3a4147;
    color: #ffffff;
    border: 1px solid #4a5058;
    border-radius: 4px;
    padding: 8px 12px;
}

.settings-container input:focus,
.settings-container textarea:focus,
.settings-container select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(0, 135, 113, 0.25);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ª–µ–π–±–ª–æ–≤ */
.settings-container label {
    color: #ffffff;
    font-weight: 500;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
.settings-container .text-muted {
    color: #bdc3c7 !important;
}

/* ---- Custom overrides for servers tab controls ---- */
/* Kebab buttons only in main host header (not in plans table) */
.servers-grid .host-card > .host-header .kebab-btn{
    background: #282b30 !important;
}

/* "–°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ" button styles */
.servers-grid .host-card > .host-header .create-plan-btn{
    background: #282b30 !important;
}
.servers-grid .host-card > .host-header .create-plan-btn:hover{
    background: #7f7f7f !important;
}
</style>

<script>
// ===== Kebab menu styles injected here to keep self-contained =====
const kebabStyle = document.createElement('style');
kebabStyle.textContent = `
.kebab-wrapper{ position:relative; }
.kebab-btn{ min-width:36px; }
.kebab-menu{ position:absolute; top:110%; background:#151f31; border:1px solid #444; border-radius:6px; box-shadow:0 8px 18px rgba(0,0,0,0.35); display:none; min-width:200px; z-index:1000; padding:6px; }
.kebab-menu.open{ display:block; }
.kebab-item{ width:100%; text-align:left; background:#3a4147; color:#fff; border:none; padding:8px 10px; border-radius:4px; cursor:pointer; margin:4px 0; font-size:14px; }
.kebab-item:hover{ background:#4a5058; }
.kebab-item.danger{ background:#7a2e34; }
.kebab-item.danger:hover{ background:#943b42; }
`;
document.head.appendChild(kebabStyle);

    function showTab(tabName, el) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
    const tabs = document.querySelectorAll('.settings-tab');
    tabs.forEach(tab => {
        tab.classList.remove('active');
    });
    
    // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
    const buttons = document.querySelectorAll('.nav-button');
    buttons.forEach(button => {
        button.classList.remove('active');
    });
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
        if (el) { el.classList.add('active'); }
}

function updateStarsRate() {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram
    document.getElementById('stars_conversion_rate').value = '1.79';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alert('–ö—É—Ä—Å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ 1.79 —Ä—É–±–ª–µ–π –∑–∞ 1 –∑–≤–µ–∑–¥—É.\n\n–≠—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ:\n100 –∑–≤–µ–∑–¥ = 179 —Ä—É–±–ª–µ–π\n\n–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –≤ Telegram.');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    const currentActiveTab = '{{ active_tab or "servers" }}';
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    showTab(currentActiveTab);
    // –ü—Ä–æ—Å—Ç–∞–≤–∏–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–Ω–æ–ø–∫–µ
    const currentBtn = Array.from(document.querySelectorAll('.nav-button'))
        .find(btn => (btn.getAttribute('onclick') || '').includes("'" + currentActiveTab + "'"));
    if (currentBtn) { currentBtn.classList.add('active'); }

    // Kebab toggling
    document.body.addEventListener('click', function(e){
        const btn = e.target.closest('.kebab-btn');
        const anyMenu = document.querySelectorAll('.kebab-menu.open');
        if (!btn){
            // click outside: close all
            anyMenu.forEach(m=>m.classList.remove('open'));
            return;
        }
        const wrap = btn.closest('.kebab-wrapper');
        if (!wrap) return;
        const menu = wrap.querySelector('.kebab-menu');
        if (!menu) return;
        // close others
        anyMenu.forEach(m=>{ if(m!==menu) m.classList.remove('open'); });
        // toggle current
        menu.classList.toggle('open');
    });

    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ dblclick –ø–æ —Å—Ç—Ä–æ–∫–∞–º —Ç–∞—Ä–∏—Ñ–æ–≤
    document.body.addEventListener('dblclick', function(e){
        const tr = e.target.closest('tr.plan-row');
        if (!tr) return;
        const planId = tr.getAttribute('data-plan-id');
        const name = tr.getAttribute('data-plan-name') || '';
        const months = tr.getAttribute('data-plan-months') || '';
        const days = tr.getAttribute('data-plan-days') || '';
        const price = tr.getAttribute('data-plan-price') || '';
        const traffic = tr.getAttribute('data-plan-traffic') || '';
        const hours = tr.getAttribute('data-plan-hours') || '';
        const hostName = tr.getAttribute('data-host-name') || '';
        openPlanModal(planId, name, months, days, price, traffic, hostName, hours);
    });
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ö–æ—Å—Ç–æ–º
async function checkHost(hostName, btn){
    try{
        if(btn){ btn.disabled = true; btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...'; }
        const form = new FormData();
        form.append('host_name', hostName);
        const res = await fetch('/check-host', {method:'POST', body: form});
        const data = await res.json();
        alert((data.status==='success'?'‚úÖ ':'‚ùå ') + (data.message || ''));
    }catch(e){
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏');
    }finally{
        if(btn){ btn.disabled = false; btn.textContent = 'üîå –ü—Ä–æ–≤–µ—Ä–∏—Ç—å'; }
    }
}

// –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Ö–æ—Å—Ç–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
function openHostModal(name='', url='', user='', pass='', inbound='', code=''){
    const html = `
    <div class="modal-backdrop">
      <div class="modal" style="display:block;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>${name? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ö–æ—Å—Ç' : '–î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç'}</h3>
            <span class="close" onclick="closeModal()">&times;</span>
          </div>
          <div class="modal-body">
            <form method="post" action="${name? '/edit-host' : '/add-host'}">
              ${name? `<input type="hidden" name="old_host_name" value="${name}">` : ''}
              <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="host_name" value="${name}" required></div>
              <div class="form-group"><label>URL –ø–∞–Ω–µ–ª–∏ XUI</label><input type="url" name="host_url" value="${url}" placeholder="https://host:port/secret" required></div>
              <div class="form-group"><label>–õ–æ–≥–∏–Ω</label><input type="text" name="host_username" value="${user}" required></div>
              <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" name="host_pass" value="${pass||''}" required></div>
              <div class="form-group"><label>ID –∏–Ω–±–∞—É–Ω–¥–∞</label><input type="number" name="host_inbound_id" value="${inbound}" required></div>
              <div class="form-group"><label>–ö–æ–¥ 3x‚Äëui (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π)</label><input type="text" name="host_code" value="${code|| (name||'').replace(/\s+/g,'').toLowerCase()}" placeholder="amsterdam"></div>
              <div class="modal-actions">
                <span></span>
                <button type="button" class="button button-secondary" onclick="closeModal()" title="–û—Ç–º–µ–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="button button-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>`;
    showModal(html);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ data-* –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ö–æ—Å—Ç–∞
function openHostModalData(el){
    if(!el) return;
    const name = el.getAttribute('data-host-name') || '';
    const url = el.getAttribute('data-host-url') || '';
    const user = el.getAttribute('data-host-username') || '';
    const inbound = el.getAttribute('data-host-inbound-id') || '';
    const code = el.getAttribute('data-host-code') || '';
    openHostModal(name, url, user, '', inbound, code);
}

// –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
function openPlanModal(planId, name, months, days, price, traffic, hostName, hours){
    const isEdit = !!planId;
    const action = isEdit ? `/edit-plan/${planId}` : '/add-plan';
    const hiddenHost = isEdit ? '' : `<input type="hidden" name="host_name" value="${hostName}">`;
    const html = `
    <div class="modal-backdrop">
      <div class="modal" style="display:block;">
        <div class="modal-content">
          <div class="modal-header">
            <h3>${isEdit? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ' : '–î–æ–±–∞–≤–∏—Ç—å —Ç–∞—Ä–∏—Ñ'}</h3>
            <span class="close" onclick="closeModal()">&times;</span>
          </div>
          <div class="modal-body">
            <form method="post" action="${action}">
              ${hiddenHost}
              <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="plan_name" value="${name||''}" placeholder="–ù–∞–ø—Ä. –ë–∞–∑–æ–≤—ã–π" required title="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞"></div>
              <div class="form-group"><label>–ú–µ—Å—è—Ü—ã</label><input type="number" name="months" value="${months||''}" placeholder="0" title="–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤"></div>
              <div class="form-group"><label>–î–Ω–∏</label><input type="number" name="days" value="${days||''}" placeholder="0" title="–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π"></div>
              <div class="form-group"><label>–ß–∞—Å—ã</label><input type="number" name="hours" value="${hours||''}" placeholder="0" min="0" max="24" title="–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (0‚Äì24)"></div>
              <div class="form-group"><label>–¶–µ–Ω–∞ (RUB)</label><input type="number" step="0.01" name="price" value="${price||''}" placeholder="0" required title="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É —Ç–∞—Ä–∏—Ñ–∞, –≤ —Ä—É–±–ª—è—Ö"></div>
              <div class="form-group"><label>–¢—Ä–∞—Ñ–∏–∫ (–ì–ë)</label><input type="number" step="0.01" name="traffic_gb" value="${traffic||''}" placeholder="0 (–±–µ–∑–ª–∏–º–∏—Ç)" title="–í–≤–µ–¥–∏—Ç–µ –ª–∏–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –ì–ë –∏–ª–∏ 0 –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–∞"></div>
              <div class="modal-actions">
                <span></span>
                <button type="button" class="button button-secondary" onclick="closeModal()" title="–û—Ç–º–µ–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="button button-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>`;
    showModal(html);
}

// Delete helpers
function deleteHost(hostName){
    if (!hostName) return;
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç –∏ –≤—Å–µ –µ–≥–æ —Ç–∞—Ä–∏—Ñ—ã?')) return;
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/delete-host/${hostName}`;
    document.body.appendChild(form);
    form.submit();
}

function deletePlan(planId){
    if (!planId) return;
    if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ?')) return;
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/delete-plan/${planId}`;
    document.body.appendChild(form);
    form.submit();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–∫–∏ —Ç–∞—Ä–∏—Ñ–∞ (add/edit) —á–µ—Ä–µ–∑ data-*
function openPlanModalData(el){
    if(!el) return;
    const planId = el.getAttribute('data-plan-id');
    const hostName = el.getAttribute('data-host-name') || '';
    if (planId) {
        const name = el.getAttribute('data-plan-name') || '';
        const months = el.getAttribute('data-plan-months') || '';
        const days = el.getAttribute('data-plan-days') || '';
        const price = el.getAttribute('data-plan-price') || '';
        const traffic = el.getAttribute('data-plan-traffic') || '';
        const hours = el.getAttribute('data-plan-hours') || '';
        openPlanModal(planId, name, months, days, price, traffic, hostName, hours);
    } else {
        openPlanModal(null, '', '', '', '', '', hostName, '');
    }
}

function showModal(html){
    const wrap = document.createElement('div');
    wrap.innerHTML = html;
    document.body.appendChild(wrap);
    const modal = wrap.querySelector('.modal');
    if (modal) modal.style.display = 'block';
}
function closeModal(){
    const el = document.querySelector('.modal-backdrop');
    if(el) el.remove();
}
</script>

{% endblock %}
