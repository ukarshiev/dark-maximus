<!-- fe2e9669-0c47-407d-90c0-7735f29becb1 861f1013-8826-4243-b9de-7bbd382b854f -->
# –ü–ª–∞–Ω —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ Dark Maximus

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 16.11.2025 05:29
**–í–µ—Ä—Å–∏—è:** 1.0

## –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤:** 47
- Product defects: 36
- Test defects: 11
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤:** 86.25% (306/355)
- **–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤:** 22 (–±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

---

## –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–≠—Ç–∞–ø 1) - 22 –¥–µ—Ñ–µ–∫—Ç–∞

–ë–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**

- –ë–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–∫—É–ø–∫—É VPN-–∫–ª—é—á–∞
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

### –í—ã—Å–æ–∫–∏–µ (–≠—Ç–∞–ø 2) - 13 –¥–µ—Ñ–µ–∫—Ç–æ–≤

–í–ª–∏—è—é—Ç –Ω–∞ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**

- Product defects –Ω–µ –∏–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –∫–∞–±–∏–Ω–µ—Ç–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å WAL —Ä–µ–∂–∏–º–æ–º –ë–î
- –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (XSS)

### –°—Ä–µ–¥–Ω–∏–µ (–≠—Ç–∞–ø 3) - 10 –¥–µ—Ñ–µ–∫—Ç–æ–≤

–¢–µ—Å—Ç–æ–≤—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ —Å—Ö–µ–º–æ–π –ë–î –∏ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**

- Test defects, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î (–Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã/–∫–æ–ª–æ–Ω–∫–∏)
- –ü—Ä–æ–±–ª–µ–º—ã —Å –º–æ–∫–∞–º–∏ –∏ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏

### –ù–∏–∑–∫–∏–µ (–≠—Ç–∞–ø 4) - 2 –¥–µ—Ñ–µ–∫—Ç–∞

–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–µ –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**

- –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ deeplink
- –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ—Å—Ç–∞—Ö

---

## –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã (22 –¥–µ—Ñ–µ–∫—Ç–∞)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π
**–°—Ä–æ–∫:** 2-3 –¥–Ω—è
**–¶–µ–ª—å:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 1.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (4 –¥–µ—Ñ–µ–∫—Ç–∞) ‚Äî **üü° –ü–†–û–ë–õ–ï–ú–ê –í –¢–ï–°–¢–ê–•**

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –æ–∂–∏–¥–∞—é—Ç –≤–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `register_user_if_not_exists()`, –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:**

- –§—É–Ω–∫—Ü–∏—è `register_user_if_not_exists()` –≤ `database.py` (—Å—Ç—Ä–æ–∫–∞ 4665) —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç.
- –§—É–Ω–∫—Ü–∏—è `get_user()` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
- –§—É–Ω–∫—Ü–∏—è `register_user_if_not_exists()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî –æ–Ω–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –¥–∏–∑–∞–π–Ω—É.

**–î–µ—Ñ–µ–∫—Ç—ã (–≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ—Å—Ç–∞—Ö):**

- `test_user_registration_flow` (unit.test_bot) ‚Äî **–ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–µ—Å—Ç–µ**
- `test_register_user_with_referrer` (unit.test_database) ‚Äî **–ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–µ—Å—Ç–µ**
- `test_register_user_if_not_exists` (unit.test_database) ‚Äî **–ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–µ—Å—Ç–µ**
- `test_register_user_twice` (unit.test_database) ‚Äî broken ‚Äî **–ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–µ—Å—Ç–µ**

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `tests/unit/test_database/test_user_operations.py` ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `tests/unit/test_bot/test_handlers.py` ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å `test_user_registration_flow`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã:** –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `register_user_if_not_exists()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_user(telegram_id)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_register_user_twice`:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ `None` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–ª–æ–≤–∞—Ä—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_user()`)
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `get_user()`

### 1.2 –ü–æ–∫—É–ø–∫–∞ VPN-–∫–ª—é—á–∞ (2 –¥–µ—Ñ–µ–∫—Ç–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `None` –≤–º–µ—Å—Ç–æ `key_id`.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_token_creation_on_key_creation` (unit.test_database)
- `test_validate_token_with_deleted_key` (unit.test_database)

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/data_manager/database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π
- `tests/unit/test_database/test_cabinet_links.py` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª—é—á–µ–π

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π (`create_key`, `create_test_key`)
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `key_id`, –∞ –Ω–µ `None`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã `vpn_keys` –≤ `conftest.py`

### 1.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (3 –¥–µ—Ñ–µ–∫—Ç–∞)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_log_transaction` (unit.test_database) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`
- `test_update_transaction_status` (unit.test_database) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False`
- `test_update_transaction_on_payment` (unit.test_database) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False`

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/data_manager/database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `log_transaction`, `update_transaction_status`, `complete_transaction`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `log_transaction` –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –≤—Å—Ç–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `update_transaction_status` –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã `transactions` –≤ `conftest.py`
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å

### 1.4 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞ (1 –¥–µ—Ñ–µ–∫—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è `get_next_key_number` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–∞–±–ª–∏—Ü—ã `users`.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_get_next_key_number` (unit.test_database) - `sqlite3.OperationalError: no such table: users`

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `tests/conftest.py` - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `users` —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ñ–∏–∫—Å—Ç—É—Ä–µ `temp_db`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `temp_db` —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `users` —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–æ –≤—ã–∑–æ–≤–∞ `get_next_key_number`

### 1.5 –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (1 –¥–µ—Ñ–µ–∫—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_get_user_balance` (unit.test_database) - –±–∞–ª–∞–Ω—Å –æ—Å—Ç–∞–µ—Ç—Å—è 0.0 –≤–º–µ—Å—Ç–æ 500.0

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/data_manager/database.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ –ë–î

### 1.6 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (11 –¥–µ—Ñ–µ–∫—Ç–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø–∞–¥–∞—é—Ç –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∫–æ–ª–æ–Ω–∫–∏ `vpn_plan_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `promo_codes`.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_calculate_discount_amount` (unit.test_bot) - broken
- `test_calculate_discount_percent` (unit.test_bot) - broken
- `test_promo_code_limit_reached` (unit.test_bot) - broken
- `test_create_promo_code` (unit.test_database) - broken
- `test_get_promo_code_by_id` (unit.test_database) - broken
- `test_get_promo_code_by_code` (unit.test_database) - broken
- `test_update_promo_code` (unit.test_database) - broken
- `test_delete_promo_code` (unit.test_database) - broken
- `test_can_user_use_promo_code` (unit.test_database) - broken
- `test_record_promo_code_usage` (unit.test_database) - broken
- `test_key_creation_with_integrity_error` (unit.test_database) - broken

**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `tests/conftest.py` - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `vpn_plan_id` –≤ —Ç–∞–±–ª–∏—Ü—É `promo_codes`
- `src/shop_bot/data_manager/database.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `vpn_plan_id`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã `promo_codes` –≤ production –ë–î
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –≤ `conftest.py` —Å production
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ñ–∏–∫—Å—Ç—É—Ä—É `temp_db`

---

## –≠—Ç–∞–ø 2: –í—ã—Å–æ–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã (13 –¥–µ—Ñ–µ–∫—Ç–æ–≤)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–°—Ä–æ–∫:** 3-4 –¥–Ω—è
**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### 2.1 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (2 –¥–µ—Ñ–µ–∫—Ç–∞)

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_terms_agreement_flow` (unit.test_bot) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`
- `test_update_user_stats` (unit.test_database) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è —Å —É—Å–ª–æ–≤–∏—è–º–∏
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2.2 –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ (3 –¥–µ—Ñ–µ–∫—Ç–∞)

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_token_deletion_on_key_deletion` (unit.test_database)
- `test_token_deletion_on_user_keys_deletion` (unit.test_database)
- –í–æ–∑–º–æ–∂–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å `test_validate_token_with_deleted_key` (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 1)

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª—é—á–µ–π
2. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

### 2.3 –†–µ–∂–∏–º WAL –ë–î (1 –¥–µ—Ñ–µ–∫—Ç)

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_wal_mode_in_run_migration` (unit.test_database) - –æ–∂–∏–¥–∞–µ—Ç—Å—è WAL, –ø–æ–ª—É—á–∞–µ—Ç—Å—è DELETE

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ journal_mode –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ WAL —Ä–µ–∂–∏–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2.4 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (1 –¥–µ—Ñ–µ–∫—Ç)

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_sanitize_string_dangerous_chars` (unit.test_security) - –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –£–ª—É—á—à–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫
2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∫–æ–±–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

### 2.5 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Product defects (6 –¥–µ—Ñ–µ–∫—Ç–æ–≤)

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è Product defects
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## –≠—Ç–∞–ø 3: –°—Ä–µ–¥–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã (10 –¥–µ—Ñ–µ–∫—Ç–æ–≤)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π
**–°—Ä–æ–∫:** 2-3 –¥–Ω—è
**–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã, —É–ª—É—á—à–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### 3.1 –°—Ö–µ–º–∞ –ë–î –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (10 –¥–µ—Ñ–µ–∫—Ç–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ö–µ–º–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç production —Å—Ö–µ–º–µ.

**–î–µ—Ñ–µ–∫—Ç—ã:**

- –í—Å–µ 10 –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Å–≤—è–∑–∞–Ω—ã —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 1.6)
- `test_get_next_key_number` - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∞–±–ª–∏—Ü—ã `users` (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 1.4)

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –ë–î –≤ `conftest.py` —Å production
2. –î–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –∏–∑ production
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ö–µ–º –≤ CI/CD

### 3.2 –£–ª—É—á—à–µ–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—É `temp_db`
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã

---

## –≠—Ç–∞–ø 4: –ù–∏–∑–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã (2 –¥–µ—Ñ–µ–∫—Ç–∞)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π
**–°—Ä–æ–∫:** 1 –¥–µ–Ω—å
**–¶–µ–ª—å:** –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 4.1 –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (1 –¥–µ—Ñ–µ–∫—Ç)

**–î–µ—Ñ–µ–∫—Ç—ã:**

- `test_deeplink_parameter_length_limit` (unit.test_utils) - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç `g`

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ `create_deeplink`

### 4.2 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã (1 –¥–µ—Ñ–µ–∫—Ç)

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ù–µ–¥–µ–ª—è 1

- **–î–µ–Ω—å 1-2:** –≠—Ç–∞–ø 1.1 (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–î–µ–Ω—å 3:** –≠—Ç–∞–ø 1.2 (–ü–æ–∫—É–ø–∫–∞ VPN-–∫–ª—é—á–∞)
- **–î–µ–Ω—å 4:** –≠—Ç–∞–ø 1.3 (–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π)
- **–î–µ–Ω—å 5:** –≠—Ç–∞–ø 1.4-1.5 (–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞, –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞)

### –ù–µ–¥–µ–ª—è 2

- **–î–µ–Ω—å 1-2:** –≠—Ç–∞–ø 1.6 (–ü—Ä–æ–º–æ–∫–æ–¥—ã)
- **–î–µ–Ω—å 3-4:** –≠—Ç–∞–ø 2.1-2.2 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –¢–æ–∫–µ–Ω—ã)
- **–î–µ–Ω—å 5:** –≠—Ç–∞–ø 2.3-2.4 (WAL, –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### –ù–µ–¥–µ–ª—è 3

- **–î–µ–Ω—å 1-2:** –≠—Ç–∞–ø 2.5 (–û—Å—Ç–∞–ª—å–Ω—ã–µ Product defects)
- **–î–µ–Ω—å 3-4:** –≠—Ç–∞–ø 3 (–¢–µ—Å—Ç–æ–≤—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã)
- **–î–µ–Ω—å 5:** –≠—Ç–∞–ø 4 (–ù–∏–∑–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã)

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤: > 95%
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤: 0

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 2:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤: > 98%
- ‚úÖ Product defects: < 5

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 3:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤: > 99%
- ‚úÖ Test defects: 0

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 4:

- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤: 100%
- ‚úÖ –í—Å–µ –¥–µ—Ñ–µ–∫—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –°—Ö–µ–º–∞ –ë–î –≤ —Ç–µ—Å—Ç–∞—Ö –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç production

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º—ã

### –†–∏—Å–∫ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –¥–µ—Ñ–µ–∫—Ç–∞ –ª–æ–º–∞–µ—Ç –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ó–∞–ø—É—Å–∫–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –†–∏—Å–∫ 3: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–µ—Ñ–µ–∫—Ç–∞—Ö

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç—ã

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1.1 (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
2. **–ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 1:** –û–±–Ω–æ–≤–∏—Ç—å CHANGELOG.md –∏ –≤–µ—Ä—Å–∏—é –≤ pyproject.toml
3. **–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:** –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **–ü–æ—Å–ª–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é