<!-- e87488c5-9a40-4905-9cfc-06e0a2e6a1cf 94ef333c-17fd-4542-8677-52e93ef15ed8 -->
# План обновления отображения времени и панели

1. Аудит текущих сообщений и UI

- Найти в `src/shop_bot/bot/handlers.py`, `keyboards.py`, `templates/` (если есть) все места, где формируется текст с датой/временем для бота.
- Проверить веб-интерфейс (`apps/web-interface`) на наличие настроек timezone, особенно секцию «Глобальные параметры» вкладки «Панель».
- Зафиксировать используемые функции форматирования (например, `format_datetime_moscow`, `format_datetime_for_user`, `datetime.strftime`).

2. Обновление утилит форматирования

- В `src/shop_bot/utils/datetime_utils.py` расширить `format_datetime_for_user` (и при необходимости `format_datetime_moscow`) так, чтобы добавлять суффикс вида `(UTC±X)` с учётом фактического timezone пользователя и fallback.
- Убедиться, что функция корректно работает при выключенном feature flag и недоступных `ZoneInfo`.

3. Приведение сообщений и UI к новой логике

- В местах из шага 1 заменить ручное форматирование на обновлённую функцию, передавая timezone пользователя и флаг; убедиться, что тексты включают `(UTC±X)`.
- В веб-интерфейсе добавить или скорректировать элемент управления timezone в «Глобальных параметрах» вкладки «Панель», чтобы администратор мог менять зону.

4. Обновление тестов и документации

- Дополнить тесты в `tests/test_timezone_utils.py` и `tests/test_timezone_integration.py`, проверяя наличие `(UTC±X)` в выводе.
- Обновить документацию/чек-листы, отражающие новую логику отображения времени и настройку timezone в веб-интерфейсе.