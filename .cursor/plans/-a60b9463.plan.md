<!-- a60b9463-26ea-4a62-a347-f78562a42fff f767636d-e6e8-4f50-9f8a-390e425d35a0 -->
# План обновления портов в оставшихся файлах

## Цель

Заменить все упоминания старых портов на новые во всех файлах проекта:

- 3001 → 50001 (docs)
- 3002 → 50002 (codex-docs)
- 3003 → 50003 (user-cabinet)
- 5051 → 50004 (allure-service внутренний порт)

## Этапы выполнения

### Этап 1: Шаблоны веб-интерфейса

**Файл:** `src/shop_bot/webhook_server/templates/wiki_editor.html`

- Строка 84: заменить `3001` на `50001` в тексте и URL

**Файл:** `src/shop_bot/webhook_server/templates/wiki_editor_edit.html`

- Строка 415: заменить `http://localhost:3001` на `http://localhost:50001`

### Этап 2: Скрипт установки

**Файл:** `install.sh`

- Строка 568: `'127.0.0.1:3001:80'` → `'127.0.0.1:50001:80'`
- Строка 585: `'127.0.0.1:3002:3000'` → `'127.0.0.1:50002:50002'`
- Строка 592: `nc -z localhost 3000` → `nc -z localhost 50002`
- Строка 607: `'127.0.0.1:3003:3003'` → `'127.0.0.1:50003:50003'`
- Строка 614: `nc -z localhost 3003` → `nc -z localhost 50003`
- Строка 705: `server 127.0.0.1:3001;` → `server 127.0.0.1:50001;`
- Строка 710: `server 127.0.0.1:3002;` → `server 127.0.0.1:50002;`
- Строка 715: `server 127.0.0.1:3003;` → `server 127.0.0.1:50003;`
- Строка 993: `50000/3001/3002` → `50000/50001/50002`
- Строка 1082: `nc -z 127.0.0.1 3001` → `nc -z 127.0.0.1 50001`
- Строка 1090: `nc -z 127.0.0.1 3002` → `nc -z 127.0.0.1 50002`
- Строка 1091: `порту 3002` → `порту 50002`
- Строка 1097: `nc -z 127.0.0.1 3003` → `nc -z 127.0.0.1 50003`
- Строка 1197: `nc -z 127.0.0.1 3001` → `nc -z 127.0.0.1 50001`
- Строка 1204: `nc -z 127.0.0.1 3002` → `nc -z 127.0.0.1 50002`

### Этап 3: Скрипт SSL установки

**Файл:** `ssl-install.sh`

- Строка 128: `server 127.0.0.1:3001;` → `server 127.0.0.1:50001;`
- Строка 133: `server 127.0.0.1:3002;` → `server 127.0.0.1:50002;`

### Этап 4: Документация

**Файл:** `README.md`

- Строка 63: `http://localhost:3001/` → `http://localhost:50001/`

**Файл:** `docs/guides/testing/allure-reporting.md`

- Строка 67: `127.0.0.1:5051` → `127.0.0.1:50004`
- Строка 79: `'127.0.0.1:5051:50005'` → `'127.0.0.1:50004:5050'` (с комментарием о формате внешний:внутренний)

### Этап 5: Конфигурация Nginx

**Файл:** `tools/nginx/nginx-1.27.2/conf/https-local.conf`

- Строка 15: `server 127.0.0.1:3003;` → `server 127.0.0.1:50003;`

### Этап 6: Тесты

**Файл:** `tests/ad-hoc/tests/test_real_install.sh`

- Строка 13: `-p 3001:3001 \` → `-p 50001:50001 \`
- Строка 14: `-p 3002:3002 \` → `-p 50002:50002 \`

## Проверка после изменений

1. Запустить `grep -r "3001\|3002\|3003\|5051"` для проверки, что все старые порты заменены
2. Проверить синтаксис измененных скриптов (bash, nginx)
3. Обновить CHANGELOG.md с записью об изменениях
4. Обновить версию в pyproject.toml (patch bump)

## Исключения (не менять)

- `CHANGELOG.md` - исторические записи оставляем без изменений
- `apps/allure-homepage/app.py` - `allure-service:5050` это внутренний URL между контейнерами, корректно

### To-dos

- [ ] Обновить порты в шаблонах wiki_editor.html и wiki_editor_edit.html
- [ ] Обновить все упоминания портов в install.sh (15+ мест)
- [ ] Обновить порты в ssl-install.sh
- [ ] Обновить порты в README.md и allure-reporting.md
- [ ] Обновить порт в tools/nginx/nginx-1.27.2/conf/https-local.conf
- [ ] Обновить порты в tests/ad-hoc/tests/test_real_install.sh
- [ ] Проверить отсутствие старых портов через grep и обновить CHANGELOG.md и pyproject.toml