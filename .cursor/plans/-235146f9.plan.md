<!-- 235146f9-671b-481b-a332-bdc90a84e92a 46bf3a7e-1f85-4051-848d-5f4845feaac7 -->
# План группировки тестов по функциональности

## Цель

Добавить декораторы `@allure.epic` и `@allure.feature` ко всем тестам для корректной группировки по функциональности в Allure Report, как показано на скриншоте.

## Структура категорий (Epic)

На основе структуры проекта и скриншота определены следующие категории:

1. **База данных** - все тесты из `tests/unit/test_database/`
2. **Валидация шаблонов** - `tests/unit/test_utils/test_template_validation.py`
3. **Личный кабинет** - все тесты из `tests/unit/test_user_cabinet/` и `tests/integration/test_user_cabinet/`
4. **Обработчики бота** - все тесты из `tests/unit/test_bot/`
5. **Форматирование сообщений** - `tests/unit/test_utils/test_message_templates.py`
6. **Веб-панель** - все тесты из `tests/unit/test_webhook_server/`
7. **Безопасность** - все тесты из `tests/unit/test_security/`
8. **Утилиты** - остальные тесты из `tests/unit/test_utils/` (deeplink, timezone)
9. **Интеграционные тесты** - все тесты из `tests/integration/` (с подкатегориями)
10. **Модули** - тесты из `tests/unit/test_modules/`

## Этапы реализации

### 1. Анализ текущего состояния

- Проверить все тестовые файлы на наличие `import allure`
- Определить, какие файлы уже имеют декораторы
- Составить список файлов, требующих добавления декораторов

### 2. Добавление импортов

- Добавить `import allure` в файлы, где его нет
- Файлы: большинство файлов в `test_database/`, `test_bot/`, `test_webhook_server/`, `test_utils/`

### 3. Добавление декораторов @allure.epic на уровне классов

- Для каждого класса тестов добавить `@allure.epic("Категория")` перед `class Test*`
- Использовать соответствующие категории из списка выше

### 4. Добавление декораторов @allure.feature для детализации

- Добавить `@allure.feature("Название функции")` на уровне классов или методов
- Названия features должны отражать конкретную функциональность:
- Для test_database: "Операции с пользователями", "Операции с ключами", "Промокоды", "Транзакции", и т.д.
- Для test_bot: "Обработка команд", "Управление ключами", "Обработка платежей", и т.д.
- Для test_webhook_server: "Авторизация", "Управление пользователями", "Управление ключами", и т.д.

### 5. Обновление существующих декораторов

- Проверить файлы, которые уже имеют декораторы (test_message_templates.py, test_template_validation.py, test_plan_display_mode.py)
- Убедиться, что они соответствуют новой структуре категорий

### 6. Интеграционные тесты

- Для `tests/integration/` использовать категорию "Интеграционные тесты"
- Добавить подкатегории через @allure.feature:
- "Автопродление"
- "Платежи"
- "Покупка VPN"
- "Реферальная система"
- "Пробный период"
- "Веб-панель"

## Файлы для изменения

### Unit тесты (tests/unit/)

- test_database/ (11 файлов) - добавить "База данных"
- test_bot/ (6 файлов) - добавить "Обработчики бота"
- test_webhook_server/ (15 файлов) - добавить "Веб-панель"
- test_utils/ (4 файла) - добавить соответствующие категории
- test_user_cabinet/ (1 файл) - добавить "Личный кабинет"
- test_security/ (1 файл) - добавить "Безопасность"
- test_modules/ (1 файл) - добавить "Модули"

### Integration тесты (tests/integration/)

- Все файлы (21 файл) - добавить "Интеграционные тесты" с соответствующими features

## Примечания

- Декораторы добавляются на уровне классов тестов (перед `class Test*`)
- Для методов тестов можно добавить `@allure.story` для еще более детальной группировки (опционально)
- Все названия категорий на русском языке, как в текущих тестах
- Сохранить существующие декораторы там, где они уже есть и корректны

### To-dos

- [ ] Проанализировать все тестовые файлы и составить список файлов, требующих добавления декораторов
- [ ] Добавить 'import allure' в файлы, где его нет
- [ ] Добавить @allure.epic('База данных') для всех тестов в test_database/
- [ ] Добавить @allure.epic('Обработчики бота') для всех тестов в test_bot/
- [ ] Добавить @allure.epic('Веб-панель') для всех тестов в test_webhook_server/
- [ ] Добавить соответствующие @allure.epic для тестов в test_utils/ (Форматирование сообщений, Валидация шаблонов, Утилиты)
- [ ] Добавить @allure.epic('Личный кабинет') для тестов в test_user_cabinet/
- [ ] Добавить @allure.epic('Интеграционные тесты') для всех тестов в tests/integration/
- [ ] Добавить @allure.feature для детализации внутри каждой категории
- [ ] Запустить тесты и проверить группировку в Allure Report