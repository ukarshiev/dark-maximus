<!-- 6c01d15c-a71e-4416-bb3c-7bf139d23c73 ec13dbd4-e216-489b-be7b-3267d6e7f4f2 -->
# Исправление ошибок тестирования

## Проблемы

1. **ModuleNotFoundError: No module named 'yaml'** - тесты в `tests/scripts/` используют `import yaml`, но `pyyaml` не установлен
2. **PytestUnknownMarkWarning** - pytest не распознает маркеры, определенные в `pytest.ini`

## Решение

### 1. Добавить pyyaml в зависимости для тестов

**Файл:** `pyproject.toml`

Добавить `pyyaml` в секцию `[project.optional-dependencies]` -> `test`:

```toml
test = [
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
    "pytest-mock>=3.11.0",
    "pytest-cov>=4.1.0",
    "allure-pytest>=2.13.0",
    "faker>=19.0.0",
    "pyyaml>=6.0.0"  # Добавить для тестов в tests/scripts/
]
```

### 2. Исправить формат маркеров в pytest.ini

**Файл:** `tests/pytest.ini`

Проблема может быть в том, что маркеры определены после `addopts`, или формат не совсем правильный. Проверить и при необходимости исправить формат:

- Убедиться, что секция `[pytest]` правильная
- Маркеры должны быть в формате `marker_name: описание`
- Возможно, нужно переместить секцию `markers` выше или использовать другой формат

**Текущий формат (строки 22-30):**

```ini
# Маркеры для категоризации тестов
markers =
    unit: Unit tests (70% coverage)
    integration: Integration tests (20% coverage)
    e2e: End-to-end tests (10% coverage)
    database: Database tests
    bot: Bot tests
    slow: Slow running tests
    asyncio: Async tests
```

**Проверить:**

- Формат правильный для pytest 7.4.0+
- Возможно, нужно убрать пробелы или использовать другой синтаксис

### 3. Пересобрать Docker образ autotest

После изменения `pyproject.toml` нужно пересобрать образ `autotest`, чтобы установить `pyyaml`:

```powershell
docker compose build autotest
```

## Файлы для изменения

1. `pyproject.toml` - добавить `pyyaml>=6.0.0` в `[project.optional-dependencies]` -> `test`
2. `tests/pytest.ini` - проверить и при необходимости исправить формат маркеров

## Проверка

После исправлений запустить тесты:

```powershell
docker compose exec autotest pytest tests/scripts/ -v
```

Ожидаемый результат:

- Нет ошибки `ModuleNotFoundError: No module named 'yaml'`
- Нет предупреждений `PytestUnknownMarkWarning`