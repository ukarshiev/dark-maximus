<!-- d4679b8f-ce90-4b1e-a47a-58c988010284 0d8beaf8-0d72-4522-b860-287ff12a295a -->
# Исправление проблемы с /latest/index.html в Allure Docker Service

## Проблема

После запуска тестов запрос к `http://localhost:50005/allure-docker-service/projects/default/reports/latest/index.html` возвращает JSON с метаданными проекта вместо HTML-отчета.

**Причина:** Симлинк `/latest` не указывает на существующий отчет, и Allure Docker Service обрабатывает запрос как API endpoint.

## Решение

Добавить обработку в `allure-homepage` для автоматического определения и редиректа на последний доступный отчет через API.

## Шаги реализации

### 1. Модификация allure-homepage/app.py

**Файл:** `apps/allure-homepage/app.py`

**Изменения:**

- Добавить проверку Content-Type в функции `proxy()` для пути `projects/default/reports/latest/index.html`
- Если ответ - JSON, извлечь список отчетов и найти последний доступный
- Выполнить редирект на конкретный отчет `/reports/{latest_id}/index.html`

**Логика:**

1. В функции `proxy()` добавить специальную обработку для пути `projects/default/reports/latest/index.html`
2. После получения ответа проверить Content-Type
3. Если `application/json` - парсить JSON и извлечь `reports_id[0]` (первый элемент - самый новый)
4. Выполнить редирект на `/projects/default/reports/{latest_id}/index.html`

### 2. Добавление вспомогательных функций

**Новые функции:**

- `get_latest_report_id()` - запрос к API для получения списка отчетов и извлечения ID последнего
- `redirect_to_latest_report()` - формирование URL для редиректа

### 3. Обработка ошибок

**Добавить обработку:**

- Если API запрос не удался - показать сообщение об ошибке
- Если список отчетов пустой - показать соответствующее сообщение
- Логирование для отладки

### 4. Обновление документации

**Файлы для обновления:**

- `docs/guides/testing/allure-reporting.md` - добавить информацию о автоматическом редиректе
- Обновить раздел "Решение проблем" с описанием новой логики

### 5. Тестирование

**Проверить:**

- Редирект работает когда `/latest` недоступен
- Корректный выбор последнего отчета из списка
- Обработка ошибок (API недоступен, пустой список)
- Логирование работает корректно

## Технические детали

**Изменяемые файлы:**

- `apps/allure-homepage/app.py` - основная логика
- `docs/guides/testing/allure-reporting.md` - документация

**API endpoints для использования:**

- `GET /allure-docker-service/projects/default/reports` - получение списка отчетов

**Структура JSON ответа (из примера пользователя):**

```json
{
  "data": {
    "project": {
      "reports_id": ["9", "8", "7", ...]
    }
  }
}
```

Первая цифра в массиве `reports_id` - это ID последнего (самого нового) отчета.

### To-dos

- [ ] Модифицировать apps/allure-homepage/app.py: добавить проверку Content-Type для /latest/index.html и логику редиректа через API
- [ ] Добавить вспомогательные функции get_latest_report_id() и redirect_to_latest_report() в allure-homepage/app.py
- [ ] Добавить обработку ошибок: API недоступен, пустой список отчетов, логирование
- [ ] Обновить docs/guides/testing/allure-reporting.md: добавить информацию о автоматическом редиректе в раздел решения проблем
- [ ] Протестировать: редирект работает при недоступном /latest, корректный выбор последнего отчета, обработка ошибок