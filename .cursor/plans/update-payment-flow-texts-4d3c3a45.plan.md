<!-- 4d3c3a45-fb17-4653-bf47-555f9cba39cb 235afa2d-6078-4fd1-9d29-89e6d67676d8 -->
# Обновление текстов процесса покупки

## Цель

Улучшить информативность текстов на всех этапах покупки, добавив информацию о выбранных параметрах (хост, тариф, стоимость, способ оплаты).

## Изменения

### 1. Страница выбора тарифа

**Файл:** `src/shop_bot/bot/handlers.py`

- **Строки 3724-3727:** Обновить текст при выборе хоста для нового ключа
- **Строки 3934-3937:** Обновить текст при возврате к выбору тарифа
- Добавить текст: "Вы выбрали: ✅ [Название хоста] ➡️ Теперь выберите тариф для нового ключа:"

### 2. Страница выбора способа оплаты

**Файл:** `src/shop_bot/config.py`

- **Функция `get_payment_method_message_with_plan` (строки 18-32):** Обновить формат сообщения
- Новый формат: "Вы выбрали: ✅ Хост: [Название хоста] ✅ Тариф: [Название тарифа] ✅ Стоимость: [Стоимость] ➡️ Теперь выберите удобный способ оплаты:"
- Формат тарифа: использовать `plan_name` как есть (например, "№3 · 2 дн · Трафик: ∞")

### 3. Банковская карта / СБП (YooKassa)

**Файл:** `src/shop_bot/bot/handlers.py`

- **Строки 4979-4981:** Обновить текст перед оплатой
- Добавить информацию о выбранных параметрах: хост, тариф, стоимость, способ оплаты
- Текст: "Вы выбрали: ✅ Хост: [Название хоста] ✅ Тариф: [Название тарифа] ✅ Стоимость: [Стоимость] ✅ Способ оплаты: СБП / Банковская карта ➡️ Для оплаты нажмите на кнопку:"

### 4. TON Connect

**Файл:** `src/shop_bot/bot/handlers.py`

- **Строки 5417-5428:** Обновить caption для фото с QR-кодом
- Добавить информацию о выбранных параметрах
- Обновить инструкции по оплате согласно требованиям

### 5. Telegram Stars

**Файл:** `src/shop_bot/bot/handlers.py`

- **Строки 5523-5531:** Обновить текст перед созданием счета
- Добавить информацию о выбранных параметрах: хост, тариф, стоимость, способ оплаты

### 6. Оплата с баланса

**Файл:** `src/shop_bot/bot/handlers.py`

- **Строка 5735:** Обновить сообщение о списании
- Добавить полную информацию о выбранных параметрах перед списанием
- После списания показать: "✅ С баланса списано [Сумма] RUB"

## Технические детали

### Получение данных

- `host_name` - из `state.get_data().get('host_name')`
- `plan_name` - из `plan_info.get('plan_name')` (уже содержит формат "№3 · 2 дн · Трафик: ∞")
- `price` - из `final_price` или `plan_info.get('price')`
- Для форматирования стоимости использовать формат с валютой (RUB, TON, ⭐️)

### Форматирование стоимости

- RUB: `{price:.2f} RUB`
- TON: `{price_ton} TON`
- Stars: `{amount_stars} ⭐️`

## Файлы для изменения

1. `src/shop_bot/bot/handlers.py` - обработчики платежей
2. `src/shop_bot/config.py` - функция формирования текста выбора способа оплаты

### To-dos

- [ ] Обновить текст на странице выбора тарифа (добавить информацию о выбранном хосте)
- [ ] Обновить функцию get_payment_method_message_with_plan для детального отображения выбранных параметров
- [ ] Обновить текст для YooKassa (банковская карта/СБП) с информацией о выбранных параметрах
- [ ] Обновить текст для TON Connect с информацией о выбранных параметрах и инструкциями
- [ ] Обновить текст для Telegram Stars с информацией о выбранных параметрах
- [ ] Обновить текст для оплаты с баланса с полной информацией о выбранных параметрах