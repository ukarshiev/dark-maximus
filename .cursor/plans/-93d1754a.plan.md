<!-- 93d1754a-61fc-4f1d-86c9-1e2cd8bb63e1 2cec4f0e-c24d-4a8b-8790-ac72f6fd6f94 -->
# Добавление динамической ссылки на кабинет

## Цель

При нажатии на кнопку "Кабинет" на главной странице панели система должна автоматически находить последний созданный ключ (по максимальному key_id), получать его токен и формировать рабочую ссылку вида `http://localhost:50003/auth/{token}`.

## Изменения

### 1. Добавление функции получения последней ссылки на кабинет

**Файл:** `src/shop_bot/webhook_server/app.py`

- Добавить функцию `get_latest_cabinet_link()` которая:
- Находит последний ключ через SQL запрос: `SELECT key_id FROM vpn_keys ORDER BY key_id DESC LIMIT 1`
- Получает токен для этого ключа через `database.get_tokens_for_key(key_id)`
- Берет первый токен из списка (самый свежий)
- Формирует ссылку через `get_user_cabinet_domain()` + `/auth/{token}`
- Возвращает ссылку или `None` если ключ/токен не найден

### 2. Обновление функции dashboard_page

**Файл:** `src/shop_bot/webhook_server/app.py`

- В функции `dashboard_page()` (строка 501):
- Вызвать `get_latest_cabinet_link()` для получения последней ссылки
- Передать результат в шаблон как `latest_cabinet_link`

### 3. Обновление шаблона dashboard.html

**Файл:** `src/shop_bot/webhook_server/templates/dashboard.html`

- Изменить href кнопки "Кабинет" (строка 15):
- Использовать `{{ latest_cabinet_link or 'http://localhost:50003' }}` для динамической ссылки
- Если `latest_cabinet_link` не задан, использовать fallback `http://localhost:50003`

## Технические детали

- Использовать существующую функцию `database.get_tokens_for_key(key_id)` для получения токенов
- Использовать существующую функцию `get_user_cabinet_domain()` для получения домена кабинета
- Обработать случаи когда:
- Нет ключей в базе
- У ключа нет токена
- Домен кабинета не настроен

## Файлы для изменения

1. `src/shop_bot/webhook_server/app.py` - добавление функции и обновление dashboard_page
2. `src/shop_bot/webhook_server/templates/dashboard.html` - обновление href кнопки

### To-dos

- [ ] Добавить функцию get_latest_cabinet_link() в app.py для получения последней ссылки на кабинет
- [ ] Обновить функцию dashboard_page() для вызова get_latest_cabinet_link() и передачи результата в шаблон
- [ ] Обновить шаблон dashboard.html для использования динамической ссылки в кнопке 'Кабинет'