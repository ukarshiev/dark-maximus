<!-- 722a0f98-8867-42a0-ac28-ab83e3d49740 1fc46fbb-4ec9-47a0-964f-4a5713f87e77 -->
# –ü–ª–∞–Ω –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 15.11.2025 16:56
**–í–µ—Ä—Å–∏—è:** 1.0

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ò–∑ Allure Dashboard –≤–∏–¥–Ω–æ:

- –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: **355**
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: **80%** (284 —É—Å–ø–µ—à–Ω—ã—Ö, 71 –ø–∞–¥–∞—é—â–∏—Ö)
- **36** –¥–µ—Ñ–µ–∫—Ç–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–∞ (Product defects)
- **35** –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ (Test defects)

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ö–†–ò–¢–ò–ß–ù–û - –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å)

#### 1. `test_process_successful_payment_extend_key` (2 –ø–∞–¥–µ–Ω–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å `AssertionError: assert None == 1768...`
**–õ–æ–∫–∞—Ü–∏—è:** `tests/unit/test_bot/test_payment_handlers.py:520`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** ‚ö†Ô∏è **–í–´–°–û–ö–ê–Ø** - –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `process_successful_payment` –∫–ª—é—á –≤ –ë–î –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è - `expiry_timestamp_ms` –æ—Å—Ç–∞–µ—Ç—Å—è `None`
**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/bot/handlers.py` - —Ñ—É–Ω–∫—Ü–∏—è `process_successful_payment` (—Å—Ç—Ä–æ–∫–∞ 7281-7338)
- `src/shop_bot/data_manager/database.py` - —Ñ—É–Ω–∫—Ü–∏—è `update_key_info`
- `tests/unit/test_bot/test_payment_handlers.py` - —Ç–µ—Å—Ç –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –º–æ–∫–æ–≤

#### 2. `test_delete_client` (3 –ø–∞–¥–µ–Ω–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å `AssertionError: –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å–ø–µ—à–Ω—ã–º` (assert False is True)
**–õ–æ–∫–∞—Ü–∏—è:** `tests/unit/test_modules/test_xui_api.py:188`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** ‚ö†Ô∏è **–í–´–°–û–ö–ê–Ø** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ 3X-UI –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª—é—á–µ–π
**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `delete_client_on_host` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False` –≤–º–µ—Å—Ç–æ `True`
**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/modules/xui_api.py` - —Ñ—É–Ω–∫—Ü–∏—è `delete_client_on_host` (—Å—Ç—Ä–æ–∫–∞ 1072-1132)
- `tests/unit/test_modules/test_xui_api.py` - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –º–æ–∫–∞—Ö –∏–ª–∏ –ª–æ–≥–∏–∫–µ —Ç–µ—Å—Ç–∞

### –í–´–°–û–ö–ê–Ø - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ–±-–ø–∞–Ω–µ–ª—å/–∞–¥–º–∏–Ω–∫—É

#### 3. `test_get_key_details` (20 –ø–∞–¥–µ–Ω–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å `AssertionError: assert 404 == 200`
**–õ–æ–∫–∞—Ü–∏—è:** `tests/unit/test_webhook_server/test_keys.py:110`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ **–í–´–°–û–ö–ê–Ø** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤–µ–±-–ø–∞–Ω–µ–ª–∏ (–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∫–ª—é—á–∞)
**–ü—Ä–∏—á–∏–Ω–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/key-details/{key_id}` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404
**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/webhook_server/app.py` - –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏/—Å–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/key-details/<key_id>`
- `tests/unit/test_webhook_server/test_keys.py:110` - —Ç–µ—Å—Ç –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç

#### 4. `test_admin_user_management` (2 –ø–∞–¥–µ–Ω–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å `AssertionError: assert 500 in [200, 302, 400, 404]`
**–õ–æ–∫–∞—Ü–∏—è:** `tests/e2e/test_admin_scenarios/test_admin_user_management.py`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ **–°–†–ï–î–ù–Ø–Ø** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –∞–¥–º–∏–Ω–∫–∏ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
**–ü—Ä–∏—á–∏–Ω–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)
**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `src/shop_bot/webhook_server/app.py` - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `tests/e2e/test_admin_scenarios/test_admin_user_management.py` - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –°–†–ï–î–ù–Ø–Ø - –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞

#### 5. `ModuleNotFoundError: No module named 'app'` (15 –ø–∞–¥–µ–Ω–∏–π)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Ç–µ—Å—Ç—ã `test_user_cabinet` –ø–∞–¥–∞—é—Ç —Å `ModuleNotFoundError`
**–õ–æ–∫–∞—Ü–∏—è:** `tests/unit/test_user_cabinet/test_cabinet.py:47`
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° **–ù–ò–ó–ö–ê–Ø** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã user-cabinet, –Ω–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª—è `app` –∏–∑ user-cabinet
**–§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- `tests/unit/test_user_cabinet/test_cabinet.py` - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç (—Å—Ç—Ä–æ–∫–∞ 47)
- `tests/integration/test_user_cabinet/test_cabinet_flow.py` - –≤–æ–∑–º–æ–∂–Ω–æ, —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `apps/user-cabinet/` –∏ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `app.py`

## –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_process_successful_payment_extend_key`**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `update_key_info` –≤ `database.py`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `expiry_timestamp_ms` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `result['expiry_timestamp_ms']` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ `create_or_update_key_on_host`

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_delete_client`**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É `delete_client_on_host` –≤ `xui_api.py`
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∫–∏ –≤ —Ç–µ—Å—Ç–µ - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –º–æ–∫–æ–≤

### –≠—Ç–∞–ø 2: –í—ã—Å–æ–∫–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å (–±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ–±-–ø–∞–Ω–µ–ª—å)

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_get_key_details`**

- –ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/key-details/<key_id>` –≤ `webhook_server/app.py`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∫–ª—é—á–∞ –∏–∑ –ë–î

4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_admin_user_management`**

- –ù–∞–π—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏, –≤—ã–∑—ã–≤–∞—é—â–∏–µ 500

### –≠—Ç–∞–ø 3: –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã)

5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `ModuleNotFoundError`**

- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Ç–µ—Å—Ç–∞—Ö user-cabinet
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—É—Ç–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π** - –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å attachment.txt –∏–∑ allure-results –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–û–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–æ–∫–∏** - –º–Ω–æ–≥–∏–µ –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –º–æ–∫–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö

### To-dos

- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å test_process_successful_payment_extend_key - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å update_key_info –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ expiry_timestamp_ms –≤ –ë–î
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å test_delete_client - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É delete_client_on_host –∏ –º–æ–∫–∏ –≤ —Ç–µ—Å—Ç–µ
- [ ] –°–æ–∑–¥–∞—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç /api/key-details/<key_id> –¥–ª—è test_get_key_details
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å 500 –æ—à–∏–±–∫—É –≤ test_admin_user_management - –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å ModuleNotFoundError –≤ —Ç–µ—Å—Ç–∞—Ö user-cabinet - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è 'app'