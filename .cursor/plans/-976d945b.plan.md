<!-- 976d945b-c984-427a-b080-d8ede5d134eb 1419ff4f-0e60-4e54-afe4-3cd8a1a27480 -->
# Восстановление повреждённой базы данных

1. Диагностика и поиск актуального бэкапа

- Вывести список доступных файлов резервного копирования в `backups/` или аналогичных каталогах.
- Проверить, какие из них наиболее свежие и неповреждённые (например, с помощью `sqlite3` команды `PRAGMA integrity_check`).

2. Подготовка и восстановление

- Остановить зависимые сервисы/контейнеры через `npx --yes nx stop bot`, чтобы исключить доступ к БД во время восстановления.
- Создать резервную копию текущего `users.db` (несмотря на повреждение, сохранить копию как артефакт).
- Развернуть свежий бэкап (заменить `users.db` на выбранную резервную копию или выполнить `sqlite3 backup` команду).
- Убедиться, что у файла корректные права и путь совпадает с ожиданиями приложения.

3. Проверка после восстановления

- Запустить миграции (`python -m shop_bot.data_manager.database` или другой предусмотренный скрипт) и убедиться в успешном выполнении без ошибок `DatabaseError`.
- Запустить `npx --yes nx build bot` и `npx --yes nx serve bot` (или `docker compose up -d bot`), проверив, что контейнер стартует без ошибок.
- Выполнить ключевые автотесты на БД (например, `tests/test_database_indexes.py`, `tests/test_auto_renewal_functionality.py`), подтверждая целостность.
- Зафиксировать состояние (логи, даты бэкапа) для отчётности.

## Todo

- backup-list — определить и проверить доступные резервные копии
- stop-and-swap — остановить сервис и заменить повреждённый `users.db` бэкапом
- post-restore-verify — провести миграции, тесты и убедиться в успешном запуске