<!-- c15cb0f9-6fac-4f2d-9b8c-6330e34052b6 2091a323-6c4b-4117-b272-95941d3a6f50 -->
# План: Добавление теста проверки валидных ссылок личного кабинета

## Цель

Создать тест, который явно проверяет, что валидные ссылки на личный кабинет (`/auth/{token}`) не возвращают ошибку 403 (FORBIDDEN) и работают корректно.

## Текущая ситуация

- Есть тесты, проверяющие невалидные токены (возвращают 403)
- Есть тесты, проверяющие валидные токены (возвращают 200/302)
- НЕТ явного теста, который проверяет, что валидные ссылки НЕ возвращают 403

## Задачи

### 1. Добавить unit-тест в `tests/unit/test_user_cabinet/test_cabinet.py`

- Создать тест `test_valid_link_not_forbidden` с интеграцией Allure:
- Использовать `@allure.title("Проверка валидных ссылок личного кабинета")`
- Добавить `@allure.description` с подробным описанием теста
- Установить `@allure.severity(allure.severity_level.CRITICAL)`
- Добавить теги: `@allure.tag("cabinet", "links", "validation", "unit", "critical")`
- Использовать `allure.step()` для каждого шага теста:
- Создание валидного токена для существующего ключа
- Выполнение HTTP-запроса к `/auth/{token}`
- Проверка, что статус НЕ равен 403
- Проверка, что статус равен 200 или 302 (успешный ответ)
- Проверка, что в ответе нет сообщения "Ссылка недействительна"

### 2. Добавить интеграционный тест в `tests/integration/test_user_cabinet/test_cabinet_flow.py`

- Создать тест `test_valid_cabinet_link_accessible` с интеграцией Allure:
- Использовать `@allure.title("Проверка доступности валидных ссылок личного кабинета")`
- Добавить `@allure.description` с описанием полного flow
- Установить `@allure.severity(allure.severity_level.CRITICAL)`
- Добавить теги: `@allure.tag("cabinet", "links", "accessibility", "integration", "critical")`
- Использовать `allure.step()` для каждого шага:
- Создание полного сценария: пользователь → ключ → токен
- Проверка доступности ссылки `/auth/{token}`
- Проверка, что после авторизации можно получить доступ к главной странице
- Проверка отсутствия ошибок 403 на всех этапах

### 3. Добавить тест для проверки множественных ссылок

- Создать тест `test_multiple_valid_links_not_broken` с интеграцией Allure:
- Использовать `@allure.title("Проверка множественных валидных ссылок")`
- Добавить `@allure.description` с описанием сценария
- Установить `@allure.severity(allure.severity_level.NORMAL)`
- Добавить теги: `@allure.tag("cabinet", "links", "multiple", "integration", "normal")`
- Использовать `allure.step()` для каждого шага:
- Создание нескольких ключей для одного пользователя
- Генерация токенов для каждого ключа
- Проверка, что все ссылки работают и не возвращают 403

## Файлы для изменения

- `tests/unit/test_user_cabinet/test_cabinet.py` - добавить unit-тест
- `tests/integration/test_user_cabinet/test_cabinet_flow.py` - добавить интеграционный тест

## Критерии успеха

- Все валидные ссылки возвращают статус 200 или 302 (не 403)
- В ответе нет сообщения об ошибке "Ссылка недействительна"
- Тесты проходят успешно
- Тесты покрывают различные сценарии (один ключ, несколько ключей, разные пользователи)