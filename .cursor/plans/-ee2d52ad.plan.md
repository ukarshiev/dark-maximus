<!-- ee2d52ad-b6b6-49db-81cb-c0e9869219c7 d62ca868-5db4-474c-9bef-2e863e9437e9 -->
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é "–ú–æ–∏ –∫–ª—é—á–∏" —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è

## –ó–∞–¥–∞—á–∏

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π

**–§–∞–π–ª:** `src/shop_bot/bot/keyboards.py`

**–§—É–Ω–∫—Ü–∏—è:** `create_keys_management_keyboard` (—Å—Ç—Ä–æ–∫–∏ 389-468)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –ü–æ—Å–ª–µ –Ω–æ–º–µ—Ä–∞ –∫–ª—é—á–∞ (`#{key_number}`) –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è:
  - `üü¢` –µ—Å–ª–∏ `auto_renewal_enabled == True` (–≤–∫–ª—é—á–µ–Ω–æ)
  - `üî¥` –µ—Å–ª–∏ `auto_renewal_enabled == False` (–≤—ã–∫–ª—é—á–µ–Ω–æ)
- –ü–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `get_key_auto_renewal_enabled(key['key_id'])` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `parts` —Å–ø–∏—Å–∫–∞, –¥–æ–±–∞–≤–∏–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—Å–ª–µ —Å—Ç–∞—Ç—É—Å–Ω–æ–π –∏–∫–æ–Ω–∫–∏ –∏ –Ω–æ–º–µ—Ä–∞

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```python
parts = [
    f"{status_icon} #{key_number}",
    host_flag,
    tariff_display,
    price_display,
    f"–¥–æ {expiry_date_str}"
]
```

**–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç:**

```python
# –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
from shop_bot.data_manager.database import get_key_auto_renewal_enabled
auto_renewal_status = get_key_auto_renewal_enabled(key['key_id'])
auto_renewal_icon = "üü¢" if auto_renewal_status else "üî¥"

parts = [
    f"{status_icon} #{key_number}",
    auto_renewal_icon,
    host_flag,
    tariff_display,
    price_display,
    f"–¥–æ {expiry_date_str}"
]
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –º–µ–Ω—é "–í–∞—à–∏ –∫–ª—é—á–∏:"

**–§–∞–π–ª:** `src/shop_bot/bot/handlers.py`

**–§—É–Ω–∫—Ü–∏–∏:**

- `manage_keys_message` (—Å—Ç—Ä–æ–∫–∏ 1396-1406)
- `manage_keys_handler` (—Å—Ç—Ä–æ–∫–∏ 3041-3062)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç "–í–∞—à–∏ –∫–ª—é—á–∏:" –Ω–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —É—Å–ª–æ–≤–Ω—ã—Ö –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `<blockquote>` –¥–ª—è —Å–ø–∏—Å–∫–∞ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π

**–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç:**

```
=== –ú–æ–∏ –∫–ª—é—á–∏ ===



–£—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:

<blockquote>

1. –°—Ç–∞—Ç—É—Å –∏–∫–æ–Ω–∫–∞: ‚úÖ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö, ‚ùå –¥–ª—è –∏—Å—Ç—ë–∫—à–∏—Ö/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

2. –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∫–ª—é—á–∞: üü¢ –≤–∫–ª—é—á–µ–Ω–æ, üî¥ –≤—ã–∫–ª—é—á–µ–Ω–æ

3. –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∫–ª—é—á–∞

4. –°—Ç—Ä–∞–Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∫–ª—é—á–∞

5. –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞

6. –¶–µ–Ω–∞

7. –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è

</blockquote>
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –ø—É—Å—Ç, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–ª—é—á–µ–π."

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

1. **–ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏:** –î–æ–±–∞–≤–∏—Ç—å `from shop_bot.data_manager.database import get_key_auto_renewal_enabled` –≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ `create_keys_management_keyboard` –∏–ª–∏ –≤ –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è `keyboards.py`

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –§—É–Ω–∫—Ü–∏—è `get_key_auto_renewal_enabled` —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

3. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTML:** –í `manage_keys_handler` –∏ `manage_keys_message` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `parse_mode="HTML"` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

1. **`docs/diagrams/reference/menu-uml.md`** (—Å—Ç—Ä–æ–∫–∞ 68)

   - –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–π —Å `"{status} #{i} | {flag} | {tariff/TRIAL} | {price}‚ÇΩ | –¥–æ {date}"` 
   - –ù–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: `"{status} #{i} | {auto_renewal} | {flag} | {tariff/TRIAL} | {price}‚ÇΩ | –¥–æ {date}"`
   - –ì–¥–µ `{auto_renewal}` - üü¢ –∏–ª–∏ üî¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è

2. **`docs/reference/admin-panel/menus-reference.md`** (—Å—Ç—Ä–æ–∫–∞ 31)

   - –û–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ–Ω—é "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏" —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª—é—á–µ–π —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è

3. **`docs/reference/admin-panel/message-templates-reference.md`** (—Å—Ç—Ä–æ–∫–∞ 207)

   - –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –º–µ–Ω—é —Å "–í–∞—à–∏ –∫–ª—é—á–∏:" –Ω–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —É—Å–ª–æ–≤–Ω—ã—Ö –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**

- –í –¥–∏–∞–≥—Ä–∞–º–º–µ –º–µ–Ω—é –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫–∏ –∫–ª—é—á–∞, –¥–æ–±–∞–≤–∏–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
- –í —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö –º–µ–Ω—é –∏ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª—é—á–µ–π
- –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è (üü¢/üî¥) –≤ —É—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. `src/shop_bot/bot/keyboards.py` - —Ñ—É–Ω–∫—Ü–∏—è `create_keys_management_keyboard`
2. `src/shop_bot/bot/handlers.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `manage_keys_message` –∏ `manage_keys_handler`
3. `docs/diagrams/reference/menu-uml.md` - –¥–∏–∞–≥—Ä–∞–º–º–∞ –º–µ–Ω—é
4. `docs/reference/admin-panel/menus-reference.md` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–µ–Ω—é
5. `docs/reference/admin-panel/message-templates-reference.md` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

### To-dos

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è (üü¢/üî¥) –≤ —Ñ—É–Ω–∫—Ü–∏—é create_keys_management_keyboard –ø–æ—Å–ª–µ –Ω–æ–º–µ—Ä–∞ –∫–ª—é—á–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –º–µ–Ω—é '–í–∞—à–∏ –∫–ª—é—á–∏:' –Ω–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —É—Å–ª–æ–≤–Ω—ã—Ö –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–π –≤ manage_keys_message –∏ manage_keys_handler