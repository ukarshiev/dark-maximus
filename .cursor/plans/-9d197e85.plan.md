<!-- 9d197e85-6749-45cb-9511-fcaedd39ac75 c65f4bf4-1399-4e22-87ac-dc51175a08c4 -->
# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π

## –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –¥–ª—è –Ω–µ–Ω—É–∂–Ω—ã—Ö –∫–ª—é—á–µ–π, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –µ–≥–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (src/shop_bot/data_manager/database.py)

- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `auto_renewal_enabled` –≤ —Ç–∞–±–ª–∏—Ü–µ `vpn_keys` (INTEGER DEFAULT 1)
- –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `_ensure_database_schema()` –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–æ–Ω–∫–∏ `enabled` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 1648)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏ –ø–æ–ª—É—á–∞—Ç –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã–º (1)

## –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î

### 2. –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ database.py

- `get_key_auto_renewal_enabled(key_id: int) -> bool`
- –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True (–≤–∫–ª—é—á–µ–Ω–æ)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ª–æ–Ω–∫–∏ (–º–∏–≥—Ä–∞—Ü–∏—è –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)

- `set_key_auto_renewal_enabled(key_id: int, enabled: bool) -> bool`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –¥–ª—è –∫–ª—é—á–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, False –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

## –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ scheduler.py (src/shop_bot/data_manager/scheduler.py)

- –í —Ñ—É–Ω–∫—Ü–∏–∏ `perform_auto_renewals()` (—Å—Ç—Ä–æ–∫–∞ 891) –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –∫–ª—é—á–∞:
- –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 936)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `get_key_auto_renewal_enabled(key_id)`
- –ü—Ä–æ–¥–ª–µ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã: –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ò –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø—É—Å–∫ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –∫–ª—é—á–∞

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (scheduler.py)

- –í —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`send_autorenew_balance_notice`, `send_autorenew_disabled_notice`) —É—á–∏—Ç—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –∫–ª—é—á–∞
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–ª—é—á–µ–π —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞

### 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è (src/shop_bot/bot/handlers.py)

- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `toggle_key_auto_renewal_handler`:
- Callback data: `toggle_key_auto_renewal_{key_id}`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–∫–ª—é—á –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `set_key_auto_renewal_enabled()`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–ª—é—á–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∫–ª—é—á–∞ (src/shop_bot/bot/keyboards.py)

- –í —Ñ—É–Ω–∫—Ü–∏–∏ `create_key_info_keyboard()` (—Å—Ç—Ä–æ–∫–∞ 470):
- –ü–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `get_key_auto_renewal_enabled()`
- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üîÑ –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ: –í–∫–ª/–í—ã–∫–ª" —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ç–µ–∫—Å—Ç–æ–º
- –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏ "üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª—é—á"

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ (src/shop_bot/config.py)

- –í —Ñ—É–Ω–∫—Ü–∏–∏ `get_key_info_text()` (—Å—Ç—Ä–æ–∫–∞ 237):
- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `key_auto_renewal_enabled: bool | None = None`
- –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–µ–∫—Å—Ç –∫–ª—é—á–∞: "üîÑ –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ: –í–∫–ª—é—á–µ–Ω–æ/–û—Ç–∫–ª—é—á–µ–Ω–æ"
- –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç–∞—Ç—É—Å–µ –∫–ª—é—á–∞

### 8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ show_key_handler (src/shop_bot/bot/handlers.py)

- –í —Ñ—É–Ω–∫—Ü–∏–∏ `show_key_handler()` (—Å—Ç—Ä–æ–∫–∞ 3420):
- –ü–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ `get_key_auto_renewal_enabled()`
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ `get_key_info_text()` –∏ `create_key_info_keyboard()`

### 9. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ —Å–ø–∏—Å–∫–µ –∫–ª—é—á–µ–π

- –í —Ñ—É–Ω–∫—Ü–∏–∏ `create_keys_management_keyboard()` (src/shop_bot/bot/keyboards.py, —Å—Ç—Ä–æ–∫–∞ 389):
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è (üü¢/üî¥) –≤ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∫–ª—é—á–∞
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 10. Unit-—Ç–µ—Å—Ç—ã (tests/unit/test_database/)

- `test_get_key_auto_renewal_enabled()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- `test_set_key_auto_renewal_enabled()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
- `test_key_auto_renewal_default()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 11. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (tests/integration/)

- –¢–µ—Å—Ç –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º –∫–ª—é—á–∞
- –¢–µ—Å—Ç –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º, –Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º
- –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 12. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CHANGELOG.md

- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –Ω–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ
- –£–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é –∏ –¥–∞—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –û–ø–∏—Å–∞—Ç—å –Ω–æ–≤—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –∏ —Ñ—É–Ω–∫—Ü–∏–∏ database.py (–ø—É–Ω–∫—Ç—ã 1-2)
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è (–ø—É–Ω–∫—Ç 3-4)
3. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞ (–ø—É–Ω–∫—Ç—ã 5-9)
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—É–Ω–∫—Ç—ã 10-11)
5. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞ (–ø—É–Ω–∫—Ç 13)
6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ø—É–Ω–∫—Ç—ã 12, 14)