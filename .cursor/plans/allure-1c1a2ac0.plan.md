<!-- 1c1a2ac0-6dad-4881-9739-eb368f5393bd 2a08d034-1d65-433f-9292-3864889eb4b0 -->
# Расширение блока статуса отчета Allure

## Цель

Расширить блок статуса отчета на главной странице Allure Homepage (`apps/allure-homepage/templates/index.html`) для отображения дополнительной информации:

- Количество тестовых сценариев с процентом успешных
- Дата отчета
- Время выполнения (начало - конец, длительность)

## Изменения в backend (app.py)

### 1. Добавить функцию получения статистики из JSON отчета

- Создать функцию `get_report_statistics(report_id, project='default')` для получения данных из `widgets/summary.json`
- Функция должна получать:
  - `statistic.total` - общее количество тестов
  - `statistic.passed` - количество успешных тестов
  - Процент успешных: `(passed / total) * 100`

### 2. Добавить функцию получения времени выполнения

- Создать функцию `get_report_execution_time(report_id, project='default')` для получения времени выполнения
- Парсить `data/test-cases.json` или другие JSON файлы для получения:
  - Время начала выполнения (минимальное `start` из всех тестов)
  - Время окончания (максимальное `stop` из всех тестов)
  - Вычислить длительность

### 3. Обновить функцию `get_latest_report_info`

- Расширить возвращаемый словарь:
  - `test_count` - количество тестов
  - `success_percentage` - процент успешных тестов
  - `report_date` - дата отчета (формат DD.MM.YYYY)
  - `execution_start` - время начала (формат HH:MM:SS)
  - `execution_end` - время окончания (формат HH:MM:SS)
  - `execution_duration` - длительность (формат "Xm Ys")

### 4. Обновить API endpoint `/allure-docker-service/api/report-status`

- Вернуть расширенные данные в JSON формате
- Обработать случаи, когда данные недоступны (показать "отчет создается")

## Изменения в frontend (index.html)

### 1. Обновить CSS для многострочного блока

- Добавить стили для многострочного отображения информации
- Улучшить читаемость с разделителями

### 2. Обновить JavaScript функцию `loadReportStatus`

- Обновить логику отображения для многострочного формата:
  ```
  ✅ Создан ID: latest
  Тестовых сценариев: 482 (95.2%)
  Дата: 21.11.2025
  Время: 11:05:07 - 11:18:34 (13m 27s)
  ```

- Обработать случаи отсутствия данных (показать "отчет создается")

## Файлы для изменения

- `apps/allure-homepage/app.py` - backend логика
- `apps/allure-homepage/templates/index.html` - frontend отображение

## Примечания

- Использовать JSON файлы отчета: `widgets/summary.json` и `data/test-cases.json`
- Форматирование даты: DD.MM.YYYY (UTC+3)
- Форматирование времени: HH:MM:SS
- Форматирование длительности: "Xm Ys" (минуты и секунды)
- Обработка ошибок: показывать "отчет создается" при недоступности данных

### To-dos

- [ ] Добавить функцию get_report_statistics для получения статистики из widgets/summary.json
- [ ] Добавить функцию get_report_execution_time для получения времени выполнения из data/test-cases.json
- [ ] Обновить функцию get_latest_report_info для возврата расширенных данных
- [ ] Обновить API endpoint /allure-docker-service/api/report-status для возврата расширенных данных
- [ ] Обновить CSS в index.html для многострочного отображения блока статуса
- [ ] Обновить JavaScript функцию loadReportStatus для отображения расширенной информации в многострочном формате