<!-- 0223f44d-4a8c-489d-82e0-5131fcfca148 cb8aeb22-3f35-43b8-a25d-66b19c29f0f3 -->
# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ —Å Allure Framework (–ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ)

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã

- `tests/test_database_locks_fix.py` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π pytest-—Ç–µ—Å—Ç
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ `tests/` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
- –ù–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Ç–µ—Å—Ç–æ–≤

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î, –º–æ–∫–∏)
‚îú‚îÄ‚îÄ unit/                    # Unit-—Ç–µ—Å—Ç—ã (–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –ø–∏—Ä–∞–º–∏–¥—ã - 70%)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_user_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_promo_code_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_transaction_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_plan_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_group_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_host_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_key_operations.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_migrations.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_concurrent_access.py
‚îÇ   ‚îú‚îÄ‚îÄ test_bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_promo_code_logic.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_deeplink_registration.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_payment_processing.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_keyboard_generation.py
‚îÇ   ‚îú‚îÄ‚îÄ test_utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_deeplink.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_validators.py
‚îÇ   ‚îî‚îÄ‚îÄ test_security/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ test_rate_limiter.py
‚îÇ       ‚îî‚îÄ‚îÄ test_validators.py
‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å–µ—Ä–µ–¥–∏–Ω–∞ - 20%)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_promo_code_flow.py
‚îÇ   ‚îú‚îÄ‚îÄ test_user_registration_flow.py
‚îÇ   ‚îî‚îÄ‚îÄ test_payment_flow.py
‚îú‚îÄ‚îÄ e2e/                     # End-to-End —Ç–µ—Å—Ç—ã (–≤–µ—Ä—à–∏–Ω–∞ - 10%)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ test_full_bot_flows.py
‚îî‚îÄ‚îÄ ad-hoc/                  # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö)
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_deeplink_base64.py
    ‚îú‚îÄ‚îÄ test_deeplink_comma_format.py
    ‚îú‚îÄ‚îÄ test_deeplink_fix.py
    ‚îú‚îÄ‚îÄ test_promo_deeplink_fix.py
    ‚îî‚îÄ‚îÄ ... (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã)
```

### –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤

```
        /\
       /  \  E2E (10%) - –ü–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
      /____\
     /      \  Integration (20%) - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    /________\
   /          \  Unit (70%) - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥—É–ª–∏
  /____________\
```

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:**

- **Unit-—Ç–µ—Å—Ç—ã (70%)** - –±—ã—Å—Ç—Ä—ã–µ, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
- **Integration-—Ç–µ—Å—Ç—ã (20%)** - –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **E2E-—Ç–µ—Å—Ç—ã (10%)** - –ø–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ —Å Allure Framework

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Nginx (–ø–æ—Ä—Ç 80/443)                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  tests.dark-maximus.com ‚Üí allure-service:5050 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  allure-service (Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Allure Service (–ø–æ—Ä—Ç 5050)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ —Ç–µ—Å—Ç–æ–≤                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  /app/allure-results/ (JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  /app/allure-report/ (HTML –æ—Ç—á–µ—Ç—ã)           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  tests (Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  pytest —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏:                        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - allure-pytest (Allure –æ—Ç—á–µ—Ç—ã)            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - pytest-cov (–ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞)              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - pytest-html (HTML –æ—Ç—á–µ—Ç—ã –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∞)   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–æ–≤:                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - pytest --alluredir=allure-results/       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - allure generate allure-results/           ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–µ—à–µ–Ω–∏–µ: Allure Framework + Allure Service

**–ü–æ—á–µ–º—É Allure Framework:**

1. ‚úÖ **Open-source** - –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç–æ
2. ‚úÖ **–ì–æ—Ç–æ–≤—ã–π Docker-–æ–±—Ä–∞–∑** - `frankescobar/allure-docker-service`
3. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pytest** - –ø–ª–∞–≥–∏–Ω `allure-pytest`
4. ‚úÖ **–ö—Ä–∞—Å–∏–≤—ã–µ –æ—Ç—á–µ—Ç—ã** - HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ –∫–æ—Ä–æ–±–∫–∏
5. ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
6. ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∏** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
7. ‚úÖ **–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤** - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–µ–≥–∏ (@pytest.mark.unit, @pytest.mark.integration)
8. ‚úÖ **–î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã** - —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ª–æ–≥–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
9. ‚úÖ **–ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Allure Framework:**

- üìä Dashboard —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Ç–µ—Å—Ç–æ–≤
- üìà –ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
- üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ —Ç–µ—Å—Ç–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- üìâ –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å pytest-cov)
- üè∑Ô∏è –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º —Ç–µ—Å—Ç–æ–≤ (unit/integration/e2e)
- üéØ –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- üì• –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (JSON, HTML)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ë–µ–∑–æ–ø–∞—Å–Ω–æ - —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤)

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤: `tests/unit/`, `tests/integration/`, `tests/e2e/`, `tests/ad-hoc/`
2. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤ `tests/ad-hoc/`
3. –°–æ–∑–¥–∞—Ç—å `conftest.py` —Å –±–∞–∑–æ–≤—ã–º–∏ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
4. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ `rights-rules.mdc` –¥–ª—è –Ω–æ–≤—ã—Ö –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
5. –°–æ–∑–¥–∞—Ç—å `pytest.ini` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ pytest

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –≥–æ—Ç–æ–≤–∞
- –°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `tests/ad-hoc/`
- –ü—Ä–∞–≤–∏–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

**–í—Ä–µ–º—è:** ~30 –º–∏–Ω—É—Ç

---

### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã (–ë–µ–∑–æ–ø–∞—Å–Ω–æ - —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç)

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ unit-—Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ë–î –∏ –±–æ—Ç–∞

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_utils/test_deeplink.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ deeplink
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ deeplink
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª–∏–Ω—ã

2. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_security/test_validators.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –≤ `conftest.py`
4. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ –¥–ª—è Allure: `@pytest.mark.unit`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ü–µ—Ä–≤—ã–µ —Ä–∞–±–æ—á–∏–µ unit-—Ç–µ—Å—Ç—ã
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å `pytest tests/unit/`
- –¢–µ—Å—Ç—ã –≤–∏–¥–Ω—ã –≤ Allure –æ—Ç—á–µ—Ç–∞—Ö

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞

---

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ë–µ–∑–æ–ø–∞—Å–Ω–æ - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î –∏—Å–ø–æ–ª—å–∑—É—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î

**–ó–∞–¥–∞—á–∏:**

1. –†–∞—Å—à–∏—Ä–∏—Ç—å `conftest.py` —Ñ–∏–∫—Å—Ç—É—Ä–æ–π `temp_db` (–∫–∞–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Ç–µ—Å—Ç–µ)
2. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_database/test_user_operations.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

3. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_database/test_promo_code_operations.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - CRUD –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

4. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_database/test_transaction_operations.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

5. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ `@pytest.mark.unit` –∏ `@pytest.mark.database`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –¢–µ—Å—Ç—ã –ë–î —Ä–∞–±–æ—Ç–∞—é—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ë–î
- –ü–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ë–î

**–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤

---

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç—ã –±–æ—Ç–∞ —Å –º–æ–∫–∞–º–∏ (–ë–µ–∑–æ–ø–∞—Å–Ω–æ - —Ç–æ–ª—å–∫–æ –º–æ–∫–∏)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –±–æ—Ç–∞ —Å –º–æ–∫–∞–º–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å –º–æ–∫–∏ –≤ `conftest.py`:

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `mock_bot` - –º–æ–∫ aiogram.Bot
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `mock_xui_api` - –º–æ–∫ xui_api
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - `mock_yookassa` - –º–æ–∫ YooKassa

2. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_bot/test_handlers.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /start
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ deeplink –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

3. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_bot/test_promo_code_logic.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

4. –°–æ–∑–¥–∞—Ç—å `tests/unit/test_bot/test_keyboard_generation.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä

5. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ `@pytest.mark.unit` –∏ `@pytest.mark.bot`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –¢–µ—Å—Ç—ã –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –º–æ–∫–∞–º–∏
- –ù–µ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ Telegram –±–æ—Ç–∞

**–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤

---

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–ë–µ–∑–æ–ø–∞—Å–Ω–æ - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ flow)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω—ã—Ö flow –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å `tests/integration/test_promo_code_flow.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –°–æ–∑–¥–∞–Ω–∏–µ deeplink —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

2. –°–æ–∑–¥–∞—Ç—å `tests/integration/test_user_registration_flow.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ deeplink —Å group_code
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –û–±—Ä–∞–±–æ—Ç–∫–∞ referrer_id

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ë–î
4. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ `@pytest.mark.integration`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–í—Ä–µ–º—è:** ~3-4 —á–∞—Å–∞

---

### –≠—Ç–∞–ø 6: E2E —Ç–µ—Å—Ç—ã (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å end-to-end —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å `tests/e2e/test_full_bot_flows.py`

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ø–æ–∫—É–ø–∫–∞ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è E2E
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏ `@pytest.mark.e2e`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- E2E —Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤

---

### –≠—Ç–∞–ø 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Allure Framework (–ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Allure Framework –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤

**–ó–∞–¥–∞—á–∏:**

1. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `pyproject.toml`:
   ```toml
   [project.optional-dependencies]
   test = [
       "pytest>=7.4.0",
       "pytest-asyncio>=0.21.0",
       "pytest-mock>=3.11.0",
       "pytest-cov>=4.1.0",
       "allure-pytest>=2.13.0",
       "faker>=19.0.0",
   ]
   ```

2. –°–æ–∑–¥–∞—Ç—å `Dockerfile.tests` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤:
   ```dockerfile
   FROM python:3.11-slim
   
   WORKDIR /app
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   COPY pyproject.toml .
   RUN pip install --no-cache-dir -e ".[test]"
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Allure CLI
   RUN apt-get update && apt-get install -y wget unzip && \
       wget https://github.com/allure-framework/allure2/releases/download/2.24.1/allure-2.24.1.tgz && \
       tar -xzf allure-2.24.1.tgz && \
       mv allure-2.24.1 /opt/allure && \
       ln -s /opt/allure/bin/allure /usr/local/bin/allure && \
       apt-get clean && rm -rf /var/lib/apt/lists/*
   
   # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
   COPY tests/ /app/tests/
   COPY src/ /app/src/
   
   # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   RUN mkdir -p /app/allure-results /app/allure-report
   
   CMD ["tail", "-f", "/dev/null"]
   ```

3. –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –≤ `docker-compose.yml`:
   ```yaml
   tests:
     build:
       context: .
       dockerfile: Dockerfile.tests
     container_name: dark-maximus-tests
     volumes:
       - ./tests:/app/tests
       - ./src:/app/src
       - ./allure-results:/app/allure-results
       - ./allure-report:/app/allure-report
     networks:
       - dark-maximus-network
   
   allure-service:
     image: frankescobar/allure-docker-service:latest
     container_name: dark-maximus-allure
     ports:
       - '127.0.0.1:5050:5050'
     volumes:
       - ./allure-results:/app/allure-results
       - ./allure-report:/app/allure-report
     environment:
       - CHECK_RESULTS_EVERY_SECONDS=3
       - KEEP_HISTORY=1
     networks:
       - dark-maximus-network
   ```

4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `pytest.ini` –¥–ª—è Allure:
   ```ini
   [pytest]
   testpaths = tests
   python_files = test_*.py
   python_classes = Test*
   python_functions = test_*
   addopts = 
       --alluredir=allure-results
       --cov=src
       --cov-report=html
       --cov-report=term
       -v
   markers =
       unit: Unit tests
       integration: Integration tests
       e2e: End-to-end tests
       database: Database tests
       bot: Bot tests
   ```

5. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ `tests/run_tests.sh`:
   ```bash
   #!/bin/bash
   pytest --alluredir=allure-results
   allure generate allure-results --clean -o allure-report
   ```

6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è `tests.dark-maximus.com`:
   ```nginx
   server {
       listen 80;
       server_name tests.dark-maximus.com;
       
       location / {
           proxy_pass http://allure-service:5050;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```


**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏ Allure Service –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –î–æ—Å—Ç—É–ø –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ `tests.dark-maximus.com`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞

---

### –≠—Ç–∞–ø 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–ó–∞–¥–∞—á–∏:**

1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `tests/run_tests_scheduled.sh` –¥–ª—è cron
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–µ
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub Actions (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Ç–µ—Å—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `rights-rules.mdc`

```markdown
### –°–∫—Ä–∏–ø—Ç—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è **–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞–∑—ã–≤–∞–π —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `test_`.
- –†–∞–∑–º–µ—â–∞–π –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ `/tests/ad-hoc/`.  
  –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π –µ—ë –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–æ–≤.
- **–ê–≤—Ç–æ—Ç–µ—Å—Ç—ã** (pytest) —Ä–∞–∑–º–µ—â–∞–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞—Ö:
  - `/tests/unit/` - unit-—Ç–µ—Å—Ç—ã (70% –ø–æ–∫—Ä—ã—Ç–∏—è)
  - `/tests/integration/` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (20%)
  - `/tests/e2e/` - end-to-end —Ç–µ—Å—Ç—ã (10%)
- –í—Å–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î –∏ –º–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—É—é –ë–î `users.db` –≤ —Ç–µ—Å—Ç–∞—Ö.
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ–≥–∏ pytest –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤:
  - `@pytest.mark.unit` - –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤
  - `@pytest.mark.integration` - –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
  - `@pytest.mark.e2e` - –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤
```

## –ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –¢–µ—Å—Ç—ã –Ω–µ –ø–æ–≤—Ä–µ–¥—è—Ç –ø—Ä–æ–µ–∫—Ç

1. **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –≤—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î
2. **–ú–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** - Telegram, XUI, –ø–ª–∞—Ç–µ–∂–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
3. **–¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
4. **–û—Ç–¥–µ–ª—å–Ω—ã–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** - —Ç–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
5. **–ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ** - –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

```toml
[project.optional-dependencies]
test = [
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
    "pytest-mock>=3.11.0",
    "pytest-cov>=4.1.0",
    "allure-pytest>=2.13.0",
    "faker>=19.0.0",
]
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
docker compose exec tests pytest --alluredir=allure-results

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç–æ–≤
docker compose exec tests pytest tests/unit/ -m unit --alluredir=allure-results

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
docker compose exec tests pytest tests/integration/ -m integration --alluredir=allure-results

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–∞
docker compose exec tests allure generate allure-results --clean -o allure-report

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://tests.dark-maximus.com
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1** - —Å–∞–º–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —á–∞—Å—Ç—å
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
3. **–î–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞** - –ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –≤–µ—Ç–∫—É** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å** –≤ `docs/guides/development/testing.md`
6. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Allure —Ç–µ–≥–∏** –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º
7. **–†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### To-dos

- [ ] –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ (unit/, integration/, e2e/, ad-hoc/), –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤ ad-hoc/, –æ–±–Ω–æ–≤–∏—Ç—å rights-rules.mdc, —Å–æ–∑–¥–∞—Ç—å conftest.py –∏ pytest.ini
- [ ] –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è —É—Ç–∏–ª–∏—Ç (deeplink, validators) —Å —Ç–µ–≥–∞–º–∏ @pytest.mark.unit - –Ω–µ —Ç—Ä–µ–±—É—é—Ç –ë–î –∏ –±–æ—Ç–∞
- [ ] –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ë–î (user_operations, promo_code_operations, transaction_operations) —Å —Ç–µ–≥–∞–º–∏ @pytest.mark.unit –∏ @pytest.mark.database
- [ ] –≠—Ç–∞–ø 4: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –±–æ—Ç–∞ —Å –º–æ–∫–∞–º–∏ (handlers, promo_code_logic, keyboard_generation) —Å —Ç–µ–≥–∞–º–∏ @pytest.mark.unit –∏ @pytest.mark.bot
- [ ] –≠—Ç–∞–ø 5: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (promo_code_flow, user_registration_flow) —Å —Ç–µ–≥–∞–º–∏ @pytest.mark.integration
- [ ] –≠—Ç–∞–ø 6: –°–æ–∑–¥–∞—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å —Ç–µ–≥–∞–º–∏ @pytest.mark.e2e (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –≠—Ç–∞–ø 7: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Allure Framework (Dockerfile.tests, allure-service –≤ docker-compose.yml, pytest.ini —Å allure, —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [ ] –≠—Ç–∞–ø 8: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)