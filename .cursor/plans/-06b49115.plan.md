<!-- 06b49115-cf0c-4f2b-8f00-5547e983f6fe 4454307f-a850-495e-8349-af678503be0d -->
# –ü–ª–∞–Ω: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∫–ª—é—á–∞

## –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–Ω—ã–π flow —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º best practices –∏–∑ Context7, –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–∞—Ö –∏ —Å—Ç–∞—Ç—å–µ–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

### –§–∞–π–ª: `tests/integration/test_auto_renewal/test_notification_buttons_flow.py`

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∞:

1. **–§–∏–∫—Å—Ç—É—Ä—ã –∏ setup (Best Practices):**

                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã: `temp_db`, `mock_bot`, `mock_xui_api`
                                                                                                                                                                                                - –°–æ–∑–¥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ–∏–∫—Å—Ç—É—Ä—É `test_notification_user` –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–ª—é—á–æ–º
                                                                                                                                                                                                - –°–æ–∑–¥–∞–µ—Ç —Ö–æ—Å—Ç –∏ —Ç–∞—Ä–∏—Ñ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                                                                                                                                                                                                - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–æ–∫–∏ –¥–ª—è aiogram handlers —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `MagicMock(spec=...)` –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏

2. **–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

                                                                                                                                                                                                - –í—ã–∑—ã–≤–∞–µ—Ç `send_plan_unavailable_notice`
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É —á–µ—Ä–µ–∑ `mock_bot.send_message.assert_called_once()`
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ –ë–î —á–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å—ã
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö 4 –∫–Ω–æ–ø–æ–∫ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ —á–µ—Ä–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥ `InlineKeyboardMarkup`

3. **–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π VPN" (buy_new_vpn):**

                                                                                                                                                                                                - –°–∏–º—É–ª–∏—Ä—É–µ—Ç callback —Å `callback_data="buy_new_vpn"`
                                                                                                                                                                                                - –í—ã–∑—ã–≤–∞–µ—Ç `buy_new_vpn_handler` —Å –º–æ–∫–∞–º–∏ `CallbackQuery` –∏ `FSMContext`
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ —Ö–æ—Å—Ç–∞
                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `allure.step()` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–≥–æ–≤

4. **–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å VPN" (extend_key_{key_id}):**

                                                                                                                                                                                                - –°–∏–º—É–ª–∏—Ä—É–µ—Ç callback —Å `callback_data=f"extend_key_{key_id}"`
                                                                                                                                                                                                - –í—ã–∑—ã–≤–∞–µ—Ç `extend_key_handler` —Å –º–æ–∫–∞–º–∏
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ —Ä–µ–∂–∏–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (`display_mode`)
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞

5. **–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "üîë –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–ª—é—á—É" (show_key_{key_id}):**

                                                                                                                                                                                                - –°–∏–º—É–ª–∏—Ä—É–µ—Ç callback —Å `callback_data=f"show_key_{key_id}"`
                                                                                                                                                                                                - –í—ã–∑—ã–≤–∞–µ—Ç `show_key_handler` —Å –º–æ–∫–∞–º–∏
                                                                                                                                                                                                - –ú–æ–∫–∏—Ä—É–µ—Ç `xui_api.get_key_details_from_host` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `AsyncMock`
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–ª—é—á–µ

6. **–¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é" (back_to_main_menu):**

                                                                                                                                                                                                - –°–∏–º—É–ª–∏—Ä—É–µ—Ç callback —Å `callback_data="back_to_main_menu"`
                                                                                                                                                                                                - –í—ã–∑—ã–≤–∞–µ—Ç `back_to_main_menu_handler` —Å –º–æ–∫–∞–º–∏
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
                                                                                                                                                                                                - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É ReplyKeyboard —á–µ—Ä–µ–∑ `keyboards.get_main_reply_keyboard()`

## Best Practices (–∏–∑ Context7 –∏ pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏):

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ (AAA Pattern):

- **Arrange** (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞): —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º–æ–∫–æ–≤, —Ñ–∏–∫—Å—Ç—É—Ä
- **Act** (–î–µ–π—Å—Ç–≤–∏–µ): –≤—ã–∑–æ–≤ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- **Assert** (–ü—Ä–æ–≤–µ—Ä–∫–∞): –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 2. –§–∏–∫—Å—Ç—É—Ä—ã (Best Practices):

- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏–∑ `conftest.py`
- –°–æ–∑–¥–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ñ–∏–∫—Å—Ç—É—Ä—É `test_notification_user` –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `yield` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `@pytest.fixture` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `scope="function"` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

### 3. –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ (Best Practices –¥–ª—è aiogram):

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `MagicMock(spec=CallbackQuery)` –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `AsyncMock` –¥–ª—è async –º–µ—Ç–æ–¥–æ–≤ (`callback.answer()`, `callback.message.edit_text()`)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `patch` context managers –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- –ü–∞—Ç—á–∏–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `call` –∏–∑ `unittest.mock` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—ã–∑–æ–≤–æ–≤

### 4. Async —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–º–µ—á–∞–µ–º `@pytest.mark.asyncio`
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `pytest-asyncio` —Å `asyncio_mode = auto`
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `await` –¥–ª—è –≤—Å–µ—Ö async –≤—ã–∑–æ–≤–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `asyncio.run()` —Ç–æ–ª—å–∫–æ –≤ —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∏ (Best Practices):

- –ò—Å–ø–æ–ª—å–∑—É–µ–º `assert_called_once()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `assert_called_with()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `call` –∏–∑ `unittest.mock` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ `with pytest.raises()` –¥–ª—è –æ–∂–∏–¥–∞–µ–º—ã—Ö –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ assert'–∞—Ö

### 6. –ò–º–ø–æ—Ä—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```python
import pytest
import sys
import asyncio
from pathlib import Path
from unittest.mock import AsyncMock, MagicMock, patch, call
from datetime import datetime, timezone, timedelta
from aiogram.types import CallbackQuery, Message, User, Chat, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.fsm.context import FSMContext
import allure
```

### 7. –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∞:

```python
@pytest.fixture
def test_notification_user(temp_db):
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∫–ª—é—á–æ–º, –∏—Å—Ç–µ–∫–∞—é—â–∏–º —á–µ—Ä–µ–∑ 1 —á–∞—Å"""
    # Arrange: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö–æ—Å—Ç–∞, —Ç–∞—Ä–∏—Ñ–∞, –∫–ª—é—á–∞
    # ...
    yield {'user_id': user_id, 'key_id': key_id, 'host_name': host_name}
    # Cleanup –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ temp_db

@pytest.fixture
def mock_callback_query():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∫–∞ CallbackQuery"""
    callback = MagicMock(spec=CallbackQuery)
    callback.data = None  # –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ —Ç–µ—Å—Ç–∞—Ö
    callback.from_user = MagicMock(spec=User)
    callback.from_user.id = 123500
    callback.answer = AsyncMock()
    callback.message = MagicMock(spec=Message)
    callback.message.edit_text = AsyncMock()
    callback.message.answer = AsyncMock()
    return callback

@pytest.fixture
def mock_fsm_context():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∫–∞ FSMContext"""
    state = MagicMock(spec=FSMContext)
    state.get_state = AsyncMock(return_value=None)
    state.set_state = AsyncMock()
    state.update_data = AsyncMock()
    state.clear = AsyncMock()
    state.get_data = AsyncMock(return_value={})
    return state
```

## Allure –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å (Best Practices):

### –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞:

1. **`@allure.title("–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞")`**

                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–Ω—è—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
                                                                                                                                                                                                - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ –≤ Allure –æ—Ç—á–µ—Ç–µ

2. **`@allure.description("–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ")`**

                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å markdown
                                                                                                                                                                                                - –í–∫–ª—é—á–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã:
                                                                                                                                                                                                                                                                                                                                - **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
                                                                                                                                                                                                                                                                                                                                - **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ (user_id, key_id, –∏ —Ç.–¥.)
                                                                                                                                                                                                                                                                                                                                - **–®–∞–≥–∏ —Ç–µ—Å—Ç–∞** - –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å –º–µ—Ç–æ–¥–∞–º–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –æ–∂–∏–¥–∞–µ–º—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
                                                                                                                                                                                                                                                                                                                                - **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è** - –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
                                                                                                                                                                                                                                                                                                                                - **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞

3. **`@allure.severity(allure.severity_level.CRITICAL/NORMAL/MINOR)`**

                                                                                                                                                                                                - CRITICAL: —Ç–µ—Å—Ç—ã –∫—Ä–∏—Ç–∏—á–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫)
                                                                                                                                                                                                - NORMAL: –æ–±—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
                                                                                                                                                                                                - MINOR: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

4. **`@allure.tag("tag1", "tag2", ...)`**

                                                                                                                                                                                                - –¢–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: `notification`, `buttons`, `integration`, `bot`, `auto-renewal`

5. **`allure.step("–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞")`**

                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–≥–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ç–µ—Å—Ç–∞
                                                                                                                                                                                                - –£–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤ Allure –æ—Ç—á–µ—Ç–µ
                                                                                                                                                                                                - –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

6. **`allure.attach(data, name, attachment_type)`**

                                                                                                                                                                                                - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (user_id, key_id, token)
                                                                                                                                                                                                - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫
                                                                                                                                                                                                - –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º HTML/—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü—Ä–∏–º–µ—Ä Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ buy_new_vpn:

```python
@allure.title("–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ '–ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π VPN' –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")
@allure.description("""
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ "üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π VPN" –∏–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è 
–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è.

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `buy_new_vpn_handler`
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–æ–≤ –±–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞ —Ö–æ—Å—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º callback_data

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- user_id: 123500 (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–µ)
- key_id: —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ add_new_key
- host_name: 'test_host' (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–µ)
- –¢–∞—Ä–∏—Ñ—ã: —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ create_plan

**–®–∞–≥–∏ —Ç–µ—Å—Ç–∞:**
1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –ú–µ—Ç–æ–¥: register_user_if_not_exists(), add_new_key(), create_host(), create_plan()
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: user_id, host_name, expiry_ms
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–ª—é—á, —Ö–æ—Å—Ç –∏ —Ç–∞—Ä–∏—Ñ —Å–æ–∑–¥–∞–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏**
   - –ú–µ—Ç–æ–¥: send_plan_unavailable_notice()
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: bot, user_id, key_id, time_left_hours, expiry_date
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –∑–∞–ø–∏—Å–∞–Ω–æ –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: mock_bot.send_message.called == True
   
3. **–°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π VPN"**
   - –ú–µ—Ç–æ–¥: —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫ –æ–±—ä–µ–∫—Ç–∞ CallbackQuery —Å callback_data="buy_new_vpn"
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: callback.data = "buy_new_vpn"
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –º–æ–∫ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: callback.data == "buy_new_vpn"
   
4. **–í—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞**
   - –ú–µ—Ç–æ–¥: buy_new_vpn_handler(callback, state)
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: callback, FSMContext
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: callback.answer.called == True
   
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
   - –ú–µ—Ç–æ–¥: –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–∞ callback.message.edit_text()
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç "–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä", –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫–∏ —Ö–æ—Å—Ç–æ–≤

**–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î (temp_db)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏ –∏–º–µ–µ—Ç –∫–ª—é—á
- –•–æ—Å—Ç —Å–æ–∑–¥–∞–Ω —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏
- –ú–æ–∫ –±–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (mock_bot)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö 
—Ö–æ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–æ–≤–æ–≥–æ VPN –∫–ª—é—á–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
—Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –≤—ã–±–æ—Ä–∞ —Ö–æ—Å—Ç–∞.
""")
@allure.severity(allure.severity_level.CRITICAL)
@allure.tag("notification", "buttons", "integration", "bot", "buy-vpn")
```

## –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

### –§–∞–π–ª: `docs/guides/testing/test-notification-buttons-flow.md`

–°—Ç–∞—Ç—å—è –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:

1. **–í–≤–µ–¥–µ–Ω–∏–µ:**

                                                                                                                                                                                                - –û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ —Ç–µ—Å—Ç–∞
                                                                                                                                                                                                - –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –∫–ª—é—á–∞)
                                                                                                                                                                                                - –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è

2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞:**

                                                                                                                                                                                                - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
                                                                                                                                                                                                - –ú–æ–∫–∏ –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
                                                                                                                                                                                                - –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–∞ (Mermaid)

3. **–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**

                                                                                                                                                                                                - –î–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏ (buy_new_vpn, extend_key, show_key, back_to_main_menu):
                                                                                                                                                                                                                                                                                                                                - –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
                                                                                                                                                                                                                                                                                                                                - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
                                                                                                                                                                                                                                                                                                                                - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                                                                                                                                                                                                                                                                                                                                - –î–∏–∞–≥—Ä–∞–º–º–∞ flow (Mermaid)

4. **Best Practices:**

                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (AAA, —Ñ–∏–∫—Å—Ç—É—Ä—ã, –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ)
                                                                                                                                                                                                - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –ø–æ–¥–æ–±–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
                                                                                                                                                                                                - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
                                                                                                                                                                                                - –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–∞–∫ –∏—Ö –∏–∑–±–µ–∂–∞—Ç—å

5. **Allure –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å:**

                                                                                                                                                                                                - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Allure –æ—Ç—á–µ—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                                                                                                                                                                                                - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
                                                                                                                                                                                                - –ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –∏ –ø–ª–æ—Ö–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π
                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ attach –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

6. **–û—Ç–ª–∞–¥–∫–∞:**

                                                                                                                                                                                                - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Allure –æ—Ç—á–µ—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                                                                                                                                                                                                - –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è
                                                                                                                                                                                                - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
                                                                                                                                                                                                - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pytest flags –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

7. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

                                                                                                                                                                                                - –ü–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
                                                                                                                                                                                                - –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
                                                                                                                                                                                                - –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
                                                                                                                                                                                                - –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é pytest –∏ aiogram

## –ú–∞—Ä–∫–µ—Ä—ã pytest:

- `@pytest.mark.integration` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
- `@pytest.mark.bot` - —Ç–µ—Å—Ç –±–æ—Ç–∞
- `@pytest.mark.asyncio` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
- `@pytest.mark.database` - —Ç–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ë–î (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –∫–ª—é—á–∞ –∏–∑ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–æ —Ä–µ–∂–∏–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ layout –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (adjust(2, 1, 1))

### To-dos

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª test_notification_buttons_flow.py –∏ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Å—Ç–∞ —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ best practices
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã test_notification_user, mock_callback_query, mock_fsm_context —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MagicMock(spec=...)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–Ω–æ–ø–æ–∫, –∑–∞–ø–∏—Å–∏ –≤ –ë–î –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º allure.step()
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ buy_new_vpn —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–ø–∏—Å–∫–∞ —Ö–æ—Å—Ç–æ–≤ –∏ –ø–æ–ª–Ω—ã–º–∏ Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ extend_key —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ —Å–ø–∏—Å–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ show_key —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º xui_api –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª—é—á–µ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–Ω–æ–ø–∫–∏ back_to_main_menu —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∏ ReplyKeyboard
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (@allure.title, @allure.description, @allure.severity, @allure.tag) –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å allure.step() –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–≥–æ–≤ –≤ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–µ –∏ allure.attach() –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é docs/guides/testing/test-notification-buttons-flow.md —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–∞, best practices –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏