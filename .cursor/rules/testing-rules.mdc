---
alwaysApply: true
---
# üß™ –ü—Ä–∞–≤–∏–ª–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

> **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–ª–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ Dark Maximus

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (temp_db, –º–æ–∫–∏)
‚îú‚îÄ‚îÄ run_tests.sh             # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (bash)
‚îú‚îÄ‚îÄ run_tests.ps1            # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (PowerShell)
‚îú‚îÄ‚îÄ unit/                    # Unit-—Ç–µ—Å—Ç—ã (70% –ø–æ–∫—Ä—ã—Ç–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_database/       # –¢–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ test_bot/            # –¢–µ—Å—Ç—ã –±–æ—Ç–∞ (handlers, –ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ test_utils/          # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç
‚îÇ   ‚îî‚îÄ‚îÄ test_security/       # –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (20%)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ test_*.py            # –¢–µ—Å—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ e2e/                     # End-to-End —Ç–µ—Å—Ç—ã (10%)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ test_*.py            # –ü–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îî‚îÄ‚îÄ ad-hoc/                  # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ migrations/          # –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
    ‚îú‚îÄ‚îÄ checks/              # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    ‚îú‚îÄ‚îÄ backups/             # –°–∫—Ä–∏–ø—Ç—ã —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã (create_*, simulate_*, show_*)
    ‚îú‚îÄ‚îÄ tests/               # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (test_*.py)
    ‚îú‚îÄ‚îÄ final/               # –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    ‚îî‚îÄ‚îÄ reports/             # –û—Ç—á–µ—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

**–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `pytest.ini` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **–∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞** (–Ω–µ –≤ `tests/`), —á—Ç–æ–±—ã pytest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª –µ—ë –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –§–∞–π–ª –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ volume-–º–∞–ø–ø–∏–Ω–≥.

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

- **Unit-—Ç–µ—Å—Ç—ã** (`tests/unit/`):
  - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥—É–ª–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
  - –ù–µ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏–ª–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º–∏ (< 1 —Å–µ–∫—É–Ω–¥—ã –∫–∞–∂–¥—ã–π)

- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** (`tests/integration/`):
  - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Telegram, –ø–ª–∞—Ç–µ–∂–∏)
  - –ú–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ unit-—Ç–µ—Å—Ç–æ–≤

- **E2E —Ç–µ—Å—Ç—ã** (`tests/e2e/`):
  - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î –∏ –º–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - –ú–æ–≥—É—Ç –±—ã—Ç—å —Å–∞–º—ã–º–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏

- **–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã** (`tests/ad-hoc/`):
  - –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –ù–∞–∑–≤–∞–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º: `test_*`, `check_*`, `migrate_*`, `create_*`, `simulate_*`
  - –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ —Ç–∏–ø–∞–º –≤ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–∞—Ö

## üè∑Ô∏è –ú–∞—Ä–∫–µ—Ä—ã pytest

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–∞—Ä–∫–µ—Ä:

```python
@pytest.mark.unit              # Unit-—Ç–µ—Å—Ç—ã
@pytest.mark.integration       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
@pytest.mark.e2e               # E2E —Ç–µ—Å—Ç—ã
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

```python
@pytest.mark.database          # –¢–µ—Å—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –ë–î
@pytest.mark.bot               # –¢–µ—Å—Ç—ã –±–æ—Ç–∞
@pytest.mark.slow              # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
@pytest.mark.asyncio           # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤

```python
# –ü—Ä–∏–º–µ—Ä unit-—Ç–µ—Å—Ç–∞
@pytest.mark.unit
@pytest.mark.database
def test_user_creation(temp_db):
    # —Ç–µ—Å—Ç

# –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
@pytest.mark.integration
def test_deeplink_flow(temp_db):
    # —Ç–µ—Å—Ç
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—É—é –ë–î `users.db` –≤ —Ç–µ—Å—Ç–∞—Ö**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–∫—Å—Ç—É—Ä—É `temp_db` –∏–∑ `conftest.py`
   - –í—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞

2. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
   - Telegram Bot API ‚Üí `mock_bot` –∏–∑ `conftest.py`
   - 3X-UI API ‚Üí `mock_xui_api` –∏–∑ `conftest.py`
   - YooKassa ‚Üí `mock_yookassa` –∏–∑ `conftest.py`

3. **–ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**
   - –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
   - –û—á–∏—â–∞–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ENVIRONMENT` –∏–∑ `.env` –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–∫—Å—Ç—É—Ä—É —Å `autouse=True` –∏ `pytest.skip()` –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
   - –°–º. —Ä–∞–∑–¥–µ–ª "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π

### –ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```python
@pytest.mark.unit
@pytest.mark.database
def test_user_operations(temp_db):
    """–¢–µ—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î"""
    # temp_db - —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç users.db
    db = database.Database(str(temp_db))
    user = db.register_user_if_not_exists(123456, "test_user")
    assert user is not None
```

## üåç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ENVIRONMENT

–î–ª—è —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ENVIRONMENT` –∏–∑ —Ñ–∞–π–ª–∞ `.env`.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .env:**
```env
# ENVIRONMENT=production - –≤–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
# ENVIRONMENT=development –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ - —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ç–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è)
ENVIRONMENT=development
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
- –¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—é
- –¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö:**

```python
import os
import pytest

def is_production_environment() -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Ç–µ—Å—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–∏.
    –ß–∏—Ç–∞–µ—Ç –∏–∑ .env —Ñ–∞–π–ª–∞ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ conftest.py).
    
    Returns:
        True –µ—Å–ª–∏ ENVIRONMENT=production –≤ .env
    """
    env = os.getenv("ENVIRONMENT", "").lower()
    return env == "production"

@pytest.mark.integration
@pytest.mark.database
@allure.epic("–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã")
@allure.feature("–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö")
@allure.label("package", "tests.integration")
class TestProductionOnly:
    @pytest.fixture(autouse=True)
    def check_production_environment(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–∏"""
        if not is_production_environment():
            pytest.skip(
                "–¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ. "
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ENVIRONMENT=production –≤ .env —Ñ–∞–π–ª–µ"
            )
    
    @allure.story("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã –ë–î")
    @allure.title("–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î —Å —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î")
    @allure.description("""
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î.
    
    **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ .env:**
    - ENVIRONMENT=production - –≤–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç (development/test - –æ—Ç–∫–ª—é—á–∏—Ç—å)
    
    **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:**
    - –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ENVIRONMENT=production –≤ .env
    """)
    @allure.severity(allure.severity_level.CRITICAL)
    @allure.tag("database", "schema", "integrity", "production", "critical")
    def test_production_specific_feature(self):
        """–¢–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ"""
        # –¢–µ—Å—Ç
        pass
```

**–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–∫—Å—Ç—É—Ä—É `autouse=True`** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **–ò—Å–ø–æ–ª—å–∑—É–π `pytest.skip()`** –≤–º–µ—Å—Ç–æ `pytest.fail()` - —Ç–µ—Å—Ç –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω, –∞ –Ω–µ –ø—Ä–æ–≤–∞–ª–µ–Ω
3. **–î–æ–±–∞–≤–ª—è–π –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –≤ `pytest.skip()` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
4. **–£–∫–∞–∑—ã–≤–∞–π –≤ `@allure.description`**, —á—Ç–æ —Ç–µ—Å—Ç —Ç—Ä–µ–±—É–µ—Ç `ENVIRONMENT=production`
5. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `ENVIRONMENT` –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤** - —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏:**

```powershell
# –õ–æ–∫–∞–ª—å–Ω–æ (—Ç–µ—Å—Ç –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω)
pytest tests/integration/test_database_schema_integrity.py -v

# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ (—Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è)
# –í .env —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ENVIRONMENT=production
docker compose exec autotest pytest tests/integration/test_database_schema_integrity.py -v
```

## üê≥ Docker –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–µ—Ä–≤–∏—Å—ã –≤ docker-compose.yml

- **`autotest`** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
  - –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ `Dockerfile.tests`
  - –°–æ–¥–µ—Ä–∂–∏—Ç Python 3.11, pytest, Allure CLI
  - Volume-–º–∞–ø–ø–∏–Ω–≥–∏: `tests/`, `src/`, `allure-results/`, `allure-report/`

- **`allure-service`** - –≤–µ–±-—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤
  - –û–±—Ä–∞–∑: `frankescobar/allure-docker-service:latest`
  - –ü–æ—Ä—Ç: `127.0.0.1:5050`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç—ã –∏–∑ `allure-results/`

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–∞–º–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∏–∑ –æ–±—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ Nx (—Å–º. `nx-usage.mdc`).  
–¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `autotest`, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker –Ω–∞–ø—Ä—è–º—É—é.

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Allure **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–ª–∞–≥ `-T`** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `docker compose exec autotest pytest`. –§–ª–∞–≥ `-T` –æ—Ç–∫–ª—é—á–∞–µ—Ç TTY –∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ Allure –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞:**

```powershell
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
.\tests\run_tests.ps1                    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
.\tests\run_tests.ps1 -Clean             # –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
.\tests\run_tests.ps1 -TestPath "tests/unit" -Verbose  # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ docker compose (–ë–ï–ó —Ñ–ª–∞–≥–∞ -T)
docker compose exec autotest pytest

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã
docker compose exec autotest pytest tests/unit/ -m unit

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
docker compose exec autotest pytest tests/integration/ -m integration

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –≤—ã–≤–æ–¥–æ–º –≤ –∫–æ–Ω—Å–æ–ª—å
docker compose exec autotest pytest -v

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤
sudo ./install-autotest.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ Allure Service
docker compose logs -f allure-service
```

## üìä Allure Framework

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **pytest.ini** (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞): –Ω–∞—Å—Ç—Ä–æ–µ–Ω `--alluredir=/app/allure-results` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Allure
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `allure-results/` (308+ JSON —Ñ–∞–π–ª–æ–≤) –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- **–û—Ç—á–µ—Ç—ã**: –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `allure-report/` —á–µ—Ä–µ–∑ Allure Service

### –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

**–õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø:**
- Swagger UI (API): `http://localhost:5050`
- Allure Reports: `http://localhost:5050/allure-docker-service/projects/default/reports/latest/index.html`

**–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø (–ø–æ—Å–ª–µ SSL):**
- `https://tests.dark-maximus.com/allure-docker-service/projects/default/reports/latest/index.html`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```
allure-results/
‚îú‚îÄ‚îÄ *.json                    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ (JSON)
‚îî‚îÄ‚îÄ .gitkeep                  # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ git

allure-report/
‚îú‚îÄ‚îÄ index.html                # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç—á–µ—Ç–∞
‚îú‚îÄ‚îÄ data/                     # –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞
‚îî‚îÄ‚îÄ .gitkeep                  # –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ git
```

**–í–∞–∂–Ω–æ:** –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `allure-results/` –∏ `allure-report/` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `.gitignore`, –Ω–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `.gitkeep`.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

–í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

–î–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:

- **`@allure.epic`** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫—Ä—É–ø–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±–ª–∞—Å—Ç—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞", "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π", "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
- **`@allure.feature`** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ epic (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏", "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–µ")
- **`@allure.title`** - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –≤ –æ—Ç—á–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ manage_keys —Å –∫–ª—é—á–∞–º–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
- **`@allure.description`** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏
- **`@allure.severity`** - —É—Ä–æ–≤–µ–Ω—å –≤–∞–∂–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞ (CRITICAL, NORMAL, MINOR)
- **`@allure.tag`** - —Ç–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø–∞–º —Ç–µ—Å—Ç–æ–≤:**

- **`@allure.story`** - **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ E2E —Ç–µ—Å—Ç–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª "–í–∫–ª–∞–¥–∫–∞ Behaviors")
- **`@allure.label("package", "...")`** - **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª "–í–∫–ª–∞–¥–∫–∞ Packages")

#### –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ @allure.epic –∏ @allure.feature

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@allure.epic` –∏ `@allure.feature` –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ Allure Report.

**–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ Epic (–∫–∞—Ç–µ–≥–æ—Ä–∏—è):**

Epic –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:

| –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ | @allure.epic |
|-------------------|--------------|
| `tests/unit/test_database/` | `"–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö"` |
| `tests/unit/test_bot/` | `"–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞"` |
| `tests/unit/test_webhook_server/` | `"–í–µ–±-–ø–∞–Ω–µ–ª—å"` |
| `tests/unit/test_utils/test_message_templates.py` | `"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π"` |
| `tests/unit/test_utils/test_template_validation.py` | `"–í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤"` |
| `tests/unit/test_utils/test_deeplink.py` | `"–£—Ç–∏–ª–∏—Ç—ã"` |
| `tests/unit/test_utils/test_timezone_utils.py` | `"–£—Ç–∏–ª–∏—Ç—ã"` (unittest.TestCase - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è) |
| `tests/unit/test_user_cabinet/` | `"–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"` |
| `tests/unit/test_security/` | `"–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"` |
| `tests/unit/test_modules/` | `"–ú–æ–¥—É–ª–∏"` |
| `tests/integration/` | `"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã"` |
| `tests/e2e/` | `"E2E —Ç–µ—Å—Ç—ã"` |

**–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ Feature (–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è):**

Feature –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–ª–∞—Å—Å –∏–ª–∏ —Ñ–∞–π–ª:

**–î–ª—è `tests/unit/test_database/`:**
- `test_user_operations.py` ‚Üí `"–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"`
- `test_key_operations.py` ‚Üí `"–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–ª—é—á–∞–º–∏"`
- `test_referral_operations.py` ‚Üí `"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"`
- `test_promo_code_operations.py` ‚Üí `"–ü—Ä–æ–º–æ–∫–æ–¥—ã"`
- `test_transaction_operations.py` ‚Üí `"–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"`
- `test_trial_operations.py` ‚Üí `"–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥"`
- `test_host_operations.py` ‚Üí `"–û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ö–æ—Å—Ç–∞–º–∏"`
- `test_notifications.py` ‚Üí `"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"`
- `test_auto_renewal.py` ‚Üí `"–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ"`
- `test_cabinet_links.py` ‚Üí `"–°—Å—ã–ª–∫–∏ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞"`
- `test_key_numbering.py` ‚Üí `"–ù—É–º–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π"`
- `test_locks.py` ‚Üí `"–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–î"`
- `test_plan_display_mode.py` ‚Üí `"–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–æ–≤"`

**–î–ª—è `tests/unit/test_bot/`:**
- `test_handlers.py` ‚Üí `"–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥"`
- `test_manage_keys_handler.py` ‚Üí `"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏"`
- `test_payment_handlers.py` ‚Üí `"–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π"`
- `test_promo_code_logic.py` ‚Üí `"–ü—Ä–æ–º–æ–∫–æ–¥—ã"`
- `test_keyboard_generation.py` ‚Üí `"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä"`
- `test_router_error_handler.py` ‚Üí `"–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–æ—É—Ç–µ—Ä–∞"`

**–î–ª—è `tests/unit/test_webhook_server/`:**
- `test_auth.py` ‚Üí `"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"`
- `test_dashboard.py` ‚Üí `"Dashboard"`
- `test_users.py` ‚Üí `"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"`
- `test_keys.py` ‚Üí `"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏"`
- `test_promo_codes.py` ‚Üí `"–ü—Ä–æ–º–æ–∫–æ–¥—ã"`
- `test_settings.py` ‚Üí `"–ù–∞—Å—Ç—Ä–æ–π–∫–∏"`
- `test_notifications.py` ‚Üí `"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"`
- `test_transactions.py` ‚Üí `"–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"`
- `test_filters.py` ‚Üí `"–§–∏–ª—å—Ç—Ä—ã"`
- `test_support.py` ‚Üí `"–ü–æ–¥–¥–µ—Ä–∂–∫–∞"`
- `test_wiki.py` ‚Üí `"Wiki"`
- `test_monitoring.py` ‚Üí `"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"`
- `test_documents.py` ‚Üí `"–î–æ–∫—É–º–µ–Ω—Ç—ã"`
- `test_instructions.py` ‚Üí `"–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"`
- `test_ton_connect.py` ‚Üí `"TON Connect"`

**–î–ª—è `tests/unit/test_utils/`:**
- `test_message_templates.py` ‚Üí —Ä–∞–∑–ª–∏—á–Ω—ã–µ features –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–ª–∞—Å—Å–∞:
  - `TestFormatTariffInfo` ‚Üí `"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–µ"`
  - `TestPurchaseSuccessText` ‚Üí `"–°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ"`
  - `TestKeyInfoText` ‚Üí `"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–µ"`
  - `TestMessageTemplatesIntegration` ‚Üí `"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º"`
  - `TestHTMLTagReplacement` ‚Üí `"–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö HTML-—Ç–µ–≥–æ–≤"`
  - `TestTelegramAPIErrors` ‚Üí `"–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API"`
- `test_template_validation.py` ‚Üí `"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ '–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞'"`
- `test_deeplink.py` ‚Üí `"Deeplink"`
- `test_timezone_utils.py` ‚Üí –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (unittest.TestCase)

**–î–ª—è `tests/unit/test_user_cabinet/`:**
- `test_cabinet.py` ‚Üí `"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–∞–±–∏–Ω–µ—Ç–∞"`

**–î–ª—è `tests/unit/test_security/`:**
- `test_validators.py` ‚Üí `"–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"`

**–î–ª—è `tests/unit/test_modules/`:**
- `test_xui_api.py` ‚Üí `"3X-UI API"`

**–î–ª—è `tests/integration/`:**
- `test_user_cabinet/` ‚Üí `"–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç"`
- `test_auto_renewal/` ‚Üí `"–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ"`
- `test_payments/` ‚Üí `"–ü–ª–∞—Ç–µ–∂–∏"`
- `test_vpn_purchase/` ‚Üí `"–ü–æ–∫—É–ø–∫–∞ VPN"`
- `test_trial/` ‚Üí `"–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥"`
- `test_web_panel/` ‚Üí `"–í–µ–±-–ø–∞–Ω–µ–ª—å"`
- `test_referral/` ‚Üí `"–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"`
- `test_deeplink_*.py` ‚Üí `"Deeplink"`
- `test_database_schema_integrity.py` ‚Üí `"–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"`

**–î–ª—è `tests/e2e/`:**
- `test_user_scenarios/` ‚Üí `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_new_user_purchase.py` ‚Üí `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_user_trial_flow.py` ‚Üí `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_user_key_extension.py` ‚Üí `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_user_with_referral.py` ‚Üí `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
- `test_admin_scenarios/` ‚Üí `"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_admin_key_management.py` ‚Üí `"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_admin_promo_management.py` ‚Üí `"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`
  - `test_admin_user_management.py` ‚Üí `"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏"`

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
# tests/unit/test_database/test_user_operations.py
@pytest.mark.unit
@pytest.mark.database
@allure.epic("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
@allure.feature("–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏")
class TestUserOperations:
    # —Ç–µ—Å—Ç—ã

# tests/unit/test_bot/test_manage_keys_handler.py
@pytest.mark.unit
@pytest.mark.bot
@allure.epic("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞")
@allure.feature("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏")
class TestManageKeysHandler:
    # —Ç–µ—Å—Ç—ã

# tests/integration/test_payments/test_yookassa_flow.py
@pytest.mark.integration
@pytest.mark.database
@allure.epic("–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã")
@allure.feature("–ü–ª–∞—Ç–µ–∂–∏")
class TestYooKassaFlow:
    # —Ç–µ—Å—Ç—ã

# tests/unit/test_database/test_key_numbering.py - —Ñ—É–Ω–∫—Ü–∏–∏-—Ç–µ—Å—Ç—ã
@pytest.mark.unit
@pytest.mark.database
@allure.epic("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
@allure.feature("–ù—É–º–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π")
def test_get_next_key_number(temp_db):
    """–¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ get_next_key_number"""
    # —Ç–µ—Å—Ç

# tests/unit/test_database/test_trial_operations.py - —Ñ—É–Ω–∫—Ü–∏–∏-—Ç–µ—Å—Ç—ã
@pytest.mark.unit
@pytest.mark.database
@allure.epic("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
@allure.feature("–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥")
def test_trial_creation(temp_db):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞"""
    # —Ç–µ—Å—Ç

# tests/e2e/test_user_scenarios/test_new_user_purchase.py
@pytest.mark.e2e
@pytest.mark.asyncio
@allure.epic("E2E —Ç–µ—Å—Ç—ã")
@allure.feature("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏")
class TestNewUserPurchase:
    # —Ç–µ—Å—Ç—ã

# tests/e2e/test_admin_scenarios/test_admin_key_management.py
@pytest.mark.e2e
@allure.epic("E2E —Ç–µ—Å—Ç—ã")
@allure.feature("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏")
class TestAdminKeyManagement:
    # —Ç–µ—Å—Ç—ã
```

**–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**

1. **–í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π `import allure`** –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
2. **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞**, –ø–µ—Ä–µ–¥ `class Test*:`
3. **–î–ª—è —Ñ—É–Ω–∫—Ü–∏–π-—Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –∫–ª–∞—Å—Å–∞** –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π
4. **–ï—Å–ª–∏ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤**, –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–≤–æ–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
5. **–î–ª—è unittest.TestCase** –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥)
6. **–ù–∞–∑–≤–∞–Ω–∏—è epic –∏ feature –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ**, –∫–∞–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö
7. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞** —Å–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏ –µ–≥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π epic –∏ feature –∏–∑ —Ç–∞–±–ª–∏—Ü –≤—ã—à–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è (@allure.description)

–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) - —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ—Å—Ç
- **"–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è"** / **"–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã"** - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
- **"–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ"** / **"–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"** - –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **"–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç"** - –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö/E2E —Ç–µ—Å—Ç–æ–≤):**
- **"–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è"** - —É—Å–ª–æ–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
- **"–®–∞–≥–∏ —Ç–µ—Å—Ç–∞"** - –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞

**–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
- **"–í–∞–∂–Ω–æ—Å—Ç—å"** / **"–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å"** - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É —Ç–µ—Å—Ç –∫—Ä–∏—Ç–∏—á–µ–Ω

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è:**

```python
@allure.description("""
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É callback query "manage_keys" –∫–æ–≥–¥–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–ª—é—á–∏.

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –í—ã–∑–æ–≤ callback.answer() –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è callback query
- –í—ã–∑–æ–≤ callback.message.edit_text() —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ "–í–∞—à–∏ –∫–ª—é—á–∏:" –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ —Å–ª–æ–≤–æ "–∫–ª—é—á"
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ handler –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–ª—é—á–µ–π –≤ –ë–î

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- user_id: 123456
- host_name: 'test_host'
- key_email: 'test@example.com'

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
Handler —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç callback query –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
""")
```

#### –£—Ä–æ–≤–Ω–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏ (@allure.severity)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —É—Ä–æ–≤–Ω–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏:

- **`allure.severity_level.CRITICAL`** - –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:
  - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã
  - –¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ production

- **`allure.severity_level.NORMAL`** - –æ–±—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:
  - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
  - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ unit-—Ç–µ—Å—Ç–æ–≤

- **`allure.severity_level.MINOR`** - –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
  - –£–ª—É—á—à–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### –¢–µ–≥–∏ (@allure.tag)

–¢–µ–≥–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤ –≤ –æ—Ç—á–µ—Ç–∞—Ö.

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏:**
- –¢–∏–ø —Ç–µ—Å—Ç–∞: `"unit"`, `"integration"`, `"e2e"`

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏:**
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: `"manage_keys"`, `"callback_query"`, `"keys_management"`
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `"bot"`, `"database"`, `"utils"`
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: `"critical"` (–¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏: `"error_handling"`, `"expired_query"`, `"trial"`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
@allure.tag("manage_keys", "callback_query", "keys_management", "unit")
@allure.tag("notification", "buttons", "integration", "bot", "auto-renewal")
```

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

–î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- **`@allure.story`** - –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ user stories (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö/E2E —Ç–µ—Å—Ç–æ–≤)
  ```python
  @allure.story("–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–∫—É–ø–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã –∫–∞–±–∏–Ω–µ—Ç–∞")
  ```

- **`@allure.link`** - —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏–ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
  ```python
  @allure.link("http://localhost:3001/docs/guides/testing/template-validation", name="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤")
  ```

- **`@allure.label`** - –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–∫–∏ (owner, component)
  ```python
  @allure.label("owner", "qa-team")
  @allure.label("component", "config")
  ```

#### –í–∫–ª–∞–¥–∫–∞ Behaviors (@allure.story)

**`@allure.story`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤ –≤ –≤–∫–ª–∞–¥–∫–µ **Behaviors** –≤ Allure Report. Story –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –î–ª—è E2E —Ç–µ—Å—Ç–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –î–ª—è unit-—Ç–µ—Å—Ç–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è Story:**
- –ù–∞–∑–≤–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –û–ø–∏—Å—ã–≤–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏

**–ü—Ä–∏–º–µ—Ä—ã Story –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–µ—Å—Ç–æ–≤:**

**–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
```python
@allure.story("–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–∫—É–ø–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã –∫–∞–±–∏–Ω–µ—Ç–∞")
@allure.story("–ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏")
@allure.story("–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ YooKassa")
@allure.story("–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞")
@allure.story("–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤")
```

**–î–ª—è E2E —Ç–µ—Å—Ç–æ–≤:**
```python
@allure.story("–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø–æ–∫—É–ø–∫–∞ VPN")
@allure.story("–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∫–ª—é—á–∞")
@allure.story("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏")
@allure.story("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞")
```

**–î–ª—è unit-—Ç–µ—Å—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤):**
```python
@allure.story("–û–±—Ä–∞–±–æ—Ç–∫–∞ callback query —Å –∏—Å—Ç–µ–∫—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º")
@allure.story("–í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ HTML-—Ç–µ–≥–∞–º–∏")
```

**–í–∞–∂–Ω–æ:**
- –û–¥–∏–Ω —Ç–µ—Å—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `@allure.story`
- Story –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—É—é —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç
- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ story –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
@allure.epic("–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã")
@allure.feature("–ü–ª–∞—Ç–µ–∂–∏")
@pytest.mark.integration
class TestYooKassaFlow:
    @allure.story("–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ YooKassa")
    @allure.title("–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ —á–µ—Ä–µ–∑ YooKassa")
    def test_yookassa_payment_success(self, temp_db):
        # —Ç–µ—Å—Ç
        pass
```

#### –í–∫–ª–∞–¥–∫–∞ Packages (@allure.label("package", "..."))

**`@allure.label("package", "...")`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤ –≤ –≤–∫–ª–∞–¥–∫–µ **Packages** –≤ Allure Report. Package –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–æ–¥—É–ª—å –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –º–æ–¥—É–ª–µ–π

**–ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è Package:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π Python (—Ç–æ—á–∫–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏)
- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `src.` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–ª–∏ `tests.` –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Dark Maximus:**

**–î–ª—è —Ç–µ—Å—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```python
@allure.label("package", "tests.unit.test_database")
@allure.label("package", "src.shop_bot.database")
```

**–î–ª—è —Ç–µ—Å—Ç–æ–≤ –±–æ—Ç–∞:**
```python
@allure.label("package", "tests.unit.test_bot")
@allure.label("package", "src.shop_bot.handlers")
@allure.label("package", "src.shop_bot.keyboards")
```

**–î–ª—è —Ç–µ—Å—Ç–æ–≤ –≤–µ–±-–ø–∞–Ω–µ–ª–∏:**
```python
@allure.label("package", "tests.unit.test_webhook_server")
@allure.label("package", "src.webhook_server")
```

**–î–ª—è —Ç–µ—Å—Ç–æ–≤ —É—Ç–∏–ª–∏—Ç:**
```python
@allure.label("package", "tests.unit.test_utils")
@allure.label("package", "src.shop_bot.utils")
```

**–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
```python
@allure.label("package", "tests.integration")
@allure.label("package", "tests.integration.test_payments")
@allure.label("package", "tests.integration.test_user_cabinet")
```

**–î–ª—è E2E —Ç–µ—Å—Ç–æ–≤:**
```python
@allure.label("package", "tests.e2e")
@allure.label("package", "tests.e2e.test_user_scenarios")
@allure.label("package", "tests.e2e.test_admin_scenarios")
```

**–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ package:**
1. **–î–ª—è unit-—Ç–µ—Å—Ç–æ–≤**: –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–º—É –º–æ–¥—É–ª—é –∏–∑ `src/`
   - `test_user_operations.py` ‚Üí `@allure.label("package", "src.shop_bot.database")`
   - `test_manage_keys_handler.py` ‚Üí `@allure.label("package", "src.shop_bot.handlers")`

2. **–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö/E2E —Ç–µ—Å—Ç–æ–≤**: –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Ç—å –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –º–æ–¥—É–ª—é –∏–∑ `tests/`
   - `test_payments/test_yookassa_flow.py` ‚Üí `@allure.label("package", "tests.integration.test_payments")`
   - `test_user_scenarios/test_new_user_purchase.py` ‚Üí `@allure.label("package", "tests.e2e.test_user_scenarios")`

3. **–î–ª—è —Ç–µ—Å—Ç–æ–≤ —É—Ç–∏–ª–∏—Ç**: –∏—Å–ø–æ–ª—å–∑—É–π –ø—É—Ç—å –∫ –º–æ–¥—É–ª—é —É—Ç–∏–ª–∏—Ç
   - `test_message_templates.py` ‚Üí `@allure.label("package", "src.shop_bot.utils")`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
@allure.epic("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
@allure.feature("–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏")
@allure.label("package", "src.shop_bot.database")
@pytest.mark.unit
@pytest.mark.database
class TestUserOperations:
    @allure.title("–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    def test_user_creation(self, temp_db):
        # —Ç–µ—Å—Ç
        pass
```

**–í–∞–∂–Ω–æ:**
- –û–¥–∏–Ω —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `@allure.label("package", "...")`
- Package –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ—á–∫–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (–∫–∞–∫ –≤ Python –∏–º–ø–æ—Ä—Ç–∞—Ö)
- –î–ª—è —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π, –≤—ã–±–µ—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ —Ç–µ—Å—Ç–∞ (allure.step)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `allure.step()` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É Arrange-Act-Assert.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏
- –ö–æ–≥–¥–∞ —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π
- –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã —à–∞–≥–æ–≤:**
- "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
- "–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ format_tariff_info"
- "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–Ω–æ–π –∏–∫–æ–Ω–∫–∏"
- "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"

**–°–≤—è–∑—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:**
–®–∞–≥–∏ –≤ `allure.step()` –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª–∞–º –≤ `@allure.description`.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
def test_format_tariff_info_normal_key(self):
    with allure.step("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"):
        expiry_date = datetime.now(timezone.utc) + timedelta(days=30)
        allure.attach(str(expiry_date), "–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è", allure.attachment_type.TEXT)
    
    with allure.step("–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ format_tariff_info"):
        result = format_tariff_info(...)
        allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏", allure.attachment_type.JSON)
    
    with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"):
        assert result['status_icon'] == "‚úÖ"
```

#### –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (allure.attach)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `allure.attach()` –¥–ª—è –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫ –æ—Ç—á–µ—Ç—É.

**–¢–∏–ø—ã –≤–ª–æ–∂–µ–Ω–∏–π:**
- `allure.attachment_type.TEXT` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- `allure.attachment_type.JSON` - JSON –¥–∞–Ω–Ω—ã–µ
- `allure.attachment_type.PNG` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã)
- `allure.attachment_type.HTML` - HTML –∫–æ–Ω—Ç–µ–Ω—Ç

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –î–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞
- –î–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
- –î–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –î–ª—è –ª–æ–≥–æ–≤ –∏ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –î–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (–≤ UI —Ç–µ—Å—Ç–∞—Ö)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ü—Ä–∏–∫—Ä–µ–ø–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö `allure.step()`
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π—Ç–µ –æ—Ç—á–µ—Ç—ã - –ø—Ä–∏–∫—Ä–µ–ø–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
with allure.step("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"):
    expiry_date = datetime.now(timezone.utc) + timedelta(days=30)
    allure.attach(str(expiry_date), "–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è", allure.attachment_type.TEXT)

with allure.step("–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏"):
    result = some_function(param1, param2)
    allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏", allure.attachment_type.JSON)
```

#### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å allure.step():**
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –±–ª–æ–∫–∞–º–∏
- –ö–æ–≥–¥–∞ —Ç–µ—Å—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π
- –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å allure.attach():**
- –î–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
- –î–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
- –î–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

**–ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é:**
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã - –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–∑–æ–≤—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `allure.step()` –∏ `allure.attach()` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –°–≤—è–∑—å –º–µ–∂–¥—É –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤ `@allure.description` –∏ —à–∞–≥–∞–º–∏ –≤ `allure.step()` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ–π

**–ö–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ docstring, –∞ –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω @allure.description:**
- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ docstring
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ E2E —Ç–µ—Å—Ç–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@allure.description`
- `@allure.description` –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ Allure –æ—Ç—á–µ—Ç–∞—Ö

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π unit-—Ç–µ—Å—Ç —Å –±–∞–∑–æ–≤—ã–º–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏**

```python
@allure.epic("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞")
@allure.feature("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏")
@allure.label("package", "src.shop_bot.handlers")
@pytest.mark.unit
@pytest.mark.bot
@pytest.mark.database
class TestManageKeysHandler:
    @allure.title("–£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ manage_keys —Å –∫–ª—é—á–∞–º–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    @allure.description("""
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É callback query "manage_keys" –∫–æ–≥–¥–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–ª—é—á–∏.
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –í—ã–∑–æ–≤ callback.answer() –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è callback query
    - –í—ã–∑–æ–≤ callback.message.edit_text() —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
    
    **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - user_id: 123456
    """)
    @allure.severity(allure.severity_level.NORMAL)
    @allure.tag("manage_keys", "callback_query", "keys_management", "unit")
    async def test_manage_keys_success_with_keys(self, temp_db, mock_bot):
        # –¢–µ—Å—Ç
        pass
```

**–ü—Ä–∏–º–µ—Ä 2: Unit-—Ç–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º allure.step() –∏ allure.attach()**

```python
@allure.epic("–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π")
@allure.feature("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞—Ä–∏—Ñ–µ")
@allure.label("package", "src.shop_bot.utils")
@pytest.mark.unit
class TestFormatTariffInfo:
    @allure.title("–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞—Ä–∏—Ñ–µ: –æ–±—ã—á–Ω—ã–π –∫–ª—é—á")
    @allure.description("""
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞—Ä–∏—Ñ–µ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª—é—á–∞.
    
    **–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∞—Å–ø–µ–∫—Ç—ã:**
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–Ω–æ–π –∏–∫–æ–Ω–∫–∏
    - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞
    - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö
    
    **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - host_name: "–§–∏–Ω–ª—è–Ω–¥–∏—è"
    - plan_name: "5. –õ–ö –ü–æ–¥–ø–∏—Å–∫–∞"
    - price: 1.0
    """)
    @allure.severity(allure.severity_level.NORMAL)
    @allure.tag("tariff", "formatting", "unit")
    def test_format_tariff_info_normal_key(self):
        with allure.step("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"):
            expiry_date = datetime.now(timezone.utc) + timedelta(days=30)
            allure.attach(str(expiry_date), "–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è", allure.attachment_type.TEXT)
        
        with allure.step("–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ format_tariff_info"):
            result = format_tariff_info(
                host_name="–§–∏–Ω–ª—è–Ω–¥–∏—è",
                plan_name="5. –õ–ö –ü–æ–¥–ø–∏—Å–∫–∞",
                price=1.0,
                is_trial=False,
                status="pay-active",
                expiry_date=expiry_date
            )
            allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏", allure.attachment_type.JSON)
        
        with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"):
            assert result['status_icon'] == "‚úÖ"
            assert result['price_formatted'] == "1‚ÇΩ"
```

**–ü—Ä–∏–º–µ—Ä 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å @allure.story –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º**

```python
@allure.epic("–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
@allure.feature("–†–µ–∂–∏–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")
@allure.label("package", "tests.integration.test_user_cabinet")
@pytest.mark.integration
class TestCabinetFlow:
    @allure.story("–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–∫—É–ø–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã –∫–∞–±–∏–Ω–µ—Ç–∞")
    @allure.title("–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ —Å —Ä–µ–∂–∏–º–æ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è 'cabinet'")
    @allure.description("""
    –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç".
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —Å —Ä–µ–∂–∏–º–æ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è 'cabinet'
    - –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —Ç–∞—Ä–∏—Ñ–∞
    - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
    - –†–∞–±–æ—Ç–∞ –≤—Å–µ—Ö —Ç—Ä–µ—Ö –≤–∫–ª–∞–¥–æ–∫: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ü–æ–¥–ø–∏—Å–∫–∞, –ü—Ä–æ–≤–µ—Ä–∫–∞ IP
    
    **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - user_id: 123500
    - host_name: 'test_host_cabinet'
    - key_provision_mode: 'cabinet'
    
    **–®–∞–≥–∏ —Ç–µ—Å—Ç–∞:**
    1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —Å —Ä–µ–∂–∏–º–æ–º 'cabinet'
    2. –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —Ç–∞—Ä–∏—Ñ–∞
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
    4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª–∞–¥–∫–∏ '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏'
    5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª–∞–¥–∫–∏ '–ü–æ–¥–ø–∏—Å–∫–∞'
    6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª–∞–¥–∫–∏ '–ü—Ä–æ–≤–µ—Ä–∫–∞ IP'
    
    **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:**
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î (temp_db)
    - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
    - –•–æ—Å—Ç —Å–æ–∑–¥–∞–Ω —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏
    """)
    @allure.severity(allure.severity_level.CRITICAL)
    @allure.tag("cabinet", "provision_mode", "integration", "critical", "full_flow")
    def test_cabinet_provision_mode_flow(self, temp_db):
        # –¢–µ—Å—Ç
        pass
```

**–ü—Ä–∏–º–µ—Ä 4: –ö—Ä–∏—Ç–∏—á–Ω—ã–π —Ç–µ—Å—Ç —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π**

```python
@allure.epic("–í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤")
@allure.feature("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ '–¢–µ–∫—Å—Ç—ã –±–æ—Ç–∞'")
@allure.label("package", "src.shop_bot.database")
@pytest.mark.unit
@pytest.mark.database
class TestTemplateValidation:
    @allure.title("–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å")
    @allure.description("""
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –≤ –ë–î –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å HTML-—Ç–µ–≥–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–≥–æ–≤ <br> (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è Telegram)
    - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    - –í–∞–ª–∏–¥–∞—Ü–∏—è HTML-—Ç–µ–≥–æ–≤ —á–µ—Ä–µ–∑ InputValidator
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —à–∞–±–ª–æ–Ω—ã
    
    **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:**
    - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ HTML –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é fallback –∏–∑ –∫–æ–¥–∞
    - –¢–µ–≥–∏ <br> –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É Telegram API
    """)
    @allure.severity(allure.severity_level.CRITICAL)
    @allure.tag("templates", "validation", "database", "unit", "critical", "message-templates", "html-validation")
    @allure.link("http://localhost:3001/docs/guides/testing/template-validation", name="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤")
    @allure.label("owner", "qa-team")
    @allure.label("component", "config")
    def test_validate_all_templates(self, temp_db):
        # –¢–µ—Å—Ç
        pass
```

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –®–∞–±–ª–æ–Ω unit-—Ç–µ—Å—Ç–∞

```python
import pytest
import allure
from pathlib import Path

@allure.epic("–ù–∞–∑–≤–∞–Ω–∏–µ Epic")
@allure.feature("–ù–∞–∑–≤–∞–Ω–∏–µ Feature")
@allure.label("package", "src.shop_bot.module_name")  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–æ–¥—É–ª—é
@pytest.mark.unit
@pytest.mark.database  # –µ—Å–ª–∏ —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ë–î
class TestExampleFunctionality:
    """–¢–µ—Å—Ç—ã –¥–ª—è example_functionality"""
    
    @allure.title("–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞")
    @allure.description("""
    –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –ê—Å–ø–µ–∫—Ç 1
    - –ê—Å–ø–µ–∫—Ç 2
    - –ê—Å–ø–µ–∫—Ç 3
    
    **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - –ü–∞—Ä–∞–º–µ—Ç—Ä 1: –∑–Ω–∞—á–µ–Ω–∏–µ
    - –ü–∞—Ä–∞–º–µ—Ç—Ä 2: –∑–Ω–∞—á–µ–Ω–∏–µ
    
    **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
    –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
    """)
    @allure.severity(allure.severity_level.NORMAL)
    @allure.tag("functionality", "unit")
    def test_example_functionality(self, temp_db):
        """–¢–µ—Å—Ç example_functionality"""
        with allure.step("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"):
            db = database.Database(str(temp_db))
            test_data = {"key": "value"}
            allure.attach(str(test_data), "–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ", allure.attachment_type.JSON)
        
        with allure.step("–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏"):
            result = db.some_method(test_data)
            allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏", allure.attachment_type.JSON)
        
        with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"):
            assert result is not None
            assert result == expected_value
```

### –®–∞–±–ª–æ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```python
import pytest
import allure

@allure.epic("–ù–∞–∑–≤–∞–Ω–∏–µ Epic")
@allure.feature("–ù–∞–∑–≤–∞–Ω–∏–µ Feature")
@allure.label("package", "tests.integration.test_module_name")  # –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –º–æ–¥—É–ª—é
@pytest.mark.integration
class TestIntegrationFlow:
    """–¢–µ—Å—Ç—ã –¥–ª—è integration_flow"""
    
    @allure.story("–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ")
    @allure.title("–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞")
    @allure.description("""
    –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ 1 —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º 2
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    
    **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
    - –ü–∞—Ä–∞–º–µ—Ç—Ä 1: –∑–Ω–∞—á–µ–Ω–∏–µ
    - –ü–∞—Ä–∞–º–µ—Ç—Ä 2: –∑–Ω–∞—á–µ–Ω–∏–µ
    
    **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:**
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ë–î (temp_db)
    - –ú–æ–∫ –±–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (mock_bot)
    - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
    
    **–®–∞–≥–∏ —Ç–µ—Å—Ç–∞:**
    1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    
    **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
    –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤
    """)
    @allure.severity(allure.severity_level.CRITICAL)
    @allure.tag("integration", "flow", "critical")
    def test_integration_flow(self, temp_db, mock_bot):
        """–¢–µ—Å—Ç integration_flow"""
        with allure.step("–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è"):
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç.–¥.
            user_id = 123456
            allure.attach(str(user_id), "User ID", allure.attachment_type.TEXT)
        
        with allure.step("–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è"):
            # –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –º–µ—Ç–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
            result = some_integration_function(user_id, mock_bot)
            allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏", allure.attachment_type.JSON)
        
        with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"):
            assert result is not None
            assert result['status'] == 'success'
```

### –®–∞–±–ª–æ–Ω –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```python
import pytest
import os
import allure

def is_production_environment() -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Ç–µ—Å—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–∏"""
    env = os.getenv("ENVIRONMENT", "").lower()
    return env == "production"

@allure.epic("–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã")
@allure.feature("–ù–∞–∑–≤–∞–Ω–∏–µ Feature")
@allure.label("package", "tests.integration.test_module_name")
@pytest.mark.integration
@pytest.mark.database
class TestProductionSpecific:
    """–¢–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
    
    @pytest.fixture(autouse=True)
    def check_production_environment(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏–∏"""
        if not is_production_environment():
            pytest.skip(
                "–¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ. "
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ENVIRONMENT=production –≤ .env —Ñ–∞–π–ª–µ"
            )
    
    @allure.story("–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ")
    @allure.title("–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞")
    @allure.description("""
    –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
    - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –ë–î
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    
    **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ .env:**
    - ENVIRONMENT=production - –≤–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç (development/test - –æ—Ç–∫–ª—é—á–∏—Ç—å)
    
    **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:**
    - –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ENVIRONMENT=production –≤ .env
    - –î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
    
    **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
    –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ
    """)
    @allure.severity(allure.severity_level.CRITICAL)
    @allure.tag("production", "integration", "critical")
    def test_production_specific_feature(self):
        """–¢–µ—Å—Ç –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏"""
        with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"):
            assert is_production_environment(), "–¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω–µ"
        
        with allure.step("–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏"):
            # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
            result = check_production_environment()
            allure.attach(str(result), "–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏", allure.attachment_type.JSON)
        
        with allure.step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"):
            assert result['status'] == 'success'
```

### –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–º–µ–Ω

- **–§–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤**: `test_*.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_user_operations.py`)
- **–ö–ª–∞—Å—Å—ã —Ç–µ—Å—Ç–æ–≤**: `Test*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TestUserOperations`)
- **–§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤**: `test_*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_user_creation`)

#### –Ø–∑—ã–∫ –∏–º–µ–Ω

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ò–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π, –∫–ª–∞—Å—Å–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ **–∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ**.

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ò–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π —Ç–µ—Å—Ç–æ–≤ (`test_*`) ‚Äî –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
- –ò–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤ —Ç–µ—Å—Ç–æ–≤ (`Test*`) ‚Äî –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
- –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤ (`test_*.py`) ‚Äî –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
- –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º pytest –∏ Python

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–º–µ–Ω:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ
def test_user_creation(temp_db):
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    pass

class TestUserOperations:
    """–¢–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏"""
    pass

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
def test_—Å–æ–∑–¥–∞–Ω–∏–µ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è(temp_db):  # ‚ùå –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏
    pass

class Test–û–ø–µ—Ä–∞—Ü–∏–∏–°–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:  # ‚ùå –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞
    pass
```

**–°–≤—è–∑—å —Å Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏:**
- –ò–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º ‚Äî –¥–ª—è –∫–æ–¥–∞ –∏ pytest
- `@allure.title` ‚Äî –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ—Ç—á–µ—Ç–∞—Ö)
- `@allure.description` ‚Äî –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)
- `@allure.epic`, `@allure.feature`, `@allure.story` ‚Äî –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –æ—Ç—á–µ—Ç–∞—Ö)

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
@allure.epic("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
@allure.feature("–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏")
@pytest.mark.unit
@pytest.mark.database
class TestUserOperations:  # ‚úÖ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –∏–º—è –∫–ª–∞—Å—Å–∞
    @allure.title("–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")  # ‚úÖ —Ä—É—Å—Å–∫–∏–π title
    @allure.description("""
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
    
    **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
    - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ users
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    """)
    def test_user_creation(self, temp_db):  # ‚úÖ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""  # ‚úÖ —Ä—É—Å—Å–∫–∏–π docstring
        # —Ç–µ—Å—Ç
        pass
```

**Docstrings:**
- Docstrings —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –≠—Ç–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã

## üîß conftest.py –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

- **`temp_db`** - —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é SQLite –ë–î —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–∞–±–ª–∏—Ü
- **`mock_bot`** - –º–æ–∫ –¥–ª—è `aiogram.Bot`
- **`mock_xui_api`** - –º–æ–∫ –¥–ª—è `xui_api`
- **`mock_yookassa`** - –º–æ–∫ –¥–ª—è YooKassa

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
def test_with_db_and_mocks(temp_db, mock_bot, mock_xui_api):
    # temp_db - Path –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ë–î
    # mock_bot, mock_xui_api - –≥–æ—Ç–æ–≤—ã–µ –º–æ–∫–∏
    pass
```

## üìã pytest.ini –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `pytest.ini` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **–∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞** (–Ω–µ –≤ `tests/`), —á—Ç–æ–±—ã pytest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –§–∞–π–ª –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `autotest` —á–µ—Ä–µ–∑ volume-–º–∞–ø–ø–∏–Ω–≥ `./pytest.ini:/app/pytest.ini:ro`.

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- `testpaths = tests` - –ø—É—Ç—å –∫ —Ç–µ—Å—Ç–∞–º
- `python_files = test_*.py` - –ø–∞—Ç—Ç–µ—Ä–Ω —Ñ–∞–π–ª–æ–≤
- `--alluredir=/app/allure-results` - –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è Allure —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
- `asyncio_mode = auto` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ async —Ç–µ—Å—Ç–æ–≤

**–í–∞–∂–Ω–æ:** –ü—É—Ç—å `--alluredir=/app/allure-results` —è–≤–ª—è–µ—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–º –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ù–∞ —Ö–æ—Å—Ç–µ —ç—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ `./allure-results/` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ volume-–º–∞–ø–ø–∏–Ω–≥ –≤ `docker-compose.yml`.

### –ú–∞—Ä–∫–µ—Ä—ã

–í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ `pytest.ini`:

```ini
markers =
    unit: Unit tests (70% coverage)
    integration: Integration tests (20% coverage)
    e2e: End-to-end tests (10% coverage)
    database: Database tests
    bot: Bot tests
    slow: Slow running tests
    asyncio: Async tests
```

## üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–æ

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ë–î `users.db`** –≤ —Ç–µ—Å—Ç–∞—Ö
2. **–í—ã–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ API** (Telegram, –ø–ª–∞—Ç–µ–∂–∏) –±–µ–∑ –º–æ–∫–æ–≤
3. **–°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤** `@pytest.mark.*`
4. **–†–∞–∑–º–µ—â–∞—Ç—å –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –≤ `tests/ad-hoc/`** (—Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã)
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
6. **–ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞–ø—Ä—è–º—É—é** –±–µ–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `autotest` (–≤ production)

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤**: 70% unit, 20% integration, 10% e2e
2. **–ü–æ–∫—Ä—ã—Ç–∏–µ**: —Å—Ç—Ä–µ–º–∏—Å—å –∫ –≤—ã—Å–æ–∫–æ–º—É –ø–æ–∫—Ä—ã—Ç–∏—é –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. **–°–∫–æ—Ä–æ—Å—Ç—å**: unit-—Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±—ã—Å—Ç—Ä—ã–º–∏ (< 1 —Å–µ–∫)
4. **–ò–∑–æ–ª—è—Ü–∏—è**: –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
5. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
6. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –¥–æ–±–∞–≤–ª—è–π docstrings –∫ —Ç–µ—Å—Ç–∞–º –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
7. **Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π Allure –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (@allure.epic, @allure.feature, @allure.title, @allure.description, @allure.severity, @allure.tag). –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ E2E —Ç–µ—Å—Ç–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω @allure.story. –î–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è @allure.label("package", "...")
8. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤**: –∏—Å–ø–æ–ª—å–∑—É–π allure.step() –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É Arrange-Act-Assert
9. **–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –ø—Ä–∏–∫—Ä–µ–ø–ª—è–π –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ allure.attach() –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
10. **Behaviors –∏ Packages**: –∏—Å–ø–æ–ª—å–∑—É–π @allure.story –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ –≤–∫–ª–∞–¥–∫–µ Behaviors (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö/E2E —Ç–µ—Å—Ç–æ–≤) –∏ @allure.label("package", "...") –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ –≤–∫–ª–∞–¥–∫–µ Packages (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤)
11. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏**: –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ENVIRONMENT` –∏–∑ `.env` —Å —Ñ–∏–∫—Å—Ç—É—Ä–æ–π `autouse=True` –∏ `pytest.skip()` –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞ –≤ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** `docs/reports/KAR-29-AUTOTEST-IMPLEMENTATION-PLAN.md`
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–∞–º–∏:** `docs/guides/testing/allure-defects-management.md`
- **Dockerfile.tests:** `Dockerfile.tests`
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤:** `install-autotest.sh`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 17.11.2025
