# agent.md — Правила агента

Кратко и по делу: при любом изменении кода автоматически проверяй и актуализируй `docs/` — добавляй/редактируй разделы, диаграммы (PlantUML, Mermaid), примеры и ссылки. Стиль — простой и понятный. В начале каждого изменённого `.md` — обновляй дату последней редакции.

---

## 1. Changelog (`changelog.md`)
1. Всегда проверяй наличие файла `changelog.md`.
   - Если файл отсутствует — создавай его.
   - Если файл есть — анализируй изменения в проекте и дописывай файл новыми изменениями.

2. Никогда не редактируй существующие записи в `CHANGELOG.md` — даты и версии прошлых записей сохраняются без изменений.

3. **Источник даты для новой записи**
   - Используй текущее время сервера (UTC).
   - Формат даты: `DD.MM.YYYY`.
   - Если в файле уже есть запись с такой же датой — добавь временную метку `HH:MM` (формат: `DD.MM.YYYY HH:MM`).

4. **Версионирование**
   - Найди последнюю строку версии в формате `X.Y.Z – DD.MM.YYYY HH:MM`.
   - Определи bump по приоритету изменений: **Мажор (архитектура) > Минор (новый функционал) > Патч (фиксы/мелкие доработки)**.
     - Если есть хотя бы один «новый функционал» → bump Y (минор) и Z = 0.
     - Если есть «мажорное» изменение (архитектурное, несовместимое) → bump X, Y = 0, Z = 0.
     - Иначе → bump Z (патч).
   - Если версия не найдена — начинай с `0.1.0`.

5. **Вставка записи**
   - Новая запись **вставляется в начало** файла (самая свежая сверху).
   - Не меняй порядок/даты/версии предыдущих записей.

6. **Формат записи**
```
X.Y.Z – DD.MM.YYYY HH:MM
- [Тип изменения] (Область) место — Краткое развернутое описание
- ...
```

7. **Логирование**
   - При автогенерации логируй источник даты (`now UTC`) в CI/логе.
   - Проверь: новая дата либо позже последней, либо та же дата с временем (чтобы избежать коллизий).

---

## 2. Актуализация `docs/`
- При каждом изменении кода проверяй файлы в папке `docs/`.
- Если файлы устарели или требуют дополнения — автоматически актуализируй документацию:
  - добавляй или редактируй разделы;
  - обновляй диаграммы (PlantUML, Mermaid);
  - корректируй примеры и ссылки.
- Стиль документации — простой и понятный, без лишней технической воды.
- В начале каждого изменённого `.md` файла обновляй дату последней редакции.

---

## 3. Рабочие команды и формат раздела "Что сделать, чтобы применить изменения:"
Формат раздела в документации должен быть:

**"Что сделать, чтобы применить изменения:"**
1) `<команда>`
2) `<команда>`
Кратко указать "почему" после каждой команды.

**Логика выбора команд (Docker Compose, сервис `bot`):**
- **Если менял только Python-код** (`src/shop_bot/**`, включая `webhook_server/*.py`, но без зависимостей):
  - `docker compose restart bot`
  - Почему: перезапуск подтянет изменения кода из volume.
- **Если менял шаблоны/статику** (`src/shop_bot/webhook_server/templates/**`, `src/shop_bot/webhook_server/static/**`):
  - Обнови страницу в браузере (Ctrl+F5)
  - При необходимости: `docker compose restart bot`
  - Почему: шаблоны/стили подхватываются из volume; перезапуск нужен только если кэш.
- **Если менял `Dockerfile`:**
  - `docker compose build bot && docker compose up -d bot`
  - Почему: требуется пересборка образа.
- **Если менял зависимости** (`pyproject.toml`):
  - `docker compose down -v && docker compose build bot && docker compose up -d bot`
  - Почему: нужен чистый venv-том и переустановка зависимостей.
- **Если менял `docker-compose.yml`:**
  - `docker compose up -d --build`
  - Почему: применить изменения сервисов/окружения и при необходимости пересобрать.
- **Если менял конфиги, читаемые на старте** (например, `src/shop_bot/config.py`):
  - `docker compose restart bot`
  - Почему: конфиг перечитывается при старте процесса.
- **Если не уверен, какой вариант:**
  - `docker compose up -d --build`
  - Почему: безопасно пересоздаёт контейнер с учётом всех изменений.
- **Для проверки результата/ошибок всегда добавлять:**
  - `docker compose logs -f bot`

---

## 4. Терминал — задержка перед чтением вывода
- Всегда при выполнении команд в терминале вставляй небольшую задержку (например, `0.5–1` секунду) **перед** тем, как анализировать вывод.
- Если команда завершается мгновенно — всё равно жди этот `delay`, чтобы успеть перехватить результат.
- Если команда требует интерактивного ввода — **не** добавляй задержку.

---

## 5. Язык общения
- Всегда используй **русский язык** для общения, комментариев, описаний и объяснений.
- Не использовать английский, даже если исходный код или документация на английском.
- Всё обсуждение, пояснения, ответы на вопросы — только на русском языке.
- Если случайно написал сообщение на английском — перепиши его на русском и продолжай диалог только на русском.

---

## 6. Cursor Rule: Add tooltips to all UI elements
- **Всегда** добавляй подсказку (tooltip / hover hint) ко всем интерактивным элементам UI:
  - Кнопки
  - Поля ввода (text, select, checkbox, radio и т.д.)
  - Ссылки
  - Иконки
  - Элементы навигации
- Tooltip должен ясно и кратко описывать функцию элемента.
- Используй стандартный подход для выбранного фреймворка:
  - Plain HTML → `title="..."`
  - React + MUI → обернуть элемент в `<Tooltip title="..."> ... </Tooltip>`
  - Bootstrap → `data-bs-toggle="tooltip" title="..."`
- Текст tooltip должен быть в формате:
  - Для кнопок — глагол действия (например: `Добавить сервер`)
  - Для полей ввода — цель (например: `Введите название хоста`)
  - Для иконок — объяснение (например: `Настройки пользователя`)
- Не пропускать ни один элемент, даже если его значение кажется очевидным.

---

## 7. Формат раздела и образцы
(Повторение формата для единообразия документации)

**Формат записи в changelog:**
`X.Y.Z – DD.MM.YYYY HH:MM`
`- [Тип изменения] (Область) место — Краткое развернутое описание`

**Формат раздела "Что сделать, чтобы применить изменения":**
1) `<команда>` — Почему: `<коротко>`

---

## 8. Дизайн-система (Material-UI)
- Всегда использовать **Material-UI (MUI)** как основную дизайн-систему.
- Все новые интерфейсы, компоненты и стили должны базироваться на компонентах из `@mui/material` и `@mui/icons-material`.
- Не использовать кастомные CSS-классы, если аналог можно сделать средствами MUI.
- Для верстки использовать `Box`, `Grid`, `Stack`.
- Для темизации использовать `ThemeProvider` и `createTheme`, придерживаясь единого стиля оформления.
- Все новые компоненты обязаны соответствовать гайдлайнам MUI: отступы, цвета, размеры брать из темы.

---

## 9. Заключение — поведение агента
- Автоматизировать проверки и обновления `docs/` при изменениях кода.
- Всегда логировать дату/источник (UTC) при автогенерации changelog.
- Всегда следовать правилам деплоя/рестарта, приведённым в разделе «Что сделать...».
- Всегда использовать русский язык.
- Всегда добавлять tooltip ко всем интерактивным элементам.
- Всегда использовать MUI для новых интерфейсов.

---

Готово. Этот документ можно сохранить как `agent.md` и разместить в корне репозитория или в `docs/` по вашему усмотрению. Если нужны правки, сокращения или версия в другом формате — внесу быстро.

